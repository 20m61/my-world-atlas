function nm(A,D){for(var z=0;z<D.length;z++){const j=D[z];if(typeof j!="string"&&!Array.isArray(j)){for(const Y in j)if(Y!=="default"&&!(Y in A)){const ce=Object.getOwnPropertyDescriptor(j,Y);ce&&Object.defineProperty(A,Y,ce.get?ce:{enumerable:!0,get:()=>j[Y]})}}}return Object.freeze(Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}))}(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const Y of document.querySelectorAll('link[rel="modulepreload"]'))j(Y);new MutationObserver(Y=>{for(const ce of Y)if(ce.type==="childList")for(const xe of ce.addedNodes)xe.tagName==="LINK"&&xe.rel==="modulepreload"&&j(xe)}).observe(document,{childList:!0,subtree:!0});function z(Y){const ce={};return Y.integrity&&(ce.integrity=Y.integrity),Y.referrerPolicy&&(ce.referrerPolicy=Y.referrerPolicy),Y.crossOrigin==="use-credentials"?ce.credentials="include":Y.crossOrigin==="anonymous"?ce.credentials="omit":ce.credentials="same-origin",ce}function j(Y){if(Y.ep)return;Y.ep=!0;const ce=z(Y);fetch(Y.href,ce)}})();function ed(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var _p={exports:{}},Xh={},vp={exports:{}},Cr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jp;function sm(){if(Jp)return Cr;Jp=1;var A=Symbol.for("react.element"),D=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),Y=Symbol.for("react.profiler"),ce=Symbol.for("react.provider"),xe=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),ye=Symbol.for("react.suspense"),$=Symbol.for("react.memo"),Le=Symbol.for("react.lazy"),Me=Symbol.iterator;function Ce(ae){return ae===null||typeof ae!="object"?null:(ae=Me&&ae[Me]||ae["@@iterator"],typeof ae=="function"?ae:null)}var xt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Je=Object.assign,at={};function je(ae,Pe,Ne){this.props=ae,this.context=Pe,this.refs=at,this.updater=Ne||xt}je.prototype.isReactComponent={},je.prototype.setState=function(ae,Pe){if(typeof ae!="object"&&typeof ae!="function"&&ae!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ae,Pe,"setState")},je.prototype.forceUpdate=function(ae){this.updater.enqueueForceUpdate(this,ae,"forceUpdate")};function pt(){}pt.prototype=je.prototype;function Lt(ae,Pe,Ne){this.props=ae,this.context=Pe,this.refs=at,this.updater=Ne||xt}var Ot=Lt.prototype=new pt;Ot.constructor=Lt,Je(Ot,je.prototype),Ot.isPureReactComponent=!0;var Ut=Array.isArray,Dt=Object.prototype.hasOwnProperty,Rt={current:null},ft={key:!0,ref:!0,__self:!0,__source:!0};function le(ae,Pe,Ne){var wt,Nt={},Zt=null,lr=null;if(Pe!=null)for(wt in Pe.ref!==void 0&&(lr=Pe.ref),Pe.key!==void 0&&(Zt=""+Pe.key),Pe)Dt.call(Pe,wt)&&!ft.hasOwnProperty(wt)&&(Nt[wt]=Pe[wt]);var _t=arguments.length-2;if(_t===1)Nt.children=Ne;else if(1<_t){for(var Ct=Array(_t),rr=0;rr<_t;rr++)Ct[rr]=arguments[rr+2];Nt.children=Ct}if(ae&&ae.defaultProps)for(wt in _t=ae.defaultProps,_t)Nt[wt]===void 0&&(Nt[wt]=_t[wt]);return{$$typeof:A,type:ae,key:Zt,ref:lr,props:Nt,_owner:Rt.current}}function ve(ae,Pe){return{$$typeof:A,type:ae.type,key:Pe,ref:ae.ref,props:ae.props,_owner:ae._owner}}function Ae(ae){return typeof ae=="object"&&ae!==null&&ae.$$typeof===A}function mt(ae){var Pe={"=":"=0",":":"=2"};return"$"+ae.replace(/[=:]/g,function(Ne){return Pe[Ne]})}var ot=/\/+/g;function ct(ae,Pe){return typeof ae=="object"&&ae!==null&&ae.key!=null?mt(""+ae.key):Pe.toString(36)}function Wt(ae,Pe,Ne,wt,Nt){var Zt=typeof ae;(Zt==="undefined"||Zt==="boolean")&&(ae=null);var lr=!1;if(ae===null)lr=!0;else switch(Zt){case"string":case"number":lr=!0;break;case"object":switch(ae.$$typeof){case A:case D:lr=!0}}if(lr)return lr=ae,Nt=Nt(lr),ae=wt===""?"."+ct(lr,0):wt,Ut(Nt)?(Ne="",ae!=null&&(Ne=ae.replace(ot,"$&/")+"/"),Wt(Nt,Pe,Ne,"",function(rr){return rr})):Nt!=null&&(Ae(Nt)&&(Nt=ve(Nt,Ne+(!Nt.key||lr&&lr.key===Nt.key?"":(""+Nt.key).replace(ot,"$&/")+"/")+ae)),Pe.push(Nt)),1;if(lr=0,wt=wt===""?".":wt+":",Ut(ae))for(var _t=0;_t<ae.length;_t++){Zt=ae[_t];var Ct=wt+ct(Zt,_t);lr+=Wt(Zt,Pe,Ne,Ct,Nt)}else if(Ct=Ce(ae),typeof Ct=="function")for(ae=Ct.call(ae),_t=0;!(Zt=ae.next()).done;)Zt=Zt.value,Ct=wt+ct(Zt,_t++),lr+=Wt(Zt,Pe,Ne,Ct,Nt);else if(Zt==="object")throw Pe=String(ae),Error("Objects are not valid as a React child (found: "+(Pe==="[object Object]"?"object with keys {"+Object.keys(ae).join(", ")+"}":Pe)+"). If you meant to render a collection of children, use an array instead.");return lr}function dr(ae,Pe,Ne){if(ae==null)return ae;var wt=[],Nt=0;return Wt(ae,wt,"","",function(Zt){return Pe.call(Ne,Zt,Nt++)}),wt}function pr(ae){if(ae._status===-1){var Pe=ae._result;Pe=Pe(),Pe.then(function(Ne){(ae._status===0||ae._status===-1)&&(ae._status=1,ae._result=Ne)},function(Ne){(ae._status===0||ae._status===-1)&&(ae._status=2,ae._result=Ne)}),ae._status===-1&&(ae._status=0,ae._result=Pe)}if(ae._status===1)return ae._result.default;throw ae._result}var yt={current:null},Ue={transition:null},Xe={ReactCurrentDispatcher:yt,ReactCurrentBatchConfig:Ue,ReactCurrentOwner:Rt};function nt(){throw Error("act(...) is not supported in production builds of React.")}return Cr.Children={map:dr,forEach:function(ae,Pe,Ne){dr(ae,function(){Pe.apply(this,arguments)},Ne)},count:function(ae){var Pe=0;return dr(ae,function(){Pe++}),Pe},toArray:function(ae){return dr(ae,function(Pe){return Pe})||[]},only:function(ae){if(!Ae(ae))throw Error("React.Children.only expected to receive a single React element child.");return ae}},Cr.Component=je,Cr.Fragment=z,Cr.Profiler=Y,Cr.PureComponent=Lt,Cr.StrictMode=j,Cr.Suspense=ye,Cr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xe,Cr.act=nt,Cr.cloneElement=function(ae,Pe,Ne){if(ae==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ae+".");var wt=Je({},ae.props),Nt=ae.key,Zt=ae.ref,lr=ae._owner;if(Pe!=null){if(Pe.ref!==void 0&&(Zt=Pe.ref,lr=Rt.current),Pe.key!==void 0&&(Nt=""+Pe.key),ae.type&&ae.type.defaultProps)var _t=ae.type.defaultProps;for(Ct in Pe)Dt.call(Pe,Ct)&&!ft.hasOwnProperty(Ct)&&(wt[Ct]=Pe[Ct]===void 0&&_t!==void 0?_t[Ct]:Pe[Ct])}var Ct=arguments.length-2;if(Ct===1)wt.children=Ne;else if(1<Ct){_t=Array(Ct);for(var rr=0;rr<Ct;rr++)_t[rr]=arguments[rr+2];wt.children=_t}return{$$typeof:A,type:ae.type,key:Nt,ref:Zt,props:wt,_owner:lr}},Cr.createContext=function(ae){return ae={$$typeof:xe,_currentValue:ae,_currentValue2:ae,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ae.Provider={$$typeof:ce,_context:ae},ae.Consumer=ae},Cr.createElement=le,Cr.createFactory=function(ae){var Pe=le.bind(null,ae);return Pe.type=ae,Pe},Cr.createRef=function(){return{current:null}},Cr.forwardRef=function(ae){return{$$typeof:c,render:ae}},Cr.isValidElement=Ae,Cr.lazy=function(ae){return{$$typeof:Le,_payload:{_status:-1,_result:ae},_init:pr}},Cr.memo=function(ae,Pe){return{$$typeof:$,type:ae,compare:Pe===void 0?null:Pe}},Cr.startTransition=function(ae){var Pe=Ue.transition;Ue.transition={};try{ae()}finally{Ue.transition=Pe}},Cr.unstable_act=nt,Cr.useCallback=function(ae,Pe){return yt.current.useCallback(ae,Pe)},Cr.useContext=function(ae){return yt.current.useContext(ae)},Cr.useDebugValue=function(){},Cr.useDeferredValue=function(ae){return yt.current.useDeferredValue(ae)},Cr.useEffect=function(ae,Pe){return yt.current.useEffect(ae,Pe)},Cr.useId=function(){return yt.current.useId()},Cr.useImperativeHandle=function(ae,Pe,Ne){return yt.current.useImperativeHandle(ae,Pe,Ne)},Cr.useInsertionEffect=function(ae,Pe){return yt.current.useInsertionEffect(ae,Pe)},Cr.useLayoutEffect=function(ae,Pe){return yt.current.useLayoutEffect(ae,Pe)},Cr.useMemo=function(ae,Pe){return yt.current.useMemo(ae,Pe)},Cr.useReducer=function(ae,Pe,Ne){return yt.current.useReducer(ae,Pe,Ne)},Cr.useRef=function(ae){return yt.current.useRef(ae)},Cr.useState=function(ae){return yt.current.useState(ae)},Cr.useSyncExternalStore=function(ae,Pe,Ne){return yt.current.useSyncExternalStore(ae,Pe,Ne)},Cr.useTransition=function(){return yt.current.useTransition()},Cr.version="18.3.1",Cr}var Qp;function td(){return Qp||(Qp=1,vp.exports=sm()),vp.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ef;function am(){if(ef)return Xh;ef=1;var A=td(),D=Symbol.for("react.element"),z=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,Y=A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ce={key:!0,ref:!0,__self:!0,__source:!0};function xe(c,ye,$){var Le,Me={},Ce=null,xt=null;$!==void 0&&(Ce=""+$),ye.key!==void 0&&(Ce=""+ye.key),ye.ref!==void 0&&(xt=ye.ref);for(Le in ye)j.call(ye,Le)&&!ce.hasOwnProperty(Le)&&(Me[Le]=ye[Le]);if(c&&c.defaultProps)for(Le in ye=c.defaultProps,ye)Me[Le]===void 0&&(Me[Le]=ye[Le]);return{$$typeof:D,type:c,key:Ce,ref:xt,props:Me,_owner:Y.current}}return Xh.Fragment=z,Xh.jsx=xe,Xh.jsxs=xe,Xh}var tf;function om(){return tf||(tf=1,_p.exports=am()),_p.exports}var Ke=om(),$e=td();const Kd=ed($e),lm=nm({__proto__:null,default:Kd},[$e]);var $d={},xp={exports:{}},Ls={},wp={exports:{}},bp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rf;function um(){return rf||(rf=1,function(A){function D(Ue,Xe){var nt=Ue.length;Ue.push(Xe);e:for(;0<nt;){var ae=nt-1>>>1,Pe=Ue[ae];if(0<Y(Pe,Xe))Ue[ae]=Xe,Ue[nt]=Pe,nt=ae;else break e}}function z(Ue){return Ue.length===0?null:Ue[0]}function j(Ue){if(Ue.length===0)return null;var Xe=Ue[0],nt=Ue.pop();if(nt!==Xe){Ue[0]=nt;e:for(var ae=0,Pe=Ue.length,Ne=Pe>>>1;ae<Ne;){var wt=2*(ae+1)-1,Nt=Ue[wt],Zt=wt+1,lr=Ue[Zt];if(0>Y(Nt,nt))Zt<Pe&&0>Y(lr,Nt)?(Ue[ae]=lr,Ue[Zt]=nt,ae=Zt):(Ue[ae]=Nt,Ue[wt]=nt,ae=wt);else if(Zt<Pe&&0>Y(lr,nt))Ue[ae]=lr,Ue[Zt]=nt,ae=Zt;else break e}}return Xe}function Y(Ue,Xe){var nt=Ue.sortIndex-Xe.sortIndex;return nt!==0?nt:Ue.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ce=performance;A.unstable_now=function(){return ce.now()}}else{var xe=Date,c=xe.now();A.unstable_now=function(){return xe.now()-c}}var ye=[],$=[],Le=1,Me=null,Ce=3,xt=!1,Je=!1,at=!1,je=typeof setTimeout=="function"?setTimeout:null,pt=typeof clearTimeout=="function"?clearTimeout:null,Lt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ot(Ue){for(var Xe=z($);Xe!==null;){if(Xe.callback===null)j($);else if(Xe.startTime<=Ue)j($),Xe.sortIndex=Xe.expirationTime,D(ye,Xe);else break;Xe=z($)}}function Ut(Ue){if(at=!1,Ot(Ue),!Je)if(z(ye)!==null)Je=!0,pr(Dt);else{var Xe=z($);Xe!==null&&yt(Ut,Xe.startTime-Ue)}}function Dt(Ue,Xe){Je=!1,at&&(at=!1,pt(le),le=-1),xt=!0;var nt=Ce;try{for(Ot(Xe),Me=z(ye);Me!==null&&(!(Me.expirationTime>Xe)||Ue&&!mt());){var ae=Me.callback;if(typeof ae=="function"){Me.callback=null,Ce=Me.priorityLevel;var Pe=ae(Me.expirationTime<=Xe);Xe=A.unstable_now(),typeof Pe=="function"?Me.callback=Pe:Me===z(ye)&&j(ye),Ot(Xe)}else j(ye);Me=z(ye)}if(Me!==null)var Ne=!0;else{var wt=z($);wt!==null&&yt(Ut,wt.startTime-Xe),Ne=!1}return Ne}finally{Me=null,Ce=nt,xt=!1}}var Rt=!1,ft=null,le=-1,ve=5,Ae=-1;function mt(){return!(A.unstable_now()-Ae<ve)}function ot(){if(ft!==null){var Ue=A.unstable_now();Ae=Ue;var Xe=!0;try{Xe=ft(!0,Ue)}finally{Xe?ct():(Rt=!1,ft=null)}}else Rt=!1}var ct;if(typeof Lt=="function")ct=function(){Lt(ot)};else if(typeof MessageChannel<"u"){var Wt=new MessageChannel,dr=Wt.port2;Wt.port1.onmessage=ot,ct=function(){dr.postMessage(null)}}else ct=function(){je(ot,0)};function pr(Ue){ft=Ue,Rt||(Rt=!0,ct())}function yt(Ue,Xe){le=je(function(){Ue(A.unstable_now())},Xe)}A.unstable_IdlePriority=5,A.unstable_ImmediatePriority=1,A.unstable_LowPriority=4,A.unstable_NormalPriority=3,A.unstable_Profiling=null,A.unstable_UserBlockingPriority=2,A.unstable_cancelCallback=function(Ue){Ue.callback=null},A.unstable_continueExecution=function(){Je||xt||(Je=!0,pr(Dt))},A.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ve=0<Ue?Math.floor(1e3/Ue):5},A.unstable_getCurrentPriorityLevel=function(){return Ce},A.unstable_getFirstCallbackNode=function(){return z(ye)},A.unstable_next=function(Ue){switch(Ce){case 1:case 2:case 3:var Xe=3;break;default:Xe=Ce}var nt=Ce;Ce=Xe;try{return Ue()}finally{Ce=nt}},A.unstable_pauseExecution=function(){},A.unstable_requestPaint=function(){},A.unstable_runWithPriority=function(Ue,Xe){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var nt=Ce;Ce=Ue;try{return Xe()}finally{Ce=nt}},A.unstable_scheduleCallback=function(Ue,Xe,nt){var ae=A.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?ae+nt:ae):nt=ae,Ue){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=nt+Pe,Ue={id:Le++,callback:Xe,priorityLevel:Ue,startTime:nt,expirationTime:Pe,sortIndex:-1},nt>ae?(Ue.sortIndex=nt,D($,Ue),z(ye)===null&&Ue===z($)&&(at?(pt(le),le=-1):at=!0,yt(Ut,nt-ae))):(Ue.sortIndex=Pe,D(ye,Ue),Je||xt||(Je=!0,pr(Dt))),Ue},A.unstable_shouldYield=mt,A.unstable_wrapCallback=function(Ue){var Xe=Ce;return function(){var nt=Ce;Ce=Xe;try{return Ue.apply(this,arguments)}finally{Ce=nt}}}}(bp)),bp}var nf;function cm(){return nf||(nf=1,wp.exports=um()),wp.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sf;function hm(){if(sf)return Ls;sf=1;var A=td(),D=cm();function z(n){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+n,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+n+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var j=new Set,Y={};function ce(n,a){xe(n,a),xe(n+"Capture",a)}function xe(n,a){for(Y[n]=a,n=0;n<a.length;n++)j.add(a[n])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ye=Object.prototype.hasOwnProperty,$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Le={},Me={};function Ce(n){return ye.call(Me,n)?!0:ye.call(Le,n)?!1:$.test(n)?Me[n]=!0:(Le[n]=!0,!1)}function xt(n,a,d,y){if(d!==null&&d.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return y?!1:d!==null?!d.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Je(n,a,d,y){if(a===null||typeof a>"u"||xt(n,a,d,y))return!0;if(y)return!1;if(d!==null)switch(d.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function at(n,a,d,y,b,T,O){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=y,this.attributeNamespace=b,this.mustUseProperty=d,this.propertyName=n,this.type=a,this.sanitizeURL=T,this.removeEmptyString=O}var je={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){je[n]=new at(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var a=n[0];je[a]=new at(a,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){je[n]=new at(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){je[n]=new at(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){je[n]=new at(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){je[n]=new at(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){je[n]=new at(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){je[n]=new at(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){je[n]=new at(n,5,!1,n.toLowerCase(),null,!1,!1)});var pt=/[\-:]([a-z])/g;function Lt(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var a=n.replace(pt,Lt);je[a]=new at(a,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var a=n.replace(pt,Lt);je[a]=new at(a,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var a=n.replace(pt,Lt);je[a]=new at(a,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){je[n]=new at(n,1,!1,n.toLowerCase(),null,!1,!1)}),je.xlinkHref=new at("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){je[n]=new at(n,1,!1,n.toLowerCase(),null,!0,!0)});function Ot(n,a,d,y){var b=je.hasOwnProperty(a)?je[a]:null;(b!==null?b.type!==0:y||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Je(a,d,b,y)&&(d=null),y||b===null?Ce(a)&&(d===null?n.removeAttribute(a):n.setAttribute(a,""+d)):b.mustUseProperty?n[b.propertyName]=d===null?b.type===3?!1:"":d:(a=b.attributeName,y=b.attributeNamespace,d===null?n.removeAttribute(a):(b=b.type,d=b===3||b===4&&d===!0?"":""+d,y?n.setAttributeNS(y,a,d):n.setAttribute(a,d))))}var Ut=A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Dt=Symbol.for("react.element"),Rt=Symbol.for("react.portal"),ft=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),ve=Symbol.for("react.profiler"),Ae=Symbol.for("react.provider"),mt=Symbol.for("react.context"),ot=Symbol.for("react.forward_ref"),ct=Symbol.for("react.suspense"),Wt=Symbol.for("react.suspense_list"),dr=Symbol.for("react.memo"),pr=Symbol.for("react.lazy"),yt=Symbol.for("react.offscreen"),Ue=Symbol.iterator;function Xe(n){return n===null||typeof n!="object"?null:(n=Ue&&n[Ue]||n["@@iterator"],typeof n=="function"?n:null)}var nt=Object.assign,ae;function Pe(n){if(ae===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);ae=a&&a[1]||""}return`
`+ae+n}var Ne=!1;function wt(n,a){if(!n||Ne)return"";Ne=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(Ie){var y=Ie}Reflect.construct(n,[],a)}else{try{a.call()}catch(Ie){y=Ie}n.call(a.prototype)}else{try{throw Error()}catch(Ie){y=Ie}n()}}catch(Ie){if(Ie&&y&&typeof Ie.stack=="string"){for(var b=Ie.stack.split(`
`),T=y.stack.split(`
`),O=b.length-1,re=T.length-1;1<=O&&0<=re&&b[O]!==T[re];)re--;for(;1<=O&&0<=re;O--,re--)if(b[O]!==T[re]){if(O!==1||re!==1)do if(O--,re--,0>re||b[O]!==T[re]){var ue=`
`+b[O].replace(" at new "," at ");return n.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",n.displayName)),ue}while(1<=O&&0<=re);break}}}finally{Ne=!1,Error.prepareStackTrace=d}return(n=n?n.displayName||n.name:"")?Pe(n):""}function Nt(n){switch(n.tag){case 5:return Pe(n.type);case 16:return Pe("Lazy");case 13:return Pe("Suspense");case 19:return Pe("SuspenseList");case 0:case 2:case 15:return n=wt(n.type,!1),n;case 11:return n=wt(n.type.render,!1),n;case 1:return n=wt(n.type,!0),n;default:return""}}function Zt(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ft:return"Fragment";case Rt:return"Portal";case ve:return"Profiler";case le:return"StrictMode";case ct:return"Suspense";case Wt:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case mt:return(n.displayName||"Context")+".Consumer";case Ae:return(n._context.displayName||"Context")+".Provider";case ot:var a=n.render;return n=n.displayName,n||(n=a.displayName||a.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case dr:return a=n.displayName||null,a!==null?a:Zt(n.type)||"Memo";case pr:a=n._payload,n=n._init;try{return Zt(n(a))}catch{}}return null}function lr(n){var a=n.type;switch(n.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=a.render,n=n.displayName||n.name||"",a.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zt(a);case 8:return a===le?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function _t(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ct(n){var a=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function rr(n){var a=Ct(n)?"checked":"value",d=Object.getOwnPropertyDescriptor(n.constructor.prototype,a),y=""+n[a];if(!n.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,T=d.set;return Object.defineProperty(n,a,{configurable:!0,get:function(){return b.call(this)},set:function(O){y=""+O,T.call(this,O)}}),Object.defineProperty(n,a,{enumerable:d.enumerable}),{getValue:function(){return y},setValue:function(O){y=""+O},stopTracking:function(){n._valueTracker=null,delete n[a]}}}}function ir(n){n._valueTracker||(n._valueTracker=rr(n))}function Tr(n){if(!n)return!1;var a=n._valueTracker;if(!a)return!0;var d=a.getValue(),y="";return n&&(y=Ct(n)?n.checked?"true":"false":n.value),n=y,n!==d?(a.setValue(n),!0):!1}function Nr(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vr(n,a){var d=a.checked;return nt({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??n._wrapperState.initialChecked})}function xr(n,a){var d=a.defaultValue==null?"":a.defaultValue,y=a.checked!=null?a.checked:a.defaultChecked;d=_t(a.value!=null?a.value:d),n._wrapperState={initialChecked:y,initialValue:d,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function nr(n,a){a=a.checked,a!=null&&Ot(n,"checked",a,!1)}function Vr(n,a){nr(n,a);var d=_t(a.value),y=a.type;if(d!=null)y==="number"?(d===0&&n.value===""||n.value!=d)&&(n.value=""+d):n.value!==""+d&&(n.value=""+d);else if(y==="submit"||y==="reset"){n.removeAttribute("value");return}a.hasOwnProperty("value")?Er(n,a.type,d):a.hasOwnProperty("defaultValue")&&Er(n,a.type,_t(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(n.defaultChecked=!!a.defaultChecked)}function fr(n,a,d){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var y=a.type;if(!(y!=="submit"&&y!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+n._wrapperState.initialValue,d||a===n.value||(n.value=a),n.defaultValue=a}d=n.name,d!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,d!==""&&(n.name=d)}function Er(n,a,d){(a!=="number"||Nr(n.ownerDocument)!==n)&&(d==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+d&&(n.defaultValue=""+d))}var Te=Array.isArray;function Wr(n,a,d,y){if(n=n.options,a){a={};for(var b=0;b<d.length;b++)a["$"+d[b]]=!0;for(d=0;d<n.length;d++)b=a.hasOwnProperty("$"+n[d].value),n[d].selected!==b&&(n[d].selected=b),b&&y&&(n[d].defaultSelected=!0)}else{for(d=""+_t(d),a=null,b=0;b<n.length;b++){if(n[b].value===d){n[b].selected=!0,y&&(n[b].defaultSelected=!0);return}a!==null||n[b].disabled||(a=n[b])}a!==null&&(a.selected=!0)}}function Jr(n,a){if(a.dangerouslySetInnerHTML!=null)throw Error(z(91));return nt({},a,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function kr(n,a){var d=a.value;if(d==null){if(d=a.children,a=a.defaultValue,d!=null){if(a!=null)throw Error(z(92));if(Te(d)){if(1<d.length)throw Error(z(93));d=d[0]}a=d}a==null&&(a=""),d=a}n._wrapperState={initialValue:_t(d)}}function Kt(n,a){var d=_t(a.value),y=_t(a.defaultValue);d!=null&&(d=""+d,d!==n.value&&(n.value=d),a.defaultValue==null&&n.defaultValue!==d&&(n.defaultValue=d)),y!=null&&(n.defaultValue=""+y)}function ui(n){var a=n.textContent;a===n._wrapperState.initialValue&&a!==""&&a!==null&&(n.value=a)}function Hr(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kr(n,a){return n==null||n==="http://www.w3.org/1999/xhtml"?Hr(a):n==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Ui,Qn=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,d,y,b){MSApp.execUnsafeLocalFunction(function(){return n(a,d,y,b)})}:n}(function(n,a){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=a;else{for(Ui=Ui||document.createElement("div"),Ui.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Ui.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;a.firstChild;)n.appendChild(a.firstChild)}});function un(n,a){if(a){var d=n.firstChild;if(d&&d===n.lastChild&&d.nodeType===3){d.nodeValue=a;return}}n.textContent=a}var Ai={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ge=["Webkit","ms","Moz","O"];Object.keys(Ai).forEach(function(n){Ge.forEach(function(a){a=a+n.charAt(0).toUpperCase()+n.substring(1),Ai[a]=Ai[n]})});function $i(n,a,d){return a==null||typeof a=="boolean"||a===""?"":d||typeof a!="number"||a===0||Ai.hasOwnProperty(n)&&Ai[n]?(""+a).trim():a+"px"}function jr(n,a){n=n.style;for(var d in a)if(a.hasOwnProperty(d)){var y=d.indexOf("--")===0,b=$i(d,a[d],y);d==="float"&&(d="cssFloat"),y?n.setProperty(d,b):n[d]=b}}var xa=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function es(n,a){if(a){if(xa[n]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(z(137,n));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(z(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(z(61))}if(a.style!=null&&typeof a.style!="object")throw Error(z(62))}}function Qe(n,a){if(n.indexOf("-")===-1)return typeof a.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sr=null;function Jt(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var qi=null,cn=null,Qt=null;function ms(n){if(n=Us(n)){if(typeof qi!="function")throw Error(z(280));var a=n.stateNode;a&&(a=Co(a),qi(n.stateNode,n.type,a))}}function H(n){cn?Qt?Qt.push(n):Qt=[n]:cn=n}function L(){if(cn){var n=cn,a=Qt;if(Qt=cn=null,ms(n),a)for(n=0;n<a.length;n++)ms(a[n])}}function F(n,a){return n(a)}function U(){}var X=!1;function Q(n,a,d){if(X)return n(a,d);X=!0;try{return F(n,a,d)}finally{X=!1,(cn!==null||Qt!==null)&&(U(),L())}}function me(n,a){var d=n.stateNode;if(d===null)return null;var y=Co(d);if(y===null)return null;d=y[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(n=n.type,y=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!y;break e;default:n=!1}if(n)return null;if(d&&typeof d!="function")throw Error(z(231,a,typeof d));return d}var se=!1;if(c)try{var te={};Object.defineProperty(te,"passive",{get:function(){se=!0}}),window.addEventListener("test",te,te),window.removeEventListener("test",te,te)}catch{se=!1}function pe(n,a,d,y,b,T,O,re,ue){var Ie=Array.prototype.slice.call(arguments,3);try{a.apply(d,Ie)}catch(We){this.onError(We)}}var ze=!1,Re=null,Be=!1,At=null,Xt={onError:function(n){ze=!0,Re=n}};function St(n,a,d,y,b,T,O,re,ue){ze=!1,Re=null,pe.apply(Xt,arguments)}function Ft(n,a,d,y,b,T,O,re,ue){if(St.apply(this,arguments),ze){if(ze){var Ie=Re;ze=!1,Re=null}else throw Error(z(198));Be||(Be=!0,At=Ie)}}function Gt(n){var a=n,d=n;if(n.alternate)for(;a.return;)a=a.return;else{n=a;do a=n,(a.flags&4098)!==0&&(d=a.return),n=a.return;while(n)}return a.tag===3?d:null}function Ir(n){if(n.tag===13){var a=n.memoizedState;if(a===null&&(n=n.alternate,n!==null&&(a=n.memoizedState)),a!==null)return a.dehydrated}return null}function zr(n){if(Gt(n)!==n)throw Error(z(188))}function wr(n){var a=n.alternate;if(!a){if(a=Gt(n),a===null)throw Error(z(188));return a!==n?null:n}for(var d=n,y=a;;){var b=d.return;if(b===null)break;var T=b.alternate;if(T===null){if(y=b.return,y!==null){d=y;continue}break}if(b.child===T.child){for(T=b.child;T;){if(T===d)return zr(b),n;if(T===y)return zr(b),a;T=T.sibling}throw Error(z(188))}if(d.return!==y.return)d=b,y=T;else{for(var O=!1,re=b.child;re;){if(re===d){O=!0,d=b,y=T;break}if(re===y){O=!0,y=b,d=T;break}re=re.sibling}if(!O){for(re=T.child;re;){if(re===d){O=!0,d=T,y=b;break}if(re===y){O=!0,y=T,d=b;break}re=re.sibling}if(!O)throw Error(z(189))}}if(d.alternate!==y)throw Error(z(190))}if(d.tag!==3)throw Error(z(188));return d.stateNode.current===d?n:a}function yr(n){return n=wr(n),n!==null?Zi(n):null}function Zi(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var a=Zi(n);if(a!==null)return a;n=n.sibling}return null}var Br=D.unstable_scheduleCallback,yi=D.unstable_cancelCallback,Gi=D.unstable_shouldYield,On=D.unstable_requestPaint,ci=D.unstable_now,Ja=D.unstable_getCurrentPriorityLevel,na=D.unstable_ImmediatePriority,sc=D.unstable_UserBlockingPriority,Pr=D.unstable_NormalPriority,cu=D.unstable_LowPriority,Oo=D.unstable_IdlePriority,Ii=null,hi=null;function lh(n){if(hi&&typeof hi.onCommitFiberRoot=="function")try{hi.onCommitFiberRoot(Ii,n,void 0,(n.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:Qa,Wi=Math.log,vl=Math.LN2;function Qa(n){return n>>>=0,n===0?32:31-(Wi(n)/vl|0)|0}var Ur=64,br=4194304;function ts(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Xr(n,a){var d=n.pendingLanes;if(d===0)return 0;var y=0,b=n.suspendedLanes,T=n.pingedLanes,O=d&268435455;if(O!==0){var re=O&~b;re!==0?y=ts(re):(T&=O,T!==0&&(y=ts(T)))}else O=d&~b,O!==0?y=ts(O):T!==0&&(y=ts(T));if(y===0)return 0;if(a!==0&&a!==y&&(a&b)===0&&(b=y&-y,T=a&-a,b>=T||b===16&&(T&4194240)!==0))return a;if((y&4)!==0&&(y|=d&16),a=n.entangledLanes,a!==0)for(n=n.entanglements,a&=y;0<a;)d=31-di(a),b=1<<d,y|=n[d],a&=~b;return y}function xl(n,a){switch(n){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nn(n,a){for(var d=n.suspendedLanes,y=n.pingedLanes,b=n.expirationTimes,T=n.pendingLanes;0<T;){var O=31-di(T),re=1<<O,ue=b[O];ue===-1?((re&d)===0||(re&y)!==0)&&(b[O]=xl(re,a)):ue<=a&&(n.expiredLanes|=re),T&=~re}}function No(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Rs(){var n=Ur;return Ur<<=1,(Ur&4194240)===0&&(Ur=64),n}function wl(n){for(var a=[],d=0;31>d;d++)a.push(n);return a}function wa(n,a,d){n.pendingLanes|=a,a!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,a=31-di(a),n[a]=d}function bl(n,a){var d=n.pendingLanes&~a;n.pendingLanes=a,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=a,n.mutableReadLanes&=a,n.entangledLanes&=a,a=n.entanglements;var y=n.eventTimes;for(n=n.expirationTimes;0<d;){var b=31-di(d),T=1<<b;a[b]=0,y[b]=-1,n[b]=-1,d&=~T}}function eo(n,a){var d=n.entangledLanes|=a;for(n=n.entanglements;d;){var y=31-di(d),b=1<<y;b&a|n[y]&a&&(n[y]|=a),d&=~b}}var Sr=0;function Sl(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var to,kl,ac,Tl,El,Cl=!1,Il=[],Fs=null,Bs=null,rs=null,ro=new Map,io=new Map,gs=[],hu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sa(n,a){switch(n){case"focusin":case"focusout":Fs=null;break;case"dragenter":case"dragleave":Bs=null;break;case"mouseover":case"mouseout":rs=null;break;case"pointerover":case"pointerout":ro.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":io.delete(a.pointerId)}}function aa(n,a,d,y,b,T){return n===null||n.nativeEvent!==T?(n={blockedOn:a,domEventName:d,eventSystemFlags:y,nativeEvent:T,targetContainers:[b]},a!==null&&(a=Us(a),a!==null&&kl(a)),n):(n.eventSystemFlags|=y,a=n.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),n)}function Vn(n,a,d,y,b){switch(a){case"focusin":return Fs=aa(Fs,n,a,d,y,b),!0;case"dragenter":return Bs=aa(Bs,n,a,d,y,b),!0;case"mouseover":return rs=aa(rs,n,a,d,y,b),!0;case"pointerover":var T=b.pointerId;return ro.set(T,aa(ro.get(T)||null,n,a,d,y,b)),!0;case"gotpointercapture":return T=b.pointerId,io.set(T,aa(io.get(T)||null,n,a,d,y,b)),!0}return!1}function Vo(n){var a=ns(n.target);if(a!==null){var d=Gt(a);if(d!==null){if(a=d.tag,a===13){if(a=Ir(d),a!==null){n.blockedOn=a,El(n.priority,function(){ac(d)});return}}else if(a===3&&d.stateNode.current.memoizedState.isDehydrated){n.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ba(n){if(n.blockedOn!==null)return!1;for(var a=n.targetContainers;0<a.length;){var d=so(n.domEventName,n.eventSystemFlags,a[0],n.nativeEvent);if(d===null){d=n.nativeEvent;var y=new d.constructor(d.type,d);sr=y,d.target.dispatchEvent(y),sr=null}else return a=Us(d),a!==null&&kl(a),n.blockedOn=d,!1;a.shift()}return!0}function no(n,a,d){ba(n)&&d.delete(a)}function Pl(){Cl=!1,Fs!==null&&ba(Fs)&&(Fs=null),Bs!==null&&ba(Bs)&&(Bs=null),rs!==null&&ba(rs)&&(rs=null),ro.forEach(no),io.forEach(no)}function ys(n,a){n.blockedOn===a&&(n.blockedOn=null,Cl||(Cl=!0,D.unstable_scheduleCallback(D.unstable_NormalPriority,Pl)))}function jn(n){function a(b){return ys(b,n)}if(0<Il.length){ys(Il[0],n);for(var d=1;d<Il.length;d++){var y=Il[d];y.blockedOn===n&&(y.blockedOn=null)}}for(Fs!==null&&ys(Fs,n),Bs!==null&&ys(Bs,n),rs!==null&&ys(rs,n),ro.forEach(a),io.forEach(a),d=0;d<gs.length;d++)y=gs[d],y.blockedOn===n&&(y.blockedOn=null);for(;0<gs.length&&(d=gs[0],d.blockedOn===null);)Vo(d),d.blockedOn===null&&gs.shift()}var ur=Ut.ReactCurrentBatchConfig,Sa=!0;function En(n,a,d,y){var b=Sr,T=ur.transition;ur.transition=null;try{Sr=1,jo(n,a,d,y)}finally{Sr=b,ur.transition=T}}function Cn(n,a,d,y){var b=Sr,T=ur.transition;ur.transition=null;try{Sr=4,jo(n,a,d,y)}finally{Sr=b,ur.transition=T}}function jo(n,a,d,y){if(Sa){var b=so(n,a,d,y);if(b===null)Fa(n,a,y,ka,d),sa(n,y);else if(Vn(b,n,a,d,y))y.stopPropagation();else if(sa(n,y),a&4&&-1<hu.indexOf(n)){for(;b!==null;){var T=Us(b);if(T!==null&&to(T),T=so(n,a,d,y),T===null&&Fa(n,a,y,ka,d),T===b)break;b=T}b!==null&&y.stopPropagation()}else Fa(n,a,y,null,d)}}var ka=null;function so(n,a,d,y){if(ka=null,n=Jt(y),n=ns(n),n!==null)if(a=Gt(n),a===null)n=null;else if(d=a.tag,d===13){if(n=Ir(a),n!==null)return n;n=null}else if(d===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null);return ka=n,null}function Ml(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ja()){case na:return 1;case sc:return 4;case Pr:case cu:return 16;case Oo:return 536870912;default:return 16}default:return 16}}var _s=null,ao=null,oo=null;function Al(){if(oo)return oo;var n,a=ao,d=a.length,y,b="value"in _s?_s.value:_s.textContent,T=b.length;for(n=0;n<d&&a[n]===b[n];n++);var O=d-n;for(y=1;y<=O&&a[d-y]===b[T-y];y++);return oo=b.slice(n,1<y?1-y:void 0)}function Ta(n){var a=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&a===13&&(n=13)):n=a,n===10&&(n=13),32<=n||n===13?n:0}function Uo(){return!0}function du(){return!1}function zi(n){function a(d,y,b,T,O){this._reactName=d,this._targetInst=b,this.type=y,this.nativeEvent=T,this.target=O,this.currentTarget=null;for(var re in n)n.hasOwnProperty(re)&&(d=n[re],this[re]=d?d(T):T[re]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Uo:du,this.isPropagationStopped=du,this}return nt(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Uo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Uo)},persist:function(){},isPersistent:Uo}),a}var lo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pu=zi(lo),$o=nt({},lo,{view:0,detail:0}),uh=zi($o),fu,mu,Ea,Ca=nt({},$o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mr,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ea&&(Ea&&n.type==="mousemove"?(fu=n.screenX-Ea.screenX,mu=n.screenY-Ea.screenY):mu=fu=0,Ea=n),fu)},movementY:function(n){return"movementY"in n?n.movementY:mu}}),zl=zi(Ca),gu=nt({},Ca,{dataTransfer:0}),uo=zi(gu),oc=nt({},$o,{relatedTarget:0}),Dl=zi(oc),yu=nt({},lo,{animationName:0,elapsedTime:0,pseudoElement:0}),Ia=zi(yu),lc=nt({},lo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),oa=zi(lc),co=nt({},lo,{data:0}),_u=zi(co),vu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ti={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ch(n){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(n):(n=ti[n])?!!a[n]:!1}function mr(){return ch}var Pa=nt({},$o,{key:function(n){if(n.key){var a=vu[n.key]||n.key;if(a!=="Unidentified")return a}return n.type==="keypress"?(n=Ta(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Mr[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mr,charCode:function(n){return n.type==="keypress"?Ta(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ta(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),ri=zi(Pa),Qr=nt({},Ca,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ho=zi(Qr),uc=nt({},$o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mr}),xu=zi(uc),Ll=nt({},lo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rl=zi(Ll),wu=nt({},Ca,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Fl=zi(wu),bu=[9,13,27,32],Ma=c&&"CompositionEvent"in window,Os=null;c&&"documentMode"in document&&(Os=document.documentMode);var qo=c&&"TextEvent"in window&&!Os,cc=c&&(!Ma||Os&&8<Os&&11>=Os),Bl=" ",hc=!1;function Su(n,a){switch(n){case"keyup":return bu.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zo(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var la=!1;function dc(n,a){switch(n){case"compositionend":return Zo(a);case"keypress":return a.which!==32?null:(hc=!0,Bl);case"textInput":return n=a.data,n===Bl&&hc?null:n;default:return null}}function pc(n,a){if(la)return n==="compositionend"||!Ma&&Su(n,a)?(n=Al(),oo=ao=_s=null,la=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return cc&&a.locale!=="ko"?null:a.data;default:return null}}var Go={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wo(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a==="input"?!!Go[n.type]:a==="textarea"}function Ho(n,a,d,y){H(y),a=ua(a,"onChange"),0<a.length&&(d=new pu("onChange","change",null,d,y),n.push({event:d,listeners:a}))}var po=null,$r=null;function Aa(n){Ol(n,0)}function Hi(n){var a=qn(n);if(Tr(a))return n}function fo(n,a){if(n==="change")return a}var mo=!1;if(c){var go;if(c){var Ns="oninput"in document;if(!Ns){var yo=document.createElement("div");yo.setAttribute("oninput","return;"),Ns=typeof yo.oninput=="function"}go=Ns}else go=!1;mo=go&&(!document.documentMode||9<document.documentMode)}function za(){po&&(po.detachEvent("onpropertychange",ku),$r=po=null)}function ku(n){if(n.propertyName==="value"&&Hi($r)){var a=[];Ho(a,$r,n,Jt(n)),Q(Aa,a)}}function fc(n,a,d){n==="focusin"?(za(),po=a,$r=d,po.attachEvent("onpropertychange",ku)):n==="focusout"&&za()}function mc(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Hi($r)}function gc(n,a){if(n==="click")return Hi(a)}function yc(n,a){if(n==="input"||n==="change")return Hi(a)}function vs(n,a){return n===a&&(n!==0||1/n===1/a)||n!==n&&a!==a}var hn=typeof Object.is=="function"?Object.is:vs;function Ki(n,a){if(hn(n,a))return!0;if(typeof n!="object"||n===null||typeof a!="object"||a===null)return!1;var d=Object.keys(n),y=Object.keys(a);if(d.length!==y.length)return!1;for(y=0;y<d.length;y++){var b=d[y];if(!ye.call(a,b)||!hn(n[b],a[b]))return!1}return!0}function _o(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Tu(n,a){var d=_o(n);n=0;for(var y;d;){if(d.nodeType===3){if(y=n+d.textContent.length,n<=a&&y>=a)return{node:d,offset:a-n};n=y}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=_o(d)}}function Eu(n,a){return n&&a?n===a?!0:n&&n.nodeType===3?!1:a&&a.nodeType===3?Eu(n,a.parentNode):"contains"in n?n.contains(a):n.compareDocumentPosition?!!(n.compareDocumentPosition(a)&16):!1:!1}function Cu(){for(var n=window,a=Nr();a instanceof n.HTMLIFrameElement;){try{var d=typeof a.contentWindow.location.href=="string"}catch{d=!1}if(d)n=a.contentWindow;else break;a=Nr(n.document)}return a}function xs(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a&&(a==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||a==="textarea"||n.contentEditable==="true")}function _c(n){var a=Cu(),d=n.focusedElem,y=n.selectionRange;if(a!==d&&d&&d.ownerDocument&&Eu(d.ownerDocument.documentElement,d)){if(y!==null&&xs(d)){if(a=y.start,n=y.end,n===void 0&&(n=a),"selectionStart"in d)d.selectionStart=a,d.selectionEnd=Math.min(n,d.value.length);else if(n=(a=d.ownerDocument||document)&&a.defaultView||window,n.getSelection){n=n.getSelection();var b=d.textContent.length,T=Math.min(y.start,b);y=y.end===void 0?T:Math.min(y.end,b),!n.extend&&T>y&&(b=y,y=T,T=b),b=Tu(d,T);var O=Tu(d,y);b&&O&&(n.rangeCount!==1||n.anchorNode!==b.node||n.anchorOffset!==b.offset||n.focusNode!==O.node||n.focusOffset!==O.offset)&&(a=a.createRange(),a.setStart(b.node,b.offset),n.removeAllRanges(),T>y?(n.addRange(a),n.extend(O.node,O.offset)):(a.setEnd(O.node,O.offset),n.addRange(a)))}}for(a=[],n=d;n=n.parentNode;)n.nodeType===1&&a.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<a.length;d++)n=a[d],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Un=c&&"documentMode"in document&&11>=document.documentMode,yn=null,vo=null,In=null,is=!1;function vc(n,a,d){var y=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;is||yn==null||yn!==Nr(y)||(y=yn,"selectionStart"in y&&xs(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),In&&Ki(In,y)||(In=y,y=ua(vo,"onSelect"),0<y.length&&(a=new pu("onSelect","select",null,a,d),n.push({event:a,listeners:y}),a.target=yn)))}function xo(n,a){var d={};return d[n.toLowerCase()]=a.toLowerCase(),d["Webkit"+n]="webkit"+a,d["Moz"+n]="moz"+a,d}var Da={animationend:xo("Animation","AnimationEnd"),animationiteration:xo("Animation","AnimationIteration"),animationstart:xo("Animation","AnimationStart"),transitionend:xo("Transition","TransitionEnd")},wo={},La={};c&&(La=document.createElement("div").style,"AnimationEvent"in window||(delete Da.animationend.animation,delete Da.animationiteration.animation,delete Da.animationstart.animation),"TransitionEvent"in window||delete Da.transitionend.transition);function $n(n){if(wo[n])return wo[n];if(!Da[n])return n;var a=Da[n],d;for(d in a)if(a.hasOwnProperty(d)&&d in La)return wo[n]=a[d];return n}var gt=$n("animationend"),Ko=$n("animationiteration"),Vs=$n("animationstart"),Ra=$n("transitionend"),Iu=new Map,lt="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ws(n,a){Iu.set(n,a),ce(a,[n])}for(var Xo=0;Xo<lt.length;Xo++){var Pu=lt[Xo],Mu=Pu.toLowerCase(),xc=Pu[0].toUpperCase()+Pu.slice(1);ws(Mu,"on"+xc)}ws(gt,"onAnimationEnd"),ws(Ko,"onAnimationIteration"),ws(Vs,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(Ra,"onTransitionEnd"),xe("onMouseEnter",["mouseout","mouseover"]),xe("onMouseLeave",["mouseout","mouseover"]),xe("onPointerEnter",["pointerout","pointerover"]),xe("onPointerLeave",["pointerout","pointerover"]),ce("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ce("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ce("onBeforeInput",["compositionend","keypress","textInput","paste"]),ce("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ce("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ce("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wc=new Set("cancel close invalid load scroll toggle".split(" ").concat(bo));function bc(n,a,d){var y=n.type||"unknown-event";n.currentTarget=d,Ft(y,a,void 0,n),n.currentTarget=null}function Ol(n,a){a=(a&4)!==0;for(var d=0;d<n.length;d++){var y=n[d],b=y.event;y=y.listeners;e:{var T=void 0;if(a)for(var O=y.length-1;0<=O;O--){var re=y[O],ue=re.instance,Ie=re.currentTarget;if(re=re.listener,ue!==T&&b.isPropagationStopped())break e;bc(b,re,Ie),T=ue}else for(O=0;O<y.length;O++){if(re=y[O],ue=re.instance,Ie=re.currentTarget,re=re.listener,ue!==T&&b.isPropagationStopped())break e;bc(b,re,Ie),T=ue}}}if(Be)throw n=At,Be=!1,At=null,n}function qr(n,a){var d=a[ei];d===void 0&&(d=a[ei]=new Set);var y=n+"__bubble";d.has(y)||(js(a,n,2,!1),d.add(y))}function Yo(n,a,d){var y=0;a&&(y|=4),js(d,n,y,a)}var So="_reactListening"+Math.random().toString(36).slice(2);function Di(n){if(!n[So]){n[So]=!0,j.forEach(function(d){d!=="selectionchange"&&(wc.has(d)||Yo(d,!1,n),Yo(d,!0,n))});var a=n.nodeType===9?n:n.ownerDocument;a===null||a[So]||(a[So]=!0,Yo("selectionchange",!1,a))}}function js(n,a,d,y){switch(Ml(a)){case 1:var b=En;break;case 4:b=Cn;break;default:b=jo}d=b.bind(null,a,d,n),b=void 0,!se||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),y?b!==void 0?n.addEventListener(a,d,{capture:!0,passive:b}):n.addEventListener(a,d,!0):b!==void 0?n.addEventListener(a,d,{passive:b}):n.addEventListener(a,d,!1)}function Fa(n,a,d,y,b){var T=y;if((a&1)===0&&(a&2)===0&&y!==null)e:for(;;){if(y===null)return;var O=y.tag;if(O===3||O===4){var re=y.stateNode.containerInfo;if(re===b||re.nodeType===8&&re.parentNode===b)break;if(O===4)for(O=y.return;O!==null;){var ue=O.tag;if((ue===3||ue===4)&&(ue=O.stateNode.containerInfo,ue===b||ue.nodeType===8&&ue.parentNode===b))return;O=O.return}for(;re!==null;){if(O=ns(re),O===null)return;if(ue=O.tag,ue===5||ue===6){y=T=O;continue e}re=re.parentNode}}y=y.return}Q(function(){var Ie=T,We=Jt(d),Ye=[];e:{var He=Iu.get(n);if(He!==void 0){var Tt=pu,zt=n;switch(n){case"keypress":if(Ta(d)===0)break e;case"keydown":case"keyup":Tt=ri;break;case"focusin":zt="focus",Tt=Dl;break;case"focusout":zt="blur",Tt=Dl;break;case"beforeblur":case"afterblur":Tt=Dl;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Tt=zl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Tt=uo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Tt=xu;break;case gt:case Ko:case Vs:Tt=Ia;break;case Ra:Tt=Rl;break;case"scroll":Tt=uh;break;case"wheel":Tt=Fl;break;case"copy":case"cut":case"paste":Tt=oa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Tt=ho}var Bt=(a&4)!==0,ai=!Bt&&n==="scroll",_e=Bt?He!==null?He+"Capture":null:He;Bt=[];for(var de=Ie,Ee;de!==null;){Ee=de;var rt=Ee.stateNode;if(Ee.tag===5&&rt!==null&&(Ee=rt,_e!==null&&(rt=me(de,_e),rt!=null&&Bt.push(Ba(de,rt,Ee)))),ai)break;de=de.return}0<Bt.length&&(He=new Tt(He,zt,null,d,We),Ye.push({event:He,listeners:Bt}))}}if((a&7)===0){e:{if(He=n==="mouseover"||n==="pointerover",Tt=n==="mouseout"||n==="pointerout",He&&d!==sr&&(zt=d.relatedTarget||d.fromElement)&&(ns(zt)||zt[dn]))break e;if((Tt||He)&&(He=We.window===We?We:(He=We.ownerDocument)?He.defaultView||He.parentWindow:window,Tt?(zt=d.relatedTarget||d.toElement,Tt=Ie,zt=zt?ns(zt):null,zt!==null&&(ai=Gt(zt),zt!==ai||zt.tag!==5&&zt.tag!==6)&&(zt=null)):(Tt=null,zt=Ie),Tt!==zt)){if(Bt=zl,rt="onMouseLeave",_e="onMouseEnter",de="mouse",(n==="pointerout"||n==="pointerover")&&(Bt=ho,rt="onPointerLeave",_e="onPointerEnter",de="pointer"),ai=Tt==null?He:qn(Tt),Ee=zt==null?He:qn(zt),He=new Bt(rt,de+"leave",Tt,d,We),He.target=ai,He.relatedTarget=Ee,rt=null,ns(We)===Ie&&(Bt=new Bt(_e,de+"enter",zt,d,We),Bt.target=Ee,Bt.relatedTarget=ai,rt=Bt),ai=rt,Tt&&zt)t:{for(Bt=Tt,_e=zt,de=0,Ee=Bt;Ee;Ee=ca(Ee))de++;for(Ee=0,rt=_e;rt;rt=ca(rt))Ee++;for(;0<de-Ee;)Bt=ca(Bt),de--;for(;0<Ee-de;)_e=ca(_e),Ee--;for(;de--;){if(Bt===_e||_e!==null&&Bt===_e.alternate)break t;Bt=ca(Bt),_e=ca(_e)}Bt=null}else Bt=null;Tt!==null&&Au(Ye,He,Tt,Bt,!1),zt!==null&&ai!==null&&Au(Ye,ai,zt,Bt,!0)}}e:{if(He=Ie?qn(Ie):window,Tt=He.nodeName&&He.nodeName.toLowerCase(),Tt==="select"||Tt==="input"&&He.type==="file")var Vt=fo;else if(Wo(He))if(mo)Vt=yc;else{Vt=mc;var Yt=fc}else(Tt=He.nodeName)&&Tt.toLowerCase()==="input"&&(He.type==="checkbox"||He.type==="radio")&&(Vt=gc);if(Vt&&(Vt=Vt(n,Ie))){Ho(Ye,Vt,d,We);break e}Yt&&Yt(n,He,Ie),n==="focusout"&&(Yt=He._wrapperState)&&Yt.controlled&&He.type==="number"&&Er(He,"number",He.value)}switch(Yt=Ie?qn(Ie):window,n){case"focusin":(Wo(Yt)||Yt.contentEditable==="true")&&(yn=Yt,vo=Ie,In=null);break;case"focusout":In=vo=yn=null;break;case"mousedown":is=!0;break;case"contextmenu":case"mouseup":case"dragend":is=!1,vc(Ye,d,We);break;case"selectionchange":if(Un)break;case"keydown":case"keyup":vc(Ye,d,We)}var tr;if(Ma)e:{switch(n){case"compositionstart":var or="onCompositionStart";break e;case"compositionend":or="onCompositionEnd";break e;case"compositionupdate":or="onCompositionUpdate";break e}or=void 0}else la?Su(n,d)&&(or="onCompositionEnd"):n==="keydown"&&d.keyCode===229&&(or="onCompositionStart");or&&(cc&&d.locale!=="ko"&&(la||or!=="onCompositionStart"?or==="onCompositionEnd"&&la&&(tr=Al()):(_s=We,ao="value"in _s?_s.value:_s.textContent,la=!0)),Yt=ua(Ie,or),0<Yt.length&&(or=new _u(or,n,null,d,We),Ye.push({event:or,listeners:Yt}),tr?or.data=tr:(tr=Zo(d),tr!==null&&(or.data=tr)))),(tr=qo?dc(n,d):pc(n,d))&&(Ie=ua(Ie,"onBeforeInput"),0<Ie.length&&(We=new _u("onBeforeInput","beforeinput",null,d,We),Ye.push({event:We,listeners:Ie}),We.data=tr))}Ol(Ye,a)})}function Ba(n,a,d){return{instance:n,listener:a,currentTarget:d}}function ua(n,a){for(var d=a+"Capture",y=[];n!==null;){var b=n,T=b.stateNode;b.tag===5&&T!==null&&(b=T,T=me(n,d),T!=null&&y.unshift(Ba(n,T,b)),T=me(n,a),T!=null&&y.push(Ba(n,T,b))),n=n.return}return y}function ca(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Au(n,a,d,y,b){for(var T=a._reactName,O=[];d!==null&&d!==y;){var re=d,ue=re.alternate,Ie=re.stateNode;if(ue!==null&&ue===y)break;re.tag===5&&Ie!==null&&(re=Ie,b?(ue=me(d,T),ue!=null&&O.unshift(Ba(d,ue,re))):b||(ue=me(d,T),ue!=null&&O.push(Ba(d,ue,re)))),d=d.return}O.length!==0&&n.push({event:a,listeners:O})}var Pn=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Jo(n){return(typeof n=="string"?n:""+n).replace(Pn,`
`).replace(Yr,"")}function ko(n,a,d){if(a=Jo(a),Jo(n)!==a&&d)throw Error(z(425))}function Qo(){}var Nl=null,Vl=null;function zu(n,a){return n==="textarea"||n==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Xi=typeof setTimeout=="function"?setTimeout:void 0,jl=typeof clearTimeout=="function"?clearTimeout:void 0,It=typeof Promise=="function"?Promise:void 0,qt=typeof queueMicrotask=="function"?queueMicrotask:typeof It<"u"?function(n){return It.resolve(null).then(n).catch(el)}:Xi;function el(n){setTimeout(function(){throw n})}function tl(n,a){var d=a,y=0;do{var b=d.nextSibling;if(n.removeChild(d),b&&b.nodeType===8)if(d=b.data,d==="/$"){if(y===0){n.removeChild(b),jn(a);return}y--}else d!=="$"&&d!=="$?"&&d!=="$!"||y++;d=b}while(d);jn(a)}function bs(n){for(;n!=null;n=n.nextSibling){var a=n.nodeType;if(a===1||a===3)break;if(a===8){if(a=n.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return n}function pi(n){n=n.previousSibling;for(var a=0;n;){if(n.nodeType===8){var d=n.data;if(d==="$"||d==="$!"||d==="$?"){if(a===0)return n;a--}else d==="/$"&&a++}n=n.previousSibling}return null}var ha=Math.random().toString(36).slice(2),_i="__reactFiber$"+ha,To="__reactProps$"+ha,dn="__reactContainer$"+ha,ei="__reactEvents$"+ha,ii="__reactListeners$"+ha,Eo="__reactHandles$"+ha;function ns(n){var a=n[_i];if(a)return a;for(var d=n.parentNode;d;){if(a=d[dn]||d[_i]){if(d=a.alternate,a.child!==null||d!==null&&d.child!==null)for(n=pi(n);n!==null;){if(d=n[_i])return d;n=pi(n)}return a}n=d,d=n.parentNode}return null}function Us(n){return n=n[_i]||n[dn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function qn(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(z(33))}function Co(n){return n[To]||null}var rl=[],ss=-1;function Ss(n){return{current:n}}function Zr(n){0>ss||(n.current=rl[ss],rl[ss]=null,ss--)}function $t(n,a){ss++,rl[ss]=n.current,n.current=a}var p={},t=Ss(p),s=Ss(!1),l=p;function h(n,a){var d=n.type.contextTypes;if(!d)return p;var y=n.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===a)return y.__reactInternalMemoizedMaskedChildContext;var b={},T;for(T in d)b[T]=a[T];return y&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=a,n.__reactInternalMemoizedMaskedChildContext=b),b}function f(n){return n=n.childContextTypes,n!=null}function v(){Zr(s),Zr(t)}function x(n,a,d){if(t.current!==p)throw Error(z(168));$t(t,a),$t(s,d)}function S(n,a,d){var y=n.stateNode;if(a=a.childContextTypes,typeof y.getChildContext!="function")return d;y=y.getChildContext();for(var b in y)if(!(b in a))throw Error(z(108,lr(n)||"Unknown",b));return nt({},d,y)}function E(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||p,l=t.current,$t(t,n),$t(s,s.current),!0}function I(n,a,d){var y=n.stateNode;if(!y)throw Error(z(169));d?(n=S(n,a,l),y.__reactInternalMemoizedMergedChildContext=n,Zr(s),Zr(t),$t(t,n)):Zr(s),$t(s,d)}var P=null,B=!1,Z=!1;function G(n){P===null?P=[n]:P.push(n)}function K(n){B=!0,G(n)}function q(){if(!Z&&P!==null){Z=!0;var n=0,a=Sr;try{var d=P;for(Sr=1;n<d.length;n++){var y=d[n];do y=y(!0);while(y!==null)}P=null,B=!1}catch(b){throw P!==null&&(P=P.slice(n+1)),Br(na,q),b}finally{Sr=a,Z=!1}}return null}var oe=[],we=0,ee=null,he=0,be=[],Se=0,De=null,Ve=1,Fe="";function qe(n,a){oe[we++]=he,oe[we++]=ee,ee=n,he=a}function bt(n,a,d){be[Se++]=Ve,be[Se++]=Fe,be[Se++]=De,De=n;var y=Ve;n=Fe;var b=32-di(y)-1;y&=~(1<<b),d+=1;var T=32-di(a)+b;if(30<T){var O=b-b%5;T=(y&(1<<O)-1).toString(32),y>>=O,b-=O,Ve=1<<32-di(a)+b|d<<b|y,Fe=T+n}else Ve=1<<T|d<<b|y,Fe=n}function cr(n){n.return!==null&&(qe(n,1),bt(n,1,0))}function tt(n){for(;n===ee;)ee=oe[--we],oe[we]=null,he=oe[--we],oe[we]=null;for(;n===De;)De=be[--Se],be[Se]=null,Fe=be[--Se],be[Se]=null,Ve=be[--Se],be[Se]=null}var kt=null,ht=null,Ht=!1,er=null;function ar(n,a){var d=us(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=n,a=n.deletions,a===null?(n.deletions=[d],n.flags|=16):a.push(d)}function hr(n,a){switch(n.tag){case 5:var d=n.type;return a=a.nodeType!==1||d.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(n.stateNode=a,kt=n,ht=bs(a.firstChild),!0):!1;case 6:return a=n.pendingProps===""||a.nodeType!==3?null:a,a!==null?(n.stateNode=a,kt=n,ht=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(d=De!==null?{id:Ve,overflow:Fe}:null,n.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=us(18,null,null,0),d.stateNode=a,d.return=n,n.child=d,kt=n,ht=null,!0):!1;default:return!1}}function ni(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Rr(n){if(Ht){var a=ht;if(a){var d=a;if(!hr(n,a)){if(ni(n))throw Error(z(418));a=bs(d.nextSibling);var y=kt;a&&hr(n,a)?ar(y,d):(n.flags=n.flags&-4097|2,Ht=!1,kt=n)}}else{if(ni(n))throw Error(z(418));n.flags=n.flags&-4097|2,Ht=!1,kt=n}}}function Li(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;kt=n}function fi(n){if(n!==kt)return!1;if(!Ht)return Li(n),Ht=!0,!1;var a;if((a=n.tag!==3)&&!(a=n.tag!==5)&&(a=n.type,a=a!=="head"&&a!=="body"&&!zu(n.type,n.memoizedProps)),a&&(a=ht)){if(ni(n))throw mi(),Error(z(418));for(;a;)ar(n,a),a=bs(a.nextSibling)}if(Li(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(z(317));e:{for(n=n.nextSibling,a=0;n;){if(n.nodeType===8){var d=n.data;if(d==="/$"){if(a===0){ht=bs(n.nextSibling);break e}a--}else d!=="$"&&d!=="$!"&&d!=="$?"||a++}n=n.nextSibling}ht=null}}else ht=kt?bs(n.stateNode.nextSibling):null;return!0}function mi(){for(var n=ht;n;)n=bs(n.nextSibling)}function Ri(){ht=kt=null,Ht=!1}function Or(n){er===null?er=[n]:er.push(n)}var ks=Ut.ReactCurrentBatchConfig;function _n(n,a,d){if(n=d.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(z(309));var y=d.stateNode}if(!y)throw Error(z(147,n));var b=y,T=""+n;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===T?a.ref:(a=function(O){var re=b.refs;O===null?delete re[T]:re[T]=O},a._stringRef=T,a)}if(typeof n!="string")throw Error(z(284));if(!d._owner)throw Error(z(290,n))}return n}function as(n,a){throw n=Object.prototype.toString.call(a),Error(z(31,n==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":n))}function da(n){var a=n._init;return a(n._payload)}function Oa(n){function a(_e,de){if(n){var Ee=_e.deletions;Ee===null?(_e.deletions=[de],_e.flags|=16):Ee.push(de)}}function d(_e,de){if(!n)return null;for(;de!==null;)a(_e,de),de=de.sibling;return null}function y(_e,de){for(_e=new Map;de!==null;)de.key!==null?_e.set(de.key,de):_e.set(de.index,de),de=de.sibling;return _e}function b(_e,de){return _e=Fo(_e,de),_e.index=0,_e.sibling=null,_e}function T(_e,de,Ee){return _e.index=Ee,n?(Ee=_e.alternate,Ee!==null?(Ee=Ee.index,Ee<de?(_e.flags|=2,de):Ee):(_e.flags|=2,de)):(_e.flags|=1048576,de)}function O(_e){return n&&_e.alternate===null&&(_e.flags|=2),_e}function re(_e,de,Ee,rt){return de===null||de.tag!==6?(de=Xc(Ee,_e.mode,rt),de.return=_e,de):(de=b(de,Ee),de.return=_e,de)}function ue(_e,de,Ee,rt){var Vt=Ee.type;return Vt===ft?We(_e,de,Ee.props.children,rt,Ee.key):de!==null&&(de.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===pr&&da(Vt)===de.type)?(rt=b(de,Ee.props),rt.ref=_n(_e,de,Ee),rt.return=_e,rt):(rt=Kc(Ee.type,Ee.key,Ee.props,null,_e.mode,rt),rt.ref=_n(_e,de,Ee),rt.return=_e,rt)}function Ie(_e,de,Ee,rt){return de===null||de.tag!==4||de.stateNode.containerInfo!==Ee.containerInfo||de.stateNode.implementation!==Ee.implementation?(de=Yc(Ee,_e.mode,rt),de.return=_e,de):(de=b(de,Ee.children||[]),de.return=_e,de)}function We(_e,de,Ee,rt,Vt){return de===null||de.tag!==7?(de=Ga(Ee,_e.mode,rt,Vt),de.return=_e,de):(de=b(de,Ee),de.return=_e,de)}function Ye(_e,de,Ee){if(typeof de=="string"&&de!==""||typeof de=="number")return de=Xc(""+de,_e.mode,Ee),de.return=_e,de;if(typeof de=="object"&&de!==null){switch(de.$$typeof){case Dt:return Ee=Kc(de.type,de.key,de.props,null,_e.mode,Ee),Ee.ref=_n(_e,null,de),Ee.return=_e,Ee;case Rt:return de=Yc(de,_e.mode,Ee),de.return=_e,de;case pr:var rt=de._init;return Ye(_e,rt(de._payload),Ee)}if(Te(de)||Xe(de))return de=Ga(de,_e.mode,Ee,null),de.return=_e,de;as(_e,de)}return null}function He(_e,de,Ee,rt){var Vt=de!==null?de.key:null;if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Vt!==null?null:re(_e,de,""+Ee,rt);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Dt:return Ee.key===Vt?ue(_e,de,Ee,rt):null;case Rt:return Ee.key===Vt?Ie(_e,de,Ee,rt):null;case pr:return Vt=Ee._init,He(_e,de,Vt(Ee._payload),rt)}if(Te(Ee)||Xe(Ee))return Vt!==null?null:We(_e,de,Ee,rt,null);as(_e,Ee)}return null}function Tt(_e,de,Ee,rt,Vt){if(typeof rt=="string"&&rt!==""||typeof rt=="number")return _e=_e.get(Ee)||null,re(de,_e,""+rt,Vt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case Dt:return _e=_e.get(rt.key===null?Ee:rt.key)||null,ue(de,_e,rt,Vt);case Rt:return _e=_e.get(rt.key===null?Ee:rt.key)||null,Ie(de,_e,rt,Vt);case pr:var Yt=rt._init;return Tt(_e,de,Ee,Yt(rt._payload),Vt)}if(Te(rt)||Xe(rt))return _e=_e.get(Ee)||null,We(de,_e,rt,Vt,null);as(de,rt)}return null}function zt(_e,de,Ee,rt){for(var Vt=null,Yt=null,tr=de,or=de=0,Ji=null;tr!==null&&or<Ee.length;or++){tr.index>or?(Ji=tr,tr=null):Ji=tr.sibling;var Lr=He(_e,tr,Ee[or],rt);if(Lr===null){tr===null&&(tr=Ji);break}n&&tr&&Lr.alternate===null&&a(_e,tr),de=T(Lr,de,or),Yt===null?Vt=Lr:Yt.sibling=Lr,Yt=Lr,tr=Ji}if(or===Ee.length)return d(_e,tr),Ht&&qe(_e,or),Vt;if(tr===null){for(;or<Ee.length;or++)tr=Ye(_e,Ee[or],rt),tr!==null&&(de=T(tr,de,or),Yt===null?Vt=tr:Yt.sibling=tr,Yt=tr);return Ht&&qe(_e,or),Vt}for(tr=y(_e,tr);or<Ee.length;or++)Ji=Tt(tr,_e,or,Ee[or],rt),Ji!==null&&(n&&Ji.alternate!==null&&tr.delete(Ji.key===null?or:Ji.key),de=T(Ji,de,or),Yt===null?Vt=Ji:Yt.sibling=Ji,Yt=Ji);return n&&tr.forEach(function(Wa){return a(_e,Wa)}),Ht&&qe(_e,or),Vt}function Bt(_e,de,Ee,rt){var Vt=Xe(Ee);if(typeof Vt!="function")throw Error(z(150));if(Ee=Vt.call(Ee),Ee==null)throw Error(z(151));for(var Yt=Vt=null,tr=de,or=de=0,Ji=null,Lr=Ee.next();tr!==null&&!Lr.done;or++,Lr=Ee.next()){tr.index>or?(Ji=tr,tr=null):Ji=tr.sibling;var Wa=He(_e,tr,Lr.value,rt);if(Wa===null){tr===null&&(tr=Ji);break}n&&tr&&Wa.alternate===null&&a(_e,tr),de=T(Wa,de,or),Yt===null?Vt=Wa:Yt.sibling=Wa,Yt=Wa,tr=Ji}if(Lr.done)return d(_e,tr),Ht&&qe(_e,or),Vt;if(tr===null){for(;!Lr.done;or++,Lr=Ee.next())Lr=Ye(_e,Lr.value,rt),Lr!==null&&(de=T(Lr,de,or),Yt===null?Vt=Lr:Yt.sibling=Lr,Yt=Lr);return Ht&&qe(_e,or),Vt}for(tr=y(_e,tr);!Lr.done;or++,Lr=Ee.next())Lr=Tt(tr,_e,or,Lr.value,rt),Lr!==null&&(n&&Lr.alternate!==null&&tr.delete(Lr.key===null?or:Lr.key),de=T(Lr,de,or),Yt===null?Vt=Lr:Yt.sibling=Lr,Yt=Lr);return n&&tr.forEach(function(Gh){return a(_e,Gh)}),Ht&&qe(_e,or),Vt}function ai(_e,de,Ee,rt){if(typeof Ee=="object"&&Ee!==null&&Ee.type===ft&&Ee.key===null&&(Ee=Ee.props.children),typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Dt:e:{for(var Vt=Ee.key,Yt=de;Yt!==null;){if(Yt.key===Vt){if(Vt=Ee.type,Vt===ft){if(Yt.tag===7){d(_e,Yt.sibling),de=b(Yt,Ee.props.children),de.return=_e,_e=de;break e}}else if(Yt.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===pr&&da(Vt)===Yt.type){d(_e,Yt.sibling),de=b(Yt,Ee.props),de.ref=_n(_e,Yt,Ee),de.return=_e,_e=de;break e}d(_e,Yt);break}else a(_e,Yt);Yt=Yt.sibling}Ee.type===ft?(de=Ga(Ee.props.children,_e.mode,rt,Ee.key),de.return=_e,_e=de):(rt=Kc(Ee.type,Ee.key,Ee.props,null,_e.mode,rt),rt.ref=_n(_e,de,Ee),rt.return=_e,_e=rt)}return O(_e);case Rt:e:{for(Yt=Ee.key;de!==null;){if(de.key===Yt)if(de.tag===4&&de.stateNode.containerInfo===Ee.containerInfo&&de.stateNode.implementation===Ee.implementation){d(_e,de.sibling),de=b(de,Ee.children||[]),de.return=_e,_e=de;break e}else{d(_e,de);break}else a(_e,de);de=de.sibling}de=Yc(Ee,_e.mode,rt),de.return=_e,_e=de}return O(_e);case pr:return Yt=Ee._init,ai(_e,de,Yt(Ee._payload),rt)}if(Te(Ee))return zt(_e,de,Ee,rt);if(Xe(Ee))return Bt(_e,de,Ee,rt);as(_e,Ee)}return typeof Ee=="string"&&Ee!==""||typeof Ee=="number"?(Ee=""+Ee,de!==null&&de.tag===6?(d(_e,de.sibling),de=b(de,Ee),de.return=_e,_e=de):(d(_e,de),de=Xc(Ee,_e.mode,rt),de.return=_e,_e=de),O(_e)):d(_e,de)}return ai}var vi=Oa(!0),Fi=Oa(!1),Bi=Ss(null),Ts=null,Gr=null,xi=null;function sn(){xi=Gr=Ts=null}function si(n){var a=Bi.current;Zr(Bi),n._currentValue=a}function $s(n,a,d){for(;n!==null;){var y=n.alternate;if((n.childLanes&a)!==a?(n.childLanes|=a,y!==null&&(y.childLanes|=a)):y!==null&&(y.childLanes&a)!==a&&(y.childLanes|=a),n===d)break;n=n.return}}function qs(n,a){Ts=n,xi=Gr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&a)!==0&&(xn=!0),n.firstContext=null)}function Mn(n){var a=n._currentValue;if(xi!==n)if(n={context:n,memoizedValue:a,next:null},Gr===null){if(Ts===null)throw Error(z(308));Gr=n,Ts.dependencies={lanes:0,firstContext:n}}else Gr=Gr.next=n;return a}var pa=null;function Du(n){pa===null?pa=[n]:pa.push(n)}function Ul(n,a,d,y){var b=a.interleaved;return b===null?(d.next=d,Du(a)):(d.next=b.next,b.next=d),a.interleaved=d,Oi(n,y)}function Oi(n,a){n.lanes|=a;var d=n.alternate;for(d!==null&&(d.lanes|=a),d=n,n=n.return;n!==null;)n.childLanes|=a,d=n.alternate,d!==null&&(d.childLanes|=a),d=n,n=n.return;return d.tag===3?d.stateNode:null}var vn=!1;function Zn(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function An(n,a){n=n.updateQueue,a.updateQueue===n&&(a.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ni(n,a){return{eventTime:n,lane:a,tag:0,payload:null,callback:null,next:null}}function Es(n,a,d){var y=n.updateQueue;if(y===null)return null;if(y=y.shared,(Ar&2)!==0){var b=y.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),y.pending=a,Oi(n,d)}return b=y.interleaved,b===null?(a.next=a,Du(y)):(a.next=b.next,b.next=a),y.interleaved=a,Oi(n,d)}function Gn(n,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var y=a.lanes;y&=n.pendingLanes,d|=y,a.lanes=d,eo(n,d)}}function rd(n,a){var d=n.updateQueue,y=n.alternate;if(y!==null&&(y=y.updateQueue,d===y)){var b=null,T=null;if(d=d.firstBaseUpdate,d!==null){do{var O={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};T===null?b=T=O:T=T.next=O,d=d.next}while(d!==null);T===null?b=T=a:T=T.next=a}else b=T=a;d={baseState:y.baseState,firstBaseUpdate:b,lastBaseUpdate:T,shared:y.shared,effects:y.effects},n.updateQueue=d;return}n=d.lastBaseUpdate,n===null?d.firstBaseUpdate=a:n.next=a,d.lastBaseUpdate=a}function Lu(n,a,d,y){var b=n.updateQueue;vn=!1;var T=b.firstBaseUpdate,O=b.lastBaseUpdate,re=b.shared.pending;if(re!==null){b.shared.pending=null;var ue=re,Ie=ue.next;ue.next=null,O===null?T=Ie:O.next=Ie,O=ue;var We=n.alternate;We!==null&&(We=We.updateQueue,re=We.lastBaseUpdate,re!==O&&(re===null?We.firstBaseUpdate=Ie:re.next=Ie,We.lastBaseUpdate=ue))}if(T!==null){var Ye=b.baseState;O=0,We=Ie=ue=null,re=T;do{var He=re.lane,Tt=re.eventTime;if((y&He)===He){We!==null&&(We=We.next={eventTime:Tt,lane:0,tag:re.tag,payload:re.payload,callback:re.callback,next:null});e:{var zt=n,Bt=re;switch(He=a,Tt=d,Bt.tag){case 1:if(zt=Bt.payload,typeof zt=="function"){Ye=zt.call(Tt,Ye,He);break e}Ye=zt;break e;case 3:zt.flags=zt.flags&-65537|128;case 0:if(zt=Bt.payload,He=typeof zt=="function"?zt.call(Tt,Ye,He):zt,He==null)break e;Ye=nt({},Ye,He);break e;case 2:vn=!0}}re.callback!==null&&re.lane!==0&&(n.flags|=64,He=b.effects,He===null?b.effects=[re]:He.push(re))}else Tt={eventTime:Tt,lane:He,tag:re.tag,payload:re.payload,callback:re.callback,next:null},We===null?(Ie=We=Tt,ue=Ye):We=We.next=Tt,O|=He;if(re=re.next,re===null){if(re=b.shared.pending,re===null)break;He=re,re=He.next,He.next=null,b.lastBaseUpdate=He,b.shared.pending=null}}while(!0);if(We===null&&(ue=Ye),b.baseState=ue,b.firstBaseUpdate=Ie,b.lastBaseUpdate=We,a=b.shared.interleaved,a!==null){b=a;do O|=b.lane,b=b.next;while(b!==a)}else T===null&&(b.shared.lanes=0);ll|=O,n.lanes=O,n.memoizedState=Ye}}function wi(n,a,d){if(n=a.effects,a.effects=null,n!==null)for(a=0;a<n.length;a++){var y=n[a],b=y.callback;if(b!==null){if(y.callback=null,y=d,typeof b!="function")throw Error(z(191,b));b.call(y)}}}var il={},Zs=Ss(il),Gs=Ss(il),Ws=Ss(il);function fa(n){if(n===il)throw Error(z(174));return n}function Ru(n,a){switch($t(Ws,a),$t(Gs,n),$t(Zs,il),n=a.nodeType,n){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Kr(null,"");break;default:n=n===8?a.parentNode:a,a=n.namespaceURI||null,n=n.tagName,a=Kr(a,n)}Zr(Zs),$t(Zs,a)}function nl(){Zr(Zs),Zr(Gs),Zr(Ws)}function id(n){fa(Ws.current);var a=fa(Zs.current),d=Kr(a,n.type);a!==d&&($t(Gs,n),$t(Zs,d))}function Sc(n){Gs.current===n&&(Zr(Zs),Zr(Gs))}var bi=Ss(0);function $l(n){for(var a=n;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hh=[];function Fu(){for(var n=0;n<hh.length;n++)hh[n]._workInProgressVersionPrimary=null;hh.length=0}var Bu=Ut.ReactCurrentDispatcher,kc=Ut.ReactCurrentBatchConfig,Cs=0,Si=null,ki=null,Pi=null,sl=!1,ql=!1,Zl=0,Qd=0;function Fr(){throw Error(z(321))}function Io(n,a){if(a===null)return!1;for(var d=0;d<a.length&&d<n.length;d++)if(!hn(n[d],a[d]))return!1;return!0}function Ou(n,a,d,y,b,T){if(Cs=T,Si=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Bu.current=n===null||n.memoizedState===null?ip:Ti,n=d(y,b),ql){T=0;do{if(ql=!1,Zl=0,25<=T)throw Error(z(301));T+=1,Pi=ki=null,a.updateQueue=null,Bu.current=zc,n=d(y,b)}while(ql)}if(Bu.current=Va,a=ki!==null&&ki.next!==null,Cs=0,Pi=ki=Si=null,sl=!1,a)throw Error(z(300));return n}function Tc(){var n=Zl!==0;return Zl=0,n}function Wn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Si.memoizedState=Pi=n:Pi=Pi.next=n,Pi}function Is(){if(ki===null){var n=Si.alternate;n=n!==null?n.memoizedState:null}else n=ki.next;var a=Pi===null?Si.memoizedState:Pi.next;if(a!==null)Pi=a,ki=n;else{if(n===null)throw Error(z(310));ki=n,n={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},Pi===null?Si.memoizedState=Pi=n:Pi=Pi.next=n}return Pi}function Po(n,a){return typeof a=="function"?a(n):a}function dh(n){var a=Is(),d=a.queue;if(d===null)throw Error(z(311));d.lastRenderedReducer=n;var y=ki,b=y.baseQueue,T=d.pending;if(T!==null){if(b!==null){var O=b.next;b.next=T.next,T.next=O}y.baseQueue=b=T,d.pending=null}if(b!==null){T=b.next,y=y.baseState;var re=O=null,ue=null,Ie=T;do{var We=Ie.lane;if((Cs&We)===We)ue!==null&&(ue=ue.next={lane:0,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null}),y=Ie.hasEagerState?Ie.eagerState:n(y,Ie.action);else{var Ye={lane:We,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null};ue===null?(re=ue=Ye,O=y):ue=ue.next=Ye,Si.lanes|=We,ll|=We}Ie=Ie.next}while(Ie!==null&&Ie!==T);ue===null?O=y:ue.next=re,hn(y,a.memoizedState)||(xn=!0),a.memoizedState=y,a.baseState=O,a.baseQueue=ue,d.lastRenderedState=y}if(n=d.interleaved,n!==null){b=n;do T=b.lane,Si.lanes|=T,ll|=T,b=b.next;while(b!==n)}else b===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function Ec(n){var a=Is(),d=a.queue;if(d===null)throw Error(z(311));d.lastRenderedReducer=n;var y=d.dispatch,b=d.pending,T=a.memoizedState;if(b!==null){d.pending=null;var O=b=b.next;do T=n(T,O.action),O=O.next;while(O!==b);hn(T,a.memoizedState)||(xn=!0),a.memoizedState=T,a.baseQueue===null&&(a.baseState=T),d.lastRenderedState=T}return[T,y]}function ph(){}function fh(n,a){var d=Si,y=Is(),b=a(),T=!hn(y.memoizedState,b);if(T&&(y.memoizedState=b,xn=!0),y=y.queue,gh(mh.bind(null,d,y,n),[n]),y.getSnapshot!==a||T||Pi!==null&&Pi.memoizedState.tag&1){if(d.flags|=2048,Wl(9,Cc.bind(null,d,y,b,a),void 0,null),an===null)throw Error(z(349));(Cs&30)!==0||nd(d,a,b)}return b}function nd(n,a,d){n.flags|=16384,n={getSnapshot:a,value:d},a=Si.updateQueue,a===null?(a={lastEffect:null,stores:null},Si.updateQueue=a,a.stores=[n]):(d=a.stores,d===null?a.stores=[n]:d.push(n))}function Cc(n,a,d,y){a.value=d,a.getSnapshot=y,Ic(a)&&Gl(n)}function mh(n,a,d){return d(function(){Ic(a)&&Gl(n)})}function Ic(n){var a=n.getSnapshot;n=n.value;try{var d=a();return!hn(n,d)}catch{return!0}}function Gl(n){var a=Oi(n,1);a!==null&&Js(a,n,1,-1)}function Hn(n){var a=Wn();return typeof n=="function"&&(n=n()),a.memoizedState=a.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Po,lastRenderedState:n},a.queue=n,n=n.dispatch=rp.bind(null,Si,n),[a.memoizedState,n]}function Wl(n,a,d,y){return n={tag:n,create:a,destroy:d,deps:y,next:null},a=Si.updateQueue,a===null?(a={lastEffect:null,stores:null},Si.updateQueue=a,a.lastEffect=n.next=n):(d=a.lastEffect,d===null?a.lastEffect=n.next=n:(y=d.next,d.next=n,n.next=y,a.lastEffect=n)),n}function sd(){return Is().memoizedState}function Nu(n,a,d,y){var b=Wn();Si.flags|=n,b.memoizedState=Wl(1|a,d,void 0,y===void 0?null:y)}function Pc(n,a,d,y){var b=Is();y=y===void 0?null:y;var T=void 0;if(ki!==null){var O=ki.memoizedState;if(T=O.destroy,y!==null&&Io(y,O.deps)){b.memoizedState=Wl(a,d,T,y);return}}Si.flags|=n,b.memoizedState=Wl(1|a,d,T,y)}function ad(n,a){return Nu(8390656,8,n,a)}function gh(n,a){return Pc(2048,8,n,a)}function od(n,a){return Pc(4,2,n,a)}function Mc(n,a){return Pc(4,4,n,a)}function Vu(n,a){if(typeof a=="function")return n=n(),a(n),function(){a(null)};if(a!=null)return n=n(),a.current=n,function(){a.current=null}}function yh(n,a,d){return d=d!=null?d.concat([n]):null,Pc(4,4,Vu.bind(null,a,n),d)}function Na(){}function Hl(n,a){var d=Is();a=a===void 0?null:a;var y=d.memoizedState;return y!==null&&a!==null&&Io(a,y[1])?y[0]:(d.memoizedState=[n,a],n)}function ld(n,a){var d=Is();a=a===void 0?null:a;var y=d.memoizedState;return y!==null&&a!==null&&Io(a,y[1])?y[0]:(n=n(),d.memoizedState=[n,a],n)}function ud(n,a,d){return(Cs&21)===0?(n.baseState&&(n.baseState=!1,xn=!0),n.memoizedState=d):(hn(d,a)||(d=Rs(),Si.lanes|=d,ll|=d,n.baseState=!0),a)}function ep(n,a){var d=Sr;Sr=d!==0&&4>d?d:4,n(!0);var y=kc.transition;kc.transition={};try{n(!1),a()}finally{Sr=d,kc.transition=y}}function cd(){return Is().memoizedState}function tp(n,a,d){var y=Ys(n);if(d={lane:y,action:d,hasEagerState:!1,eagerState:null,next:null},hd(n))Ac(a,d);else if(d=Ul(n,a,d,y),d!==null){var b=ln();Js(d,n,y,b),dd(d,a,y)}}function rp(n,a,d){var y=Ys(n),b={lane:y,action:d,hasEagerState:!1,eagerState:null,next:null};if(hd(n))Ac(a,b);else{var T=n.alternate;if(n.lanes===0&&(T===null||T.lanes===0)&&(T=a.lastRenderedReducer,T!==null))try{var O=a.lastRenderedState,re=T(O,d);if(b.hasEagerState=!0,b.eagerState=re,hn(re,O)){var ue=a.interleaved;ue===null?(b.next=b,Du(a)):(b.next=ue.next,ue.next=b),a.interleaved=b;return}}catch{}finally{}d=Ul(n,a,b,y),d!==null&&(b=ln(),Js(d,n,y,b),dd(d,a,y))}}function hd(n){var a=n.alternate;return n===Si||a!==null&&a===Si}function Ac(n,a){ql=sl=!0;var d=n.pending;d===null?a.next=a:(a.next=d.next,d.next=a),n.pending=a}function dd(n,a,d){if((d&4194240)!==0){var y=a.lanes;y&=n.pendingLanes,d|=y,a.lanes=d,eo(n,d)}}var Va={readContext:Mn,useCallback:Fr,useContext:Fr,useEffect:Fr,useImperativeHandle:Fr,useInsertionEffect:Fr,useLayoutEffect:Fr,useMemo:Fr,useReducer:Fr,useRef:Fr,useState:Fr,useDebugValue:Fr,useDeferredValue:Fr,useTransition:Fr,useMutableSource:Fr,useSyncExternalStore:Fr,useId:Fr,unstable_isNewReconciler:!1},ip={readContext:Mn,useCallback:function(n,a){return Wn().memoizedState=[n,a===void 0?null:a],n},useContext:Mn,useEffect:ad,useImperativeHandle:function(n,a,d){return d=d!=null?d.concat([n]):null,Nu(4194308,4,Vu.bind(null,a,n),d)},useLayoutEffect:function(n,a){return Nu(4194308,4,n,a)},useInsertionEffect:function(n,a){return Nu(4,2,n,a)},useMemo:function(n,a){var d=Wn();return a=a===void 0?null:a,n=n(),d.memoizedState=[n,a],n},useReducer:function(n,a,d){var y=Wn();return a=d!==void 0?d(a):a,y.memoizedState=y.baseState=a,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:a},y.queue=n,n=n.dispatch=tp.bind(null,Si,n),[y.memoizedState,n]},useRef:function(n){var a=Wn();return n={current:n},a.memoizedState=n},useState:Hn,useDebugValue:Na,useDeferredValue:function(n){return Wn().memoizedState=n},useTransition:function(){var n=Hn(!1),a=n[0];return n=ep.bind(null,n[1]),Wn().memoizedState=n,[a,n]},useMutableSource:function(){},useSyncExternalStore:function(n,a,d){var y=Si,b=Wn();if(Ht){if(d===void 0)throw Error(z(407));d=d()}else{if(d=a(),an===null)throw Error(z(349));(Cs&30)!==0||nd(y,a,d)}b.memoizedState=d;var T={value:d,getSnapshot:a};return b.queue=T,ad(mh.bind(null,y,T,n),[n]),y.flags|=2048,Wl(9,Cc.bind(null,y,T,d,a),void 0,null),d},useId:function(){var n=Wn(),a=an.identifierPrefix;if(Ht){var d=Fe,y=Ve;d=(y&~(1<<32-di(y)-1)).toString(32)+d,a=":"+a+"R"+d,d=Zl++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=Qd++,a=":"+a+"r"+d.toString(32)+":";return n.memoizedState=a},unstable_isNewReconciler:!1},Ti={readContext:Mn,useCallback:Hl,useContext:Mn,useEffect:gh,useImperativeHandle:yh,useInsertionEffect:od,useLayoutEffect:Mc,useMemo:ld,useReducer:dh,useRef:sd,useState:function(){return dh(Po)},useDebugValue:Na,useDeferredValue:function(n){var a=Is();return ud(a,ki.memoizedState,n)},useTransition:function(){var n=dh(Po)[0],a=Is().memoizedState;return[n,a]},useMutableSource:ph,useSyncExternalStore:fh,useId:cd,unstable_isNewReconciler:!1},zc={readContext:Mn,useCallback:Hl,useContext:Mn,useEffect:gh,useImperativeHandle:yh,useInsertionEffect:od,useLayoutEffect:Mc,useMemo:ld,useReducer:Ec,useRef:sd,useState:function(){return Ec(Po)},useDebugValue:Na,useDeferredValue:function(n){var a=Is();return ki===null?a.memoizedState=n:ud(a,ki.memoizedState,n)},useTransition:function(){var n=Ec(Po)[0],a=Is().memoizedState;return[n,a]},useMutableSource:ph,useSyncExternalStore:fh,useId:cd,unstable_isNewReconciler:!1};function Ps(n,a){if(n&&n.defaultProps){a=nt({},a),n=n.defaultProps;for(var d in n)a[d]===void 0&&(a[d]=n[d]);return a}return a}function Kl(n,a,d,y){a=n.memoizedState,d=d(y,a),d=d==null?a:nt({},a,d),n.memoizedState=d,n.lanes===0&&(n.updateQueue.baseState=d)}var al={isMounted:function(n){return(n=n._reactInternals)?Gt(n)===n:!1},enqueueSetState:function(n,a,d){n=n._reactInternals;var y=ln(),b=Ys(n),T=Ni(y,b);T.payload=a,d!=null&&(T.callback=d),a=Es(n,T,b),a!==null&&(Js(a,n,b,y),Gn(a,n,b))},enqueueReplaceState:function(n,a,d){n=n._reactInternals;var y=ln(),b=Ys(n),T=Ni(y,b);T.tag=1,T.payload=a,d!=null&&(T.callback=d),a=Es(n,T,b),a!==null&&(Js(a,n,b,y),Gn(a,n,b))},enqueueForceUpdate:function(n,a){n=n._reactInternals;var d=ln(),y=Ys(n),b=Ni(d,y);b.tag=2,a!=null&&(b.callback=a),a=Es(n,b,y),a!==null&&(Js(a,n,y,d),Gn(a,n,y))}};function Xl(n,a,d,y,b,T,O){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(y,T,O):a.prototype&&a.prototype.isPureReactComponent?!Ki(d,y)||!Ki(b,T):!0}function _h(n,a,d){var y=!1,b=p,T=a.contextType;return typeof T=="object"&&T!==null?T=Mn(T):(b=f(a)?l:t.current,y=a.contextTypes,T=(y=y!=null)?h(n,b):p),a=new a(d,T),n.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=al,n.stateNode=a,a._reactInternals=n,y&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=b,n.__reactInternalMemoizedMaskedChildContext=T),a}function vh(n,a,d,y){n=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,y),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,y),a.state!==n&&al.enqueueReplaceState(a,a.state,null)}function ol(n,a,d,y){var b=n.stateNode;b.props=d,b.state=n.memoizedState,b.refs={},Zn(n);var T=a.contextType;typeof T=="object"&&T!==null?b.context=Mn(T):(T=f(a)?l:t.current,b.context=h(n,T)),b.state=n.memoizedState,T=a.getDerivedStateFromProps,typeof T=="function"&&(Kl(n,a,T,d),b.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(a=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),a!==b.state&&al.enqueueReplaceState(b,b.state,null),Lu(n,d,b,y),b.state=n.memoizedState),typeof b.componentDidMount=="function"&&(n.flags|=4194308)}function Mo(n,a){try{var d="",y=a;do d+=Nt(y),y=y.return;while(y);var b=d}catch(T){b=`
Error generating stack: `+T.message+`
`+T.stack}return{value:n,source:a,stack:b,digest:null}}function ju(n,a,d){return{value:n,source:null,stack:d??null,digest:a??null}}function Dc(n,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var np=typeof WeakMap=="function"?WeakMap:Map;function xh(n,a,d){d=Ni(-1,d),d.tag=3,d.payload={element:null};var y=a.value;return d.callback=function(){jc||(jc=!0,Bh=y),Dc(n,a)},d}function Yl(n,a,d){d=Ni(-1,d),d.tag=3;var y=n.type.getDerivedStateFromError;if(typeof y=="function"){var b=a.value;d.payload=function(){return y(b)},d.callback=function(){Dc(n,a)}}var T=n.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(d.callback=function(){Dc(n,a),typeof y!="function"&&($a===null?$a=new Set([this]):$a.add(this));var O=a.stack;this.componentDidCatch(a.value,{componentStack:O!==null?O:""})}),d}function pd(n,a,d){var y=n.pingCache;if(y===null){y=n.pingCache=new np;var b=new Set;y.set(a,b)}else b=y.get(a),b===void 0&&(b=new Set,y.set(a,b));b.has(d)||(b.add(d),n=Dd.bind(null,n,a,d),a.then(n,n))}function Lc(n){do{var a;if((a=n.tag===13)&&(a=n.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return n;n=n.return}while(n!==null);return null}function fd(n,a,d,y,b){return(n.mode&1)===0?(n===a?n.flags|=65536:(n.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Ni(-1,1),a.tag=2,Es(d,a,1))),d.lanes|=1),n):(n.flags|=65536,n.lanes=b,n)}var wh=Ut.ReactCurrentOwner,xn=!1;function pn(n,a,d,y){a.child=n===null?Fi(a,null,d,y):vi(a,n.child,d,y)}function bh(n,a,d,y,b){d=d.render;var T=a.ref;return qs(a,b),y=Ou(n,a,d,y,T,b),d=Tc(),n!==null&&!xn?(a.updateQueue=n.updateQueue,a.flags&=-2053,n.lanes&=~b,Hs(n,a,b)):(Ht&&d&&cr(a),a.flags|=1,pn(n,a,y,b),a.child)}function Sh(n,a,d,y,b){if(n===null){var T=d.type;return typeof T=="function"&&!$h(T)&&T.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=T,md(n,a,T,y,b)):(n=Kc(d.type,null,y,a,a.mode,b),n.ref=a.ref,n.return=a,a.child=n)}if(T=n.child,(n.lanes&b)===0){var O=T.memoizedProps;if(d=d.compare,d=d!==null?d:Ki,d(O,y)&&n.ref===a.ref)return Hs(n,a,b)}return a.flags|=1,n=Fo(T,y),n.ref=a.ref,n.return=a,a.child=n}function md(n,a,d,y,b){if(n!==null){var T=n.memoizedProps;if(Ki(T,y)&&n.ref===a.ref)if(xn=!1,a.pendingProps=y=T,(n.lanes&b)!==0)(n.flags&131072)!==0&&(xn=!0);else return a.lanes=n.lanes,Hs(n,a,b)}return kh(n,a,d,y,b)}function gd(n,a,d){var y=a.pendingProps,b=y.children,T=n!==null?n.memoizedState:null;if(y.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},$t(eu,ls),ls|=d;else{if((d&1073741824)===0)return n=T!==null?T.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:n,cachePool:null,transitions:null},a.updateQueue=null,$t(eu,ls),ls|=n,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=T!==null?T.baseLanes:d,$t(eu,ls),ls|=y}else T!==null?(y=T.baseLanes|d,a.memoizedState=null):y=d,$t(eu,ls),ls|=y;return pn(n,a,b,d),a.child}function yd(n,a){var d=a.ref;(n===null&&d!==null||n!==null&&n.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function kh(n,a,d,y,b){var T=f(d)?l:t.current;return T=h(a,T),qs(a,b),d=Ou(n,a,d,y,T,b),y=Tc(),n!==null&&!xn?(a.updateQueue=n.updateQueue,a.flags&=-2053,n.lanes&=~b,Hs(n,a,b)):(Ht&&y&&cr(a),a.flags|=1,pn(n,a,d,b),a.child)}function _d(n,a,d,y,b){if(f(d)){var T=!0;E(a)}else T=!1;if(qs(a,b),a.stateNode===null)Rc(n,a),_h(a,d,y),ol(a,d,y,b),y=!0;else if(n===null){var O=a.stateNode,re=a.memoizedProps;O.props=re;var ue=O.context,Ie=d.contextType;typeof Ie=="object"&&Ie!==null?Ie=Mn(Ie):(Ie=f(d)?l:t.current,Ie=h(a,Ie));var We=d.getDerivedStateFromProps,Ye=typeof We=="function"||typeof O.getSnapshotBeforeUpdate=="function";Ye||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(re!==y||ue!==Ie)&&vh(a,O,y,Ie),vn=!1;var He=a.memoizedState;O.state=He,Lu(a,y,O,b),ue=a.memoizedState,re!==y||He!==ue||s.current||vn?(typeof We=="function"&&(Kl(a,d,We,y),ue=a.memoizedState),(re=vn||Xl(a,d,re,y,He,ue,Ie))?(Ye||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(a.flags|=4194308)):(typeof O.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=y,a.memoizedState=ue),O.props=y,O.state=ue,O.context=Ie,y=re):(typeof O.componentDidMount=="function"&&(a.flags|=4194308),y=!1)}else{O=a.stateNode,An(n,a),re=a.memoizedProps,Ie=a.type===a.elementType?re:Ps(a.type,re),O.props=Ie,Ye=a.pendingProps,He=O.context,ue=d.contextType,typeof ue=="object"&&ue!==null?ue=Mn(ue):(ue=f(d)?l:t.current,ue=h(a,ue));var Tt=d.getDerivedStateFromProps;(We=typeof Tt=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(re!==Ye||He!==ue)&&vh(a,O,y,ue),vn=!1,He=a.memoizedState,O.state=He,Lu(a,y,O,b);var zt=a.memoizedState;re!==Ye||He!==zt||s.current||vn?(typeof Tt=="function"&&(Kl(a,d,Tt,y),zt=a.memoizedState),(Ie=vn||Xl(a,d,Ie,y,He,zt,ue)||!1)?(We||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(y,zt,ue),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(y,zt,ue)),typeof O.componentDidUpdate=="function"&&(a.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof O.componentDidUpdate!="function"||re===n.memoizedProps&&He===n.memoizedState||(a.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||re===n.memoizedProps&&He===n.memoizedState||(a.flags|=1024),a.memoizedProps=y,a.memoizedState=zt),O.props=y,O.state=zt,O.context=ue,y=Ie):(typeof O.componentDidUpdate!="function"||re===n.memoizedProps&&He===n.memoizedState||(a.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||re===n.memoizedProps&&He===n.memoizedState||(a.flags|=1024),y=!1)}return ma(n,a,d,y,T,b)}function ma(n,a,d,y,b,T){yd(n,a);var O=(a.flags&128)!==0;if(!y&&!O)return b&&I(a,d,!1),Hs(n,a,T);y=a.stateNode,wh.current=a;var re=O&&typeof d.getDerivedStateFromError!="function"?null:y.render();return a.flags|=1,n!==null&&O?(a.child=vi(a,n.child,null,T),a.child=vi(a,null,re,T)):pn(n,a,re,T),a.memoizedState=y.state,b&&I(a,d,!0),a.child}function vd(n){var a=n.stateNode;a.pendingContext?x(n,a.pendingContext,a.pendingContext!==a.context):a.context&&x(n,a.context,!1),Ru(n,a.containerInfo)}function Th(n,a,d,y,b){return Ri(),Or(b),a.flags|=256,pn(n,a,d,y),a.child}var Ao={dehydrated:null,treeContext:null,retryLane:0};function Eh(n){return{baseLanes:n,cachePool:null,transitions:null}}function xd(n,a,d){var y=a.pendingProps,b=bi.current,T=!1,O=(a.flags&128)!==0,re;if((re=O)||(re=n!==null&&n.memoizedState===null?!1:(b&2)!==0),re?(T=!0,a.flags&=-129):(n===null||n.memoizedState!==null)&&(b|=1),$t(bi,b&1),n===null)return Rr(a),n=a.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((a.mode&1)===0?a.lanes=1:n.data==="$!"?a.lanes=8:a.lanes=1073741824,null):(O=y.children,n=y.fallback,T?(y=a.mode,T=a.child,O={mode:"hidden",children:O},(y&1)===0&&T!==null?(T.childLanes=0,T.pendingProps=O):T=ta(O,y,0,null),n=Ga(n,y,d,null),T.return=a,n.return=a,T.sibling=n,a.child=T,a.child.memoizedState=Eh(d),a.memoizedState=Ao,n):Ch(a,O));if(b=n.memoizedState,b!==null&&(re=b.dehydrated,re!==null))return wd(n,a,O,y,re,b,d);if(T){T=y.fallback,O=a.mode,b=n.child,re=b.sibling;var ue={mode:"hidden",children:y.children};return(O&1)===0&&a.child!==b?(y=a.child,y.childLanes=0,y.pendingProps=ue,a.deletions=null):(y=Fo(b,ue),y.subtreeFlags=b.subtreeFlags&14680064),re!==null?T=Fo(re,T):(T=Ga(T,O,d,null),T.flags|=2),T.return=a,y.return=a,y.sibling=T,a.child=y,y=T,T=a.child,O=n.child.memoizedState,O=O===null?Eh(d):{baseLanes:O.baseLanes|d,cachePool:null,transitions:O.transitions},T.memoizedState=O,T.childLanes=n.childLanes&~d,a.memoizedState=Ao,y}return T=n.child,n=T.sibling,y=Fo(T,{mode:"visible",children:y.children}),(a.mode&1)===0&&(y.lanes=d),y.return=a,y.sibling=null,n!==null&&(d=a.deletions,d===null?(a.deletions=[n],a.flags|=16):d.push(n)),a.child=y,a.memoizedState=null,y}function Ch(n,a){return a=ta({mode:"visible",children:a},n.mode,0,null),a.return=n,n.child=a}function Uu(n,a,d,y){return y!==null&&Or(y),vi(a,n.child,null,d),n=Ch(a,a.pendingProps.children),n.flags|=2,a.memoizedState=null,n}function wd(n,a,d,y,b,T,O){if(d)return a.flags&256?(a.flags&=-257,y=ju(Error(z(422))),Uu(n,a,O,y)):a.memoizedState!==null?(a.child=n.child,a.flags|=128,null):(T=y.fallback,b=a.mode,y=ta({mode:"visible",children:y.children},b,0,null),T=Ga(T,b,O,null),T.flags|=2,y.return=a,T.return=a,y.sibling=T,a.child=y,(a.mode&1)!==0&&vi(a,n.child,null,O),a.child.memoizedState=Eh(O),a.memoizedState=Ao,T);if((a.mode&1)===0)return Uu(n,a,O,null);if(b.data==="$!"){if(y=b.nextSibling&&b.nextSibling.dataset,y)var re=y.dgst;return y=re,T=Error(z(419)),y=ju(T,y,void 0),Uu(n,a,O,y)}if(re=(O&n.childLanes)!==0,xn||re){if(y=an,y!==null){switch(O&-O){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=(b&(y.suspendedLanes|O))!==0?0:b,b!==0&&b!==T.retryLane&&(T.retryLane=b,Oi(n,b),Js(y,n,b,-1))}return Zc(),y=ju(Error(z(421))),Uu(n,a,O,y)}return b.data==="$?"?(a.flags|=128,a.child=n.child,a=Ld.bind(null,n),b._reactRetry=a,null):(n=T.treeContext,ht=bs(b.nextSibling),kt=a,Ht=!0,er=null,n!==null&&(be[Se++]=Ve,be[Se++]=Fe,be[Se++]=De,Ve=n.id,Fe=n.overflow,De=a),a=Ch(a,y.children),a.flags|=4096,a)}function bd(n,a,d){n.lanes|=a;var y=n.alternate;y!==null&&(y.lanes|=a),$s(n.return,a,d)}function Ih(n,a,d,y,b){var T=n.memoizedState;T===null?n.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:y,tail:d,tailMode:b}:(T.isBackwards=a,T.rendering=null,T.renderingStartTime=0,T.last=y,T.tail=d,T.tailMode=b)}function Sd(n,a,d){var y=a.pendingProps,b=y.revealOrder,T=y.tail;if(pn(n,a,y.children,d),y=bi.current,(y&2)!==0)y=y&1|2,a.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=a.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&bd(n,d,a);else if(n.tag===19)bd(n,d,a);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===a)break e;for(;n.sibling===null;){if(n.return===null||n.return===a)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}y&=1}if($t(bi,y),(a.mode&1)===0)a.memoizedState=null;else switch(b){case"forwards":for(d=a.child,b=null;d!==null;)n=d.alternate,n!==null&&$l(n)===null&&(b=d),d=d.sibling;d=b,d===null?(b=a.child,a.child=null):(b=d.sibling,d.sibling=null),Ih(a,!1,b,d,T);break;case"backwards":for(d=null,b=a.child,a.child=null;b!==null;){if(n=b.alternate,n!==null&&$l(n)===null){a.child=b;break}n=b.sibling,b.sibling=d,d=b,b=n}Ih(a,!0,d,null,T);break;case"together":Ih(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Rc(n,a){(a.mode&1)===0&&n!==null&&(n.alternate=null,a.alternate=null,a.flags|=2)}function Hs(n,a,d){if(n!==null&&(a.dependencies=n.dependencies),ll|=a.lanes,(d&a.childLanes)===0)return null;if(n!==null&&a.child!==n.child)throw Error(z(153));if(a.child!==null){for(n=a.child,d=Fo(n,n.pendingProps),a.child=d,d.return=a;n.sibling!==null;)n=n.sibling,d=d.sibling=Fo(n,n.pendingProps),d.return=a;d.sibling=null}return a.child}function $u(n,a,d){switch(a.tag){case 3:vd(a),Ri();break;case 5:id(a);break;case 1:f(a.type)&&E(a);break;case 4:Ru(a,a.stateNode.containerInfo);break;case 10:var y=a.type._context,b=a.memoizedProps.value;$t(Bi,y._currentValue),y._currentValue=b;break;case 13:if(y=a.memoizedState,y!==null)return y.dehydrated!==null?($t(bi,bi.current&1),a.flags|=128,null):(d&a.child.childLanes)!==0?xd(n,a,d):($t(bi,bi.current&1),n=Hs(n,a,d),n!==null?n.sibling:null);$t(bi,bi.current&1);break;case 19:if(y=(d&a.childLanes)!==0,(n.flags&128)!==0){if(y)return Sd(n,a,d);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),$t(bi,bi.current),y)break;return null;case 22:case 23:return a.lanes=0,gd(n,a,d)}return Hs(n,a,d)}var Fc,Ph,kd,Mh;Fc=function(n,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)n.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Ph=function(){},kd=function(n,a,d,y){var b=n.memoizedProps;if(b!==y){n=a.stateNode,fa(Zs.current);var T=null;switch(d){case"input":b=vr(n,b),y=vr(n,y),T=[];break;case"select":b=nt({},b,{value:void 0}),y=nt({},y,{value:void 0}),T=[];break;case"textarea":b=Jr(n,b),y=Jr(n,y),T=[];break;default:typeof b.onClick!="function"&&typeof y.onClick=="function"&&(n.onclick=Qo)}es(d,y);var O;d=null;for(Ie in b)if(!y.hasOwnProperty(Ie)&&b.hasOwnProperty(Ie)&&b[Ie]!=null)if(Ie==="style"){var re=b[Ie];for(O in re)re.hasOwnProperty(O)&&(d||(d={}),d[O]="")}else Ie!=="dangerouslySetInnerHTML"&&Ie!=="children"&&Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&Ie!=="autoFocus"&&(Y.hasOwnProperty(Ie)?T||(T=[]):(T=T||[]).push(Ie,null));for(Ie in y){var ue=y[Ie];if(re=b!=null?b[Ie]:void 0,y.hasOwnProperty(Ie)&&ue!==re&&(ue!=null||re!=null))if(Ie==="style")if(re){for(O in re)!re.hasOwnProperty(O)||ue&&ue.hasOwnProperty(O)||(d||(d={}),d[O]="");for(O in ue)ue.hasOwnProperty(O)&&re[O]!==ue[O]&&(d||(d={}),d[O]=ue[O])}else d||(T||(T=[]),T.push(Ie,d)),d=ue;else Ie==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,re=re?re.__html:void 0,ue!=null&&re!==ue&&(T=T||[]).push(Ie,ue)):Ie==="children"?typeof ue!="string"&&typeof ue!="number"||(T=T||[]).push(Ie,""+ue):Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&(Y.hasOwnProperty(Ie)?(ue!=null&&Ie==="onScroll"&&qr("scroll",n),T||re===ue||(T=[])):(T=T||[]).push(Ie,ue))}d&&(T=T||[]).push("style",d);var Ie=T;(a.updateQueue=Ie)&&(a.flags|=4)}},Mh=function(n,a,d,y){d!==y&&(a.flags|=4)};function qu(n,a){if(!Ht)switch(n.tailMode){case"hidden":a=n.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?n.tail=null:d.sibling=null;break;case"collapsed":d=n.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?a||n.tail===null?n.tail=null:n.tail.sibling=null:y.sibling=null}}function wn(n){var a=n.alternate!==null&&n.alternate.child===n.child,d=0,y=0;if(a)for(var b=n.child;b!==null;)d|=b.lanes|b.childLanes,y|=b.subtreeFlags&14680064,y|=b.flags&14680064,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)d|=b.lanes|b.childLanes,y|=b.subtreeFlags,y|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=y,n.childLanes=d,a}function Zu(n,a,d){var y=a.pendingProps;switch(tt(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wn(a),null;case 1:return f(a.type)&&v(),wn(a),null;case 3:return y=a.stateNode,nl(),Zr(s),Zr(t),Fu(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(n===null||n.child===null)&&(fi(a)?a.flags|=4:n===null||n.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,er!==null&&(Uc(er),er=null))),Ph(n,a),wn(a),null;case 5:Sc(a);var b=fa(Ws.current);if(d=a.type,n!==null&&a.stateNode!=null)kd(n,a,d,y,b),n.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!y){if(a.stateNode===null)throw Error(z(166));return wn(a),null}if(n=fa(Zs.current),fi(a)){y=a.stateNode,d=a.type;var T=a.memoizedProps;switch(y[_i]=a,y[To]=T,n=(a.mode&1)!==0,d){case"dialog":qr("cancel",y),qr("close",y);break;case"iframe":case"object":case"embed":qr("load",y);break;case"video":case"audio":for(b=0;b<bo.length;b++)qr(bo[b],y);break;case"source":qr("error",y);break;case"img":case"image":case"link":qr("error",y),qr("load",y);break;case"details":qr("toggle",y);break;case"input":xr(y,T),qr("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!T.multiple},qr("invalid",y);break;case"textarea":kr(y,T),qr("invalid",y)}es(d,T),b=null;for(var O in T)if(T.hasOwnProperty(O)){var re=T[O];O==="children"?typeof re=="string"?y.textContent!==re&&(T.suppressHydrationWarning!==!0&&ko(y.textContent,re,n),b=["children",re]):typeof re=="number"&&y.textContent!==""+re&&(T.suppressHydrationWarning!==!0&&ko(y.textContent,re,n),b=["children",""+re]):Y.hasOwnProperty(O)&&re!=null&&O==="onScroll"&&qr("scroll",y)}switch(d){case"input":ir(y),fr(y,T,!0);break;case"textarea":ir(y),ui(y);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(y.onclick=Qo)}y=b,a.updateQueue=y,y!==null&&(a.flags|=4)}else{O=b.nodeType===9?b:b.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Hr(d)),n==="http://www.w3.org/1999/xhtml"?d==="script"?(n=O.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof y.is=="string"?n=O.createElement(d,{is:y.is}):(n=O.createElement(d),d==="select"&&(O=n,y.multiple?O.multiple=!0:y.size&&(O.size=y.size))):n=O.createElementNS(n,d),n[_i]=a,n[To]=y,Fc(n,a,!1,!1),a.stateNode=n;e:{switch(O=Qe(d,y),d){case"dialog":qr("cancel",n),qr("close",n),b=y;break;case"iframe":case"object":case"embed":qr("load",n),b=y;break;case"video":case"audio":for(b=0;b<bo.length;b++)qr(bo[b],n);b=y;break;case"source":qr("error",n),b=y;break;case"img":case"image":case"link":qr("error",n),qr("load",n),b=y;break;case"details":qr("toggle",n),b=y;break;case"input":xr(n,y),b=vr(n,y),qr("invalid",n);break;case"option":b=y;break;case"select":n._wrapperState={wasMultiple:!!y.multiple},b=nt({},y,{value:void 0}),qr("invalid",n);break;case"textarea":kr(n,y),b=Jr(n,y),qr("invalid",n);break;default:b=y}es(d,b),re=b;for(T in re)if(re.hasOwnProperty(T)){var ue=re[T];T==="style"?jr(n,ue):T==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,ue!=null&&Qn(n,ue)):T==="children"?typeof ue=="string"?(d!=="textarea"||ue!=="")&&un(n,ue):typeof ue=="number"&&un(n,""+ue):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Y.hasOwnProperty(T)?ue!=null&&T==="onScroll"&&qr("scroll",n):ue!=null&&Ot(n,T,ue,O))}switch(d){case"input":ir(n),fr(n,y,!1);break;case"textarea":ir(n),ui(n);break;case"option":y.value!=null&&n.setAttribute("value",""+_t(y.value));break;case"select":n.multiple=!!y.multiple,T=y.value,T!=null?Wr(n,!!y.multiple,T,!1):y.defaultValue!=null&&Wr(n,!!y.multiple,y.defaultValue,!0);break;default:typeof b.onClick=="function"&&(n.onclick=Qo)}switch(d){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return wn(a),null;case 6:if(n&&a.stateNode!=null)Mh(n,a,n.memoizedProps,y);else{if(typeof y!="string"&&a.stateNode===null)throw Error(z(166));if(d=fa(Ws.current),fa(Zs.current),fi(a)){if(y=a.stateNode,d=a.memoizedProps,y[_i]=a,(T=y.nodeValue!==d)&&(n=kt,n!==null))switch(n.tag){case 3:ko(y.nodeValue,d,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ko(y.nodeValue,d,(n.mode&1)!==0)}T&&(a.flags|=4)}else y=(d.nodeType===9?d:d.ownerDocument).createTextNode(y),y[_i]=a,a.stateNode=y}return wn(a),null;case 13:if(Zr(bi),y=a.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ht&&ht!==null&&(a.mode&1)!==0&&(a.flags&128)===0)mi(),Ri(),a.flags|=98560,T=!1;else if(T=fi(a),y!==null&&y.dehydrated!==null){if(n===null){if(!T)throw Error(z(318));if(T=a.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(z(317));T[_i]=a}else Ri(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;wn(a),T=!1}else er!==null&&(Uc(er),er=null),T=!0;if(!T)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=d,a):(y=y!==null,y!==(n!==null&&n.memoizedState!==null)&&y&&(a.child.flags|=8192,(a.mode&1)!==0&&(n===null||(bi.current&1)!==0?Yi===0&&(Yi=3):Zc())),a.updateQueue!==null&&(a.flags|=4),wn(a),null);case 4:return nl(),Ph(n,a),n===null&&Di(a.stateNode.containerInfo),wn(a),null;case 10:return si(a.type._context),wn(a),null;case 17:return f(a.type)&&v(),wn(a),null;case 19:if(Zr(bi),T=a.memoizedState,T===null)return wn(a),null;if(y=(a.flags&128)!==0,O=T.rendering,O===null)if(y)qu(T,!1);else{if(Yi!==0||n!==null&&(n.flags&128)!==0)for(n=a.child;n!==null;){if(O=$l(n),O!==null){for(a.flags|=128,qu(T,!1),y=O.updateQueue,y!==null&&(a.updateQueue=y,a.flags|=4),a.subtreeFlags=0,y=d,d=a.child;d!==null;)T=d,n=y,T.flags&=14680066,O=T.alternate,O===null?(T.childLanes=0,T.lanes=n,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=O.childLanes,T.lanes=O.lanes,T.child=O.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=O.memoizedProps,T.memoizedState=O.memoizedState,T.updateQueue=O.updateQueue,T.type=O.type,n=O.dependencies,T.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),d=d.sibling;return $t(bi,bi.current&1|2),a.child}n=n.sibling}T.tail!==null&&ci()>ru&&(a.flags|=128,y=!0,qu(T,!1),a.lanes=4194304)}else{if(!y)if(n=$l(O),n!==null){if(a.flags|=128,y=!0,d=n.updateQueue,d!==null&&(a.updateQueue=d,a.flags|=4),qu(T,!0),T.tail===null&&T.tailMode==="hidden"&&!O.alternate&&!Ht)return wn(a),null}else 2*ci()-T.renderingStartTime>ru&&d!==1073741824&&(a.flags|=128,y=!0,qu(T,!1),a.lanes=4194304);T.isBackwards?(O.sibling=a.child,a.child=O):(d=T.last,d!==null?d.sibling=O:a.child=O,T.last=O)}return T.tail!==null?(a=T.tail,T.rendering=a,T.tail=a.sibling,T.renderingStartTime=ci(),a.sibling=null,d=bi.current,$t(bi,y?d&1|2:d&1),a):(wn(a),null);case 22:case 23:return qc(),y=a.memoizedState!==null,n!==null&&n.memoizedState!==null!==y&&(a.flags|=8192),y&&(a.mode&1)!==0?(ls&1073741824)!==0&&(wn(a),a.subtreeFlags&6&&(a.flags|=8192)):wn(a),null;case 24:return null;case 25:return null}throw Error(z(156,a.tag))}function Td(n,a){switch(tt(a),a.tag){case 1:return f(a.type)&&v(),n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 3:return nl(),Zr(s),Zr(t),Fu(),n=a.flags,(n&65536)!==0&&(n&128)===0?(a.flags=n&-65537|128,a):null;case 5:return Sc(a),null;case 13:if(Zr(bi),n=a.memoizedState,n!==null&&n.dehydrated!==null){if(a.alternate===null)throw Error(z(340));Ri()}return n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 19:return Zr(bi),null;case 4:return nl(),null;case 10:return si(a.type._context),null;case 22:case 23:return qc(),null;case 24:return null;default:return null}}var Bc=!1,bn=!1,sp=typeof WeakSet=="function"?WeakSet:Set,Mt=null;function Jl(n,a){var d=n.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(y){Ei(n,a,y)}else d.current=null}function Ah(n,a,d){try{d()}catch(y){Ei(n,a,y)}}var zh=!1;function Dh(n,a){if(Nl=Sa,n=Cu(),xs(n)){if("selectionStart"in n)var d={start:n.selectionStart,end:n.selectionEnd};else e:{d=(d=n.ownerDocument)&&d.defaultView||window;var y=d.getSelection&&d.getSelection();if(y&&y.rangeCount!==0){d=y.anchorNode;var b=y.anchorOffset,T=y.focusNode;y=y.focusOffset;try{d.nodeType,T.nodeType}catch{d=null;break e}var O=0,re=-1,ue=-1,Ie=0,We=0,Ye=n,He=null;t:for(;;){for(var Tt;Ye!==d||b!==0&&Ye.nodeType!==3||(re=O+b),Ye!==T||y!==0&&Ye.nodeType!==3||(ue=O+y),Ye.nodeType===3&&(O+=Ye.nodeValue.length),(Tt=Ye.firstChild)!==null;)He=Ye,Ye=Tt;for(;;){if(Ye===n)break t;if(He===d&&++Ie===b&&(re=O),He===T&&++We===y&&(ue=O),(Tt=Ye.nextSibling)!==null)break;Ye=He,He=Ye.parentNode}Ye=Tt}d=re===-1||ue===-1?null:{start:re,end:ue}}else d=null}d=d||{start:0,end:0}}else d=null;for(Vl={focusedElem:n,selectionRange:d},Sa=!1,Mt=a;Mt!==null;)if(a=Mt,n=a.child,(a.subtreeFlags&1028)!==0&&n!==null)n.return=a,Mt=n;else for(;Mt!==null;){a=Mt;try{var zt=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(zt!==null){var Bt=zt.memoizedProps,ai=zt.memoizedState,_e=a.stateNode,de=_e.getSnapshotBeforeUpdate(a.elementType===a.type?Bt:Ps(a.type,Bt),ai);_e.__reactInternalSnapshotBeforeUpdate=de}break;case 3:var Ee=a.stateNode.containerInfo;Ee.nodeType===1?Ee.textContent="":Ee.nodeType===9&&Ee.documentElement&&Ee.removeChild(Ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(z(163))}}catch(rt){Ei(a,a.return,rt)}if(n=a.sibling,n!==null){n.return=a.return,Mt=n;break}Mt=a.return}return zt=zh,zh=!1,zt}function Ql(n,a,d){var y=a.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var b=y=y.next;do{if((b.tag&n)===n){var T=b.destroy;b.destroy=void 0,T!==void 0&&Ah(a,d,T)}b=b.next}while(b!==y)}}function Gu(n,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&n)===n){var y=d.create;d.destroy=y()}d=d.next}while(d!==a)}}function Oc(n){var a=n.ref;if(a!==null){var d=n.stateNode;switch(n.tag){case 5:n=d;break;default:n=d}typeof a=="function"?a(n):a.current=n}}function Ed(n){var a=n.alternate;a!==null&&(n.alternate=null,Ed(a)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(a=n.stateNode,a!==null&&(delete a[_i],delete a[To],delete a[ei],delete a[ii],delete a[Eo])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Wu(n){return n.tag===5||n.tag===3||n.tag===4}function Cd(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Wu(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Nc(n,a,d){var y=n.tag;if(y===5||y===6)n=n.stateNode,a?d.nodeType===8?d.parentNode.insertBefore(n,a):d.insertBefore(n,a):(d.nodeType===8?(a=d.parentNode,a.insertBefore(n,d)):(a=d,a.appendChild(n)),d=d._reactRootContainer,d!=null||a.onclick!==null||(a.onclick=Qo));else if(y!==4&&(n=n.child,n!==null))for(Nc(n,a,d),n=n.sibling;n!==null;)Nc(n,a,d),n=n.sibling}function Lh(n,a,d){var y=n.tag;if(y===5||y===6)n=n.stateNode,a?d.insertBefore(n,a):d.appendChild(n);else if(y!==4&&(n=n.child,n!==null))for(Lh(n,a,d),n=n.sibling;n!==null;)Lh(n,a,d),n=n.sibling}var fn=null,Ks=!1;function ja(n,a,d){for(d=d.child;d!==null;)Id(n,a,d),d=d.sibling}function Id(n,a,d){if(hi&&typeof hi.onCommitFiberUnmount=="function")try{hi.onCommitFiberUnmount(Ii,d)}catch{}switch(d.tag){case 5:bn||Jl(d,a);case 6:var y=fn,b=Ks;fn=null,ja(n,a,d),fn=y,Ks=b,fn!==null&&(Ks?(n=fn,d=d.stateNode,n.nodeType===8?n.parentNode.removeChild(d):n.removeChild(d)):fn.removeChild(d.stateNode));break;case 18:fn!==null&&(Ks?(n=fn,d=d.stateNode,n.nodeType===8?tl(n.parentNode,d):n.nodeType===1&&tl(n,d),jn(n)):tl(fn,d.stateNode));break;case 4:y=fn,b=Ks,fn=d.stateNode.containerInfo,Ks=!0,ja(n,a,d),fn=y,Ks=b;break;case 0:case 11:case 14:case 15:if(!bn&&(y=d.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){b=y=y.next;do{var T=b,O=T.destroy;T=T.tag,O!==void 0&&((T&2)!==0||(T&4)!==0)&&Ah(d,a,O),b=b.next}while(b!==y)}ja(n,a,d);break;case 1:if(!bn&&(Jl(d,a),y=d.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=d.memoizedProps,y.state=d.memoizedState,y.componentWillUnmount()}catch(re){Ei(d,a,re)}ja(n,a,d);break;case 21:ja(n,a,d);break;case 22:d.mode&1?(bn=(y=bn)||d.memoizedState!==null,ja(n,a,d),bn=y):ja(n,a,d);break;default:ja(n,a,d)}}function Pd(n){var a=n.updateQueue;if(a!==null){n.updateQueue=null;var d=n.stateNode;d===null&&(d=n.stateNode=new sp),a.forEach(function(y){var b=Hc.bind(null,n,y);d.has(y)||(d.add(y),y.then(b,b))})}}function zn(n,a){var d=a.deletions;if(d!==null)for(var y=0;y<d.length;y++){var b=d[y];try{var T=n,O=a,re=O;e:for(;re!==null;){switch(re.tag){case 5:fn=re.stateNode,Ks=!1;break e;case 3:fn=re.stateNode.containerInfo,Ks=!0;break e;case 4:fn=re.stateNode.containerInfo,Ks=!0;break e}re=re.return}if(fn===null)throw Error(z(160));Id(T,O,b),fn=null,Ks=!1;var ue=b.alternate;ue!==null&&(ue.return=null),b.return=null}catch(Ie){Ei(b,a,Ie)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)Ci(a,n),a=a.sibling}function Ci(n,a){var d=n.alternate,y=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(zn(a,n),Xs(n),y&4){try{Ql(3,n,n.return),Gu(3,n)}catch(Bt){Ei(n,n.return,Bt)}try{Ql(5,n,n.return)}catch(Bt){Ei(n,n.return,Bt)}}break;case 1:zn(a,n),Xs(n),y&512&&d!==null&&Jl(d,d.return);break;case 5:if(zn(a,n),Xs(n),y&512&&d!==null&&Jl(d,d.return),n.flags&32){var b=n.stateNode;try{un(b,"")}catch(Bt){Ei(n,n.return,Bt)}}if(y&4&&(b=n.stateNode,b!=null)){var T=n.memoizedProps,O=d!==null?d.memoizedProps:T,re=n.type,ue=n.updateQueue;if(n.updateQueue=null,ue!==null)try{re==="input"&&T.type==="radio"&&T.name!=null&&nr(b,T),Qe(re,O);var Ie=Qe(re,T);for(O=0;O<ue.length;O+=2){var We=ue[O],Ye=ue[O+1];We==="style"?jr(b,Ye):We==="dangerouslySetInnerHTML"?Qn(b,Ye):We==="children"?un(b,Ye):Ot(b,We,Ye,Ie)}switch(re){case"input":Vr(b,T);break;case"textarea":Kt(b,T);break;case"select":var He=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!T.multiple;var Tt=T.value;Tt!=null?Wr(b,!!T.multiple,Tt,!1):He!==!!T.multiple&&(T.defaultValue!=null?Wr(b,!!T.multiple,T.defaultValue,!0):Wr(b,!!T.multiple,T.multiple?[]:"",!1))}b[To]=T}catch(Bt){Ei(n,n.return,Bt)}}break;case 6:if(zn(a,n),Xs(n),y&4){if(n.stateNode===null)throw Error(z(162));b=n.stateNode,T=n.memoizedProps;try{b.nodeValue=T}catch(Bt){Ei(n,n.return,Bt)}}break;case 3:if(zn(a,n),Xs(n),y&4&&d!==null&&d.memoizedState.isDehydrated)try{jn(a.containerInfo)}catch(Bt){Ei(n,n.return,Bt)}break;case 4:zn(a,n),Xs(n);break;case 13:zn(a,n),Xs(n),b=n.child,b.flags&8192&&(T=b.memoizedState!==null,b.stateNode.isHidden=T,!T||b.alternate!==null&&b.alternate.memoizedState!==null||(Ku=ci())),y&4&&Pd(n);break;case 22:if(We=d!==null&&d.memoizedState!==null,n.mode&1?(bn=(Ie=bn)||We,zn(a,n),bn=Ie):zn(a,n),Xs(n),y&8192){if(Ie=n.memoizedState!==null,(n.stateNode.isHidden=Ie)&&!We&&(n.mode&1)!==0)for(Mt=n,We=n.child;We!==null;){for(Ye=Mt=We;Mt!==null;){switch(He=Mt,Tt=He.child,He.tag){case 0:case 11:case 14:case 15:Ql(4,He,He.return);break;case 1:Jl(He,He.return);var zt=He.stateNode;if(typeof zt.componentWillUnmount=="function"){y=He,d=He.return;try{a=y,zt.props=a.memoizedProps,zt.state=a.memoizedState,zt.componentWillUnmount()}catch(Bt){Ei(y,d,Bt)}}break;case 5:Jl(He,He.return);break;case 22:if(He.memoizedState!==null){Vc(Ye);continue}}Tt!==null?(Tt.return=He,Mt=Tt):Vc(Ye)}We=We.sibling}e:for(We=null,Ye=n;;){if(Ye.tag===5){if(We===null){We=Ye;try{b=Ye.stateNode,Ie?(T=b.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(re=Ye.stateNode,ue=Ye.memoizedProps.style,O=ue!=null&&ue.hasOwnProperty("display")?ue.display:null,re.style.display=$i("display",O))}catch(Bt){Ei(n,n.return,Bt)}}}else if(Ye.tag===6){if(We===null)try{Ye.stateNode.nodeValue=Ie?"":Ye.memoizedProps}catch(Bt){Ei(n,n.return,Bt)}}else if((Ye.tag!==22&&Ye.tag!==23||Ye.memoizedState===null||Ye===n)&&Ye.child!==null){Ye.child.return=Ye,Ye=Ye.child;continue}if(Ye===n)break e;for(;Ye.sibling===null;){if(Ye.return===null||Ye.return===n)break e;We===Ye&&(We=null),Ye=Ye.return}We===Ye&&(We=null),Ye.sibling.return=Ye.return,Ye=Ye.sibling}}break;case 19:zn(a,n),Xs(n),y&4&&Pd(n);break;case 21:break;default:zn(a,n),Xs(n)}}function Xs(n){var a=n.flags;if(a&2){try{e:{for(var d=n.return;d!==null;){if(Wu(d)){var y=d;break e}d=d.return}throw Error(z(160))}switch(y.tag){case 5:var b=y.stateNode;y.flags&32&&(un(b,""),y.flags&=-33);var T=Cd(n);Lh(n,T,b);break;case 3:case 4:var O=y.stateNode.containerInfo,re=Cd(n);Nc(n,re,O);break;default:throw Error(z(161))}}catch(ue){Ei(n,n.return,ue)}n.flags&=-3}a&4096&&(n.flags&=-4097)}function Md(n,a,d){Mt=n,Rh(n)}function Rh(n,a,d){for(var y=(n.mode&1)!==0;Mt!==null;){var b=Mt,T=b.child;if(b.tag===22&&y){var O=b.memoizedState!==null||Bc;if(!O){var re=b.alternate,ue=re!==null&&re.memoizedState!==null||bn;re=Bc;var Ie=bn;if(Bc=O,(bn=ue)&&!Ie)for(Mt=b;Mt!==null;)O=Mt,ue=O.child,O.tag===22&&O.memoizedState!==null?Fh(b):ue!==null?(ue.return=O,Mt=ue):Fh(b);for(;T!==null;)Mt=T,Rh(T),T=T.sibling;Mt=b,Bc=re,bn=Ie}Dr(n)}else(b.subtreeFlags&8772)!==0&&T!==null?(T.return=b,Mt=T):Dr(n)}}function Dr(n){for(;Mt!==null;){var a=Mt;if((a.flags&8772)!==0){var d=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:bn||Gu(5,a);break;case 1:var y=a.stateNode;if(a.flags&4&&!bn)if(d===null)y.componentDidMount();else{var b=a.elementType===a.type?d.memoizedProps:Ps(a.type,d.memoizedProps);y.componentDidUpdate(b,d.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var T=a.updateQueue;T!==null&&wi(a,T,y);break;case 3:var O=a.updateQueue;if(O!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=a.child.stateNode;break;case 1:d=a.child.stateNode}wi(a,O,d)}break;case 5:var re=a.stateNode;if(d===null&&a.flags&4){d=re;var ue=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":ue.autoFocus&&d.focus();break;case"img":ue.src&&(d.src=ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var Ie=a.alternate;if(Ie!==null){var We=Ie.memoizedState;if(We!==null){var Ye=We.dehydrated;Ye!==null&&jn(Ye)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(z(163))}bn||a.flags&512&&Oc(a)}catch(He){Ei(a,a.return,He)}}if(a===n){Mt=null;break}if(d=a.sibling,d!==null){d.return=a.return,Mt=d;break}Mt=a.return}}function Vc(n){for(;Mt!==null;){var a=Mt;if(a===n){Mt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,Mt=d;break}Mt=a.return}}function Fh(n){for(;Mt!==null;){var a=Mt;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{Gu(4,a)}catch(ue){Ei(a,d,ue)}break;case 1:var y=a.stateNode;if(typeof y.componentDidMount=="function"){var b=a.return;try{y.componentDidMount()}catch(ue){Ei(a,b,ue)}}var T=a.return;try{Oc(a)}catch(ue){Ei(a,T,ue)}break;case 5:var O=a.return;try{Oc(a)}catch(ue){Ei(a,O,ue)}}}catch(ue){Ei(a,a.return,ue)}if(a===n){Mt=null;break}var re=a.sibling;if(re!==null){re.return=a.return,Mt=re;break}Mt=a.return}}var Ad=Math.ceil,Ms=Ut.ReactCurrentDispatcher,zo=Ut.ReactCurrentOwner,os=Ut.ReactCurrentBatchConfig,Ar=0,an=null,Vi=null,mn=0,ls=0,eu=Ss(0),Yi=0,Hu=null,ll=0,ul=0,Do=0,tu=null,Sn=null,Ku=0,ru=1/0,Ua=null,jc=!1,Bh=null,$a=null,on=!1,ga=null,Xu=0,As=0,cl=null,Lo=-1,qa=0;function ln(){return(Ar&6)!==0?ci():Lo!==-1?Lo:Lo=ci()}function Ys(n){return(n.mode&1)===0?1:(Ar&2)!==0&&mn!==0?mn&-mn:ks.transition!==null?(qa===0&&(qa=Rs()),qa):(n=Sr,n!==0||(n=window.event,n=n===void 0?16:Ml(n.type)),n)}function Js(n,a,d,y){if(50<As)throw As=0,cl=null,Error(z(185));wa(n,d,y),((Ar&2)===0||n!==an)&&(n===an&&((Ar&2)===0&&(ul|=d),Yi===4&&ya(n,mn)),Dn(n,y),d===1&&Ar===0&&(a.mode&1)===0&&(ru=ci()+500,B&&q()))}function Dn(n,a){var d=n.callbackNode;Nn(n,a);var y=Xr(n,n===an?mn:0);if(y===0)d!==null&&yi(d),n.callbackNode=null,n.callbackPriority=0;else if(a=y&-y,n.callbackPriority!==a){if(d!=null&&yi(d),a===1)n.tag===0?K($c.bind(null,n)):G($c.bind(null,n)),qt(function(){(Ar&6)===0&&q()}),d=null;else{switch(Sl(y)){case 1:d=na;break;case 4:d=sc;break;case 16:d=Pr;break;case 536870912:d=Oo;break;default:d=Pr}d=Rd(d,Oh.bind(null,n))}n.callbackPriority=a,n.callbackNode=d}}function Oh(n,a){if(Lo=-1,qa=0,(Ar&6)!==0)throw Error(z(327));var d=n.callbackNode;if(Ro()&&n.callbackNode!==d)return null;var y=Xr(n,n===an?mn:0);if(y===0)return null;if((y&30)!==0||(y&n.expiredLanes)!==0||a)a=iu(n,y);else{a=y;var b=Ar;Ar|=2;var T=Za();(an!==n||mn!==a)&&(Ua=null,ru=ci()+500,Qs(n,a));do try{op();break}catch(re){ea(n,re)}while(!0);sn(),Ms.current=T,Ar=b,Vi!==null?a=0:(an=null,mn=0,a=Yi)}if(a!==0){if(a===2&&(b=No(n),b!==0&&(y=b,a=Nh(n,b))),a===1)throw d=Hu,Qs(n,0),ya(n,y),Dn(n,ci()),d;if(a===6)ya(n,y);else{if(b=n.current.alternate,(y&30)===0&&!zd(b)&&(a=iu(n,y),a===2&&(T=No(n),T!==0&&(y=T,a=Nh(n,T))),a===1))throw d=Hu,Qs(n,0),ya(n,y),Dn(n,ci()),d;switch(n.finishedWork=b,n.finishedLanes=y,a){case 0:case 1:throw Error(z(345));case 2:dl(n,Sn,Ua);break;case 3:if(ya(n,y),(y&130023424)===y&&(a=Ku+500-ci(),10<a)){if(Xr(n,0)!==0)break;if(b=n.suspendedLanes,(b&y)!==y){ln(),n.pingedLanes|=n.suspendedLanes&b;break}n.timeoutHandle=Xi(dl.bind(null,n,Sn,Ua),a);break}dl(n,Sn,Ua);break;case 4:if(ya(n,y),(y&4194240)===y)break;for(a=n.eventTimes,b=-1;0<y;){var O=31-di(y);T=1<<O,O=a[O],O>b&&(b=O),y&=~T}if(y=b,y=ci()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*Ad(y/1960))-y,10<y){n.timeoutHandle=Xi(dl.bind(null,n,Sn,Ua),y);break}dl(n,Sn,Ua);break;case 5:dl(n,Sn,Ua);break;default:throw Error(z(329))}}}return Dn(n,ci()),n.callbackNode===d?Oh.bind(null,n):null}function Nh(n,a){var d=tu;return n.current.memoizedState.isDehydrated&&(Qs(n,a).flags|=256),n=iu(n,a),n!==2&&(a=Sn,Sn=d,a!==null&&Uc(a)),n}function Uc(n){Sn===null?Sn=n:Sn.push.apply(Sn,n)}function zd(n){for(var a=n;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var y=0;y<d.length;y++){var b=d[y],T=b.getSnapshot;b=b.value;try{if(!hn(T(),b))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ya(n,a){for(a&=~Do,a&=~ul,n.suspendedLanes|=a,n.pingedLanes&=~a,n=n.expirationTimes;0<a;){var d=31-di(a),y=1<<d;n[d]=-1,a&=~y}}function $c(n){if((Ar&6)!==0)throw Error(z(327));Ro();var a=Xr(n,0);if((a&1)===0)return Dn(n,ci()),null;var d=iu(n,a);if(n.tag!==0&&d===2){var y=No(n);y!==0&&(a=y,d=Nh(n,y))}if(d===1)throw d=Hu,Qs(n,0),ya(n,a),Dn(n,ci()),d;if(d===6)throw Error(z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=a,dl(n,Sn,Ua),Dn(n,ci()),null}function Vh(n,a){var d=Ar;Ar|=1;try{return n(a)}finally{Ar=d,Ar===0&&(ru=ci()+500,B&&q())}}function hl(n){ga!==null&&ga.tag===0&&(Ar&6)===0&&Ro();var a=Ar;Ar|=1;var d=os.transition,y=Sr;try{if(os.transition=null,Sr=1,n)return n()}finally{Sr=y,os.transition=d,Ar=a,(Ar&6)===0&&q()}}function qc(){ls=eu.current,Zr(eu)}function Qs(n,a){n.finishedWork=null,n.finishedLanes=0;var d=n.timeoutHandle;if(d!==-1&&(n.timeoutHandle=-1,jl(d)),Vi!==null)for(d=Vi.return;d!==null;){var y=d;switch(tt(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&v();break;case 3:nl(),Zr(s),Zr(t),Fu();break;case 5:Sc(y);break;case 4:nl();break;case 13:Zr(bi);break;case 19:Zr(bi);break;case 10:si(y.type._context);break;case 22:case 23:qc()}d=d.return}if(an=n,Vi=n=Fo(n.current,null),mn=ls=a,Yi=0,Hu=null,Do=ul=ll=0,Sn=tu=null,pa!==null){for(a=0;a<pa.length;a++)if(d=pa[a],y=d.interleaved,y!==null){d.interleaved=null;var b=y.next,T=d.pending;if(T!==null){var O=T.next;T.next=b,y.next=O}d.pending=y}pa=null}return n}function ea(n,a){do{var d=Vi;try{if(sn(),Bu.current=Va,sl){for(var y=Si.memoizedState;y!==null;){var b=y.queue;b!==null&&(b.pending=null),y=y.next}sl=!1}if(Cs=0,Pi=ki=Si=null,ql=!1,Zl=0,zo.current=null,d===null||d.return===null){Yi=1,Hu=a,Vi=null;break}e:{var T=n,O=d.return,re=d,ue=a;if(a=mn,re.flags|=32768,ue!==null&&typeof ue=="object"&&typeof ue.then=="function"){var Ie=ue,We=re,Ye=We.tag;if((We.mode&1)===0&&(Ye===0||Ye===11||Ye===15)){var He=We.alternate;He?(We.updateQueue=He.updateQueue,We.memoizedState=He.memoizedState,We.lanes=He.lanes):(We.updateQueue=null,We.memoizedState=null)}var Tt=Lc(O);if(Tt!==null){Tt.flags&=-257,fd(Tt,O,re,T,a),Tt.mode&1&&pd(T,Ie,a),a=Tt,ue=Ie;var zt=a.updateQueue;if(zt===null){var Bt=new Set;Bt.add(ue),a.updateQueue=Bt}else zt.add(ue);break e}else{if((a&1)===0){pd(T,Ie,a),Zc();break e}ue=Error(z(426))}}else if(Ht&&re.mode&1){var ai=Lc(O);if(ai!==null){(ai.flags&65536)===0&&(ai.flags|=256),fd(ai,O,re,T,a),Or(Mo(ue,re));break e}}T=ue=Mo(ue,re),Yi!==4&&(Yi=2),tu===null?tu=[T]:tu.push(T),T=O;do{switch(T.tag){case 3:T.flags|=65536,a&=-a,T.lanes|=a;var _e=xh(T,ue,a);rd(T,_e);break e;case 1:re=ue;var de=T.type,Ee=T.stateNode;if((T.flags&128)===0&&(typeof de.getDerivedStateFromError=="function"||Ee!==null&&typeof Ee.componentDidCatch=="function"&&($a===null||!$a.has(Ee)))){T.flags|=65536,a&=-a,T.lanes|=a;var rt=Yl(T,re,a);rd(T,rt);break e}}T=T.return}while(T!==null)}Gc(d)}catch(Vt){a=Vt,Vi===d&&d!==null&&(Vi=d=d.return);continue}break}while(!0)}function Za(){var n=Ms.current;return Ms.current=Va,n===null?Va:n}function Zc(){(Yi===0||Yi===3||Yi===2)&&(Yi=4),an===null||(ll&268435455)===0&&(ul&268435455)===0||ya(an,mn)}function iu(n,a){var d=Ar;Ar|=2;var y=Za();(an!==n||mn!==a)&&(Ua=null,Qs(n,a));do try{ap();break}catch(b){ea(n,b)}while(!0);if(sn(),Ar=d,Ms.current=y,Vi!==null)throw Error(z(261));return an=null,mn=0,Yi}function ap(){for(;Vi!==null;)Yu(Vi)}function op(){for(;Vi!==null&&!Gi();)Yu(Vi)}function Yu(n){var a=Uh(n.alternate,n,ls);n.memoizedProps=n.pendingProps,a===null?Gc(n):Vi=a,zo.current=null}function Gc(n){var a=n;do{var d=a.alternate;if(n=a.return,(a.flags&32768)===0){if(d=Zu(d,a,ls),d!==null){Vi=d;return}}else{if(d=Td(d,a),d!==null){d.flags&=32767,Vi=d;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Yi=6,Vi=null;return}}if(a=a.sibling,a!==null){Vi=a;return}Vi=a=n}while(a!==null);Yi===0&&(Yi=5)}function dl(n,a,d){var y=Sr,b=os.transition;try{os.transition=null,Sr=1,jh(n,a,d,y)}finally{os.transition=b,Sr=y}return null}function jh(n,a,d,y){do Ro();while(ga!==null);if((Ar&6)!==0)throw Error(z(327));d=n.finishedWork;var b=n.finishedLanes;if(d===null)return null;if(n.finishedWork=null,n.finishedLanes=0,d===n.current)throw Error(z(177));n.callbackNode=null,n.callbackPriority=0;var T=d.lanes|d.childLanes;if(bl(n,T),n===an&&(Vi=an=null,mn=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||on||(on=!0,Rd(Pr,function(){return Ro(),null})),T=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||T){T=os.transition,os.transition=null;var O=Sr;Sr=1;var re=Ar;Ar|=4,zo.current=null,Dh(n,d),Ci(d,n),_c(Vl),Sa=!!Nl,Vl=Nl=null,n.current=d,Md(d),On(),Ar=re,Sr=O,os.transition=T}else n.current=d;if(on&&(on=!1,ga=n,Xu=b),T=n.pendingLanes,T===0&&($a=null),lh(d.stateNode),Dn(n,ci()),a!==null)for(y=n.onRecoverableError,d=0;d<a.length;d++)b=a[d],y(b.value,{componentStack:b.stack,digest:b.digest});if(jc)throw jc=!1,n=Bh,Bh=null,n;return(Xu&1)!==0&&n.tag!==0&&Ro(),T=n.pendingLanes,(T&1)!==0?n===cl?As++:(As=0,cl=n):As=0,q(),null}function Ro(){if(ga!==null){var n=Sl(Xu),a=os.transition,d=Sr;try{if(os.transition=null,Sr=16>n?16:n,ga===null)var y=!1;else{if(n=ga,ga=null,Xu=0,(Ar&6)!==0)throw Error(z(331));var b=Ar;for(Ar|=4,Mt=n.current;Mt!==null;){var T=Mt,O=T.child;if((Mt.flags&16)!==0){var re=T.deletions;if(re!==null){for(var ue=0;ue<re.length;ue++){var Ie=re[ue];for(Mt=Ie;Mt!==null;){var We=Mt;switch(We.tag){case 0:case 11:case 15:Ql(8,We,T)}var Ye=We.child;if(Ye!==null)Ye.return=We,Mt=Ye;else for(;Mt!==null;){We=Mt;var He=We.sibling,Tt=We.return;if(Ed(We),We===Ie){Mt=null;break}if(He!==null){He.return=Tt,Mt=He;break}Mt=Tt}}}var zt=T.alternate;if(zt!==null){var Bt=zt.child;if(Bt!==null){zt.child=null;do{var ai=Bt.sibling;Bt.sibling=null,Bt=ai}while(Bt!==null)}}Mt=T}}if((T.subtreeFlags&2064)!==0&&O!==null)O.return=T,Mt=O;else e:for(;Mt!==null;){if(T=Mt,(T.flags&2048)!==0)switch(T.tag){case 0:case 11:case 15:Ql(9,T,T.return)}var _e=T.sibling;if(_e!==null){_e.return=T.return,Mt=_e;break e}Mt=T.return}}var de=n.current;for(Mt=de;Mt!==null;){O=Mt;var Ee=O.child;if((O.subtreeFlags&2064)!==0&&Ee!==null)Ee.return=O,Mt=Ee;else e:for(O=de;Mt!==null;){if(re=Mt,(re.flags&2048)!==0)try{switch(re.tag){case 0:case 11:case 15:Gu(9,re)}}catch(Vt){Ei(re,re.return,Vt)}if(re===O){Mt=null;break e}var rt=re.sibling;if(rt!==null){rt.return=re.return,Mt=rt;break e}Mt=re.return}}if(Ar=b,q(),hi&&typeof hi.onPostCommitFiberRoot=="function")try{hi.onPostCommitFiberRoot(Ii,n)}catch{}y=!0}return y}finally{Sr=d,os.transition=a}}return!1}function pl(n,a,d){a=Mo(d,a),a=xh(n,a,1),n=Es(n,a,1),a=ln(),n!==null&&(wa(n,1,a),Dn(n,a))}function Ei(n,a,d){if(n.tag===3)pl(n,n,d);else for(;a!==null;){if(a.tag===3){pl(a,n,d);break}else if(a.tag===1){var y=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&($a===null||!$a.has(y))){n=Mo(d,n),n=Yl(a,n,1),a=Es(a,n,1),n=ln(),a!==null&&(wa(a,1,n),Dn(a,n));break}}a=a.return}}function Dd(n,a,d){var y=n.pingCache;y!==null&&y.delete(a),a=ln(),n.pingedLanes|=n.suspendedLanes&d,an===n&&(mn&d)===d&&(Yi===4||Yi===3&&(mn&130023424)===mn&&500>ci()-Ku?Qs(n,0):Do|=d),Dn(n,a)}function Wc(n,a){a===0&&((n.mode&1)===0?a=1:(a=br,br<<=1,(br&130023424)===0&&(br=4194304)));var d=ln();n=Oi(n,a),n!==null&&(wa(n,a,d),Dn(n,d))}function Ld(n){var a=n.memoizedState,d=0;a!==null&&(d=a.retryLane),Wc(n,d)}function Hc(n,a){var d=0;switch(n.tag){case 13:var y=n.stateNode,b=n.memoizedState;b!==null&&(d=b.retryLane);break;case 19:y=n.stateNode;break;default:throw Error(z(314))}y!==null&&y.delete(a),Wc(n,d)}var Uh;Uh=function(n,a,d){if(n!==null)if(n.memoizedProps!==a.pendingProps||s.current)xn=!0;else{if((n.lanes&d)===0&&(a.flags&128)===0)return xn=!1,$u(n,a,d);xn=(n.flags&131072)!==0}else xn=!1,Ht&&(a.flags&1048576)!==0&&bt(a,he,a.index);switch(a.lanes=0,a.tag){case 2:var y=a.type;Rc(n,a),n=a.pendingProps;var b=h(a,t.current);qs(a,d),b=Ou(null,a,y,n,b,d);var T=Tc();return a.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,f(y)?(T=!0,E(a)):T=!1,a.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,Zn(a),b.updater=al,a.stateNode=b,b._reactInternals=a,ol(a,y,n,d),a=ma(null,a,y,!0,T,d)):(a.tag=0,Ht&&T&&cr(a),pn(null,a,b,d),a=a.child),a;case 16:y=a.elementType;e:{switch(Rc(n,a),n=a.pendingProps,b=y._init,y=b(y._payload),a.type=y,b=a.tag=up(y),n=Ps(y,n),b){case 0:a=kh(null,a,y,n,d);break e;case 1:a=_d(null,a,y,n,d);break e;case 11:a=bh(null,a,y,n,d);break e;case 14:a=Sh(null,a,y,Ps(y.type,n),d);break e}throw Error(z(306,y,""))}return a;case 0:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Ps(y,b),kh(n,a,y,b,d);case 1:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Ps(y,b),_d(n,a,y,b,d);case 3:e:{if(vd(a),n===null)throw Error(z(387));y=a.pendingProps,T=a.memoizedState,b=T.element,An(n,a),Lu(a,y,null,d);var O=a.memoizedState;if(y=O.element,T.isDehydrated)if(T={element:y,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},a.updateQueue.baseState=T,a.memoizedState=T,a.flags&256){b=Mo(Error(z(423)),a),a=Th(n,a,y,d,b);break e}else if(y!==b){b=Mo(Error(z(424)),a),a=Th(n,a,y,d,b);break e}else for(ht=bs(a.stateNode.containerInfo.firstChild),kt=a,Ht=!0,er=null,d=Fi(a,null,y,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ri(),y===b){a=Hs(n,a,d);break e}pn(n,a,y,d)}a=a.child}return a;case 5:return id(a),n===null&&Rr(a),y=a.type,b=a.pendingProps,T=n!==null?n.memoizedProps:null,O=b.children,zu(y,b)?O=null:T!==null&&zu(y,T)&&(a.flags|=32),yd(n,a),pn(n,a,O,d),a.child;case 6:return n===null&&Rr(a),null;case 13:return xd(n,a,d);case 4:return Ru(a,a.stateNode.containerInfo),y=a.pendingProps,n===null?a.child=vi(a,null,y,d):pn(n,a,y,d),a.child;case 11:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Ps(y,b),bh(n,a,y,b,d);case 7:return pn(n,a,a.pendingProps,d),a.child;case 8:return pn(n,a,a.pendingProps.children,d),a.child;case 12:return pn(n,a,a.pendingProps.children,d),a.child;case 10:e:{if(y=a.type._context,b=a.pendingProps,T=a.memoizedProps,O=b.value,$t(Bi,y._currentValue),y._currentValue=O,T!==null)if(hn(T.value,O)){if(T.children===b.children&&!s.current){a=Hs(n,a,d);break e}}else for(T=a.child,T!==null&&(T.return=a);T!==null;){var re=T.dependencies;if(re!==null){O=T.child;for(var ue=re.firstContext;ue!==null;){if(ue.context===y){if(T.tag===1){ue=Ni(-1,d&-d),ue.tag=2;var Ie=T.updateQueue;if(Ie!==null){Ie=Ie.shared;var We=Ie.pending;We===null?ue.next=ue:(ue.next=We.next,We.next=ue),Ie.pending=ue}}T.lanes|=d,ue=T.alternate,ue!==null&&(ue.lanes|=d),$s(T.return,d,a),re.lanes|=d;break}ue=ue.next}}else if(T.tag===10)O=T.type===a.type?null:T.child;else if(T.tag===18){if(O=T.return,O===null)throw Error(z(341));O.lanes|=d,re=O.alternate,re!==null&&(re.lanes|=d),$s(O,d,a),O=T.sibling}else O=T.child;if(O!==null)O.return=T;else for(O=T;O!==null;){if(O===a){O=null;break}if(T=O.sibling,T!==null){T.return=O.return,O=T;break}O=O.return}T=O}pn(n,a,b.children,d),a=a.child}return a;case 9:return b=a.type,y=a.pendingProps.children,qs(a,d),b=Mn(b),y=y(b),a.flags|=1,pn(n,a,y,d),a.child;case 14:return y=a.type,b=Ps(y,a.pendingProps),b=Ps(y.type,b),Sh(n,a,y,b,d);case 15:return md(n,a,a.type,a.pendingProps,d);case 17:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Ps(y,b),Rc(n,a),a.tag=1,f(y)?(n=!0,E(a)):n=!1,qs(a,d),_h(a,y,b),ol(a,y,b,d),ma(null,a,y,!0,n,d);case 19:return Sd(n,a,d);case 22:return gd(n,a,d)}throw Error(z(156,a.tag))};function Rd(n,a){return Br(n,a)}function lp(n,a,d,y){this.tag=n,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function us(n,a,d,y){return new lp(n,a,d,y)}function $h(n){return n=n.prototype,!(!n||!n.isReactComponent)}function up(n){if(typeof n=="function")return $h(n)?1:0;if(n!=null){if(n=n.$$typeof,n===ot)return 11;if(n===dr)return 14}return 2}function Fo(n,a){var d=n.alternate;return d===null?(d=us(n.tag,a,n.key,n.mode),d.elementType=n.elementType,d.type=n.type,d.stateNode=n.stateNode,d.alternate=n,n.alternate=d):(d.pendingProps=a,d.type=n.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=n.flags&14680064,d.childLanes=n.childLanes,d.lanes=n.lanes,d.child=n.child,d.memoizedProps=n.memoizedProps,d.memoizedState=n.memoizedState,d.updateQueue=n.updateQueue,a=n.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=n.sibling,d.index=n.index,d.ref=n.ref,d}function Kc(n,a,d,y,b,T){var O=2;if(y=n,typeof n=="function")$h(n)&&(O=1);else if(typeof n=="string")O=5;else e:switch(n){case ft:return Ga(d.children,b,T,a);case le:O=8,b|=8;break;case ve:return n=us(12,d,a,b|2),n.elementType=ve,n.lanes=T,n;case ct:return n=us(13,d,a,b),n.elementType=ct,n.lanes=T,n;case Wt:return n=us(19,d,a,b),n.elementType=Wt,n.lanes=T,n;case yt:return ta(d,b,T,a);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ae:O=10;break e;case mt:O=9;break e;case ot:O=11;break e;case dr:O=14;break e;case pr:O=16,y=null;break e}throw Error(z(130,n==null?n:typeof n,""))}return a=us(O,d,a,b),a.elementType=n,a.type=y,a.lanes=T,a}function Ga(n,a,d,y){return n=us(7,n,y,a),n.lanes=d,n}function ta(n,a,d,y){return n=us(22,n,y,a),n.elementType=yt,n.lanes=d,n.stateNode={isHidden:!1},n}function Xc(n,a,d){return n=us(6,n,null,a),n.lanes=d,n}function Yc(n,a,d){return a=us(4,n.children!==null?n.children:[],n.key,a),a.lanes=d,a.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},a}function Fd(n,a,d,y,b){this.tag=a,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wl(0),this.expirationTimes=wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.identifierPrefix=y,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Jc(n,a,d,y,b,T,O,re,ue){return n=new Fd(n,a,d,re,ue),a===1?(a=1,T===!0&&(a|=8)):a=0,T=us(3,null,null,a),n.current=T,T.stateNode=n,T.memoizedState={element:y,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zn(T),n}function Bd(n,a,d){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rt,key:y==null?null:""+y,children:n,containerInfo:a,implementation:d}}function qh(n){if(!n)return p;n=n._reactInternals;e:{if(Gt(n)!==n||n.tag!==1)throw Error(z(170));var a=n;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(f(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(z(171))}if(n.tag===1){var d=n.type;if(f(d))return S(n,d,a)}return a}function Qc(n,a,d,y,b,T,O,re,ue){return n=Jc(d,y,!0,n,b,T,O,re,ue),n.context=qh(null),d=n.current,y=ln(),b=Ys(d),T=Ni(y,b),T.callback=a??null,Es(d,T,b),n.current.lanes=b,wa(n,b,y),Dn(n,y),n}function fl(n,a,d,y){var b=a.current,T=ln(),O=Ys(b);return d=qh(d),a.context===null?a.context=d:a.pendingContext=d,a=Ni(T,O),a.payload={element:n},y=y===void 0?null:y,y!==null&&(a.callback=y),n=Es(b,a,O),n!==null&&(Js(n,b,O,T),Gn(n,b,O)),O}function Ju(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function eh(n,a){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var d=n.retryLane;n.retryLane=d!==0&&d<a?d:a}}function th(n,a){eh(n,a),(n=n.alternate)&&eh(n,a)}function cs(){return null}var nu=typeof reportError=="function"?reportError:function(n){console.error(n)};function rh(n){this._internalRoot=n}Qu.prototype.render=rh.prototype.render=function(n){var a=this._internalRoot;if(a===null)throw Error(z(409));fl(n,a,null,null)},Qu.prototype.unmount=rh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var a=n.containerInfo;hl(function(){fl(null,n,null,null)}),a[dn]=null}};function Qu(n){this._internalRoot=n}Qu.prototype.unstable_scheduleHydration=function(n){if(n){var a=Tl();n={blockedOn:null,target:n,priority:a};for(var d=0;d<gs.length&&a!==0&&a<gs[d].priority;d++);gs.splice(d,0,n),d===0&&Vo(n)}};function ih(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ec(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Zh(){}function Od(n,a,d,y,b){if(b){if(typeof y=="function"){var T=y;y=function(){var Ie=Ju(O);T.call(Ie)}}var O=Qc(a,y,n,0,null,!1,!1,"",Zh);return n._reactRootContainer=O,n[dn]=O.current,Di(n.nodeType===8?n.parentNode:n),hl(),O}for(;b=n.lastChild;)n.removeChild(b);if(typeof y=="function"){var re=y;y=function(){var Ie=Ju(ue);re.call(Ie)}}var ue=Jc(n,0,!1,null,null,!1,!1,"",Zh);return n._reactRootContainer=ue,n[dn]=ue.current,Di(n.nodeType===8?n.parentNode:n),hl(function(){fl(a,ue,d,y)}),ue}function nh(n,a,d,y,b){var T=d._reactRootContainer;if(T){var O=T;if(typeof b=="function"){var re=b;b=function(){var ue=Ju(O);re.call(ue)}}fl(a,O,n,b)}else O=Od(d,a,n,b,y);return Ju(O)}to=function(n){switch(n.tag){case 3:var a=n.stateNode;if(a.current.memoizedState.isDehydrated){var d=ts(a.pendingLanes);d!==0&&(eo(a,d|1),Dn(a,ci()),(Ar&6)===0&&(ru=ci()+500,q()))}break;case 13:hl(function(){var y=Oi(n,1);if(y!==null){var b=ln();Js(y,n,1,b)}}),th(n,1)}},kl=function(n){if(n.tag===13){var a=Oi(n,134217728);if(a!==null){var d=ln();Js(a,n,134217728,d)}th(n,134217728)}},ac=function(n){if(n.tag===13){var a=Ys(n),d=Oi(n,a);if(d!==null){var y=ln();Js(d,n,a,y)}th(n,a)}},Tl=function(){return Sr},El=function(n,a){var d=Sr;try{return Sr=n,a()}finally{Sr=d}},qi=function(n,a,d){switch(a){case"input":if(Vr(n,d),a=d.name,d.type==="radio"&&a!=null){for(d=n;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<d.length;a++){var y=d[a];if(y!==n&&y.form===n.form){var b=Co(y);if(!b)throw Error(z(90));Tr(y),Vr(y,b)}}}break;case"textarea":Kt(n,d);break;case"select":a=d.value,a!=null&&Wr(n,!!d.multiple,a,!1)}},F=Vh,U=hl;var Nd={usingClientEntryPoint:!1,Events:[Us,qn,Co,H,L,Vh]},zs={findFiberByHostInstance:ns,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Vd={bundleType:zs.bundleType,version:zs.version,rendererPackageName:zs.rendererPackageName,rendererConfig:zs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ut.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=yr(n),n===null?null:n.stateNode},findFiberByHostInstance:zs.findFiberByHostInstance||cs,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tc.isDisabled&&tc.supportsFiber)try{Ii=tc.inject(Vd),hi=tc}catch{}}return Ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nd,Ls.createPortal=function(n,a){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ih(a))throw Error(z(200));return Bd(n,a,null,d)},Ls.createRoot=function(n,a){if(!ih(n))throw Error(z(299));var d=!1,y="",b=nu;return a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(y=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=Jc(n,1,!1,null,null,d,!1,y,b),n[dn]=a.current,Di(n.nodeType===8?n.parentNode:n),new rh(a)},Ls.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var a=n._reactInternals;if(a===void 0)throw typeof n.render=="function"?Error(z(188)):(n=Object.keys(n).join(","),Error(z(268,n)));return n=yr(a),n=n===null?null:n.stateNode,n},Ls.flushSync=function(n){return hl(n)},Ls.hydrate=function(n,a,d){if(!ec(a))throw Error(z(200));return nh(null,n,a,!0,d)},Ls.hydrateRoot=function(n,a,d){if(!ih(n))throw Error(z(405));var y=d!=null&&d.hydratedSources||null,b=!1,T="",O=nu;if(d!=null&&(d.unstable_strictMode===!0&&(b=!0),d.identifierPrefix!==void 0&&(T=d.identifierPrefix),d.onRecoverableError!==void 0&&(O=d.onRecoverableError)),a=Qc(a,null,n,1,d??null,b,!1,T,O),n[dn]=a.current,Di(n),y)for(n=0;n<y.length;n++)d=y[n],b=d._getVersion,b=b(d._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[d,b]:a.mutableSourceEagerHydrationData.push(d,b);return new Qu(a)},Ls.render=function(n,a,d){if(!ec(a))throw Error(z(200));return nh(null,n,a,!1,d)},Ls.unmountComponentAtNode=function(n){if(!ec(n))throw Error(z(40));return n._reactRootContainer?(hl(function(){nh(null,null,n,!1,function(){n._reactRootContainer=null,n[dn]=null})}),!0):!1},Ls.unstable_batchedUpdates=Vh,Ls.unstable_renderSubtreeIntoContainer=function(n,a,d,y){if(!ec(d))throw Error(z(200));if(n==null||n._reactInternals===void 0)throw Error(z(38));return nh(n,a,d,!1,y)},Ls.version="18.3.1-next-f1338f8080-20240426",Ls}var af;function Pf(){if(af)return xp.exports;af=1;function A(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(A)}catch(D){console.error(D)}}return A(),xp.exports=hm(),xp.exports}var of;function dm(){if(of)return $d;of=1;var A=Pf();return $d.createRoot=A.createRoot,$d.hydrateRoot=A.hydrateRoot,$d}var pm=dm();const fm=ed(pm);Pf();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jh(){return Jh=Object.assign?Object.assign.bind():function(A){for(var D=1;D<arguments.length;D++){var z=arguments[D];for(var j in z)Object.prototype.hasOwnProperty.call(z,j)&&(A[j]=z[j])}return A},Jh.apply(this,arguments)}var au;(function(A){A.Pop="POP",A.Push="PUSH",A.Replace="REPLACE"})(au||(au={}));const lf="popstate";function mm(A){A===void 0&&(A={});function D(Y,ce){let{pathname:xe="/",search:c="",hash:ye=""}=nc(Y.location.hash.substr(1));return!xe.startsWith("/")&&!xe.startsWith(".")&&(xe="/"+xe),Lp("",{pathname:xe,search:c,hash:ye},ce.state&&ce.state.usr||null,ce.state&&ce.state.key||"default")}function z(Y,ce){let xe=Y.document.querySelector("base"),c="";if(xe&&xe.getAttribute("href")){let ye=Y.location.href,$=ye.indexOf("#");c=$===-1?ye:ye.slice(0,$)}return c+"#"+(typeof ce=="string"?ce:Wd(ce))}function j(Y,ce){Vp(Y.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(ce)+")")}return ym(D,z,j,A)}function Mi(A,D){if(A===!1||A===null||typeof A>"u")throw new Error(D)}function Vp(A,D){if(!A){typeof console<"u"&&console.warn(D);try{throw new Error(D)}catch{}}}function gm(){return Math.random().toString(36).substr(2,8)}function uf(A,D){return{usr:A.state,key:A.key,idx:D}}function Lp(A,D,z,j){return z===void 0&&(z=null),Jh({pathname:typeof A=="string"?A:A.pathname,search:"",hash:""},typeof D=="string"?nc(D):D,{state:z,key:D&&D.key||j||gm()})}function Wd(A){let{pathname:D="/",search:z="",hash:j=""}=A;return z&&z!=="?"&&(D+=z.charAt(0)==="?"?z:"?"+z),j&&j!=="#"&&(D+=j.charAt(0)==="#"?j:"#"+j),D}function nc(A){let D={};if(A){let z=A.indexOf("#");z>=0&&(D.hash=A.substr(z),A=A.substr(0,z));let j=A.indexOf("?");j>=0&&(D.search=A.substr(j),A=A.substr(0,j)),A&&(D.pathname=A)}return D}function ym(A,D,z,j){j===void 0&&(j={});let{window:Y=document.defaultView,v5Compat:ce=!1}=j,xe=Y.history,c=au.Pop,ye=null,$=Le();$==null&&($=0,xe.replaceState(Jh({},xe.state,{idx:$}),""));function Le(){return(xe.state||{idx:null}).idx}function Me(){c=au.Pop;let je=Le(),pt=je==null?null:je-$;$=je,ye&&ye({action:c,location:at.location,delta:pt})}function Ce(je,pt){c=au.Push;let Lt=Lp(at.location,je,pt);z&&z(Lt,je),$=Le()+1;let Ot=uf(Lt,$),Ut=at.createHref(Lt);try{xe.pushState(Ot,"",Ut)}catch(Dt){if(Dt instanceof DOMException&&Dt.name==="DataCloneError")throw Dt;Y.location.assign(Ut)}ce&&ye&&ye({action:c,location:at.location,delta:1})}function xt(je,pt){c=au.Replace;let Lt=Lp(at.location,je,pt);z&&z(Lt,je),$=Le();let Ot=uf(Lt,$),Ut=at.createHref(Lt);xe.replaceState(Ot,"",Ut),ce&&ye&&ye({action:c,location:at.location,delta:0})}function Je(je){let pt=Y.location.origin!=="null"?Y.location.origin:Y.location.href,Lt=typeof je=="string"?je:Wd(je);return Lt=Lt.replace(/ $/,"%20"),Mi(pt,"No window.location.(origin|href) available to create URL for href: "+Lt),new URL(Lt,pt)}let at={get action(){return c},get location(){return A(Y,xe)},listen(je){if(ye)throw new Error("A history only accepts one active listener");return Y.addEventListener(lf,Me),ye=je,()=>{Y.removeEventListener(lf,Me),ye=null}},createHref(je){return D(Y,je)},createURL:Je,encodeLocation(je){let pt=Je(je);return{pathname:pt.pathname,search:pt.search,hash:pt.hash}},push:Ce,replace:xt,go(je){return xe.go(je)}};return at}var cf;(function(A){A.data="data",A.deferred="deferred",A.redirect="redirect",A.error="error"})(cf||(cf={}));function _m(A,D,z){return z===void 0&&(z="/"),vm(A,D,z)}function vm(A,D,z,j){let Y=typeof D=="string"?nc(D):D,ce=sh(Y.pathname||"/",z);if(ce==null)return null;let xe=Mf(A);xm(xe);let c=null;for(let ye=0;c==null&&ye<xe.length;++ye){let $=Am(ce);c=Pm(xe[ye],$)}return c}function Mf(A,D,z,j){D===void 0&&(D=[]),z===void 0&&(z=[]),j===void 0&&(j="");let Y=(ce,xe,c)=>{let ye={relativePath:c===void 0?ce.path||"":c,caseSensitive:ce.caseSensitive===!0,childrenIndex:xe,route:ce};ye.relativePath.startsWith("/")&&(Mi(ye.relativePath.startsWith(j),'Absolute route path "'+ye.relativePath+'" nested under path '+('"'+j+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),ye.relativePath=ye.relativePath.slice(j.length));let $=ou([j,ye.relativePath]),Le=z.concat(ye);ce.children&&ce.children.length>0&&(Mi(ce.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+$+'".')),Mf(ce.children,D,Le,$)),!(ce.path==null&&!ce.index)&&D.push({path:$,score:Cm($,ce.index),routesMeta:Le})};return A.forEach((ce,xe)=>{var c;if(ce.path===""||!((c=ce.path)!=null&&c.includes("?")))Y(ce,xe);else for(let ye of Af(ce.path))Y(ce,xe,ye)}),D}function Af(A){let D=A.split("/");if(D.length===0)return[];let[z,...j]=D,Y=z.endsWith("?"),ce=z.replace(/\?$/,"");if(j.length===0)return Y?[ce,""]:[ce];let xe=Af(j.join("/")),c=[];return c.push(...xe.map(ye=>ye===""?ce:[ce,ye].join("/"))),Y&&c.push(...xe),c.map(ye=>A.startsWith("/")&&ye===""?"/":ye)}function xm(A){A.sort((D,z)=>D.score!==z.score?z.score-D.score:Im(D.routesMeta.map(j=>j.childrenIndex),z.routesMeta.map(j=>j.childrenIndex)))}const wm=/^:[\w-]+$/,bm=3,Sm=2,km=1,Tm=10,Em=-2,hf=A=>A==="*";function Cm(A,D){let z=A.split("/"),j=z.length;return z.some(hf)&&(j+=Em),D&&(j+=Sm),z.filter(Y=>!hf(Y)).reduce((Y,ce)=>Y+(wm.test(ce)?bm:ce===""?km:Tm),j)}function Im(A,D){return A.length===D.length&&A.slice(0,-1).every((j,Y)=>j===D[Y])?A[A.length-1]-D[D.length-1]:0}function Pm(A,D,z){let{routesMeta:j}=A,Y={},ce="/",xe=[];for(let c=0;c<j.length;++c){let ye=j[c],$=c===j.length-1,Le=ce==="/"?D:D.slice(ce.length)||"/",Me=Rp({path:ye.relativePath,caseSensitive:ye.caseSensitive,end:$},Le),Ce=ye.route;if(!Me)return null;Object.assign(Y,Me.params),xe.push({params:Y,pathname:ou([ce,Me.pathname]),pathnameBase:Rm(ou([ce,Me.pathnameBase])),route:Ce}),Me.pathnameBase!=="/"&&(ce=ou([ce,Me.pathnameBase]))}return xe}function Rp(A,D){typeof A=="string"&&(A={path:A,caseSensitive:!1,end:!0});let[z,j]=Mm(A.path,A.caseSensitive,A.end),Y=D.match(z);if(!Y)return null;let ce=Y[0],xe=ce.replace(/(.)\/+$/,"$1"),c=Y.slice(1);return{params:j.reduce(($,Le,Me)=>{let{paramName:Ce,isOptional:xt}=Le;if(Ce==="*"){let at=c[Me]||"";xe=ce.slice(0,ce.length-at.length).replace(/(.)\/+$/,"$1")}const Je=c[Me];return xt&&!Je?$[Ce]=void 0:$[Ce]=(Je||"").replace(/%2F/g,"/"),$},{}),pathname:ce,pathnameBase:xe,pattern:A}}function Mm(A,D,z){D===void 0&&(D=!1),z===void 0&&(z=!0),Vp(A==="*"||!A.endsWith("*")||A.endsWith("/*"),'Route path "'+A+'" will be treated as if it were '+('"'+A.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+A.replace(/\*$/,"/*")+'".'));let j=[],Y="^"+A.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(xe,c,ye)=>(j.push({paramName:c,isOptional:ye!=null}),ye?"/?([^\\/]+)?":"/([^\\/]+)"));return A.endsWith("*")?(j.push({paramName:"*"}),Y+=A==="*"||A==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):z?Y+="\\/*$":A!==""&&A!=="/"&&(Y+="(?:(?=\\/|$))"),[new RegExp(Y,D?void 0:"i"),j]}function Am(A){try{return A.split("/").map(D=>decodeURIComponent(D).replace(/\//g,"%2F")).join("/")}catch(D){return Vp(!1,'The URL path "'+A+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+D+").")),A}}function sh(A,D){if(D==="/")return A;if(!A.toLowerCase().startsWith(D.toLowerCase()))return null;let z=D.endsWith("/")?D.length-1:D.length,j=A.charAt(z);return j&&j!=="/"?null:A.slice(z)||"/"}function zm(A,D){D===void 0&&(D="/");let{pathname:z,search:j="",hash:Y=""}=typeof A=="string"?nc(A):A;return{pathname:z?z.startsWith("/")?z:Dm(z,D):D,search:Fm(j),hash:Bm(Y)}}function Dm(A,D){let z=D.replace(/\/+$/,"").split("/");return A.split("/").forEach(Y=>{Y===".."?z.length>1&&z.pop():Y!=="."&&z.push(Y)}),z.length>1?z.join("/"):"/"}function Sp(A,D,z,j){return"Cannot include a '"+A+"' character in a manually specified "+("`to."+D+"` field ["+JSON.stringify(j)+"].  Please separate it out to the ")+("`to."+z+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Lm(A){return A.filter((D,z)=>z===0||D.route.path&&D.route.path.length>0)}function jp(A,D){let z=Lm(A);return D?z.map((j,Y)=>Y===z.length-1?j.pathname:j.pathnameBase):z.map(j=>j.pathnameBase)}function Up(A,D,z,j){j===void 0&&(j=!1);let Y;typeof A=="string"?Y=nc(A):(Y=Jh({},A),Mi(!Y.pathname||!Y.pathname.includes("?"),Sp("?","pathname","search",Y)),Mi(!Y.pathname||!Y.pathname.includes("#"),Sp("#","pathname","hash",Y)),Mi(!Y.search||!Y.search.includes("#"),Sp("#","search","hash",Y)));let ce=A===""||Y.pathname==="",xe=ce?"/":Y.pathname,c;if(xe==null)c=z;else{let Me=D.length-1;if(!j&&xe.startsWith("..")){let Ce=xe.split("/");for(;Ce[0]==="..";)Ce.shift(),Me-=1;Y.pathname=Ce.join("/")}c=Me>=0?D[Me]:"/"}let ye=zm(Y,c),$=xe&&xe!=="/"&&xe.endsWith("/"),Le=(ce||xe===".")&&z.endsWith("/");return!ye.pathname.endsWith("/")&&($||Le)&&(ye.pathname+="/"),ye}const ou=A=>A.join("/").replace(/\/\/+/g,"/"),Rm=A=>A.replace(/\/+$/,"").replace(/^\/*/,"/"),Fm=A=>!A||A==="?"?"":A.startsWith("?")?A:"?"+A,Bm=A=>!A||A==="#"?"":A.startsWith("#")?A:"#"+A;function Om(A){return A!=null&&typeof A.status=="number"&&typeof A.statusText=="string"&&typeof A.internal=="boolean"&&"data"in A}const zf=["post","put","patch","delete"];new Set(zf);const Nm=["get",...zf];new Set(Nm);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qh(){return Qh=Object.assign?Object.assign.bind():function(A){for(var D=1;D<arguments.length;D++){var z=arguments[D];for(var j in z)Object.prototype.hasOwnProperty.call(z,j)&&(A[j]=z[j])}return A},Qh.apply(this,arguments)}const Xd=$e.createContext(null),Df=$e.createContext(null),_l=$e.createContext(null),Yd=$e.createContext(null),uu=$e.createContext({outlet:null,matches:[],isDataRoute:!1}),Lf=$e.createContext(null);function Vm(A,D){let{relative:z}=D===void 0?{}:D;ah()||Mi(!1);let{basename:j,navigator:Y}=$e.useContext(_l),{hash:ce,pathname:xe,search:c}=Jd(A,{relative:z}),ye=xe;return j!=="/"&&(ye=xe==="/"?j:ou([j,xe])),Y.createHref({pathname:ye,search:c,hash:ce})}function ah(){return $e.useContext(Yd)!=null}function oh(){return ah()||Mi(!1),$e.useContext(Yd).location}function Rf(A){$e.useContext(_l).static||$e.useLayoutEffect(A)}function $p(){let{isDataRoute:A}=$e.useContext(uu);return A?Qm():jm()}function jm(){ah()||Mi(!1);let A=$e.useContext(Xd),{basename:D,future:z,navigator:j}=$e.useContext(_l),{matches:Y}=$e.useContext(uu),{pathname:ce}=oh(),xe=JSON.stringify(jp(Y,z.v7_relativeSplatPath)),c=$e.useRef(!1);return Rf(()=>{c.current=!0}),$e.useCallback(function($,Le){if(Le===void 0&&(Le={}),!c.current)return;if(typeof $=="number"){j.go($);return}let Me=Up($,JSON.parse(xe),ce,Le.relative==="path");A==null&&D!=="/"&&(Me.pathname=Me.pathname==="/"?D:ou([D,Me.pathname])),(Le.replace?j.replace:j.push)(Me,Le.state,Le)},[D,j,xe,ce,A])}function Jd(A,D){let{relative:z}=D===void 0?{}:D,{future:j}=$e.useContext(_l),{matches:Y}=$e.useContext(uu),{pathname:ce}=oh(),xe=JSON.stringify(jp(Y,j.v7_relativeSplatPath));return $e.useMemo(()=>Up(A,JSON.parse(xe),ce,z==="path"),[A,xe,ce,z])}function Um(A,D){return $m(A,D)}function $m(A,D,z,j){ah()||Mi(!1);let{navigator:Y,static:ce}=$e.useContext(_l),{matches:xe}=$e.useContext(uu),c=xe[xe.length-1],ye=c?c.params:{};c&&c.pathname;let $=c?c.pathnameBase:"/";c&&c.route;let Le=oh(),Me;if(D){var Ce;let pt=typeof D=="string"?nc(D):D;$==="/"||(Ce=pt.pathname)!=null&&Ce.startsWith($)||Mi(!1),Me=pt}else Me=Le;let xt=Me.pathname||"/",Je=xt;if($!=="/"){let pt=$.replace(/^\//,"").split("/");Je="/"+xt.replace(/^\//,"").split("/").slice(pt.length).join("/")}let at=_m(A,{pathname:Je}),je=Hm(at&&at.map(pt=>Object.assign({},pt,{params:Object.assign({},ye,pt.params),pathname:ou([$,Y.encodeLocation?Y.encodeLocation(pt.pathname).pathname:pt.pathname]),pathnameBase:pt.pathnameBase==="/"?$:ou([$,Y.encodeLocation?Y.encodeLocation(pt.pathnameBase).pathname:pt.pathnameBase])})),xe,z,j);return D&&je?$e.createElement(Yd.Provider,{value:{location:Qh({pathname:"/",search:"",hash:"",state:null,key:"default"},Me),navigationType:au.Pop}},je):je}function qm(){let A=Jm(),D=Om(A)?A.status+" "+A.statusText:A instanceof Error?A.message:JSON.stringify(A),z=A instanceof Error?A.stack:null,Y={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return $e.createElement($e.Fragment,null,$e.createElement("h2",null,"Unexpected Application Error!"),$e.createElement("h3",{style:{fontStyle:"italic"}},D),z?$e.createElement("pre",{style:Y},z):null,null)}const Zm=$e.createElement(qm,null);class Gm extends $e.Component{constructor(D){super(D),this.state={location:D.location,revalidation:D.revalidation,error:D.error}}static getDerivedStateFromError(D){return{error:D}}static getDerivedStateFromProps(D,z){return z.location!==D.location||z.revalidation!=="idle"&&D.revalidation==="idle"?{error:D.error,location:D.location,revalidation:D.revalidation}:{error:D.error!==void 0?D.error:z.error,location:z.location,revalidation:D.revalidation||z.revalidation}}componentDidCatch(D,z){console.error("React Router caught the following error during render",D,z)}render(){return this.state.error!==void 0?$e.createElement(uu.Provider,{value:this.props.routeContext},$e.createElement(Lf.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Wm(A){let{routeContext:D,match:z,children:j}=A,Y=$e.useContext(Xd);return Y&&Y.static&&Y.staticContext&&(z.route.errorElement||z.route.ErrorBoundary)&&(Y.staticContext._deepestRenderedBoundaryId=z.route.id),$e.createElement(uu.Provider,{value:D},j)}function Hm(A,D,z,j){var Y;if(D===void 0&&(D=[]),z===void 0&&(z=null),j===void 0&&(j=null),A==null){var ce;if(!z)return null;if(z.errors)A=z.matches;else if((ce=j)!=null&&ce.v7_partialHydration&&D.length===0&&!z.initialized&&z.matches.length>0)A=z.matches;else return null}let xe=A,c=(Y=z)==null?void 0:Y.errors;if(c!=null){let Le=xe.findIndex(Me=>Me.route.id&&(c==null?void 0:c[Me.route.id])!==void 0);Le>=0||Mi(!1),xe=xe.slice(0,Math.min(xe.length,Le+1))}let ye=!1,$=-1;if(z&&j&&j.v7_partialHydration)for(let Le=0;Le<xe.length;Le++){let Me=xe[Le];if((Me.route.HydrateFallback||Me.route.hydrateFallbackElement)&&($=Le),Me.route.id){let{loaderData:Ce,errors:xt}=z,Je=Me.route.loader&&Ce[Me.route.id]===void 0&&(!xt||xt[Me.route.id]===void 0);if(Me.route.lazy||Je){ye=!0,$>=0?xe=xe.slice(0,$+1):xe=[xe[0]];break}}}return xe.reduceRight((Le,Me,Ce)=>{let xt,Je=!1,at=null,je=null;z&&(xt=c&&Me.route.id?c[Me.route.id]:void 0,at=Me.route.errorElement||Zm,ye&&($<0&&Ce===0?(eg("route-fallback"),Je=!0,je=null):$===Ce&&(Je=!0,je=Me.route.hydrateFallbackElement||null)));let pt=D.concat(xe.slice(0,Ce+1)),Lt=()=>{let Ot;return xt?Ot=at:Je?Ot=je:Me.route.Component?Ot=$e.createElement(Me.route.Component,null):Me.route.element?Ot=Me.route.element:Ot=Le,$e.createElement(Wm,{match:Me,routeContext:{outlet:Le,matches:pt,isDataRoute:z!=null},children:Ot})};return z&&(Me.route.ErrorBoundary||Me.route.errorElement||Ce===0)?$e.createElement(Gm,{location:z.location,revalidation:z.revalidation,component:at,error:xt,children:Lt(),routeContext:{outlet:null,matches:pt,isDataRoute:!0}}):Lt()},null)}var Ff=function(A){return A.UseBlocker="useBlocker",A.UseRevalidator="useRevalidator",A.UseNavigateStable="useNavigate",A}(Ff||{}),Bf=function(A){return A.UseBlocker="useBlocker",A.UseLoaderData="useLoaderData",A.UseActionData="useActionData",A.UseRouteError="useRouteError",A.UseNavigation="useNavigation",A.UseRouteLoaderData="useRouteLoaderData",A.UseMatches="useMatches",A.UseRevalidator="useRevalidator",A.UseNavigateStable="useNavigate",A.UseRouteId="useRouteId",A}(Bf||{});function Km(A){let D=$e.useContext(Xd);return D||Mi(!1),D}function Xm(A){let D=$e.useContext(Df);return D||Mi(!1),D}function Ym(A){let D=$e.useContext(uu);return D||Mi(!1),D}function Of(A){let D=Ym(),z=D.matches[D.matches.length-1];return z.route.id||Mi(!1),z.route.id}function Jm(){var A;let D=$e.useContext(Lf),z=Xm(),j=Of();return D!==void 0?D:(A=z.errors)==null?void 0:A[j]}function Qm(){let{router:A}=Km(Ff.UseNavigateStable),D=Of(Bf.UseNavigateStable),z=$e.useRef(!1);return Rf(()=>{z.current=!0}),$e.useCallback(function(Y,ce){ce===void 0&&(ce={}),z.current&&(typeof Y=="number"?A.navigate(Y):A.navigate(Y,Qh({fromRouteId:D},ce)))},[A,D])}const df={};function eg(A,D,z){df[A]||(df[A]=!0)}function tg(A,D){A==null||A.v7_startTransition,A==null||A.v7_relativeSplatPath}function rg(A){let{to:D,replace:z,state:j,relative:Y}=A;ah()||Mi(!1);let{future:ce,static:xe}=$e.useContext(_l),{matches:c}=$e.useContext(uu),{pathname:ye}=oh(),$=$p(),Le=Up(D,jp(c,ce.v7_relativeSplatPath),ye,Y==="path"),Me=JSON.stringify(Le);return $e.useEffect(()=>$(JSON.parse(Me),{replace:z,state:j,relative:Y}),[$,Me,Y,z,j]),null}function qd(A){Mi(!1)}function ig(A){let{basename:D="/",children:z=null,location:j,navigationType:Y=au.Pop,navigator:ce,static:xe=!1,future:c}=A;ah()&&Mi(!1);let ye=D.replace(/^\/*/,"/"),$=$e.useMemo(()=>({basename:ye,navigator:ce,static:xe,future:Qh({v7_relativeSplatPath:!1},c)}),[ye,c,ce,xe]);typeof j=="string"&&(j=nc(j));let{pathname:Le="/",search:Me="",hash:Ce="",state:xt=null,key:Je="default"}=j,at=$e.useMemo(()=>{let je=sh(Le,ye);return je==null?null:{location:{pathname:je,search:Me,hash:Ce,state:xt,key:Je},navigationType:Y}},[ye,Le,Me,Ce,xt,Je,Y]);return at==null?null:$e.createElement(_l.Provider,{value:$},$e.createElement(Yd.Provider,{children:z,value:at}))}function ng(A){let{children:D,location:z}=A;return Um(Fp(D),z)}new Promise(()=>{});function Fp(A,D){D===void 0&&(D=[]);let z=[];return $e.Children.forEach(A,(j,Y)=>{if(!$e.isValidElement(j))return;let ce=[...D,Y];if(j.type===$e.Fragment){z.push.apply(z,Fp(j.props.children,ce));return}j.type!==qd&&Mi(!1),!j.props.index||!j.props.children||Mi(!1);let xe={id:j.props.id||ce.join("-"),caseSensitive:j.props.caseSensitive,element:j.props.element,Component:j.props.Component,index:j.props.index,path:j.props.path,loader:j.props.loader,action:j.props.action,errorElement:j.props.errorElement,ErrorBoundary:j.props.ErrorBoundary,hasErrorBoundary:j.props.ErrorBoundary!=null||j.props.errorElement!=null,shouldRevalidate:j.props.shouldRevalidate,handle:j.props.handle,lazy:j.props.lazy};j.props.children&&(xe.children=Fp(j.props.children,ce)),z.push(xe)}),z}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hd(){return Hd=Object.assign?Object.assign.bind():function(A){for(var D=1;D<arguments.length;D++){var z=arguments[D];for(var j in z)Object.prototype.hasOwnProperty.call(z,j)&&(A[j]=z[j])}return A},Hd.apply(this,arguments)}function Nf(A,D){if(A==null)return{};var z={},j=Object.keys(A),Y,ce;for(ce=0;ce<j.length;ce++)Y=j[ce],!(D.indexOf(Y)>=0)&&(z[Y]=A[Y]);return z}function sg(A){return!!(A.metaKey||A.altKey||A.ctrlKey||A.shiftKey)}function ag(A,D){return A.button===0&&(!D||D==="_self")&&!sg(A)}const og=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],lg=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],ug="6";try{window.__reactRouterVersion=ug}catch{}const cg=$e.createContext({isTransitioning:!1}),hg="startTransition",pf=lm[hg];function dg(A){let{basename:D,children:z,future:j,window:Y}=A,ce=$e.useRef();ce.current==null&&(ce.current=mm({window:Y,v5Compat:!0}));let xe=ce.current,[c,ye]=$e.useState({action:xe.action,location:xe.location}),{v7_startTransition:$}=j||{},Le=$e.useCallback(Me=>{$&&pf?pf(()=>ye(Me)):ye(Me)},[ye,$]);return $e.useLayoutEffect(()=>xe.listen(Le),[xe,Le]),$e.useEffect(()=>tg(j),[j]),$e.createElement(ig,{basename:D,children:z,location:c.location,navigationType:c.action,navigator:xe,future:j})}const pg=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fg=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mg=$e.forwardRef(function(D,z){let{onClick:j,relative:Y,reloadDocument:ce,replace:xe,state:c,target:ye,to:$,preventScrollReset:Le,viewTransition:Me}=D,Ce=Nf(D,og),{basename:xt}=$e.useContext(_l),Je,at=!1;if(typeof $=="string"&&fg.test($)&&(Je=$,pg))try{let Ot=new URL(window.location.href),Ut=$.startsWith("//")?new URL(Ot.protocol+$):new URL($),Dt=sh(Ut.pathname,xt);Ut.origin===Ot.origin&&Dt!=null?$=Dt+Ut.search+Ut.hash:at=!0}catch{}let je=Vm($,{relative:Y}),pt=yg($,{replace:xe,state:c,target:ye,preventScrollReset:Le,relative:Y,viewTransition:Me});function Lt(Ot){j&&j(Ot),Ot.defaultPrevented||pt(Ot)}return $e.createElement("a",Hd({},Ce,{href:Je||je,onClick:at||ce?j:Lt,ref:z,target:ye}))}),kp=$e.forwardRef(function(D,z){let{"aria-current":j="page",caseSensitive:Y=!1,className:ce="",end:xe=!1,style:c,to:ye,viewTransition:$,children:Le}=D,Me=Nf(D,lg),Ce=Jd(ye,{relative:Me.relative}),xt=oh(),Je=$e.useContext(Df),{navigator:at,basename:je}=$e.useContext(_l),pt=Je!=null&&_g(Ce)&&$===!0,Lt=at.encodeLocation?at.encodeLocation(Ce).pathname:Ce.pathname,Ot=xt.pathname,Ut=Je&&Je.navigation&&Je.navigation.location?Je.navigation.location.pathname:null;Y||(Ot=Ot.toLowerCase(),Ut=Ut?Ut.toLowerCase():null,Lt=Lt.toLowerCase()),Ut&&je&&(Ut=sh(Ut,je)||Ut);const Dt=Lt!=="/"&&Lt.endsWith("/")?Lt.length-1:Lt.length;let Rt=Ot===Lt||!xe&&Ot.startsWith(Lt)&&Ot.charAt(Dt)==="/",ft=Ut!=null&&(Ut===Lt||!xe&&Ut.startsWith(Lt)&&Ut.charAt(Lt.length)==="/"),le={isActive:Rt,isPending:ft,isTransitioning:pt},ve=Rt?j:void 0,Ae;typeof ce=="function"?Ae=ce(le):Ae=[ce,Rt?"active":null,ft?"pending":null,pt?"transitioning":null].filter(Boolean).join(" ");let mt=typeof c=="function"?c(le):c;return $e.createElement(mg,Hd({},Me,{"aria-current":ve,className:Ae,ref:z,style:mt,to:ye,viewTransition:$}),typeof Le=="function"?Le(le):Le)});var Bp;(function(A){A.UseScrollRestoration="useScrollRestoration",A.UseSubmit="useSubmit",A.UseSubmitFetcher="useSubmitFetcher",A.UseFetcher="useFetcher",A.useViewTransitionState="useViewTransitionState"})(Bp||(Bp={}));var ff;(function(A){A.UseFetcher="useFetcher",A.UseFetchers="useFetchers",A.UseScrollRestoration="useScrollRestoration"})(ff||(ff={}));function gg(A){let D=$e.useContext(Xd);return D||Mi(!1),D}function yg(A,D){let{target:z,replace:j,state:Y,preventScrollReset:ce,relative:xe,viewTransition:c}=D===void 0?{}:D,ye=$p(),$=oh(),Le=Jd(A,{relative:xe});return $e.useCallback(Me=>{if(ag(Me,z)){Me.preventDefault();let Ce=j!==void 0?j:Wd($)===Wd(Le);ye(A,{replace:Ce,state:Y,preventScrollReset:ce,relative:xe,viewTransition:c})}},[$,ye,Le,j,Y,z,A,ce,xe,c])}function _g(A,D){D===void 0&&(D={});let z=$e.useContext(cg);z==null&&Mi(!1);let{basename:j}=gg(Bp.useViewTransitionState),Y=Jd(A,{relative:D.relative});if(!z.isTransitioning)return!1;let ce=sh(z.currentLocation.pathname,j)||z.currentLocation.pathname,xe=sh(z.nextLocation.pathname,j)||z.nextLocation.pathname;return Rp(Y.pathname,xe)!=null||Rp(Y.pathname,ce)!=null}const vg={},mf=A=>{let D;const z=new Set,j=(Le,Me)=>{const Ce=typeof Le=="function"?Le(D):Le;if(!Object.is(Ce,D)){const xt=D;D=Me??(typeof Ce!="object"||Ce===null)?Ce:Object.assign({},D,Ce),z.forEach(Je=>Je(D,xt))}},Y=()=>D,ye={setState:j,getState:Y,getInitialState:()=>$,subscribe:Le=>(z.add(Le),()=>z.delete(Le)),destroy:()=>{(vg?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),z.clear()}},$=D=A(j,Y,ye);return ye},xg=A=>A?mf(A):mf;var Tp={exports:{}},Ep={},Cp={exports:{}},Ip={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gf;function wg(){if(gf)return Ip;gf=1;var A=td();function D(Me,Ce){return Me===Ce&&(Me!==0||1/Me===1/Ce)||Me!==Me&&Ce!==Ce}var z=typeof Object.is=="function"?Object.is:D,j=A.useState,Y=A.useEffect,ce=A.useLayoutEffect,xe=A.useDebugValue;function c(Me,Ce){var xt=Ce(),Je=j({inst:{value:xt,getSnapshot:Ce}}),at=Je[0].inst,je=Je[1];return ce(function(){at.value=xt,at.getSnapshot=Ce,ye(at)&&je({inst:at})},[Me,xt,Ce]),Y(function(){return ye(at)&&je({inst:at}),Me(function(){ye(at)&&je({inst:at})})},[Me]),xe(xt),xt}function ye(Me){var Ce=Me.getSnapshot;Me=Me.value;try{var xt=Ce();return!z(Me,xt)}catch{return!0}}function $(Me,Ce){return Ce()}var Le=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?$:c;return Ip.useSyncExternalStore=A.useSyncExternalStore!==void 0?A.useSyncExternalStore:Le,Ip}var yf;function bg(){return yf||(yf=1,Cp.exports=wg()),Cp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _f;function Sg(){if(_f)return Ep;_f=1;var A=td(),D=bg();function z($,Le){return $===Le&&($!==0||1/$===1/Le)||$!==$&&Le!==Le}var j=typeof Object.is=="function"?Object.is:z,Y=D.useSyncExternalStore,ce=A.useRef,xe=A.useEffect,c=A.useMemo,ye=A.useDebugValue;return Ep.useSyncExternalStoreWithSelector=function($,Le,Me,Ce,xt){var Je=ce(null);if(Je.current===null){var at={hasValue:!1,value:null};Je.current=at}else at=Je.current;Je=c(function(){function pt(Rt){if(!Lt){if(Lt=!0,Ot=Rt,Rt=Ce(Rt),xt!==void 0&&at.hasValue){var ft=at.value;if(xt(ft,Rt))return Ut=ft}return Ut=Rt}if(ft=Ut,j(Ot,Rt))return ft;var le=Ce(Rt);return xt!==void 0&&xt(ft,le)?(Ot=Rt,ft):(Ot=Rt,Ut=le)}var Lt=!1,Ot,Ut,Dt=Me===void 0?null:Me;return[function(){return pt(Le())},Dt===null?void 0:function(){return pt(Dt())}]},[Le,Me,Ce,xt]);var je=Y($,Je[0],Je[1]);return xe(function(){at.hasValue=!0,at.value=je},[je]),ye(je),je},Ep}var vf;function kg(){return vf||(vf=1,Tp.exports=Sg()),Tp.exports}var Tg=kg();const Eg=ed(Tg),Vf={},{useDebugValue:Cg}=Kd,{useSyncExternalStoreWithSelector:Ig}=Eg;let xf=!1;const Pg=A=>A;function Mg(A,D=Pg,z){(Vf?"production":void 0)!=="production"&&z&&!xf&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),xf=!0);const j=Ig(A.subscribe,A.getState,A.getServerState||A.getInitialState,D,z);return Cg(j),j}const wf=A=>{(Vf?"production":void 0)!=="production"&&typeof A!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const D=typeof A=="function"?xg(A):A,z=(j,Y)=>Mg(D,j,Y);return Object.assign(z,D),z},Ag=A=>A?wf(A):wf,fs=(A,D="")=>A?A.name==="TypeError"?"":A.name==="SyntaxError"?"":A.name==="NetworkError"||A.message.includes("network")?"":A.message.includes("permission")||A.message.includes("denied")?"":A.name==="QuotaExceededError"?"":A.name==="VersionError"?"":A.message||D:D,gi=(A,D={})=>{console.error(`Error: ${A.message||"Unknown error"}`)},su=(A,D)=>async(...z)=>{try{return await A(...z)}catch(j){return gi(j,{}),typeof D=="function"&&D(j),null}},zg=(A,D)=>D.some(z=>A instanceof z);let bf,Sf;function Dg(){return bf||(bf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lg(){return Sf||(Sf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jf=new WeakMap,Op=new WeakMap,Uf=new WeakMap,Pp=new WeakMap,qp=new WeakMap;function Rg(A){const D=new Promise((z,j)=>{const Y=()=>{A.removeEventListener("success",ce),A.removeEventListener("error",xe)},ce=()=>{z(lu(A.result)),Y()},xe=()=>{j(A.error),Y()};A.addEventListener("success",ce),A.addEventListener("error",xe)});return D.then(z=>{z instanceof IDBCursor&&jf.set(z,A)}).catch(()=>{}),qp.set(D,A),D}function Fg(A){if(Op.has(A))return;const D=new Promise((z,j)=>{const Y=()=>{A.removeEventListener("complete",ce),A.removeEventListener("error",xe),A.removeEventListener("abort",xe)},ce=()=>{z(),Y()},xe=()=>{j(A.error||new DOMException("AbortError","AbortError")),Y()};A.addEventListener("complete",ce),A.addEventListener("error",xe),A.addEventListener("abort",xe)});Op.set(A,D)}let Np={get(A,D,z){if(A instanceof IDBTransaction){if(D==="done")return Op.get(A);if(D==="objectStoreNames")return A.objectStoreNames||Uf.get(A);if(D==="store")return z.objectStoreNames[1]?void 0:z.objectStore(z.objectStoreNames[0])}return lu(A[D])},set(A,D,z){return A[D]=z,!0},has(A,D){return A instanceof IDBTransaction&&(D==="done"||D==="store")?!0:D in A}};function Bg(A){Np=A(Np)}function Og(A){return A===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(D,...z){const j=A.call(Mp(this),D,...z);return Uf.set(j,D.sort?D.sort():[D]),lu(j)}:Lg().includes(A)?function(...D){return A.apply(Mp(this),D),lu(jf.get(this))}:function(...D){return lu(A.apply(Mp(this),D))}}function Ng(A){return typeof A=="function"?Og(A):(A instanceof IDBTransaction&&Fg(A),zg(A,Dg())?new Proxy(A,Np):A)}function lu(A){if(A instanceof IDBRequest)return Rg(A);if(Pp.has(A))return Pp.get(A);const D=Ng(A);return D!==A&&(Pp.set(A,D),qp.set(D,A)),D}const Mp=A=>qp.get(A);function Vg(A,D,{blocked:z,upgrade:j,blocking:Y,terminated:ce}={}){const xe=indexedDB.open(A,D),c=lu(xe);return j&&xe.addEventListener("upgradeneeded",ye=>{j(lu(xe.result),ye.oldVersion,ye.newVersion,lu(xe.transaction),ye)}),z&&xe.addEventListener("blocked",ye=>z(ye.oldVersion,ye.newVersion,ye)),c.then(ye=>{ce&&ye.addEventListener("close",()=>ce()),Y&&ye.addEventListener("versionchange",$=>Y($.oldVersion,$.newVersion,$))}).catch(()=>{}),c}const jg=["get","getKey","getAll","getAllKeys","count"],Ug=["put","add","delete","clear"],Ap=new Map;function kf(A,D){if(!(A instanceof IDBDatabase&&!(D in A)&&typeof D=="string"))return;if(Ap.get(D))return Ap.get(D);const z=D.replace(/FromIndex$/,""),j=D!==z,Y=Ug.includes(z);if(!(z in(j?IDBIndex:IDBObjectStore).prototype)||!(Y||jg.includes(z)))return;const ce=async function(xe,...c){const ye=this.transaction(xe,Y?"readwrite":"readonly");let $=ye.store;return j&&($=$.index(c.shift())),(await Promise.all([$[z](...c),Y&&ye.done]))[0]};return Ap.set(D,ce),ce}Bg(A=>({...A,get:(D,z,j)=>kf(D,z)||A.get(D,z,j),has:(D,z)=>!!kf(D,z)||A.has(D,z)}));class $g{constructor(D="myWorldAtlasDB",z=1){this.dbName=D,this.version=z,this.dbPromise=this.initDB()}async initDB(){try{return await Vg(this.dbName,this.version,{upgrade:D=>{if(!D.objectStoreNames.contains("visitedPlaces")){const z=D.createObjectStore("visitedPlaces",{keyPath:"uniqueId"});z.createIndex("adminLevel","adminLevel"),z.createIndex("dateMarked","dateMarked")}}})}catch(D){throw gi(D,{}),new Error(`: ${D.message}`)}}async getAllVisitedPlaces(){try{return await(await this.dbPromise).getAll("visitedPlaces")}catch(D){throw gi(D,{}),new Error(`: ${D.message}`)}}async getVisitedPlace(D){try{return await(await this.dbPromise).get("visitedPlaces",D)}catch(z){throw gi(z,{}),new Error(`: ${z.message}`)}}async saveVisitedPlace(D){try{const j=(await this.dbPromise).transaction("visitedPlaces","readwrite");return await j.store.put(D),await j.done,D.uniqueId}catch(z){throw gi(z,{}),new Error(`: ${z.message}`)}}async deleteVisitedPlace(D){try{const j=(await this.dbPromise).transaction("visitedPlaces","readwrite");await j.store.delete(D),await j.done}catch(z){throw gi(z,{}),new Error(`: ${z.message}`)}}async bulkSaveVisitedPlaces(D){let z=0,j=0;try{const ce=(await this.dbPromise).transaction("visitedPlaces","readwrite");for(const xe of D)try{await ce.store.put(xe),z++}catch(c){j++,gi(c,{action:"bulkSaveVisitedPlaces",placeData:xe})}return await ce.done,{success:z,skipped:j}}catch(Y){throw gi(Y,{}),new Error(`: ${Y.message}`)}}async findByAdminLevel(D){try{return await(await this.dbPromise).transaction("visitedPlaces").store.index("adminLevel").getAll(D)}catch(z){throw gi(z,{}),new Error(`: ${z.message}`)}}async findByDateRange(D,z){try{const Y=(await this.dbPromise).transaction("visitedPlaces").store.index("dateMarked"),ce=IDBKeyRange.bound(D,z);return await Y.getAll(ce)}catch(j){throw gi(j,{}),new Error(`: ${j.message}`)}}}const Yh=new $g;var Zd={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var qg=Zd.exports,Tf;function Zg(){return Tf||(Tf=1,function(A,D){((z,j)=>{A.exports=j()})(qg,function z(){var j=typeof self<"u"?self:typeof window<"u"?window:j!==void 0?j:{},Y,ce=!j.document&&!!j.postMessage,xe=j.IS_PAPA_WORKER||!1,c={},ye=0,$={};function Le(le){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(ve){var Ae=Dt(ve);Ae.chunkSize=parseInt(Ae.chunkSize),ve.step||ve.chunk||(Ae.chunkSize=null),this._handle=new at(Ae),(this._handle.streamer=this)._config=Ae}).call(this,le),this.parseChunk=function(ve,Ae){var mt=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<mt){let ct=this._config.newline;ct||(ot=this._config.quoteChar||'"',ct=this._handle.guessLineEndings(ve,ot)),ve=[...ve.split(ct).slice(mt)].join(ct)}this.isFirstChunk&&ft(this._config.beforeFirstChunk)&&(ot=this._config.beforeFirstChunk(ve))!==void 0&&(ve=ot),this.isFirstChunk=!1,this._halted=!1;var mt=this._partialLine+ve,ot=(this._partialLine="",this._handle.parse(mt,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(ve=ot.meta.cursor,mt=(this._finished||(this._partialLine=mt.substring(ve-this._baseIndex),this._baseIndex=ve),ot&&ot.data&&(this._rowCount+=ot.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),xe)j.postMessage({results:ot,workerId:$.WORKER_ID,finished:mt});else if(ft(this._config.chunk)&&!Ae){if(this._config.chunk(ot,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=ot=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(ot.data),this._completeResults.errors=this._completeResults.errors.concat(ot.errors),this._completeResults.meta=ot.meta),this._completed||!mt||!ft(this._config.complete)||ot&&ot.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),mt||ot&&ot.meta.paused||this._nextChunk(),ot}this._halted=!0},this._sendError=function(ve){ft(this._config.error)?this._config.error(ve):xe&&this._config.error&&j.postMessage({workerId:$.WORKER_ID,error:ve,finished:!1})}}function Me(le){var ve;(le=le||{}).chunkSize||(le.chunkSize=$.RemoteChunkSize),Le.call(this,le),this._nextChunk=ce?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Ae){this._input=Ae,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(ve=new XMLHttpRequest,this._config.withCredentials&&(ve.withCredentials=this._config.withCredentials),ce||(ve.onload=Rt(this._chunkLoaded,this),ve.onerror=Rt(this._chunkError,this)),ve.open(this._config.downloadRequestBody?"POST":"GET",this._input,!ce),this._config.downloadRequestHeaders){var Ae,mt=this._config.downloadRequestHeaders;for(Ae in mt)ve.setRequestHeader(Ae,mt[Ae])}var ot;this._config.chunkSize&&(ot=this._start+this._config.chunkSize-1,ve.setRequestHeader("Range","bytes="+this._start+"-"+ot));try{ve.send(this._config.downloadRequestBody)}catch(ct){this._chunkError(ct.message)}ce&&ve.status===0&&this._chunkError()}},this._chunkLoaded=function(){ve.readyState===4&&(ve.status<200||400<=ve.status?this._chunkError():(this._start+=this._config.chunkSize||ve.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Ae=>(Ae=Ae.getResponseHeader("Content-Range"))!==null?parseInt(Ae.substring(Ae.lastIndexOf("/")+1)):-1)(ve),this.parseChunk(ve.responseText)))},this._chunkError=function(Ae){Ae=ve.statusText||Ae,this._sendError(new Error(Ae))}}function Ce(le){(le=le||{}).chunkSize||(le.chunkSize=$.LocalChunkSize),Le.call(this,le);var ve,Ae,mt=typeof FileReader<"u";this.stream=function(ot){this._input=ot,Ae=ot.slice||ot.webkitSlice||ot.mozSlice,mt?((ve=new FileReader).onload=Rt(this._chunkLoaded,this),ve.onerror=Rt(this._chunkError,this)):ve=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var ot=this._input,ct=(this._config.chunkSize&&(ct=Math.min(this._start+this._config.chunkSize,this._input.size),ot=Ae.call(ot,this._start,ct)),ve.readAsText(ot,this._config.encoding));mt||this._chunkLoaded({target:{result:ct}})},this._chunkLoaded=function(ot){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(ot.target.result)},this._chunkError=function(){this._sendError(ve.error)}}function xt(le){var ve;Le.call(this,le=le||{}),this.stream=function(Ae){return ve=Ae,this._nextChunk()},this._nextChunk=function(){var Ae,mt;if(!this._finished)return Ae=this._config.chunkSize,ve=Ae?(mt=ve.substring(0,Ae),ve.substring(Ae)):(mt=ve,""),this._finished=!ve,this.parseChunk(mt)}}function Je(le){Le.call(this,le=le||{});var ve=[],Ae=!0,mt=!1;this.pause=function(){Le.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Le.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(ot){this._input=ot,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){mt&&ve.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),ve.length?this.parseChunk(ve.shift()):Ae=!0},this._streamData=Rt(function(ot){try{ve.push(typeof ot=="string"?ot:ot.toString(this._config.encoding)),Ae&&(Ae=!1,this._checkIsFinished(),this.parseChunk(ve.shift()))}catch(ct){this._streamError(ct)}},this),this._streamError=Rt(function(ot){this._streamCleanUp(),this._sendError(ot)},this),this._streamEnd=Rt(function(){this._streamCleanUp(),mt=!0,this._streamData("")},this),this._streamCleanUp=Rt(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function at(le){var ve,Ae,mt,ot,ct=Math.pow(2,53),Wt=-ct,dr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,pr=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,yt=this,Ue=0,Xe=0,nt=!1,ae=!1,Pe=[],Ne={data:[],errors:[],meta:{}};function wt(_t){return le.skipEmptyLines==="greedy"?_t.join("").trim()==="":_t.length===1&&_t[0].length===0}function Nt(){if(Ne&&mt&&(lr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+$.DefaultDelimiter+"'"),mt=!1),le.skipEmptyLines&&(Ne.data=Ne.data.filter(function(Tr){return!wt(Tr)})),Zt()){let Tr=function(Nr,vr){ft(le.transformHeader)&&(Nr=le.transformHeader(Nr,vr)),Pe.push(Nr)};var ir=Tr;if(Ne)if(Array.isArray(Ne.data[0])){for(var _t=0;Zt()&&_t<Ne.data.length;_t++)Ne.data[_t].forEach(Tr);Ne.data.splice(0,1)}else Ne.data.forEach(Tr)}function Ct(Tr,Nr){for(var vr=le.header?{}:[],xr=0;xr<Tr.length;xr++){var nr=xr,Vr=Tr[xr],Vr=((fr,Er)=>(Te=>(le.dynamicTypingFunction&&le.dynamicTyping[Te]===void 0&&(le.dynamicTyping[Te]=le.dynamicTypingFunction(Te)),(le.dynamicTyping[Te]||le.dynamicTyping)===!0))(fr)?Er==="true"||Er==="TRUE"||Er!=="false"&&Er!=="FALSE"&&((Te=>{if(dr.test(Te)&&(Te=parseFloat(Te),Wt<Te&&Te<ct))return 1})(Er)?parseFloat(Er):pr.test(Er)?new Date(Er):Er===""?null:Er):Er)(nr=le.header?xr>=Pe.length?"__parsed_extra":Pe[xr]:nr,Vr=le.transform?le.transform(Vr,nr):Vr);nr==="__parsed_extra"?(vr[nr]=vr[nr]||[],vr[nr].push(Vr)):vr[nr]=Vr}return le.header&&(xr>Pe.length?lr("FieldMismatch","TooManyFields","Too many fields: expected "+Pe.length+" fields but parsed "+xr,Xe+Nr):xr<Pe.length&&lr("FieldMismatch","TooFewFields","Too few fields: expected "+Pe.length+" fields but parsed "+xr,Xe+Nr)),vr}var rr;Ne&&(le.header||le.dynamicTyping||le.transform)&&(rr=1,!Ne.data.length||Array.isArray(Ne.data[0])?(Ne.data=Ne.data.map(Ct),rr=Ne.data.length):Ne.data=Ct(Ne.data,0),le.header&&Ne.meta&&(Ne.meta.fields=Pe),Xe+=rr)}function Zt(){return le.header&&Pe.length===0}function lr(_t,Ct,rr,ir){_t={type:_t,code:Ct,message:rr},ir!==void 0&&(_t.row=ir),Ne.errors.push(_t)}ft(le.step)&&(ot=le.step,le.step=function(_t){Ne=_t,Zt()?Nt():(Nt(),Ne.data.length!==0&&(Ue+=_t.data.length,le.preview&&Ue>le.preview?Ae.abort():(Ne.data=Ne.data[0],ot(Ne,yt))))}),this.parse=function(_t,Ct,rr){var ir=le.quoteChar||'"',ir=(le.newline||(le.newline=this.guessLineEndings(_t,ir)),mt=!1,le.delimiter?ft(le.delimiter)&&(le.delimiter=le.delimiter(_t),Ne.meta.delimiter=le.delimiter):((ir=((Tr,Nr,vr,xr,nr)=>{var Vr,fr,Er,Te;nr=nr||[",","	","|",";",$.RECORD_SEP,$.UNIT_SEP];for(var Wr=0;Wr<nr.length;Wr++){for(var Jr,kr=nr[Wr],Kt=0,ui=0,Hr=0,Kr=(Er=void 0,new pt({comments:xr,delimiter:kr,newline:Nr,preview:10}).parse(Tr)),Ui=0;Ui<Kr.data.length;Ui++)vr&&wt(Kr.data[Ui])?Hr++:(Jr=Kr.data[Ui].length,ui+=Jr,Er===void 0?Er=Jr:0<Jr&&(Kt+=Math.abs(Jr-Er),Er=Jr));0<Kr.data.length&&(ui/=Kr.data.length-Hr),(fr===void 0||Kt<=fr)&&(Te===void 0||Te<ui)&&1.99<ui&&(fr=Kt,Vr=kr,Te=ui)}return{successful:!!(le.delimiter=Vr),bestDelimiter:Vr}})(_t,le.newline,le.skipEmptyLines,le.comments,le.delimitersToGuess)).successful?le.delimiter=ir.bestDelimiter:(mt=!0,le.delimiter=$.DefaultDelimiter),Ne.meta.delimiter=le.delimiter),Dt(le));return le.preview&&le.header&&ir.preview++,ve=_t,Ae=new pt(ir),Ne=Ae.parse(ve,Ct,rr),Nt(),nt?{meta:{paused:!0}}:Ne||{meta:{paused:!1}}},this.paused=function(){return nt},this.pause=function(){nt=!0,Ae.abort(),ve=ft(le.chunk)?"":ve.substring(Ae.getCharIndex())},this.resume=function(){yt.streamer._halted?(nt=!1,yt.streamer.parseChunk(ve,!0)):setTimeout(yt.resume,3)},this.aborted=function(){return ae},this.abort=function(){ae=!0,Ae.abort(),Ne.meta.aborted=!0,ft(le.complete)&&le.complete(Ne),ve=""},this.guessLineEndings=function(Tr,ir){Tr=Tr.substring(0,1048576);var ir=new RegExp(je(ir)+"([^]*?)"+je(ir),"gm"),rr=(Tr=Tr.replace(ir,"")).split("\r"),ir=Tr.split(`
`),Tr=1<ir.length&&ir[0].length<rr[0].length;if(rr.length===1||Tr)return`
`;for(var Nr=0,vr=0;vr<rr.length;vr++)rr[vr][0]===`
`&&Nr++;return Nr>=rr.length/2?`\r
`:"\r"}}function je(le){return le.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pt(le){var ve=(le=le||{}).delimiter,Ae=le.newline,mt=le.comments,ot=le.step,ct=le.preview,Wt=le.fastMode,dr=null,pr=!1,yt=le.quoteChar==null?'"':le.quoteChar,Ue=yt;if(le.escapeChar!==void 0&&(Ue=le.escapeChar),(typeof ve!="string"||-1<$.BAD_DELIMITERS.indexOf(ve))&&(ve=","),mt===ve)throw new Error("Comment character same as delimiter");mt===!0?mt="#":(typeof mt!="string"||-1<$.BAD_DELIMITERS.indexOf(mt))&&(mt=!1),Ae!==`
`&&Ae!=="\r"&&Ae!==`\r
`&&(Ae=`
`);var Xe=0,nt=!1;this.parse=function(ae,Pe,Ne){if(typeof ae!="string")throw new Error("Input must be a string");var wt=ae.length,Nt=ve.length,Zt=Ae.length,lr=mt.length,_t=ft(ot),Ct=[],rr=[],ir=[],Tr=Xe=0;if(!ae)return Kt();if(Wt||Wt!==!1&&ae.indexOf(yt)===-1){for(var Nr=ae.split(Ae),vr=0;vr<Nr.length;vr++){if(ir=Nr[vr],Xe+=ir.length,vr!==Nr.length-1)Xe+=Ae.length;else if(Ne)return Kt();if(!mt||ir.substring(0,lr)!==mt){if(_t){if(Ct=[],Te(ir.split(ve)),ui(),nt)return Kt()}else Te(ir.split(ve));if(ct&&ct<=vr)return Ct=Ct.slice(0,ct),Kt(!0)}}return Kt()}for(var xr=ae.indexOf(ve,Xe),nr=ae.indexOf(Ae,Xe),Vr=new RegExp(je(Ue)+je(yt),"g"),fr=ae.indexOf(yt,Xe);;)if(ae[Xe]===yt)for(fr=Xe,Xe++;;){if((fr=ae.indexOf(yt,fr+1))===-1)return Ne||rr.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Ct.length,index:Xe}),Jr();if(fr===wt-1)return Jr(ae.substring(Xe,fr).replace(Vr,yt));if(yt===Ue&&ae[fr+1]===Ue)fr++;else if(yt===Ue||fr===0||ae[fr-1]!==Ue){xr!==-1&&xr<fr+1&&(xr=ae.indexOf(ve,fr+1));var Er=Wr((nr=nr!==-1&&nr<fr+1?ae.indexOf(Ae,fr+1):nr)===-1?xr:Math.min(xr,nr));if(ae.substr(fr+1+Er,Nt)===ve){ir.push(ae.substring(Xe,fr).replace(Vr,yt)),ae[Xe=fr+1+Er+Nt]!==yt&&(fr=ae.indexOf(yt,Xe)),xr=ae.indexOf(ve,Xe),nr=ae.indexOf(Ae,Xe);break}if(Er=Wr(nr),ae.substring(fr+1+Er,fr+1+Er+Zt)===Ae){if(ir.push(ae.substring(Xe,fr).replace(Vr,yt)),kr(fr+1+Er+Zt),xr=ae.indexOf(ve,Xe),fr=ae.indexOf(yt,Xe),_t&&(ui(),nt))return Kt();if(ct&&Ct.length>=ct)return Kt(!0);break}rr.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Ct.length,index:Xe}),fr++}}else if(mt&&ir.length===0&&ae.substring(Xe,Xe+lr)===mt){if(nr===-1)return Kt();Xe=nr+Zt,nr=ae.indexOf(Ae,Xe),xr=ae.indexOf(ve,Xe)}else if(xr!==-1&&(xr<nr||nr===-1))ir.push(ae.substring(Xe,xr)),Xe=xr+Nt,xr=ae.indexOf(ve,Xe);else{if(nr===-1)break;if(ir.push(ae.substring(Xe,nr)),kr(nr+Zt),_t&&(ui(),nt))return Kt();if(ct&&Ct.length>=ct)return Kt(!0)}return Jr();function Te(Hr){Ct.push(Hr),Tr=Xe}function Wr(Hr){var Kr=0;return Kr=Hr!==-1&&(Hr=ae.substring(fr+1,Hr))&&Hr.trim()===""?Hr.length:Kr}function Jr(Hr){return Ne||(Hr===void 0&&(Hr=ae.substring(Xe)),ir.push(Hr),Xe=wt,Te(ir),_t&&ui()),Kt()}function kr(Hr){Xe=Hr,Te(ir),ir=[],nr=ae.indexOf(Ae,Xe)}function Kt(Hr){if(le.header&&!Pe&&Ct.length&&!pr){var Kr=Ct[0],Ui={},Qn=new Set(Kr);let un=!1;for(let Ai=0;Ai<Kr.length;Ai++){let Ge=Kr[Ai];if(Ui[Ge=ft(le.transformHeader)?le.transformHeader(Ge,Ai):Ge]){let $i,jr=Ui[Ge];for(;$i=Ge+"_"+jr,jr++,Qn.has($i););Qn.add($i),Kr[Ai]=$i,Ui[Ge]++,un=!0,(dr=dr===null?{}:dr)[$i]=Ge}else Ui[Ge]=1,Kr[Ai]=Ge;Qn.add(Ge)}un&&console.warn("Duplicate headers found and renamed."),pr=!0}return{data:Ct,errors:rr,meta:{delimiter:ve,linebreak:Ae,aborted:nt,truncated:!!Hr,cursor:Tr+(Pe||0),renamedHeaders:dr}}}function ui(){ot(Kt()),Ct=[],rr=[]}},this.abort=function(){nt=!0},this.getCharIndex=function(){return Xe}}function Lt(le){var ve=le.data,Ae=c[ve.workerId],mt=!1;if(ve.error)Ae.userError(ve.error,ve.file);else if(ve.results&&ve.results.data){var ot={abort:function(){mt=!0,Ot(ve.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Ut,resume:Ut};if(ft(Ae.userStep)){for(var ct=0;ct<ve.results.data.length&&(Ae.userStep({data:ve.results.data[ct],errors:ve.results.errors,meta:ve.results.meta},ot),!mt);ct++);delete ve.results}else ft(Ae.userChunk)&&(Ae.userChunk(ve.results,ot,ve.file),delete ve.results)}ve.finished&&!mt&&Ot(ve.workerId,ve.results)}function Ot(le,ve){var Ae=c[le];ft(Ae.userComplete)&&Ae.userComplete(ve),Ae.terminate(),delete c[le]}function Ut(){throw new Error("Not implemented.")}function Dt(le){if(typeof le!="object"||le===null)return le;var ve,Ae=Array.isArray(le)?[]:{};for(ve in le)Ae[ve]=Dt(le[ve]);return Ae}function Rt(le,ve){return function(){le.apply(ve,arguments)}}function ft(le){return typeof le=="function"}return $.parse=function(le,ve){var Ae=(ve=ve||{}).dynamicTyping||!1;if(ft(Ae)&&(ve.dynamicTypingFunction=Ae,Ae={}),ve.dynamicTyping=Ae,ve.transform=!!ft(ve.transform)&&ve.transform,!ve.worker||!$.WORKERS_SUPPORTED)return Ae=null,$.NODE_STREAM_INPUT,typeof le=="string"?(le=(mt=>mt.charCodeAt(0)!==65279?mt:mt.slice(1))(le),Ae=new(ve.download?Me:xt)(ve)):le.readable===!0&&ft(le.read)&&ft(le.on)?Ae=new Je(ve):(j.File&&le instanceof File||le instanceof Object)&&(Ae=new Ce(ve)),Ae.stream(le);(Ae=(()=>{var mt;return!!$.WORKERS_SUPPORTED&&(mt=(()=>{var ot=j.URL||j.webkitURL||null,ct=z.toString();return $.BLOB_URL||($.BLOB_URL=ot.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",ct,")();"],{type:"text/javascript"})))})(),(mt=new j.Worker(mt)).onmessage=Lt,mt.id=ye++,c[mt.id]=mt)})()).userStep=ve.step,Ae.userChunk=ve.chunk,Ae.userComplete=ve.complete,Ae.userError=ve.error,ve.step=ft(ve.step),ve.chunk=ft(ve.chunk),ve.complete=ft(ve.complete),ve.error=ft(ve.error),delete ve.worker,Ae.postMessage({input:le,config:ve,workerId:Ae.id})},$.unparse=function(le,ve){var Ae=!1,mt=!0,ot=",",ct=`\r
`,Wt='"',dr=Wt+Wt,pr=!1,yt=null,Ue=!1,Xe=((()=>{if(typeof ve=="object"){if(typeof ve.delimiter!="string"||$.BAD_DELIMITERS.filter(function(Pe){return ve.delimiter.indexOf(Pe)!==-1}).length||(ot=ve.delimiter),typeof ve.quotes!="boolean"&&typeof ve.quotes!="function"&&!Array.isArray(ve.quotes)||(Ae=ve.quotes),typeof ve.skipEmptyLines!="boolean"&&typeof ve.skipEmptyLines!="string"||(pr=ve.skipEmptyLines),typeof ve.newline=="string"&&(ct=ve.newline),typeof ve.quoteChar=="string"&&(Wt=ve.quoteChar),typeof ve.header=="boolean"&&(mt=ve.header),Array.isArray(ve.columns)){if(ve.columns.length===0)throw new Error("Option columns is empty");yt=ve.columns}ve.escapeChar!==void 0&&(dr=ve.escapeChar+Wt),ve.escapeFormulae instanceof RegExp?Ue=ve.escapeFormulae:typeof ve.escapeFormulae=="boolean"&&ve.escapeFormulae&&(Ue=/^[=+\-@\t\r].*$/)}})(),new RegExp(je(Wt),"g"));if(typeof le=="string"&&(le=JSON.parse(le)),Array.isArray(le)){if(!le.length||Array.isArray(le[0]))return nt(null,le,pr);if(typeof le[0]=="object")return nt(yt||Object.keys(le[0]),le,pr)}else if(typeof le=="object")return typeof le.data=="string"&&(le.data=JSON.parse(le.data)),Array.isArray(le.data)&&(le.fields||(le.fields=le.meta&&le.meta.fields||yt),le.fields||(le.fields=Array.isArray(le.data[0])?le.fields:typeof le.data[0]=="object"?Object.keys(le.data[0]):[]),Array.isArray(le.data[0])||typeof le.data[0]=="object"||(le.data=[le.data])),nt(le.fields||[],le.data||[],pr);throw new Error("Unable to serialize unrecognized input");function nt(Pe,Ne,wt){var Nt="",Zt=(typeof Pe=="string"&&(Pe=JSON.parse(Pe)),typeof Ne=="string"&&(Ne=JSON.parse(Ne)),Array.isArray(Pe)&&0<Pe.length),lr=!Array.isArray(Ne[0]);if(Zt&&mt){for(var _t=0;_t<Pe.length;_t++)0<_t&&(Nt+=ot),Nt+=ae(Pe[_t],_t);0<Ne.length&&(Nt+=ct)}for(var Ct=0;Ct<Ne.length;Ct++){var rr=(Zt?Pe:Ne[Ct]).length,ir=!1,Tr=Zt?Object.keys(Ne[Ct]).length===0:Ne[Ct].length===0;if(wt&&!Zt&&(ir=wt==="greedy"?Ne[Ct].join("").trim()==="":Ne[Ct].length===1&&Ne[Ct][0].length===0),wt==="greedy"&&Zt){for(var Nr=[],vr=0;vr<rr;vr++){var xr=lr?Pe[vr]:vr;Nr.push(Ne[Ct][xr])}ir=Nr.join("").trim()===""}if(!ir){for(var nr=0;nr<rr;nr++){0<nr&&!Tr&&(Nt+=ot);var Vr=Zt&&lr?Pe[nr]:nr;Nt+=ae(Ne[Ct][Vr],nr)}Ct<Ne.length-1&&(!wt||0<rr&&!Tr)&&(Nt+=ct)}}return Nt}function ae(Pe,Ne){var wt,Nt;return Pe==null?"":Pe.constructor===Date?JSON.stringify(Pe).slice(1,25):(Nt=!1,Ue&&typeof Pe=="string"&&Ue.test(Pe)&&(Pe="'"+Pe,Nt=!0),wt=Pe.toString().replace(Xe,dr),(Nt=Nt||Ae===!0||typeof Ae=="function"&&Ae(Pe,Ne)||Array.isArray(Ae)&&Ae[Ne]||((Zt,lr)=>{for(var _t=0;_t<lr.length;_t++)if(-1<Zt.indexOf(lr[_t]))return!0;return!1})(wt,$.BAD_DELIMITERS)||-1<wt.indexOf(ot)||wt.charAt(0)===" "||wt.charAt(wt.length-1)===" ")?Wt+wt+Wt:wt)}},$.RECORD_SEP="",$.UNIT_SEP="",$.BYTE_ORDER_MARK="\uFEFF",$.BAD_DELIMITERS=["\r",`
`,'"',$.BYTE_ORDER_MARK],$.WORKERS_SUPPORTED=!ce&&!!j.Worker,$.NODE_STREAM_INPUT=1,$.LocalChunkSize=10485760,$.RemoteChunkSize=5242880,$.DefaultDelimiter=",",$.Parser=pt,$.ParserHandle=at,$.NetworkStreamer=Me,$.FileStreamer=Ce,$.StringStreamer=xt,$.ReadableStreamStreamer=Je,j.jQuery&&((Y=j.jQuery).fn.parse=function(le){var ve=le.config||{},Ae=[];return this.each(function(ct){if(!(Y(this).prop("tagName").toUpperCase()==="INPUT"&&Y(this).attr("type").toLowerCase()==="file"&&j.FileReader)||!this.files||this.files.length===0)return!0;for(var Wt=0;Wt<this.files.length;Wt++)Ae.push({file:this.files[Wt],inputElem:this,instanceConfig:Y.extend({},ve)})}),mt(),this;function mt(){if(Ae.length===0)ft(le.complete)&&le.complete();else{var ct,Wt,dr,pr,yt=Ae[0];if(ft(le.before)){var Ue=le.before(yt.file,yt.inputElem);if(typeof Ue=="object"){if(Ue.action==="abort")return ct="AbortError",Wt=yt.file,dr=yt.inputElem,pr=Ue.reason,void(ft(le.error)&&le.error({name:ct},Wt,dr,pr));if(Ue.action==="skip")return void ot();typeof Ue.config=="object"&&(yt.instanceConfig=Y.extend(yt.instanceConfig,Ue.config))}else if(Ue==="skip")return void ot()}var Xe=yt.instanceConfig.complete;yt.instanceConfig.complete=function(nt){ft(Xe)&&Xe(nt,yt.file,yt.inputElem),ot()},$.parse(yt.file,yt.instanceConfig)}}function ot(){Ae.splice(0,1),mt()}}),xe&&(j.onmessage=function(le){le=le.data,$.WORKER_ID===void 0&&le&&($.WORKER_ID=le.workerId),typeof le.input=="string"?j.postMessage({workerId:$.WORKER_ID,results:$.parse(le.input,le.config),finished:!0}):(j.File&&le.input instanceof File||le.input instanceof Object)&&(le=$.parse(le.input,le.config))&&j.postMessage({workerId:$.WORKER_ID,results:le,finished:!0})}),(Me.prototype=Object.create(Le.prototype)).constructor=Me,(Ce.prototype=Object.create(Le.prototype)).constructor=Ce,(xt.prototype=Object.create(xt.prototype)).constructor=xt,(Je.prototype=Object.create(Le.prototype)).constructor=Je,$})}(Zd)),Zd.exports}var Gg=Zg();const Ef=ed(Gg);class Wg{async parseCSV(D){return new Promise((z,j)=>{if(!D){j(new Error(""));return}if(D.type&&!["text/csv","application/vnd.ms-excel","text/plain"].includes(D.type)){j(new Error(`: ${D.type}`));return}try{const Y=new FileReader;Y.onload=ce=>{try{const xe=ce.target.result;if(!xe||xe.trim()===""){j(new Error(""));return}const c=xe.replace(/^\uFEFF/,""),{data:ye,errors:$,meta:Le}=Ef.parse(c,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,transform:Je=>Je.trim(),transformHeader:Je=>Je.trim(),delimitersToGuess:[",","	",";","|"],error:Je=>{j(new Error(`CSV: ${Je.message}`))}});if($.length>0){const Je=$.filter(at=>at.type!=="FieldMismatch");if(Je.length>0){const at="CSV: "+Je.map(je=>` ${je.row}: ${je.message}`).join(", ");j(new Error(at));return}}const Ce=["uniqueId","placeName","adminLevel"].filter(Je=>!Le.fields.includes(Je));if(Ce.length>0){j(new Error(`CSV: ${Ce.join(", ")}`));return}const xt=ye.filter(Je=>Je.uniqueId&&Je.placeName&&Je.adminLevel).map(Je=>({...Je,uniqueId:String(Je.uniqueId).trim(),placeName:String(Je.placeName).trim(),adminLevel:String(Je.adminLevel).trim(),dateMarked:Je.dateMarked||new Date().toISOString()}));if(xt.length===0){j(new Error(""));return}z({data:xt,meta:Le,invalidRows:ye.length-xt.length})}catch(xe){gi(xe,{action:"parseCSV"}),j(new Error(`CSV: ${xe.message}`))}},Y.onerror=()=>{j(new Error(""))},Y.readAsText(D)}catch(Y){gi(Y,{}),j(new Error(`: ${Y.message}`))}})}generateCSV(D,z=null){try{if(!D||D.length===0)throw new Error("");const j=["uniqueId","placeName","adminLevel","dateMarked","countryCodeISO","regionCodeISO"],Y=D.map(ce=>{const xe={};return(z||j).forEach(c=>{xe[c]=ce[c]!==null&&ce[c]!==void 0?ce[c]:""}),xe});return Ef.unparse({fields:z||j,data:Y},{quotes:!0,delimiter:",",header:!0,newline:`\r
`})}catch(j){throw gi(j,{}),new Error(`CSV: ${j.message}`)}}downloadCSV(D,z=null){try{if(!D)throw new Error("");if(!z){const ye=new Date,$=`${ye.getFullYear()}${String(ye.getMonth()+1).padStart(2,"0")}${String(ye.getDate()).padStart(2,"0")}`,Le=`${String(ye.getHours()).padStart(2,"0")}${String(ye.getMinutes()).padStart(2,"0")}`;z=`MyWorldAtlas_Export_${$}_${Le}.csv`}const Y="\uFEFF"+D,ce=new Blob([Y],{type:"text/csv;charset=utf-8;"}),xe=URL.createObjectURL(ce),c=document.createElement("a");c.setAttribute("href",xe),c.setAttribute("download",z),c.style.visibility="hidden",document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(xe)},100)}catch(j){throw gi(j,{}),new Error(`: ${j.message}`)}}exportToCSV(D,z=null,j=null){try{const Y=this.generateCSV(D,z);return this.downloadCSV(Y,j),!0}catch(Y){throw gi(Y,{}),Y}}}const Cf=new Wg;class Hg{constructor(){this.countriesGeoJsonUrl="https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson",this.geoDataCache={countries:null,lastFetched:null},this.cacheExpiration=24*60*60*1e3,this.maxRetries=3,this.retryDelay=1e3}async getCountriesGeoJson(){if(this.isCacheValid("countries"))return this.geoDataCache.countries;let D=0;for(;D<this.maxRetries;)try{const z=await fetch(this.countriesGeoJsonUrl,{headers:{Accept:"application/json","Cache-Control":"no-cache"},signal:AbortSignal.timeout(1e4)});if(!z.ok)throw new Error(`: ${z.status} ${z.statusText}`);const j=await z.json();if(!j||!j.features||!Array.isArray(j.features))throw new Error("GeoJSON");return this.geoDataCache.countries=j,this.geoDataCache.lastFetched=new Date,j}catch(z){if(D++,D>=this.maxRetries)throw gi(z,{}),new Error(`${D}: ${z.message}`);await new Promise(j=>setTimeout(j,this.retryDelay*D))}}isCacheValid(D){return!this.geoDataCache[D]||!this.geoDataCache.lastFetched?!1:new Date-this.geoDataCache.lastFetched<this.cacheExpiration}clearCache(D=null){D&&this.geoDataCache[D]?this.geoDataCache[D]=null:Object.keys(this.geoDataCache).forEach(z=>{z!=="lastFetched"&&(this.geoDataCache[z]=null)}),this.geoDataCache.lastFetched=null}async getCurrentLocation(){return new Promise((D,z)=>{if(!("geolocation"in navigator)){z(new Error(""));return}const j=setTimeout(()=>{z(new Error(""))},15e3);navigator.geolocation.getCurrentPosition(Y=>{clearTimeout(j);const{longitude:ce,latitude:xe,accuracy:c}=Y.coords;c>1e4&&console.warn("",{accuracy:c}),D({longitude:ce,latitude:xe,accuracy:c})},Y=>{clearTimeout(j),gi(Y,{});let ce="";switch(Y.code){case 1:ce="";break;case 2:ce="";break;case 3:ce="";break}z(new Error(ce))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})})}async getCountryByIsoCode(D){if(!D||typeof D!="string")throw new Error("");try{const z=await this.getCountriesGeoJson();if(!z||!z.features)throw new Error("");const j=z.features.find(Y=>Y.properties&&Y.properties.ISO_A2===D);if(!j)throw new Error(` "${D}" `);return j}catch(z){throw gi(z,{}),z}}async searchCountriesByName(D){try{if(!D||D.trim()==="")return[];const z=await this.getCountriesGeoJson();if(!z||!z.features)throw new Error("");const j=D.toLowerCase();return z.features.filter(Y=>Y.properties&&Y.properties.ADMIN&&Y.properties.ADMIN.toLowerCase().includes(j))}catch(z){throw gi(z,{}),z}}generateVisitedCountriesStyle(D,z="#ADD8E6"){return Array.isArray(D)?["case",["in",["get","ISO_A2"],["literal",D]],z,"rgba(0, 0, 0, 0)"]:(console.warn("",D),["case",["in",["get","ISO_A2"],["literal",[]]],z,"rgba(0, 0, 0, 0)"])}}const zp=new Hg,Zp=Ag((A,D)=>({visitedPlaces:[],selectedPlace:null,isLoading:!1,error:null,toast:{show:!1,message:"",type:"info"},initializeStore:su(async()=>{A({isLoading:!0});try{const z=await Yh.getAllVisitedPlaces();console.log(":",z),A({visitedPlaces:z,isLoading:!1})}catch(z){gi(z,{action:"initializeStore"});const j=fs(z,"");A({error:j,isLoading:!1,toast:{show:!0,message:j,type:"error"}})}},z=>{A({isLoading:!1,error:fs(z,"")})}),markPlaceAsVisited:su(async z=>{const{uniqueId:j,placeName:Y,adminLevel:ce,countryCodeISO:xe,regionCodeISO:c}=z;if(console.log(":",z),!j||!Y||!ce){const ye="";console.error(ye,z),A({error:ye,toast:{show:!0,message:ye,type:"error"}});return}A({isLoading:!0});try{const ye={uniqueId:j,placeName:Y,adminLevel:ce,dateMarked:new Date().toISOString(),countryCodeISO:xe||j,regionCodeISO:c||j};console.log(":",ye),await Yh.saveVisitedPlace(ye);const $=[...D().visitedPlaces,ye];A({visitedPlaces:$,isLoading:!1,selectedPlace:ye,toast:{show:!0,message:`${Y}`,type:"success"}}),console.log(":",$),setTimeout(()=>{A(Le=>({toast:{...Le.toast,show:!1}}))},3e3)}catch(ye){gi(ye,{action:"markPlaceAsVisited",placeData:z});const $=fs(ye,"");A({error:$,isLoading:!1,toast:{show:!0,message:$,type:"error"}})}},z=>{A({isLoading:!1,error:fs(z,""),toast:{show:!0,message:fs(z,""),type:"error"}})}),removePlaceVisit:su(async z=>{A({isLoading:!0});try{await Yh.deleteVisitedPlace(z);const j=D().visitedPlaces.filter(Y=>Y.uniqueId!==z);A({visitedPlaces:j,isLoading:!1,toast:{show:!0,message:"",type:"info"}}),setTimeout(()=>{A(Y=>({toast:{...Y.toast,show:!1}}))},3e3)}catch(j){gi(j,{action:"removePlaceVisit",uniqueId:z});const Y=fs(j,"");A({error:Y,isLoading:!1,toast:{show:!0,message:Y,type:"error"}})}},z=>{A({isLoading:!1,error:fs(z,""),toast:{show:!0,message:fs(z,""),type:"error"}})}),setSelectedPlace:z=>A({selectedPlace:z}),clearError:()=>A({error:null}),showToast:(z,j="info")=>{A({toast:{show:!0,message:z,type:j}}),setTimeout(()=>{A(Y=>({toast:{...Y.toast,show:!1}}))},3e3)},exportToCSV:su(()=>{const z=D().visitedPlaces;if(z.length===0){D().showToast("","warning");return}try{Cf.exportToCSV(z),D().showToast("CSV","success")}catch(j){gi(j,{action:"exportToCSV"});const Y=fs(j,"");throw D().showToast(Y,"error"),j}},z=>{D().showToast(fs(z,""),"error")}),importFromCSV:su(async z=>{if(!z){D().showToast("","warning");return}A({isLoading:!0});try{const{data:j}=await Cf.parseCSV(z),{success:Y,skipped:ce}=await Yh.bulkSaveVisitedPlaces(j),xe=await Yh.getAllVisitedPlaces();A({visitedPlaces:xe,isLoading:!1,toast:{show:!0,message:`: ${Y}${ce}`,type:"success"}})}catch(j){gi(j,{action:"importFromCSV"});const Y=fs(j,"");A({error:Y,isLoading:!1,toast:{show:!0,message:Y,type:"error"}})}},z=>{A({isLoading:!1,error:fs(z,""),toast:{show:!0,message:fs(z,""),type:"error"}})}),getCurrentLocation:su(async()=>{try{return await zp.getCurrentLocation()}catch{return{longitude:139.7528,latitude:35.6852}}},z=>(gi(z,{}),{longitude:139.7528,latitude:35.6852})),getCountriesData:su(async()=>{try{return await zp.getCountriesGeoJson()}catch(z){gi(z,{action:"getCountriesData"});const j=fs(z,"");throw D().showToast(j,"error"),z}},z=>(D().showToast(fs(z,""),"error"),null)),getVisitedCountriesStyle:()=>{const j=D().visitedPlaces.filter(Y=>Y.countryCodeISO).map(Y=>Y.countryCodeISO);return zp.generateVisitedCountriesStyle(j)}}));var Gd={exports:{}},Kg=Gd.exports,If;function Xg(){return If||(If=1,function(A,D){(function(z,j){A.exports=j()})(Kg,function(){var z,j,Y;function ce(c,ye){if(!z)z=ye;else if(!j)j=ye;else{var $="var sharedChunk = {}; ("+z+")(sharedChunk); ("+j+")(sharedChunk);",Le={};z(Le),Y=ye(Le),typeof window<"u"&&(Y.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}ce(["exports"],function(c){function ye(r,e,i,o){return new(i||(i=Promise))(function(u,m){function g(k){try{w(o.next(k))}catch(C){m(C)}}function _(k){try{w(o.throw(k))}catch(C){m(C)}}function w(k){var C;k.done?u(k.value):(C=k.value,C instanceof i?C:new i(function(M){M(C)})).then(g,_)}w((o=o.apply(r,e||[])).next())})}function $(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var Le=Me;function Me(r,e){this.x=r,this.y=e}Me.prototype={clone:function(){return new Me(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(r,e){var i=Math.cos(r),o=Math.sin(r),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Me.convert=function(r){return r instanceof Me?r:Array.isArray(r)?new Me(r[0],r[1]):r};var Ce=$(Le),xt=Je;function Je(r,e,i,o){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=o}Je.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,o=0;o<8;o++){var u=this.sampleCurveX(i)-r;if(Math.abs(u)<e)return i;var m=this.sampleCurveDerivativeX(i);if(Math.abs(m)<1e-6)break;i-=u/m}var g=0,_=1;for(i=r,o=0;o<20&&(u=this.sampleCurveX(i),!(Math.abs(u-r)<e));o++)r>u?g=i:_=i,i=.5*(_-g)+g;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var at=$(xt);let je,pt;function Lt(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function Ot(){if(pt==null&&(pt=!1,Lt())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&i[o]!==o){pt=!0;break}}}return pt||!1}function Ut(r,e,i,o){const u=new at(r,e,i,o);return function(m){return u.solve(m)}}const Dt=Ut(.25,.1,.25,1);function Rt(r,e,i){return Math.min(i,Math.max(e,r))}function ft(r,e,i){const o=i-e,u=((r-e)%o+o)%o+e;return u===e?i:u}function le(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let ve=1;function Ae(r,e,i){const o={};for(const u in r)o[u]=e.call(i||this,r[u],u,r);return o}function mt(r,e,i){const o={};for(const u in r)e.call(i||this,r[u],u,r)&&(o[u]=r[u]);return o}function ot(r){return Array.isArray(r)?r.map(ot):typeof r=="object"&&r?Ae(r,ot):r}const ct={};function Wt(r){ct[r]||(typeof console<"u"&&console.warn(r),ct[r]=!0)}function dr(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function pr(r){let e=0;for(let i,o,u=0,m=r.length,g=m-1;u<m;g=u++)i=r[u],o=r[g],e+=(o.x-i.x)*(i.y+o.y);return e}function yt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ue=null;function Xe(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ae(r,e,i,o,u){return ye(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),w=new Uint8ClampedArray(o*u*4);if(yield m.copyTo(w,function(k,C,M,R,N){const V=4*Math.max(-C,0),W=(Math.max(0,M)-M)*R*4+V,J=4*R,ie=Math.max(0,C),fe=Math.max(0,M);return{rect:{x:ie,y:fe,width:Math.min(k.width,C+R)-ie,height:Math.min(k.height,M+N)-fe},layout:[{offset:W,stride:J}]}}(r,e,i,o,u)),_)for(let k=0;k<w.length;k+=4){const C=w[k];w[k]=w[k+2],w[k+2]=C}return w}finally{m.close()}})}let Pe,Ne,wt,Nt;const Zt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){return this.getImageCanvasContext(r).getImageData(-e,-e,r.width+2*e,r.height+2*e)},getImageCanvasContext(r){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=r.width,e.height=r.height,i.drawImage(r,0,0,r.width,r.height),i},resolveURL:r=>(wt||(wt=document.createElement("a")),wt.href=r,wt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Nt==null&&(Nt=matchMedia("(prefers-reduced-motion: reduce)")),Nt.matches)}},lr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class _t extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const Ct=yt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,rr=r=>lr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function ir(r,e){const i=new AbortController,o=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:Ct(),signal:i.signal});let u=!1,m=!1;return r.type==="json"&&o.headers.set("Accept","application/json"),m||fetch(o).then(g=>g.ok?(_=>{(r.type==="arrayBuffer"||r.type==="image"?_.arrayBuffer():r.type==="json"?_.json():_.text()).then(w=>{m||(u=!0,e(null,w,_.headers.get("Cache-Control"),_.headers.get("Expires")))}).catch(w=>{m||e(new Error(w.message))})})(g):g.blob().then(_=>e(new _t(g.status,g.statusText,r.url,_)))).catch(g=>{g.code!==20&&e(new Error(g.message))}),{cancel:()=>{m=!0,u||i.abort()}}}const Tr=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(yt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!yt())return(rr(r.url)||ir)(r,e)}if(!(/^file:/.test(i=r.url)||/^file:/.test(Ct())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ir(r,e);if(yt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(o,u){const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(m.responseType="arraybuffer");for(const g in o.headers)m.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{u(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(o.type==="json")try{g=JSON.parse(m.response)}catch(_){return u(_)}u(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const g=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});u(new _t(m.status,m.statusText,o.url,g))}},m.send(o.body),{cancel:()=>m.abort()}}(r,e)},Nr=function(r,e){return Tr(le(r,{type:"arrayBuffer"}),e)};function vr(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function xr(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function nr(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class Vr{constructor(e,i={}){le(this,i),this.type=e}}class fr extends Vr{constructor(e,i={}){super("error",le({error:e},i))}}class Er{on(e,i){return this._listeners=this._listeners||{},xr(e,i,this._listeners),this}off(e,i){return nr(e,i,this._listeners),nr(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},xr(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new Vr(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of m)nr(o,_,this._oneTimeListeners),_.call(this,e);const g=this._eventedParent;g&&(le(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof fr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Wr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jr(r,e){const i={};for(const o in r)o!=="ref"&&(i[o]=r[o]);return Wr.forEach(o=>{o in e&&(i[o]=e[o])}),i}function kr(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!kr(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!kr(r[i],e[i]))return!1;return!0}return r===e}const Kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ui(r,e,i){i.push({command:Kt.addSource,args:[r,e[r]]})}function Hr(r,e,i){e.push({command:Kt.removeSource,args:[r]}),i[r]=!0}function Kr(r,e,i,o){Hr(r,i,o),ui(r,e,i)}function Ui(r,e,i){let o;for(o in r[i])if(Object.prototype.hasOwnProperty.call(r[i],o)&&o!=="data"&&!kr(r[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!kr(r[i][o],e[i][o]))return!1;return!0}function Qn(r,e,i,o,u,m){let g;for(g in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,g)&&(kr(r[g],e[g])||i.push({command:m,args:[o,g,e[g],u]}));for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(kr(r[g],e[g])||i.push({command:m,args:[o,g,e[g],u]}))}function un(r){return r.id}function Ai(r,e){return r[e.id]=e,r}class Ge{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function $i(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}class jr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class xa{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new xa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const es={kind:"null"},Qe={kind:"number"},sr={kind:"string"},Jt={kind:"boolean"},qi={kind:"color"},cn={kind:"object"},Qt={kind:"value"},ms={kind:"collator"},H={kind:"formatted"},L={kind:"padding"},F={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function X(r,e){return{kind:"array",itemType:r,N:e}}function Q(r){if(r.kind==="array"){const e=Q(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const me=[es,Qe,sr,Jt,qi,H,cn,X(Qt),L,F,U];function se(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!se(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of me)if(!se(i,e))return null}}return`Expected ${Q(r)} but found ${Q(e)} instead.`}function te(r,e){return e.some(i=>i.kind===r.kind)}function pe(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function ze(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Re=.96422,Be=.82521,At=4/29,Xt=6/29,St=3*Xt*Xt,Ft=Xt*Xt*Xt,Gt=Math.PI/180,Ir=180/Math.PI;function zr(r){return(r%=360)<0&&(r+=360),r}function wr([r,e,i,o]){let u,m;const g=Zi((.2225045*(r=yr(r))+.7168786*(e=yr(e))+.0606169*(i=yr(i)))/1);r===e&&e===i?u=m=g:(u=Zi((.4360747*r+.3850649*e+.1430804*i)/Re),m=Zi((.0139322*r+.0971045*e+.7141733*i)/Be));const _=116*g-16;return[_<0?0:_,500*(u-g),200*(g-m),o]}function yr(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Zi(r){return r>Ft?Math.pow(r,1/3):r/St+At}function Br([r,e,i,o]){let u=(r+16)/116,m=isNaN(e)?u:u+e/500,g=isNaN(i)?u:u-i/200;return u=1*Gi(u),m=Re*Gi(m),g=Be*Gi(g),[yi(3.1338561*m-1.6168667*u-.4906146*g),yi(-.9787684*m+1.9161415*u+.033454*g),yi(.0719453*m-.2289914*u+1.4052427*g),o]}function yi(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Gi(r){return r>Xt?r*r*r:St*(r-At)}function On(r){return parseInt(r.padEnd(2,r),16)/255}function ci(r,e){return Ja(e?r/100:r,0,1)}function Ja(r,e,i){return Math.min(Math.max(e,r),i)}function na(r){return!r.some(Number.isNaN)}const sc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Pr{constructor(e,i,o,u=1,m=!0){this.r=e,this.g=i,this.b=o,this.a=u,m||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Pr)return e;if(typeof e!="string")return;const i=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=sc[o];if(u){const[g,_,w]=u;return[g/255,_/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let _=1;return[On(o.slice(_,_+=g)),On(o.slice(_,_+=g)),On(o.slice(_,_+=g)),On(o.slice(_,_+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,w,k,C,M,R,N,V,W,J,ie,fe]=g,ne=[C||" ",N||" ",J].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ge=[k,R,W].join(""),ke=ge==="%%%"?100:ge===""?255:0;if(ke){const Oe=[Ja(+w/ke,0,1),Ja(+M/ke,0,1),Ja(+V/ke,0,1),ie?ci(+ie,fe):1];if(na(Oe))return Oe}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,w,k,C,M,R,N,V]=m,W=[w||" ",C||" ",R].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const J=[+_,Ja(+k,0,100),Ja(+M,0,100),N?ci(+N,V):1];if(na(J))return function([ie,fe,ne,ge]){function ke(Oe){const dt=(Oe+ie/30)%12,Et=fe*Math.min(ne,1-ne);return ne-Et*Math.max(-1,Math.min(dt-3,9-dt,1))}return ie=zr(ie),fe/=100,ne/=100,[ke(0),ke(8),ke(4),ge]}(J)}}}(e);return i?new Pr(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,m=u||1/0;return this.overwriteGetter("rgb",[e/m,i/m,o/m,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[i,o,u,m]=wr(e),g=Math.sqrt(o*o+u*u);return[Math.round(1e4*g)?zr(Math.atan2(u,o)*Ir):NaN,g,i,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wr(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map(m=>Math.round(255*m)).join(",")},${u})`}}Pr.black=new Pr(0,0,0,1),Pr.white=new Pr(1,1,1,1),Pr.transparent=new Pr(0,0,0,0),Pr.red=new Pr(1,0,0,1);class cu{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oo{constructor(e,i,o,u,m){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=m}}class Ii{constructor(e){this.sections=e}static fromString(e){return new Ii([new Oo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ii?e:Ii.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class hi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hi)return e;if(typeof e=="number")return new hi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new hi(e)}}toString(){return JSON.stringify(this.values)}}const lh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class di{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof di)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!lh.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new di(e)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Wi({name:e,available:!1}):null}}function vl(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qa(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Pr||r instanceof cu||r instanceof Ii||r instanceof hi||r instanceof di||r instanceof Wi)return!0;if(Array.isArray(r)){for(const e of r)if(!Qa(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Qa(r[e]))return!1;return!0}return!1}function Ur(r){if(r===null)return es;if(typeof r=="string")return sr;if(typeof r=="boolean")return Jt;if(typeof r=="number")return Qe;if(r instanceof Pr)return qi;if(r instanceof cu)return ms;if(r instanceof Ii)return H;if(r instanceof hi)return L;if(r instanceof di)return U;if(r instanceof Wi)return F;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const u=Ur(o);if(i){if(i===u)continue;i=Qt;break}i=u}return X(i||Qt,e)}return cn}function br(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Pr||r instanceof Ii||r instanceof hi||r instanceof di||r instanceof Wi?r.toString():JSON.stringify(r)}class ts{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qa(e[1]))return i.error("invalid value");const o=e[1];let u=Ur(o);const m=i.expectedType;return u.kind!=="array"||u.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(u=m),new ts(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Xr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xl={string:sr,number:Qe,boolean:Jt,object:cn};class Nn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const m=e[0];if(m==="array"){let _,w;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in xl)||k==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=xl[k],u++}else _=Qt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}o=X(_,w)}else{if(!xl[m])throw new Error(`Types doesn't contain name = ${m}`);o=xl[m]}const g=[];for(;u<e.length;u++){const _=i.parse(e[u],u,Qt);if(!_)return null;g.push(_)}return new Nn(o,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!se(this.type,Ur(o)))return o;if(i===this.args.length-1)throw new Xr(`Expected value to be of type ${Q(this.type)}, but found ${Q(Ur(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const No={"to-boolean":Jt,"to-color":qi,"to-number":Qe,"to-string":sr};class Rs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!No[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=No[o],m=[];for(let g=1;g<e.length;g++){const _=i.parse(e[g],g,Qt);if(!_)return null;m.push(_)}return new Rs(u,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Pr)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:vl(i[0],i[1],i[2],i[3]),!o))return new Pr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Xr(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=hi.parse(i);if(u)return u}throw new Xr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=di.parse(i);if(u)return u}throw new Xr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Xr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Ii.fromString(br(this.args[0].evaluate(e)));case"resolvedImage":return Wi.fromString(br(this.args[0].evaluate(e)));default:return br(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const wl=["Unknown","Point","LineString","Polygon"];class wa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Pr.parse(e)),i}}class bl{constructor(e,i,o=[],u,m=new xa,g=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=m,this.errors=g,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,m={}){return i?this.concat(i,o,u)._parse(e,m):this._parse(e,m)}_parse(e,i){function o(u,m,g){return g==="assert"?new Nn(m,[u]):g==="coerce"?new Rs(m,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[u];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,w=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else g=o(g,_,i.typeAnnotation||"coerce");else g=o(g,_,i.typeAnnotation||"coerce");else g=o(g,_,i.typeAnnotation||"coerce");else g=o(g,_,i.typeAnnotation||"assert")}if(!(g instanceof ts)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new wa;try{g=new ts(g.type,g.evaluate(_))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new bl(this.registry,this._isConstant,u,i||null,m,this.errors)}error(e,...i){const o=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new jr(o,e))}checkSubtype(e,i){const o=se(e,i);return o&&this.error(o),o}}class eo{constructor(e,i,o){this.type=ms,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Jt);if(!u)return null;const m=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Jt);if(!m)return null;let g=null;return o.locale&&(g=i.parse(o.locale,1,sr),!g)?null:new eo(u,m,g)}evaluate(e){return new cu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Sr=8192;function Sl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function to(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function kl(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Sr),Math.round(o*u*Sr)]}function ac(r,e,i){const o=r[0]-e[0],u=r[1]-e[1],m=r[0]-i[0],g=r[1]-i[1];return o*g-m*u==0&&o*m<=0&&u*g<=0}function Tl(r,e){let i=!1;for(let g=0,_=e.length;g<_;g++){const w=e[g];for(let k=0,C=w.length;k<C-1;k++){if(ac(r,w[k],w[k+1]))return!1;(u=w[k])[1]>(o=r)[1]!=(m=w[k+1])[1]>o[1]&&o[0]<(m[0]-u[0])*(o[1]-u[1])/(m[1]-u[1])+u[0]&&(i=!i)}}var o,u,m;return i}function El(r,e){for(let i=0;i<e.length;i++)if(Tl(r,e[i]))return!0;return!1}function Cl(r,e,i,o){const u=o[0]-i[0],m=o[1]-i[1],g=(r[0]-i[0])*m-u*(r[1]-i[1]),_=(e[0]-i[0])*m-u*(e[1]-i[1]);return g>0&&_<0||g<0&&_>0}function Il(r,e,i){for(const k of i)for(let C=0;C<k.length-1;++C)if((_=[(g=k[C+1])[0]-(m=k[C])[0],g[1]-m[1]])[0]*(w=[(u=e)[0]-(o=r)[0],u[1]-o[1]])[1]-_[1]*w[0]!=0&&Cl(o,u,m,g)&&Cl(m,g,o,u))return!0;var o,u,m,g,_,w;return!1}function Fs(r,e){for(let i=0;i<r.length;++i)if(!Tl(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Il(r[i],r[i+1],e))return!1;return!0}function Bs(r,e){for(let i=0;i<e.length;i++)if(Fs(r,e[i]))return!0;return!1}function rs(r,e,i){const o=[];for(let u=0;u<r.length;u++){const m=[];for(let g=0;g<r[u].length;g++){const _=kl(r[u][g],i);Sl(e,_),m.push(_)}o.push(m)}return o}function ro(r,e,i){const o=[];for(let u=0;u<r.length;u++){const m=rs(r[u],e,i);o.push(m)}return o}function io(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const u=.5*o;let m=r[0]-i[0]>u?-o:i[0]-r[0]>u?o:0;m===0&&(m=r[0]-i[2]>u?-o:i[2]-r[0]>u?o:0),r[0]+=m}Sl(e,r)}function gs(r,e,i,o){const u=Math.pow(2,o.z)*Sr,m=[o.x*Sr,o.y*Sr],g=[];for(const _ of r)for(const w of _){const k=[w.x+m[0],w.y+m[1]];io(k,e,i,u),g.push(k)}return g}function hu(r,e,i,o){const u=Math.pow(2,o.z)*Sr,m=[o.x*Sr,o.y*Sr],g=[];for(const w of r){const k=[];for(const C of w){const M=[C.x+m[0],C.y+m[1]];Sl(e,M),k.push(M)}g.push(k)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of g)for(const k of w)io(k,e,i,u)}var _;return g}class sa{constructor(e,i){this.type=Jt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qa(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let u=0;u<o.features.length;++u){const m=o.features[u].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new sa(o,o.features[u].geometry)}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new sa(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new sa(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(o.type==="Polygon"){const _=rs(o.coordinates,m,g),w=gs(i.geometry(),u,m,g);if(!to(u,m))return!1;for(const k of w)if(!Tl(k,_))return!1}if(o.type==="MultiPolygon"){const _=ro(o.coordinates,m,g),w=gs(i.geometry(),u,m,g);if(!to(u,m))return!1;for(const k of w)if(!El(k,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(o.type==="Polygon"){const _=rs(o.coordinates,m,g),w=hu(i.geometry(),u,m,g);if(!to(u,m))return!1;for(const k of w)if(!Fs(k,_))return!1}if(o.type==="MultiPolygon"){const _=ro(o.coordinates,m,g),w=hu(i.geometry(),u,m,g);if(!to(u,m))return!1;for(const k of w)if(!Bs(k,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class aa{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new aa(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Vn{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=Vn.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let w=null;for(const[k,C]of _){w=new bl(i.registry,Vo,i.path,null,i.scope);const M=[];let R=!1;for(let N=1;N<e.length;N++){const V=e[N],W=Array.isArray(k)?k[N-1]:k.type,J=w.parse(V,1+M.length,W);if(!J){R=!0;break}M.push(J)}if(!R)if(Array.isArray(k)&&k.length!==M.length)w.error(`Expected ${k.length} arguments, but found ${M.length} instead.`);else{for(let N=0;N<M.length;N++){const V=Array.isArray(k)?k[N]:k.type,W=M[N];w.concat(N+1).checkSubtype(V,W.type)}if(w.errors.length===0)return new Vn(o,m,C,M)}}if(_.length===1)i.errors.push(...w.errors);else{const k=(_.length?_:g).map(([M])=>{return R=M,Array.isArray(R)?`(${R.map(Q).join(", ")})`:`(${Q(R.type)}...)`;var R}).join(" | "),C=[];for(let M=1;M<e.length;M++){const R=i.parse(e[M],1+C.length);if(!R)return null;C.push(Q(R.type))}i.error(`Expected arguments of type ${k}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){Vn.definitions=i;for(const o in i)e[o]=Vn}}function Vo(r){if(r instanceof aa)return Vo(r.boundExpression);if(r instanceof Vn&&r.name==="error"||r instanceof eo||r instanceof sa)return!1;const e=r instanceof Rs||r instanceof Nn;let i=!0;return r.eachChild(o=>{i=e?i&&Vo(o):i&&o instanceof ts}),!!i&&ba(r)&&Pl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ba(r){if(r instanceof Vn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof sa)return!1;let e=!0;return r.eachChild(i=>{e&&!ba(i)&&(e=!1)}),e}function no(r){if(r instanceof Vn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!no(i)&&(e=!1)}),e}function Pl(r,e){if(r instanceof Vn&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!Pl(o,e)&&(i=!1)}),i}function ys(r,e){const i=r.length-1;let o,u,m=0,g=i,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),o=r[_],u=r[_+1],o<=e){if(_===i||e<u)return _;m=_+1}else{if(!(o>e))throw new Xr("Input is not a number.");g=_-1}return 0}class jn{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,m]of o)this.labels.push(u),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Qe);if(!o)return null;const u=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<e.length;g+=2){const _=g===1?-1/0:e[g],w=e[g+1],k=g,C=g+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(u.length&&u[u.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const M=i.parse(w,C,m);if(!M)return null;m=m||M.type,u.push([_,M])}return new jn(m,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const m=i.length;return u>=i[m-1]?o[m-1].evaluate(e):o[ys(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ur(r,e,i){return r+i*(e-r)}function Sa(r,e,i){return r.map((o,u)=>ur(o,e[u],i))}const En={number:ur,color:function(r,e,i,o="rgb"){switch(o){case"rgb":{const[u,m,g,_]=Sa(r.rgb,e.rgb,i);return new Pr(u,m,g,_,!1)}case"hcl":{const[u,m,g,_]=r.hcl,[w,k,C,M]=e.hcl;let R,N;if(isNaN(u)||isNaN(w))isNaN(u)?isNaN(w)?R=NaN:(R=w,g!==1&&g!==0||(N=k)):(R=u,C!==1&&C!==0||(N=m));else{let fe=w-u;w>u&&fe>180?fe-=360:w<u&&u-w>180&&(fe+=360),R=u+i*fe}const[V,W,J,ie]=function([fe,ne,ge,ke]){return fe=isNaN(fe)?0:fe*Gt,Br([ge,Math.cos(fe)*ne,Math.sin(fe)*ne,ke])}([R,N??ur(m,k,i),ur(g,C,i),ur(_,M,i)]);return new Pr(V,W,J,ie,!1)}case"lab":{const[u,m,g,_]=Br(Sa(r.lab,e.lab,i));return new Pr(u,m,g,_,!1)}}},array:Sa,padding:function(r,e,i){return new hi(Sa(r.values,e.values,i))},variableAnchorOffsetCollection:function(r,e,i){const o=r.values,u=e.values;if(o.length!==u.length)throw new Xr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==u[g])throw new Xr(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${u[g]}`);m.push(o[g]);const[_,w]=o[g+1],[k,C]=u[g+1];m.push([ur(_,k,i),ur(w,C,i)])}return new di(m)}};class Cn{constructor(e,i,o,u,m){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(e,i,o,u){let m=0;if(e.name==="exponential")m=jo(i,e.base,o,u);else if(e.name==="linear")m=jo(i,1,o,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new at(g[0],g[1],g[2],g[3]).solve(jo(i,1,o,u))}return m}static parse(e,i){let[o,u,m,...g]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const k=u[1];if(typeof k!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:k}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const k=u.slice(1);if(k.length!==4||k.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,Qe),!m)return null;const _=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=qi:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let k=0;k<g.length;k+=2){const C=g[k],M=g[k+1],R=k+3,N=k+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=i.parse(M,N,w);if(!V)return null;w=w||V.type,_.push([C,V])}return ze(w,Qe)||ze(w,qi)||ze(w,L)||ze(w,U)||ze(w,X(Qe))?new Cn(w,o,u,m,_):i.error(`Type ${Q(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const m=i.length;if(u>=i[m-1])return o[m-1].evaluate(e);const g=ys(i,u),_=Cn.interpolationFactor(this.interpolation,u,i[g],i[g+1]),w=o[g].evaluate(e),k=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return En[this.type.kind](w,k,_);case"interpolate-hcl":return En.color(w,k,_,"hcl");case"interpolate-lab":return En.color(w,k,_,"lab")}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function jo(r,e,i,o){const u=o-i,m=r-i;return u===0?0:e===1?m/u:(Math.pow(e,m)-1)/(Math.pow(e,u)-1)}class ka{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const m=[];for(const _ of e.slice(1)){const w=i.parse(_,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,m.push(w)}if(!o)throw new Error("No output type");const g=u&&m.some(_=>se(u,_.type));return new ka(g?Qt:o,m)}evaluate(e){let i,o=null,u=0;for(const m of this.args)if(u++,o=m.evaluate(e),o&&o instanceof Wi&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class so{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=i.parse(e[m+1],m+1);if(!_)return null;o.push([g,_])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new so(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ml{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Qe),u=i.parse(e[2],2,X(i.expectedType||Qt));return o&&u?new Ml(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Xr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Xr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Xr(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class _s{constructor(e,i){this.type=Jt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Qt),u=i.parse(e[2],2,Qt);return o&&u?te(o.type,[Jt,sr,Qe,es,Qt])?new _s(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!pe(i,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Ur(i))} instead.`);if(!pe(o,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${Q(Ur(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ao{constructor(e,i,o){this.type=Qe,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Qt),u=i.parse(e[2],2,Qt);if(!o||!u)return null;if(!te(o.type,[Jt,sr,Qe,es,Qt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Qe);return m?new ao(o,u,m):null}return new ao(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!pe(i,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Ur(i))} instead.`);if(!pe(o,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${Q(Ur(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(i,u)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class oo{constructor(e,i,o,u,m,g){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=m,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const m={},g=[];for(let k=2;k<e.length-1;k+=2){let C=e[k];const M=e[k+1];Array.isArray(C)||(C=[C]);const R=i.concat(k);if(C.length===0)return R.error("Expected at least one branch label.");for(const V of C){if(typeof V!="number"&&typeof V!="string")return R.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(o){if(R.checkSubtype(o,Ur(V)))return null}else o=Ur(V);if(m[String(V)]!==void 0)return R.error("Branch labels must be unique.");m[String(V)]=g.length}const N=i.parse(M,k,u);if(!N)return null;u=u||N.type,g.push(N)}const _=i.parse(e[1],1,Qt);if(!_)return null;const w=i.parse(e[e.length-1],e.length-1,u);return w?_.type.kind!=="value"&&i.concat(1).checkSubtype(o,_.type)?null:new oo(o,u,_,m,g,w):null}evaluate(e){const i=this.input.evaluate(e);return(Ur(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Al{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const _=i.parse(e[g],g,Jt);if(!_)return null;const w=i.parse(e[g+1],g+1,o);if(!w)return null;u.push([_,w]),o=o||w.type}const m=i.parse(e[e.length-1],e.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Al(o,u,m)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Ta{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Qt),u=i.parse(e[2],2,Qe);if(!o||!u)return null;if(!te(o.type,[X(Qt),sr,Qt]))return i.error(`Expected first argument to be of type array or string, but found ${Q(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Qe);return m?new Ta(o.type,o,u,m):null}return new Ta(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!pe(i,["string","array"]))throw new Xr(`Expected first argument to be of type array or string, but found ${Q(Ur(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(o,u)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Uo(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function du(r,e,i,o){return o.compare(e,i)===0}function zi(r,e,i){const o=r!=="=="&&r!=="!=";return class $f{constructor(m,g,_){this.type=Jt,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let w=g.parse(m[1],1,Qt);if(!w)return null;if(!Uo(_,w.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${Q(w.type)}'.`);let k=g.parse(m[2],2,Qt);if(!k)return null;if(!Uo(_,k.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${Q(k.type)}'.`);if(w.type.kind!==k.type.kind&&w.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${Q(w.type)}' and '${Q(k.type)}'.`);o&&(w.type.kind==="value"&&k.type.kind!=="value"?w=new Nn(k.type,[w]):w.type.kind!=="value"&&k.type.kind==="value"&&(k=new Nn(w.type,[k])));let C=null;if(m.length===4){if(w.type.kind!=="string"&&k.type.kind!=="string"&&w.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(m[3],3,ms),!C)return null}return new $f(w,k,C)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const w=Ur(g),k=Ur(_);if(w.kind!==k.kind||w.kind!=="string"&&w.kind!=="number")throw new Xr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=Ur(g),k=Ur(_);if(w.kind!=="string"||k.kind!=="string")return e(m,g,_)}return this.collator?i(m,g,_,this.collator.evaluate(m)):e(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const lo=zi("==",function(r,e,i){return e===i},du),pu=zi("!=",function(r,e,i){return e!==i},function(r,e,i,o){return!du(0,e,i,o)}),$o=zi("<",function(r,e,i){return e<i},function(r,e,i,o){return o.compare(e,i)<0}),uh=zi(">",function(r,e,i){return e>i},function(r,e,i,o){return o.compare(e,i)>0}),fu=zi("<=",function(r,e,i){return e<=i},function(r,e,i,o){return o.compare(e,i)<=0}),mu=zi(">=",function(r,e,i){return e>=i},function(r,e,i,o){return o.compare(e,i)>=0});class Ea{constructor(e,i,o,u,m){this.type=sr,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Qe);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=i.parse(u.locale,1,sr),!m))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,sr),!g))return null;let _=null;if(u["min-fraction-digits"]&&(_=i.parse(u["min-fraction-digits"],1,Qe),!_))return null;let w=null;return u["max-fraction-digits"]&&(w=i.parse(u["max-fraction-digits"],1,Qe),!w)?null:new Ea(o,m,g,_,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ca{constructor(e){this.type=H,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let m=!1;for(let g=1;g<=e.length-1;++g){const _=e[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let w=null;if(_["font-scale"]&&(w=i.parse(_["font-scale"],1,Qe),!w))return null;let k=null;if(_["text-font"]&&(k=i.parse(_["text-font"],1,X(sr)),!k))return null;let C=null;if(_["text-color"]&&(C=i.parse(_["text-color"],1,qi),!C))return null;const M=u[u.length-1];M.scale=w,M.font=k,M.textColor=C}else{const w=i.parse(e[g],1,Qt);if(!w)return null;const k=w.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new Ca(u)}evaluate(e){return new Ii(this.sections.map(i=>{const o=i.content.evaluate(e);return Ur(o)===F?new Oo("",o,null,null,null):new Oo(br(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}}class zl{constructor(e){this.type=F,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,sr);return o?new zl(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Wi.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class gu{constructor(e){this.type=Qe,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Q(o.type)} instead.`):new gu(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Xr(`Expected value to be of type string or array, but found ${Q(Ur(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const uo={"==":lo,"!=":pu,">":uh,"<":$o,">=":mu,"<=":fu,array:Nn,at:Ml,boolean:Nn,case:Al,coalesce:ka,collator:eo,format:Ca,image:zl,in:_s,"index-of":ao,interpolate:Cn,"interpolate-hcl":Cn,"interpolate-lab":Cn,length:gu,let:so,literal:ts,match:oo,number:Nn,"number-format":Ea,object:Nn,slice:Ta,step:jn,string:Nn,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:aa,within:sa};function oc(r,[e,i,o,u]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const m=u?u.evaluate(r):1,g=vl(e,i,o,m);if(g)throw new Xr(g);return new Pr(e/255,i/255,o/255,m,!1)}function Dl(r,e){return r in e}function yu(r,e){const i=e[r];return i===void 0?null:i}function Ia(r){return{type:r}}function lc(r){return{result:"success",value:r}}function oa(r){return{result:"error",value:r}}function co(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function _u(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function vu(r){return!!r.expression&&r.expression.interpolated}function Mr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function ti(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ch(r){return r}function mr(r,e){const i=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",u=o||!(o||r.property!==void 0),m=r.type||(vu(e)?"exponential":"interval");if(i||e.type==="padding"){const C=i?Pr.parse:hi.parse;(r=$i({},r)).stops&&(r.stops=r.stops.map(M=>[M[0],C(M[1])])),r.default=C(r.default?r.default:e.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,w,k;if(m==="exponential")_=ho;else if(m==="interval")_=Qr;else if(m==="categorical"){_=ri,w=Object.create(null);for(const C of r.stops)w[C[0]]=C[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=uc}if(o){const C={},M=[];for(let V=0;V<r.stops.length;V++){const W=r.stops[V],J=W[0].zoom;C[J]===void 0&&(C[J]={zoom:J,type:r.type,property:r.property,default:r.default,stops:[]},M.push(J)),C[J].stops.push([W[0].value,W[1]])}const R=[];for(const V of M)R.push([C[V].zoom,mr(C[V],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Cn.interpolationFactor.bind(void 0,N),zoomStops:R.map(V=>V[0]),evaluate:({zoom:V},W)=>ho({stops:R,base:r.base},e,V).evaluate(V,W)}}if(u){const C=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Cn.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(r,e,M,w,k)}}return{kind:"source",evaluate(C,M){const R=M&&M.properties?M.properties[r.property]:void 0;return R===void 0?Pa(r.default,e.default):_(r,e,R,w,k)}}}function Pa(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function ri(r,e,i,o,u){return Pa(typeof i===u?o[i]:void 0,r.default,e.default)}function Qr(r,e,i){if(Mr(i)!=="number")return Pa(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const u=ys(r.stops.map(m=>m[0]),i);return r.stops[u][1]}function ho(r,e,i){const o=r.base!==void 0?r.base:1;if(Mr(i)!=="number")return Pa(r.default,e.default);const u=r.stops.length;if(u===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[u-1][0])return r.stops[u-1][1];const m=ys(r.stops.map(C=>C[0]),i),g=function(C,M,R,N){const V=N-R,W=C-R;return V===0?0:M===1?W/V:(Math.pow(M,W)-1)/(Math.pow(M,V)-1)}(i,o,r.stops[m][0],r.stops[m+1][0]),_=r.stops[m][1],w=r.stops[m+1][1],k=En[e.type]||ch;return typeof _.evaluate=="function"?{evaluate(...C){const M=_.evaluate.apply(void 0,C),R=w.evaluate.apply(void 0,C);if(M!==void 0&&R!==void 0)return k(M,R,g,r.colorSpace)}}:k(_,w,g,r.colorSpace)}function uc(r,e,i){switch(e.type){case"color":i=Pr.parse(i);break;case"formatted":i=Ii.fromString(i.toString());break;case"resolvedImage":i=Wi.fromString(i.toString());break;case"padding":i=hi.parse(i);break;default:Mr(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return Pa(i,r.default,e.default)}Vn.register(uo,{error:[{kind:"error"},[sr],(r,[e])=>{throw new Xr(e.evaluate(r))}],typeof:[sr,[Qt],(r,[e])=>Q(Ur(e.evaluate(r)))],"to-rgba":[X(Qe,4),[qi],(r,[e])=>{const[i,o,u,m]=e.evaluate(r).rgb;return[255*i,255*o,255*u,m]}],rgb:[qi,[Qe,Qe,Qe],oc],rgba:[qi,[Qe,Qe,Qe,Qe],oc],has:{type:Jt,overloads:[[[sr],(r,[e])=>Dl(e.evaluate(r),r.properties())],[[sr,cn],(r,[e,i])=>Dl(e.evaluate(r),i.evaluate(r))]]},get:{type:Qt,overloads:[[[sr],(r,[e])=>yu(e.evaluate(r),r.properties())],[[sr,cn],(r,[e,i])=>yu(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Qt,[sr],(r,[e])=>yu(e.evaluate(r),r.featureState||{})],properties:[cn,[],r=>r.properties()],"geometry-type":[sr,[],r=>r.geometryType()],id:[Qt,[],r=>r.id()],zoom:[Qe,[],r=>r.globals.zoom],"heatmap-density":[Qe,[],r=>r.globals.heatmapDensity||0],"line-progress":[Qe,[],r=>r.globals.lineProgress||0],accumulated:[Qt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Qe,Ia(Qe),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[Qe,Ia(Qe),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:Qe,overloads:[[[Qe,Qe],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Qe],(r,[e])=>-e.evaluate(r)]]},"/":[Qe,[Qe,Qe],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Qe,[Qe,Qe],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Qe,[Qe],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Qe,[Qe],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Qe,[Qe],(r,[e])=>Math.log(e.evaluate(r))],log2:[Qe,[Qe],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Qe,[Qe],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Qe,[Qe],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Qe,[Qe],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Qe,[Qe],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Qe,[Qe],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Qe,[Qe],(r,[e])=>Math.atan(e.evaluate(r))],min:[Qe,Ia(Qe),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Qe,Ia(Qe),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Qe,[Qe],(r,[e])=>Math.abs(e.evaluate(r))],round:[Qe,[Qe],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qe,[Qe],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Qe,[Qe],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Jt,[sr,Qt],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Jt,[Qt],(r,[e])=>r.id()===e.value],"filter-type-==":[Jt,[sr],(r,[e])=>r.geometryType()===e.value],"filter-<":[Jt,[sr,Qt],(r,[e,i])=>{const o=r.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Jt,[Qt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Jt,[sr,Qt],(r,[e,i])=>{const o=r.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Jt,[Qt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Jt,[sr,Qt],(r,[e,i])=>{const o=r.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Jt,[Qt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Jt,[sr,Qt],(r,[e,i])=>{const o=r.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Jt,[Qt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Jt,[Qt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Jt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Jt,[X(sr)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Jt,[X(Qt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Jt,[sr,X(Qt)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Jt,[sr,X(Qt)],(r,[e,i])=>function(o,u,m,g){for(;m<=g;){const _=m+g>>1;if(u[_]===o)return!0;u[_]>o?g=_-1:m=_+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Ia(Jt),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Ia(Jt),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Jt,[Jt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Jt,[sr],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[sr,[sr],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[sr,[sr],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[sr,Ia(Qt),(r,e)=>e.map(i=>br(i.evaluate(r))).join("")],"resolved-locale":[sr,[ms],(r,[e])=>e.evaluate(r).resolvedLocale()]});class xu{constructor(e,i){var o;this.expression=e,this._warningHistory={},this._evaluator=new wa,this._defaultValue=i?(o=i).type==="color"&&ti(o.default)?new Pr(0,0,0,0):o.type==="color"?Pr.parse(o.default)||null:o.type==="padding"?hi.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?di.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,u,m,g){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,m,g){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Xr(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Ll(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in uo}function Rl(r,e){const i=new bl(uo,Vo,[],e?function(u){const m={color:qi,string:sr,number:Qe,enum:sr,boolean:Jt,formatted:H,padding:L,resolvedImage:F,variableAnchorOffsetCollection:U};return u.type==="array"?X(m[u.value]||Qt,u.length):m[u.type]}(e):void 0),o=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?lc(new xu(o,e)):oa(i.errors)}class wu{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!no(i.expression)}evaluateWithoutErrorHandling(e,i,o,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,m,g)}evaluate(e,i,o,u,m,g){return this._styleExpression.evaluate(e,i,o,u,m,g)}}class Fl{constructor(e,i,o,u){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!no(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,o,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,m,g)}evaluate(e,i,o,u,m,g){return this._styleExpression.evaluate(e,i,o,u,m,g)}interpolationFactor(e,i,o){return this.interpolationType?Cn.interpolationFactor(this.interpolationType,e,i,o):0}}function bu(r,e){const i=Rl(r,e);if(i.result==="error")return i;const o=i.value.expression,u=ba(o);if(!u&&!co(e))return oa([new jr("","data expressions not supported")]);const m=Pl(o,["zoom"]);if(!m&&!_u(e))return oa([new jr("","zoom expressions not supported")]);const g=Os(o);return g||m?g instanceof jr?oa([g]):g instanceof Cn&&!vu(e)?oa([new jr("",'"interpolate" expressions cannot be used with this property')]):lc(g?new Fl(u?"camera":"composite",i.value,g.labels,g instanceof Cn?g.interpolation:void 0):new wu(u?"constant":"source",i.value)):oa([new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ma{constructor(e,i){this._parameters=e,this._specification=i,$i(this,mr(this._parameters,this._specification))}static deserialize(e){return new Ma(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Os(r){let e=null;if(r instanceof so)e=Os(r.result);else if(r instanceof ka){for(const i of r.args)if(e=Os(i),e)break}else(r instanceof jn||r instanceof Cn)&&r.input instanceof Vn&&r.input.name==="zoom"&&(e=r);return e instanceof jr||r.eachChild(i=>{const o=Os(i);o instanceof jr?e=o:!e&&o?e=new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function qo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!qo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const cc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};qo(r)||(r=Zo(r));const e=Rl(r,cc);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,o,u)=>e.value.evaluate(i,o,{},u),needGeometry:Su(r)}}function hc(r,e){return r<e?-1:r>e?1:0}function Su(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Su(r[e]))return!0;return!1}function Zo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?la(r[1],r[2],"=="):e==="!="?Go(la(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?la(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Zo))):e==="all"?["all"].concat(r.slice(1).map(Zo)):e==="none"?["all"].concat(r.slice(1).map(Zo).map(Go)):e==="in"?dc(r[1],r.slice(2)):e==="!in"?Go(dc(r[1],r.slice(2))):e==="has"?pc(r[1]):e==="!has"?Go(pc(r[1])):e!=="within"||r;var i}function la(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function dc(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(hc)]]:["filter-in-small",r,["literal",e]]}}function pc(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Go(r){return["!",r]}function Wo(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let u="[";for(const m of r)u+=`${Wo(m)},`;return`${u}]`}const i=Object.keys(r).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${Wo(r[i[u]])},`;return`${o}}`}function Ho(r){let e="";for(const i of Wr)e+=`/${Wo(r[i])}`;return e}function po(r){const e=r.value;return e?[new Ge(r.key,e,"constants have been deprecated as of v8")]:[]}function $r(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Aa(r){if(Array.isArray(r))return r.map(Aa);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Aa(r[i]);return e}return $r(r)}function Hi(r){const e=r.key,i=r.value,o=r.valueSpec||{},u=r.objectElementValidators||{},m=r.style,g=r.styleSpec,_=r.validateSpec;let w=[];const k=Mr(i);if(k!=="object")return[new Ge(e,i,`object expected, ${k} found`)];for(const C in i){const M=C.split(".")[0],R=o[M]||o["*"];let N;if(u[M])N=u[M];else if(o[M])N=_;else if(u["*"])N=u["*"];else{if(!o["*"]){w.push(new Ge(e,i[C],`unknown property "${C}"`));continue}N=_}w=w.concat(N({key:(e&&`${e}.`)+C,value:i[C],valueSpec:R,style:m,styleSpec:g,object:i,objectKey:C,validateSpec:_},i))}for(const C in o)u[C]||o[C].required&&o[C].default===void 0&&i[C]===void 0&&w.push(new Ge(e,i,`missing required property "${C}"`));return w}function fo(r){const e=r.value,i=r.valueSpec,o=r.style,u=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Mr(e)!=="array")return[new Ge(m,e,`array expected, ${Mr(e)} found`)];if(i.length&&e.length!==i.length)return[new Ge(m,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ge(m,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let _={type:i.value,values:i.values};u.$version<7&&(_.function=i.function),Mr(i.value)==="object"&&(_=i.value);let w=[];for(let k=0;k<e.length;k++)w=w.concat(g({array:e,arrayIndex:k,value:e[k],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:u,key:`${m}[${k}]`}));return w}function mo(r){const e=r.key,i=r.value,o=r.valueSpec;let u=Mr(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new Ge(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new Ge(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Ge(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function go(r){const e=r.valueSpec,i=$r(r.value.type);let o,u,m,g={};const _=i!=="categorical"&&r.value.property===void 0,w=!_,k=Mr(r.value.stops)==="array"&&Mr(r.value.stops[0])==="array"&&Mr(r.value.stops[0][0])==="object",C=Hi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(N){if(i==="identity")return[new Ge(N.key,N.value,'identity function may not have a "stops" property')];let V=[];const W=N.value;return V=V.concat(fo({key:N.key,value:W,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:M})),Mr(W)==="array"&&W.length===0&&V.push(new Ge(N.key,W,"array must have at least one stop")),V},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return i==="identity"&&_&&C.push(new Ge(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||C.push(new Ge(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!vu(r.valueSpec)&&C.push(new Ge(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(w&&!co(r.valueSpec)?C.push(new Ge(r.key,r.value,"property functions not supported")):_&&!_u(r.valueSpec)&&C.push(new Ge(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!k||r.value.property!==void 0||C.push(new Ge(r.key,r.value,'"property" property is required')),C;function M(N){let V=[];const W=N.value,J=N.key;if(Mr(W)!=="array")return[new Ge(J,W,`array expected, ${Mr(W)} found`)];if(W.length!==2)return[new Ge(J,W,`array length 2 expected, length ${W.length} found`)];if(k){if(Mr(W[0])!=="object")return[new Ge(J,W,`object expected, ${Mr(W[0])} found`)];if(W[0].zoom===void 0)return[new Ge(J,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new Ge(J,W,"object stop key must have value")];if(m&&m>$r(W[0].zoom))return[new Ge(J,W[0].zoom,"stop zoom values must appear in ascending order")];$r(W[0].zoom)!==m&&(m=$r(W[0].zoom),u=void 0,g={}),V=V.concat(Hi({key:`${J}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:mo,value:R}}))}else V=V.concat(R({key:`${J}[0]`,value:W[0],validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},W));return Ll(Aa(W[1]))?V.concat([new Ge(`${J}[1]`,W[1],"expressions are not allowed in function stops.")]):V.concat(N.validateSpec({key:`${J}[1]`,value:W[1],valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function R(N,V){const W=Mr(N.value),J=$r(N.value),ie=N.value!==null?N.value:V;if(o){if(W!==o)return[new Ge(N.key,ie,`${W} stop domain type must match previous stop domain type ${o}`)]}else o=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new Ge(N.key,ie,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&i!=="categorical"){let fe=`number expected, ${W} found`;return co(e)&&i===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(N.key,ie,fe)]}return i!=="categorical"||W!=="number"||isFinite(J)&&Math.floor(J)===J?i!=="categorical"&&W==="number"&&u!==void 0&&J<u?[new Ge(N.key,ie,"stop domain values must appear in ascending order")]:(u=J,i==="categorical"&&J in g?[new Ge(N.key,ie,"stop domain values must be unique")]:(g[J]=!0,[])):[new Ge(N.key,ie,`integer expected, found ${J}`)]}}function Ns(r){const e=(r.expressionContext==="property"?bu:Rl)(Aa(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new Ge(`${r.key}${o.key}`,r.value,o.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Ge(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!no(i))return[new Ge(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!no(i))return[new Ge(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Pl(i,["zoom","feature-state"]))return[new Ge(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!ba(i))return[new Ge(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yo(r){const e=r.key,i=r.value,o=r.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf($r(i))===-1&&u.push(new Ge(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf($r(i))===-1&&u.push(new Ge(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function za(r){return qo(Aa(r.value))?Ns($i({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ku(r)}function ku(r){const e=r.value,i=r.key;if(Mr(e)!=="array")return[new Ge(i,e,`array expected, ${Mr(e)} found`)];const o=r.styleSpec;let u,m=[];if(e.length<1)return[new Ge(i,e,"filter array must have at least 1 element")];switch(m=m.concat(yo({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),$r(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&$r(e[1])==="$type"&&m.push(new Ge(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Ge(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Mr(e[1]),u!=="string"&&m.push(new Ge(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=Mr(e[g]),$r(e[1])==="$type"?m=m.concat(yo({key:`${i}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&m.push(new Ge(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(ku({key:`${i}[${g}]`,value:e[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=Mr(e[1]),e.length!==2?m.push(new Ge(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&m.push(new Ge(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Mr(e[1]),e.length!==2?m.push(new Ge(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&m.push(new Ge(`${i}[1]`,e[1],`object expected, ${u} found`))}return m}function fc(r,e){const i=r.key,o=r.validateSpec,u=r.style,m=r.styleSpec,g=r.value,_=r.objectKey,w=m[`${e}_${r.layerType}`];if(!w)return[];const k=_.match(/^(.*)-transition$/);if(e==="paint"&&k&&w[k[1]]&&w[k[1]].transition)return o({key:i,value:g,valueSpec:m.transition,style:u,styleSpec:m});const C=r.valueSpec||w[_];if(!C)return[new Ge(i,g,`unknown property "${_}"`)];let M;if(Mr(g)==="string"&&co(C)&&!C.tokens&&(M=/^{([^}]+)}$/.exec(g)))return[new Ge(i,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const R=[];return r.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&R.push(new Ge(i,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&ti(Aa(g))&&$r(g.type)==="identity"&&R.push(new Ge(i,g,'"text-font" does not support identity functions'))),R.concat(o({key:r.key,value:g,valueSpec:C,style:u,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:_}))}function mc(r){return fc(r,"paint")}function gc(r){return fc(r,"layout")}function yc(r){let e=[];const i=r.value,o=r.key,u=r.style,m=r.styleSpec;i.type||i.ref||e.push(new Ge(o,i,'either "type" or "ref" is required'));let g=$r(i.type);const _=$r(i.ref);if(i.id){const w=$r(i.id);for(let k=0;k<r.arrayIndex;k++){const C=u.layers[k];$r(C.id)===w&&e.push(new Ge(o,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(k=>{k in i&&e.push(new Ge(o,i[k],`"${k}" is prohibited for ref layers`))}),u.layers.forEach(k=>{$r(k.id)===_&&(w=k)}),w?w.ref?e.push(new Ge(o,i.ref,"ref cannot reference another ref layer")):g=$r(w.type):e.push(new Ge(o,i.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(i.source){const w=u.sources&&u.sources[i.source],k=w&&$r(w.type);w?k==="vector"&&g==="raster"?e.push(new Ge(o,i.source,`layer "${i.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?e.push(new Ge(o,i.source,`layer "${i.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?e.push(new Ge(o,i.source,`layer "${i.id}" requires a vector source`)):k!=="vector"||i["source-layer"]?k==="raster-dem"&&g!=="hillshade"?e.push(new Ge(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]||k==="geojson"&&w.lineMetrics||e.push(new Ge(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ge(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Ge(o,i.source,`source "${i.source}" not found`))}else e.push(new Ge(o,i,'missing required property "source"'));return e=e.concat(Hi({key:o,value:i,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:i.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:za,layout:w=>Hi({layer:i,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":k=>gc($i({layerType:g},k))}}),paint:w=>Hi({layer:i,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":k=>mc($i({layerType:g},k))}})}})),e}function vs(r){const e=r.value,i=r.key,o=Mr(e);return o!=="string"?[new Ge(i,e,`string expected, ${o} found`)]:[]}const hn={promoteId:function({key:r,value:e}){if(Mr(e)==="string")return vs({key:r,value:e});{const i=[];for(const o in e)i.push(...vs({key:`${r}.${o}`,value:e[o]}));return i}}};function Ki(r){const e=r.value,i=r.key,o=r.styleSpec,u=r.style,m=r.validateSpec;if(!e.type)return[new Ge(i,e,'"type" is required')];const g=$r(e.type);let _;switch(g){case"vector":case"raster":return _=Hi({key:i,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:hn,validateSpec:m}),_;case"raster-dem":return _=function(w){var k;const C=(k=w.sourceName)!==null&&k!==void 0?k:"",M=w.value,R=w.styleSpec,N=R.source_raster_dem,V=w.style;let W=[];const J=Mr(M);if(M===void 0)return W;if(J!=="object")return W.push(new Ge("source_raster_dem",M,`object expected, ${J} found`)),W;const ie=$r(M.encoding)==="custom",fe=["redFactor","greenFactor","blueFactor","baseShift"],ne=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const ge in M)!ie&&fe.includes(ge)?W.push(new Ge(ge,M[ge],`In "${C}": "${ge}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):N[ge]?W=W.concat(w.validateSpec({key:ge,value:M[ge],valueSpec:N[ge],validateSpec:w.validateSpec,style:V,styleSpec:R})):W.push(new Ge(ge,M[ge],`unknown property "${ge}"`));return W}({sourceName:i,value:e,style:r.style,styleSpec:o,validateSpec:m}),_;case"geojson":if(_=Hi({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:m,objectElementValidators:hn}),e.cluster)for(const w in e.clusterProperties){const[k,C]=e.clusterProperties[w],M=typeof k=="string"?[k,["accumulated"],["get",w]]:k;_.push(...Ns({key:`${i}.${w}.map`,value:C,expressionContext:"cluster-map"})),_.push(...Ns({key:`${i}.${w}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return Hi({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:m,styleSpec:o});case"image":return Hi({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:m,styleSpec:o});case"canvas":return[new Ge(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yo({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function _o(r){const e=r.value,i=r.styleSpec,o=i.light,u=r.style;let m=[];const g=Mr(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ge("light",e,`object expected, ${g} found`)]),m;for(const _ in e){const w=_.match(/^(.*)-transition$/);m=m.concat(w&&o[w[1]]&&o[w[1]].transition?r.validateSpec({key:_,value:e[_],valueSpec:i.transition,validateSpec:r.validateSpec,style:u,styleSpec:i}):o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:u,styleSpec:i}):[new Ge(_,e[_],`unknown property "${_}"`)])}return m}function Tu(r){const e=r.value,i=r.styleSpec,o=i.terrain,u=r.style;let m=[];const g=Mr(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ge("terrain",e,`object expected, ${g} found`)]),m;for(const _ in e)m=m.concat(o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:u,styleSpec:i}):[new Ge(_,e[_],`unknown property "${_}"`)]);return m}function Eu(r){let e=[];const i=r.value,o=r.key;if(Array.isArray(i)){const u=[],m=[];for(const g in i)i[g].id&&u.includes(i[g].id)&&e.push(new Ge(o,i,`all the sprites' ids must be unique, but ${i[g].id} is duplicated`)),u.push(i[g].id),i[g].url&&m.includes(i[g].url)&&e.push(new Ge(o,i,`all the sprites' URLs must be unique, but ${i[g].url} is duplicated`)),m.push(i[g].url),e=e.concat(Hi({key:`${o}[${g}]`,value:i[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return vs({key:o,value:i})}const Cu={"*":()=>[],array:fo,boolean:function(r){const e=r.value,i=r.key,o=Mr(e);return o!=="boolean"?[new Ge(i,e,`boolean expected, ${o} found`)]:[]},number:mo,color:function(r){const e=r.key,i=r.value,o=Mr(i);return o!=="string"?[new Ge(e,i,`color expected, ${o} found`)]:Pr.parse(String(i))?[]:[new Ge(e,i,`color expected, "${i}" found`)]},constants:po,enum:yo,filter:za,function:go,layer:yc,object:Hi,source:Ki,light:_o,terrain:Tu,string:vs,formatted:function(r){return vs(r).length===0?[]:Ns(r)},resolvedImage:function(r){return vs(r).length===0?[]:Ns(r)},padding:function(r){const e=r.key,i=r.value;if(Mr(i)==="array"){if(i.length<1||i.length>4)return[new Ge(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let m=0;m<i.length;m++)u=u.concat(r.validateSpec({key:`${e}[${m}]`,value:i[m],validateSpec:r.validateSpec,valueSpec:o}));return u}return mo({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,i=r.value,o=Mr(i),u=r.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Ge(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<i.length;g+=2)m=m.concat(yo({key:`${e}[${g}]`,value:i[g],valueSpec:u.layout_symbol["text-anchor"]})),m=m.concat(fo({key:`${e}[${g+1}]`,value:i[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:u}));return m},sprite:Eu};function xs(r){const e=r.value,i=r.valueSpec,o=r.styleSpec;return r.validateSpec=xs,i.expression&&ti($r(e))?go(r):i.expression&&Ll(Aa(e))?Ns(r):i.type&&Cu[i.type]?Cu[i.type](r):Hi($i({},r,{valueSpec:i.type?o[i.type]:i}))}function _c(r){const e=r.value,i=r.key,o=vs(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ge(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ge(i,e,'"glyphs" url must include a "{range}" token'))),o}function Un(r,e=Te){let i=[];return i=i.concat(xs({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:xs,objectElementValidators:{glyphs:_c,"*":()=>[]}})),r.constants&&(i=i.concat(po({key:"constants",value:r.constants}))),vo(i)}function yn(r){return function(e){return r({...e,validateSpec:xs})}}function vo(r){return[].concat(r).sort((e,i)=>e.line-i.line)}function In(r){return function(...e){return vo(r.apply(this,e))}}Un.source=In(yn(Ki)),Un.sprite=In(yn(Eu)),Un.glyphs=In(yn(_c)),Un.light=In(yn(_o)),Un.terrain=In(yn(Tu)),Un.layer=In(yn(yc)),Un.filter=In(yn(za)),Un.paintProperty=In(yn(mc)),Un.layoutProperty=In(yn(gc));const is=Un,vc=is.light,xo=is.paintProperty,Da=is.layoutProperty;function wo(r,e){let i=!1;if(e&&e.length)for(const o of e)r.fire(new fr(new Error(o.message))),i=!0;return i}class La{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(i=g[1])+2*(o=g[2]);for(let w=0;w<this.d*this.d;w++){const k=g[3+w],C=g[3+w+1];u.push(k===C?null:g.subarray(k,C))}const _=g[3+u.length+1];this.keys=g.subarray(g[3+u.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let g=0;g<this.d*this.d;g++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const m=o/i*e;this.min=-m,this.max=e+m}insert(e,i,o,u,m){this._forEachCell(i,o,u,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,m,g){this.cells[m].push(g)}query(e,i,o,u,m){const g=this.min,_=this.max;if(e<=g&&i<=g&&_<=o&&_<=u&&!m)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(e,i,o,u,this._queryCell,w,{},m),w}}_queryCell(e,i,o,u,m,g,_,w){const k=this.cells[m];if(k!==null){const C=this.keys,M=this.bboxes;for(let R=0;R<k.length;R++){const N=k[R];if(_[N]===void 0){const V=4*N;(w?w(M[V+0],M[V+1],M[V+2],M[V+3]):e<=M[V+2]&&i<=M[V+3]&&o>=M[V+0]&&u>=M[V+1])?(_[N]=!0,g.push(C[N])):_[N]=!1}}}}_forEachCell(e,i,o,u,m,g,_,w){const k=this._convertToCellCoord(e),C=this._convertToCellCoord(i),M=this._convertToCellCoord(o),R=this._convertToCellCoord(u);for(let N=k;N<=M;N++)for(let V=C;V<=R;V++){const W=this.d*V+N;if((!w||w(this._convertFromCellCoord(N),this._convertFromCellCoord(V),this._convertFromCellCoord(N+1),this._convertFromCellCoord(V+1)))&&m.call(this,e,i,o,u,W,g,_,w))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let m=i;for(let g=0;g<e.length;g++){const _=e[g];u[3+g]=m,u.set(_,m),m+=_.length}return u[3+e.length]=m,u.set(this.keys,m),m+=this.keys.length,u[3+e.length+1]=m,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new La(e.buffer)}}const $n={};function gt(r,e,i={}){if($n[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),$n[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}gt("Object",Object),gt("TransferableGridIndex",La),gt("Color",Pr),gt("Error",Error),gt("AJAXError",_t),gt("ResolvedImage",Wi),gt("StylePropertyFunction",Ma),gt("StyleExpression",xu,{omit:["_evaluator"]}),gt("ZoomDependentExpression",Fl),gt("ZoomConstantExpression",wu),gt("CompoundExpression",Vn,{omit:["_evaluate"]});for(const r in uo)uo[r]._classRegistryKey||gt(`Expression_${r}`,uo[r]);function Ko(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Vs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Ko(r)||Xe(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const o of r)i.push(Vs(o,e));return i}if(typeof r=="object"){const i=r.constructor,o=i._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!$n[o])throw new Error(`${o} is not registered.`);const u=i.serialize?i.serialize(r,e):{};if(i.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||$n[o].omit.indexOf(m)>=0)continue;const g=r[m];u[m]=$n[o].shallow.indexOf(m)>=0?g:Vs(g,e)}r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof r)}function Ra(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Ko(r)||Xe(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ra);if(typeof r=="object"){const e=r.$name||"Object";if(!$n[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=$n[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const u of Object.keys(r)){if(u==="$name")continue;const m=r[u];o[u]=$n[e].shallow.indexOf(u)>=0?m:Ra(m)}return o}throw new Error("can't deserialize object of type "+typeof r)}class Iu{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const lt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function ws(r){for(const e of r)if(Mu(e.charCodeAt(0)))return!0;return!1}function Xo(r){for(const e of r)if(!Pu(e.charCodeAt(0)))return!1;return!0}function Pu(r){return!(lt.Arabic(r)||lt["Arabic Supplement"](r)||lt["Arabic Extended-A"](r)||lt["Arabic Presentation Forms-A"](r)||lt["Arabic Presentation Forms-B"](r))}function Mu(r){return!(r!==746&&r!==747&&(r<4352||!(lt["Bopomofo Extended"](r)||lt.Bopomofo(r)||lt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||lt["CJK Compatibility Ideographs"](r)||lt["CJK Compatibility"](r)||lt["CJK Radicals Supplement"](r)||lt["CJK Strokes"](r)||!(!lt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||lt["CJK Unified Ideographs Extension A"](r)||lt["CJK Unified Ideographs"](r)||lt["Enclosed CJK Letters and Months"](r)||lt["Hangul Compatibility Jamo"](r)||lt["Hangul Jamo Extended-A"](r)||lt["Hangul Jamo Extended-B"](r)||lt["Hangul Jamo"](r)||lt["Hangul Syllables"](r)||lt.Hiragana(r)||lt["Ideographic Description Characters"](r)||lt.Kanbun(r)||lt["Kangxi Radicals"](r)||lt["Katakana Phonetic Extensions"](r)||lt.Katakana(r)&&r!==12540||!(!lt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!lt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||lt["Unified Canadian Aboriginal Syllabics"](r)||lt["Unified Canadian Aboriginal Syllabics Extended"](r)||lt["Vertical Forms"](r)||lt["Yijing Hexagram Symbols"](r)||lt["Yi Syllables"](r)||lt["Yi Radicals"](r))))}function xc(r){return!(Mu(r)||function(e){return!!(lt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||lt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||lt["Letterlike Symbols"](e)||lt["Number Forms"](e)||lt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||lt["Control Pictures"](e)&&e!==9251||lt["Optical Character Recognition"](e)||lt["Enclosed Alphanumerics"](e)||lt["Geometric Shapes"](e)||lt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||lt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||lt["CJK Symbols and Punctuation"](e)||lt.Katakana(e)||lt["Private Use Area"](e)||lt["CJK Compatibility Forms"](e)||lt["Small Form Variants"](e)||lt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function bo(r){return r>=1424&&r<=2303||lt["Arabic Presentation Forms-A"](r)||lt["Arabic Presentation Forms-B"](r)}function wc(r,e){return!(!e&&bo(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||lt.Khmer(r))}function bc(r){for(const e of r)if(bo(e.charCodeAt(0)))return!0;return!1}const Ol="deferred",qr="loading",Yo="loaded";let So=null,Di="unavailable",js=null;const Fa=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Di="error"),So&&So(r)};function Ba(){ua.fire(new Vr("pluginStateChange",{pluginStatus:Di,pluginURL:js}))}const ua=new Er,ca=function(){return Di},Au=function(){if(Di!==Ol||!js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Di=qr,Ba(),js&&Nr({url:js},r=>{r?Fa(r):(Di=Yo,Ba())})},Pn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Di===Yo||Pn.applyArabicShaping!=null,isLoading:()=>Di===qr,setState(r){if(!yt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Di=r.pluginStatus,js=r.pluginURL},isParsed(){if(!yt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Pn.applyArabicShaping!=null&&Pn.processBidirectionalText!=null&&Pn.processStyledBidirectionalText!=null},getPluginURL(){if(!yt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return js}};class Yr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Iu,this.transition={})}isSupportedScript(e){return function(i,o){for(const u of i)if(!wc(u.charCodeAt(0),o))return!1;return!0}(e,Pn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}class Jo{constructor(e,i){this.property=e,this.value=i,this.expression=function(o,u){if(ti(o))return new Ma(o,u);if(Ll(o)){const m=bu(o,u);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return u.type==="color"&&typeof o=="string"?m=Pr.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=di.parse(o)):m=hi.parse(o),{kind:"constant",evaluate:()=>m}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ko{constructor(e){this.property=e,this.value=new Jo(e,void 0)}transitioned(e,i){return new Nl(this.property,this.value,i,le({},e.transition,this.transition),e.now)}untransitioned(){return new Nl(this.property,this.value,null,{},0)}}class Qo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ot(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ko(this._values[e].property)),this._values[e].value=new Jo(this._values[e].property,i===null?void 0:ot(i))}getTransition(e){return ot(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ko(this._values[e].property)),this._values[e].transition=ot(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const o=new Vl(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Vl(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Nl{constructor(e,i,o,u,m){this.property=e,this.value=i,this.begin=m+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,m=this.value.possiblyEvaluate(e,i,o),g=this.prior;if(g){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return g.possiblyEvaluate(e,i,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,o),m,function(w){if(w<=0)return 0;if(w>=1)return 1;const k=w*w,C=k*w;return 4*(w<.5?C:3*(w-k)+C-.75)}(_))}}return m}}class Vl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new jl(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class zu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ot(this._values[e].value)}setValue(e,i){this._values[e]=new Jo(this._values[e].property,i===null?void 0:ot(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new jl(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,i,o);return u}}class Xi{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class It{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=En[this.specification.type];return u?u(e,i,o):e}}class qt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new Xi(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Xi(this,{kind:"constant",value:void 0},e.parameters);const u=En[this.specification.type];if(u){const m=u(e.value.value,i.value.value,o);return new Xi(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,i,o,u,m,g){return e.kind==="constant"?e.value:e.evaluate(i,o,u,m,g)}}class el extends qt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new Xi(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,u),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,i);return new Xi(this,{kind:"constant",value:_},i)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Xi(this,{kind:"constant",value:m},i)}return new Xi(this,e.expression,i)}evaluate(e,i,o,u,m,g){if(e.kind==="source"){const _=e.evaluate(i,o,u,m,g);return this._calculate(_,_,_,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class tl{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,u);return this._calculate(m,m,m,i)}return this._calculate(e.expression.evaluate(new Yr(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Yr(Math.floor(i.zoom),i)),e.expression.evaluate(new Yr(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class bs{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class pi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new Jo(o,void 0),m=this.defaultTransitionablePropertyValues[i]=new ko(o);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}gt("DataDrivenProperty",qt),gt("DataConstantProperty",It),gt("CrossFadedDataDrivenProperty",el),gt("CrossFadedProperty",tl),gt("ColorRampProperty",bs);const ha="-transition";class _i extends Er{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new zu(i.layout)),i.paint)){this._transitionablePaint=new Qo(i.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jl(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,o={}){i!=null&&this._validate(Da,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(ha)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(xo,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(ha))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],m=u.property.specification["property-type"]==="cross-faded-data-driven",g=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,_,w)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),mt(e,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}_validate(e,i,o,u,m={}){return(!m||m.validate!==!1)&&wo(this,e.call(is,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Xi&&co(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const To={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dn{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ii(r,e=1){let i=0,o=0;return{members:r.map(u=>{const m=To[u.type].BYTES_PER_ELEMENT,g=i=Eo(i,Math.max(e,m)),_=u.components||1;return o=Math.max(o,m),i+=m*_,{name:u.name,type:u.type,components:_,offset:g}}),size:Eo(i,Math.max(o,e)),alignment:e}}function Eo(r,e){return Math.ceil(r/e)*e}class ns extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}ns.prototype.bytesPerElement=4,gt("StructArrayLayout2i4",ns);class Us extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=u,e}}Us.prototype.bytesPerElement=6,gt("StructArrayLayout3i6",Us);class qn extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,u)}emplace(e,i,o,u,m){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=u,this.int16[g+3]=m,e}}qn.prototype.bytesPerElement=8,gt("StructArrayLayout4i8",qn);class Co extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,m,g)}emplace(e,i,o,u,m,g,_){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=_,e}}Co.prototype.bytesPerElement=12,gt("StructArrayLayout2i4i12",Co);class rl extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,m,g)}emplace(e,i,o,u,m,g,_){const w=4*e,k=8*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.uint8[k+4]=u,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=_,e}}rl.prototype.bytesPerElement=8,gt("StructArrayLayout2i4ub8",rl);class ss extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}ss.prototype.bytesPerElement=8,gt("StructArrayLayout2f8",ss);class Ss extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g,_,w,k,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,o,u,m,g,_,w,k,C)}emplace(e,i,o,u,m,g,_,w,k,C,M){const R=10*e;return this.uint16[R+0]=i,this.uint16[R+1]=o,this.uint16[R+2]=u,this.uint16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=_,this.uint16[R+6]=w,this.uint16[R+7]=k,this.uint16[R+8]=C,this.uint16[R+9]=M,e}}Ss.prototype.bytesPerElement=20,gt("StructArrayLayout10ui20",Ss);class Zr extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g,_,w,k,C,M,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,o,u,m,g,_,w,k,C,M,R)}emplace(e,i,o,u,m,g,_,w,k,C,M,R,N){const V=12*e;return this.int16[V+0]=i,this.int16[V+1]=o,this.int16[V+2]=u,this.int16[V+3]=m,this.uint16[V+4]=g,this.uint16[V+5]=_,this.uint16[V+6]=w,this.uint16[V+7]=k,this.int16[V+8]=C,this.int16[V+9]=M,this.int16[V+10]=R,this.int16[V+11]=N,e}}Zr.prototype.bytesPerElement=24,gt("StructArrayLayout4i4ui4i24",Zr);class $t extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=u,e}}$t.prototype.bytesPerElement=12,gt("StructArrayLayout3f12",$t);class p extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}p.prototype.bytesPerElement=4,gt("StructArrayLayout1ul4",p);class t extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g,_,w,k){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,m,g,_,w,k)}emplace(e,i,o,u,m,g,_,w,k,C){const M=10*e,R=5*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.int16[M+2]=u,this.int16[M+3]=m,this.int16[M+4]=g,this.int16[M+5]=_,this.uint32[R+3]=w,this.uint16[M+8]=k,this.uint16[M+9]=C,e}}t.prototype.bytesPerElement=20,gt("StructArrayLayout6i1ul2ui20",t);class s extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,m,g)}emplace(e,i,o,u,m,g,_){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=_,e}}s.prototype.bytesPerElement=12,gt("StructArrayLayout2i2i2i12",s);class l extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,u,m)}emplace(e,i,o,u,m,g){const _=4*e,w=8*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[w+6]=m,this.int16[w+7]=g,e}}l.prototype.bytesPerElement=16,gt("StructArrayLayout2f1f2i16",l);class h extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,u)}emplace(e,i,o,u,m){const g=12*e,_=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=o,this.float32[_+1]=u,this.float32[_+2]=m,e}}h.prototype.bytesPerElement=12,gt("StructArrayLayout2ub2f12",h);class f extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=o,this.uint16[m+2]=u,e}}f.prototype.bytesPerElement=6,gt("StructArrayLayout3ui6",f);class v extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie)}emplace(e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie,fe){const ne=24*e,ge=12*e,ke=48*e;return this.int16[ne+0]=i,this.int16[ne+1]=o,this.uint16[ne+2]=u,this.uint16[ne+3]=m,this.uint32[ge+2]=g,this.uint32[ge+3]=_,this.uint32[ge+4]=w,this.uint16[ne+10]=k,this.uint16[ne+11]=C,this.uint16[ne+12]=M,this.float32[ge+7]=R,this.float32[ge+8]=N,this.uint8[ke+36]=V,this.uint8[ke+37]=W,this.uint8[ke+38]=J,this.uint32[ge+10]=ie,this.int16[ne+22]=fe,e}}v.prototype.bytesPerElement=48,gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",v);class x extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie,fe,ne,ge,ke,Oe,dt,Et,ut,st,et,vt){const it=this.length;return this.resize(it+1),this.emplace(it,e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie,fe,ne,ge,ke,Oe,dt,Et,ut,st,et,vt)}emplace(e,i,o,u,m,g,_,w,k,C,M,R,N,V,W,J,ie,fe,ne,ge,ke,Oe,dt,Et,ut,st,et,vt,it){const Ze=32*e,jt=16*e;return this.int16[Ze+0]=i,this.int16[Ze+1]=o,this.int16[Ze+2]=u,this.int16[Ze+3]=m,this.int16[Ze+4]=g,this.int16[Ze+5]=_,this.int16[Ze+6]=w,this.int16[Ze+7]=k,this.uint16[Ze+8]=C,this.uint16[Ze+9]=M,this.uint16[Ze+10]=R,this.uint16[Ze+11]=N,this.uint16[Ze+12]=V,this.uint16[Ze+13]=W,this.uint16[Ze+14]=J,this.uint16[Ze+15]=ie,this.uint16[Ze+16]=fe,this.uint16[Ze+17]=ne,this.uint16[Ze+18]=ge,this.uint16[Ze+19]=ke,this.uint16[Ze+20]=Oe,this.uint16[Ze+21]=dt,this.uint16[Ze+22]=Et,this.uint32[jt+12]=ut,this.float32[jt+13]=st,this.float32[jt+14]=et,this.uint16[Ze+30]=vt,this.uint16[Ze+31]=it,e}}x.prototype.bytesPerElement=64,gt("StructArrayLayout8i15ui1ul2f2ui64",x);class S extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}S.prototype.bytesPerElement=4,gt("StructArrayLayout1f4",S);class E extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const m=3*e;return this.uint16[6*e+0]=i,this.float32[m+1]=o,this.float32[m+2]=u,e}}E.prototype.bytesPerElement=12,gt("StructArrayLayout1ui2f12",E);class I extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const m=4*e;return this.uint32[2*e+0]=i,this.uint16[m+2]=o,this.uint16[m+3]=u,e}}I.prototype.bytesPerElement=8,gt("StructArrayLayout1ul2ui8",I);class P extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}P.prototype.bytesPerElement=4,gt("StructArrayLayout2ui4",P);class B extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}B.prototype.bytesPerElement=2,gt("StructArrayLayout1ui2",B);class Z extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,u)}emplace(e,i,o,u,m){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=u,this.float32[g+3]=m,e}}Z.prototype.bytesPerElement=16,gt("StructArrayLayout4f16",Z);class G extends dn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ce(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class K extends t{get(e){return new G(this,e)}}gt("CollisionBoxArray",K);class q extends dn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}q.prototype.size=48;class oe extends v{get(e){return new q(this,e)}}gt("PlacedSymbolArray",oe);class we extends dn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}we.prototype.size=64;class ee extends x{get(e){return new we(this,e)}}gt("SymbolInstanceArray",ee);class he extends S{getoffsetX(e){return this.float32[1*e+0]}}gt("GlyphOffsetArray",he);class be extends Us{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}gt("SymbolLineVertexArray",be);class Se extends dn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Se.prototype.size=12;class De extends E{get(e){return new Se(this,e)}}gt("TextAnchorOffsetArray",De);class Ve extends dn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ve.prototype.size=8;class Fe extends I{get(e){return new Ve(this,e)}}gt("FeatureIndexArray",Fe);class qe extends ns{}class bt extends ns{}class cr extends ns{}class tt extends Co{}class kt extends rl{}class ht extends ss{}class Ht extends Ss{}class er extends Zr{}class ar extends $t{}class hr extends p{}class ni extends s{}class Rr extends h{}class Li extends f{}class fi extends P{}const mi=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ri}=mi;class Or{constructor(e=[]){this.segments=e}prepareSegment(e,i,o,u){let m=this.segments[this.segments.length-1];return e>Or.MAX_VERTEX_ARRAY_LENGTH&&Wt(`Max vertices per segment is ${Or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Or.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(m.sortKey=u),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new Or([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function ks(r,e){return 256*(r=Rt(Math.floor(r),0,255))+Rt(Math.floor(e),0,255)}Or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gt("SegmentVector",Or);const _n=ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var as={exports:{}},da={exports:{}};da.exports=function(r,e){var i,o,u,m,g,_,w,k;for(o=r.length-(i=3&r.length),u=e,g=3432918353,_=461845907,k=0;k<o;)w=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,u=27492+(65535&(m=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&r.charCodeAt(k+2))<<16;case 2:w^=(255&r.charCodeAt(k+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&r.charCodeAt(k)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return u^=r.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Oa=da.exports,vi={exports:{}};vi.exports=function(r,e){for(var i,o=r.length,u=e^o,m=0;o>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:u^=(255&r.charCodeAt(m+2))<<16;case 2:u^=(255&r.charCodeAt(m+1))<<8;case 1:u=1540483477*(65535&(u^=255&r.charCodeAt(m)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Fi=Oa,Bi=vi.exports;as.exports=Fi,as.exports.murmur3=Fi,as.exports.murmur2=Bi;var Ts=$(as.exports);class Gr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(xi(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=xi(e);let o=0,u=this.ids.length-1;for(;o<u;){const g=o+u>>1;this.ids[g]>=i?u=g:o=g+1}const m=[];for(;this.ids[o]===i;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return sn(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new Gr;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function xi(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ts(String(r))}function sn(r,e,i,o){for(;i<o;){const u=r[i+o>>1];let m=i-1,g=o+1;for(;;){do m++;while(r[m]<u);do g--;while(r[g]>u);if(m>=g)break;si(r,m,g),si(e,3*m,3*g),si(e,3*m+1,3*g+1),si(e,3*m+2,3*g+2)}g-i<o-g?(sn(r,e,i,g),i=g+1):(sn(r,e,g+1,o),o=g)}}function si(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}gt("FeaturePositionMap",Gr);class $s{constructor(e,i){this.gl=e.gl,this.location=i}}class qs extends $s{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Mn extends $s{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class pa extends $s{constructor(e,i){super(e,i),this.current=Pr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Du=new Float32Array(16);function Ul(r){return[ks(255*r.r,255*r.g),ks(255*r.b,255*r.a)]}class Oi{constructor(e,i,o){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new pa(e,i):new qs(e,i)}}class vn{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setUniform(e,i,o,u){const m=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"?new Mn(e,i):new qs(e,i)}}class Zn{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,o,u,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Yr(0),i,{},u,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,_)}updatePaintArray(e,i,o,u){const m=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(e,i,m)}_setPaintValue(e,i,o){if(this.type==="color"){const u=Ul(o);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class An{constructor(e,i,o,u,m,g){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,o,u,m){const g=this.expression.evaluate(new Yr(this.zoom),i,{},u,[],m),_=this.expression.evaluate(new Yr(this.zoom+1),i,{},u,[],m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,_)}updatePaintArray(e,i,o,u){const m=this.expression.evaluate({zoom:this.zoom},o,u),g=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(e,i,m,g)}_setPaintValue(e,i,o,u){if(this.type==="color"){const m=Ul(o),g=Ul(u);for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=Rt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new qs(e,i)}}class Ni{constructor(e,i,o,u,m,g){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,u,m){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,i,o,u){if(!u||!o)return;const{min:m,mid:g,max:_}=o,w=u[m],k=u[g],C=u[_];if(w&&k&&C)for(let M=e;M<i;M++)this.zoomInPaintVertexArray.emplace(M,k.tl[0],k.tl[1],k.br[0],k.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],k.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,_n.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,_n.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const m in e.paint._values){if(!o(m))continue;const g=e.paint.get(m);if(!(g instanceof Xi&&co(g.property.specification)))continue;const _=rd(m,e.type),w=g.value,k=g.property.specification.type,C=g.property.useIntegerZoom,M=g.property.specification["property-type"],R=M==="cross-faded"||M==="cross-faded-data-driven";if(w.kind==="constant")this.binders[m]=R?new vn(w.value,_):new Oi(w.value,_,k),u.push(`/u_${m}`);else if(w.kind==="source"||R){const N=Lu(m,k,"source");this.binders[m]=R?new Ni(w,k,C,i,N,e.id):new Zn(w,_,k,N),u.push(`/a_${m}`)}else{const N=Lu(m,k,"composite");this.binders[m]=new An(w,_,k,C,i,N),u.push(`/z_${m}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Zn||i instanceof An?i.maxValue:0}populatePaintArrays(e,i,o,u,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof Zn||_ instanceof An||_ instanceof Ni)&&_.populatePaintArray(e,i,o,u,m)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof vn&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,o,u,m){let g=!1;for(const _ in e){const w=i.getPositions(_);for(const k of w){const C=o.feature(k.index);for(const M in this.binders){const R=this.binders[M];if((R instanceof Zn||R instanceof An||R instanceof Ni)&&R.expression.isStateDependent===!0){const N=u.paint.get(M);R.expression=N.value,R.updatePaintArray(k.start,k.end,C,e[_],m),g=!0}}}}return g}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Oi||o instanceof vn)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Zn||o instanceof An)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof Ni)for(let u=0;u<_n.members.length;u++)e.push(_n.members[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Oi||o instanceof vn||o instanceof An)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Oi||m instanceof vn||m instanceof An){for(const g of m.uniformNames)if(i[g]){const _=m.getBinding(e,i[g],g);o.push({name:g,property:u,binding:_})}}}return o}setUniforms(e,i,o,u){for(const{name:m,property:g,binding:_}of i)this.binders[g].setUniform(_,u,o.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof Ni){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Zn||o instanceof An)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Zn||o instanceof An||o instanceof Ni)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Zn||i instanceof An||i instanceof Ni)&&i.destroy()}}}class Gn{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Es(u,i,o);this.needsUpload=!1,this._featureMap=new Gr,this._bufferOffset=0}populatePaintArrays(e,i,o,u,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,i,u,m,g);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function rd(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Lu(r,e,i){const o={color:{source:ss,composite:Z},number:{source:S,composite:ss}},u=function(m){return{"line-pattern":{source:Ht,composite:Ht},"fill-pattern":{source:Ht,composite:Ht},"fill-extrusion-pattern":{source:Ht,composite:Ht}}[m]}(r);return u&&u[i]||o[e][i]}gt("ConstantBinder",Oi),gt("CrossFadedConstantBinder",vn),gt("SourceExpressionBinder",Zn),gt("CrossFadedCompositeBinder",Ni),gt("CompositeExpressionBinder",An),gt("ProgramConfiguration",Es,{omit:["_buffers"]}),gt("ProgramConfigurationSet",Gn);const wi=8192,il=Math.pow(2,14)-1,Zs=-il-1;function Gs(r){const e=wi/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let m=0;m<u.length;m++){const g=u[m],_=Math.round(g.x*e),w=Math.round(g.y*e);g.x=Rt(_,Zs,il),g.y=Rt(w,Zs,il),(_<g.x||_>g.x+1||w<g.y||w>g.y+1)&&Wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ws(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Gs(r):[]}}function fa(r,e,i,o,u){r.emplaceBack(2*e+(o+1)/2,2*i+(u+1)/2)}class Ru{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bt,this.indexArray=new Li,this.segments=new Or,this.programConfigurations=new Gn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){const u=this.layers[0],m=[];let g=null,_=!1;u.type==="circle"&&(g=u.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:w,id:k,index:C,sourceLayerIndex:M}of e){const R=this.layers[0]._featureFilter.needGeometry,N=Ws(w,R);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),N,o))continue;const V=_?g.evaluate(N,{},o):void 0,W={id:k,properties:w.properties,type:w.type,sourceLayerIndex:M,index:C,geometry:R?N.geometry:Gs(w),patterns:{},sortKey:V};m.push(W)}_&&m.sort((w,k)=>w.sortKey-k.sortKey);for(const w of m){const{geometry:k,index:C,sourceLayerIndex:M}=w,R=e[C].feature;this.addFeature(w,k,C,o),i.featureIndex.insert(R,k,C,M,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ri),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u){for(const m of i)for(const g of m){const _=g.x,w=g.y;if(_<0||_>=wi||w<0||w>=wi)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=k.vertexLength;fa(this.layoutVertexArray,_,w,-1,-1),fa(this.layoutVertexArray,_,w,1,-1),fa(this.layoutVertexArray,_,w,1,1),fa(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u)}}function nl(r,e){for(let i=0;i<r.length;i++)if(Cs(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Cs(r,e[i]))return!0;return!!$l(r,e)}function id(r,e,i){return!!Cs(r,e)||!!Fu(e,r,i)}function Sc(r,e){if(r.length===1)return kc(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(Cs(r,o[u]))return!0}for(let i=0;i<r.length;i++)if(kc(e,r[i]))return!0;for(let i=0;i<e.length;i++)if($l(r,e[i]))return!0;return!1}function bi(r,e,i){if(r.length>1){if($l(r,e))return!0;for(let o=0;o<e.length;o++)if(Fu(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(Fu(r[o],e,i))return!0;return!1}function $l(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],u=r[i+1];for(let m=0;m<e.length-1;m++)if(hh(o,u,e[m],e[m+1]))return!0}return!1}function hh(r,e,i,o){return dr(r,i,o)!==dr(e,i,o)&&dr(r,e,i)!==dr(r,e,o)}function Fu(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(Bu(r,e[u-1],e[u])<o)return!0;return!1}function Bu(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const u=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function kc(r,e){let i,o,u,m=!1;for(let g=0;g<r.length;g++){i=r[g];for(let _=0,w=i.length-1;_<i.length;w=_++)o=i[_],u=i[w],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(m=!m)}return m}function Cs(r,e){let i=!1;for(let o=0,u=r.length-1;o<r.length;u=o++){const m=r[o],g=r[u];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function Si(r,e,i){const o=i[0],u=i[2];if(r.x<o.x&&e.x<o.x||r.x>u.x&&e.x>u.x||r.y<o.y&&e.y<o.y||r.y>u.y&&e.y>u.y)return!1;const m=dr(r,e,i[0]);return m!==dr(r,e,i[1])||m!==dr(r,e,i[2])||m!==dr(r,e,i[3])}function ki(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Pi(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function sl(r,e,i,o,u){if(!e[0]&&!e[1])return r;const m=Ce.convert(e)._mult(u);i==="viewport"&&m._rotate(-o);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(m));return g}let ql,Zl;gt("CircleBucket",Ru,{omit:["layers"]});var Qd={get paint(){return Zl=Zl||new pi({"circle-radius":new qt(Te.paint_circle["circle-radius"]),"circle-color":new qt(Te.paint_circle["circle-color"]),"circle-blur":new qt(Te.paint_circle["circle-blur"]),"circle-opacity":new qt(Te.paint_circle["circle-opacity"]),"circle-translate":new It(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new It(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return ql=ql||new pi({"circle-sort-key":new qt(Te.layout_circle["circle-sort-key"])})}},Fr=1e-6,Io=typeof Float32Array<"u"?Float32Array:Array;function Ou(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Tc(r,e,i){var o=e[0],u=e[1],m=e[2],g=e[3],_=e[4],w=e[5],k=e[6],C=e[7],M=e[8],R=e[9],N=e[10],V=e[11],W=e[12],J=e[13],ie=e[14],fe=e[15],ne=i[0],ge=i[1],ke=i[2],Oe=i[3];return r[0]=ne*o+ge*_+ke*M+Oe*W,r[1]=ne*u+ge*w+ke*R+Oe*J,r[2]=ne*m+ge*k+ke*N+Oe*ie,r[3]=ne*g+ge*C+ke*V+Oe*fe,r[4]=(ne=i[4])*o+(ge=i[5])*_+(ke=i[6])*M+(Oe=i[7])*W,r[5]=ne*u+ge*w+ke*R+Oe*J,r[6]=ne*m+ge*k+ke*N+Oe*ie,r[7]=ne*g+ge*C+ke*V+Oe*fe,r[8]=(ne=i[8])*o+(ge=i[9])*_+(ke=i[10])*M+(Oe=i[11])*W,r[9]=ne*u+ge*w+ke*R+Oe*J,r[10]=ne*m+ge*k+ke*N+Oe*ie,r[11]=ne*g+ge*C+ke*V+Oe*fe,r[12]=(ne=i[12])*o+(ge=i[13])*_+(ke=i[14])*M+(Oe=i[15])*W,r[13]=ne*u+ge*w+ke*R+Oe*J,r[14]=ne*m+ge*k+ke*N+Oe*ie,r[15]=ne*g+ge*C+ke*V+Oe*fe,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Wn,Is=Tc;function Po(r,e,i){var o=e[0],u=e[1],m=e[2],g=e[3];return r[0]=i[0]*o+i[4]*u+i[8]*m+i[12]*g,r[1]=i[1]*o+i[5]*u+i[9]*m+i[13]*g,r[2]=i[2]*o+i[6]*u+i[10]*m+i[14]*g,r[3]=i[3]*o+i[7]*u+i[11]*m+i[15]*g,r}Wn=new Io(4),Io!=Float32Array&&(Wn[0]=0,Wn[1]=0,Wn[2]=0,Wn[3]=0);class dh extends _i{constructor(e){super(e,Qd)}createBucket(e){return new Ru(e)}queryRadius(e){const i=e;return ki("circle-radius",this,i)+ki("circle-stroke-width",this,i)+Pi(this.paint.get("circle-translate"))}queryIntersectsFeature(e,i,o,u,m,g,_,w){const k=sl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),C=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),M=this.paint.get("circle-pitch-alignment")==="map",R=M?k:function(V,W){return V.map(J=>Ec(J,W))}(k,w),N=M?C*_:C;for(const V of u)for(const W of V){const J=M?W:Ec(W,w);let ie=N;const fe=Po([],[W.x,W.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=fe[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=g.cameraToCenterDistance/fe[3]),id(R,J,ie))return!0}return!1}}function Ec(r,e){const i=Po([],[r.x,r.y,0,1],e);return new Ce(i[0]/i[3],i[1]/i[3])}class ph extends Ru{}let fh;gt("HeatmapBucket",ph,{omit:["layers"]});var nd={get paint(){return fh=fh||new pi({"heatmap-radius":new qt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bs(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(Te.paint_heatmap["heatmap-opacity"])})}};function Cc(r,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=u,r}function mh(r,{width:e,height:i},o){if(e===r.width&&i===r.height)return;const u=Cc({},{width:e,height:i},o);Ic(r,u,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},o),r.width=e,r.height=i,r.data=u.data}function Ic(r,e,i,o,u,m){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||i.x>r.width-u.width||i.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=e.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const k=((i.y+w)*r.width+i.x)*m,C=((o.y+w)*e.width+o.x)*m;for(let M=0;M<u.width*m;M++)_[C+M]=g[k+M]}return e}class Gl{constructor(e,i){Cc(this,e,1,i)}resize(e){mh(this,e,1)}clone(){return new Gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,m){Ic(e,i,o,u,m,1)}}class Hn{constructor(e,i){Cc(this,e,4,i)}resize(e){mh(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,m){Ic(e,i,o,u,m,4)}}function Wl(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,u=r.image||new Hn({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const m=(g,_,w)=>{e[r.evaluationKey]=w;const k=r.expression.evaluate(e);u.data[g+_+0]=Math.floor(255*k.r/k.a),u.data[g+_+1]=Math.floor(255*k.g/k.a),u.data[g+_+2]=Math.floor(255*k.b/k.a),u.data[g+_+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,_=0;g<o;++g,_+=4*i)for(let w=0,k=0;w<i;w++,k+=4){const C=w/(i-1),{start:M,end:R}=r.clips[g];m(_,k,M*(1-C)+R*C)}else for(let g=0,_=0;g<i;g++,_+=4)m(0,_,g/(i-1));return u}gt("AlphaImage",Gl),gt("RGBAImage",Hn);class sd extends _i{createBucket(e){return new ph(e)}constructor(e){super(e,nd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Nu;var Pc={get paint(){return Nu=Nu||new pi({"hillshade-illumination-direction":new It(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(Te.paint_hillshade["hillshade-accent-color"])})}};class ad extends _i{constructor(e){super(e,Pc)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const gh=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:od}=gh;var Mc={exports:{}};function Vu(r,e,i){i=i||2;var o,u,m,g,_,w,k,C=e&&e.length,M=C?e[0]*i:r.length,R=yh(r,0,M,i,!0),N=[];if(!R||R.next===R.prev)return N;if(C&&(R=function(W,J,ie,fe){var ne,ge,ke,Oe=[];for(ne=0,ge=J.length;ne<ge;ne++)(ke=yh(W,J[ne]*fe,ne<ge-1?J[ne+1]*fe:W.length,fe,!1))===ke.next&&(ke.steiner=!0),Oe.push(dd(ke));for(Oe.sort(tp),ne=0;ne<Oe.length;ne++)ie=rp(Oe[ne],ie);return ie}(r,e,R,i)),r.length>80*i){o=m=r[0],u=g=r[1];for(var V=i;V<M;V+=i)(_=r[V])<o&&(o=_),(w=r[V+1])<u&&(u=w),_>m&&(m=_),w>g&&(g=w);k=(k=Math.max(m-o,g-u))!==0?32767/k:0}return Hl(R,N,i,o,u,k,0),N}function yh(r,e,i,o,u){var m,g;if(u===ju(r,e,i,o)>0)for(m=e;m<i;m+=o)g=vh(m,r[m],r[m+1],g);else for(m=i-o;m>=e;m-=o)g=vh(m,r[m],r[m+1],g);return g&&zc(g,g.next)&&(ol(g),g=g.next),g}function Na(r,e){if(!r)return r;e||(e=r);var i,o=r;do if(i=!1,o.steiner||!zc(o,o.next)&&Ti(o.prev,o,o.next)!==0)o=o.next;else{if(ol(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function Hl(r,e,i,o,u,m,g){if(r){!g&&m&&function(C,M,R,N){var V=C;do V.z===0&&(V.z=Ac(V.x,V.y,M,R,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==C);V.prevZ.nextZ=null,V.prevZ=null,function(W){var J,ie,fe,ne,ge,ke,Oe,dt,Et=1;do{for(ie=W,W=null,ge=null,ke=0;ie;){for(ke++,fe=ie,Oe=0,J=0;J<Et&&(Oe++,fe=fe.nextZ);J++);for(dt=Et;Oe>0||dt>0&&fe;)Oe!==0&&(dt===0||!fe||ie.z<=fe.z)?(ne=ie,ie=ie.nextZ,Oe--):(ne=fe,fe=fe.nextZ,dt--),ge?ge.nextZ=ne:W=ne,ne.prevZ=ge,ge=ne;ie=fe}ge.nextZ=null,Et*=2}while(ke>1)}(V)}(r,o,u,m);for(var _,w,k=r;r.prev!==r.next;)if(_=r.prev,w=r.next,m?ud(r,o,u,m):ld(r))e.push(_.i/i|0),e.push(r.i/i|0),e.push(w.i/i|0),ol(r),r=w.next,k=w.next;else if((r=w)===k){g?g===1?Hl(r=ep(Na(r),e,i),e,i,o,u,m,2):g===2&&cd(r,e,i,o,u,m):Hl(Na(r),e,i,o,u,m,1);break}}}function ld(r){var e=r.prev,i=r,o=r.next;if(Ti(e,i,o)>=0)return!1;for(var u=e.x,m=i.x,g=o.x,_=e.y,w=i.y,k=o.y,C=u<m?u<g?u:g:m<g?m:g,M=_<w?_<k?_:k:w<k?w:k,R=u>m?u>g?u:g:m>g?m:g,N=_>w?_>k?_:k:w>k?w:k,V=o.next;V!==e;){if(V.x>=C&&V.x<=R&&V.y>=M&&V.y<=N&&Va(u,_,m,w,g,k,V.x,V.y)&&Ti(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function ud(r,e,i,o){var u=r.prev,m=r,g=r.next;if(Ti(u,m,g)>=0)return!1;for(var _=u.x,w=m.x,k=g.x,C=u.y,M=m.y,R=g.y,N=_<w?_<k?_:k:w<k?w:k,V=C<M?C<R?C:R:M<R?M:R,W=_>w?_>k?_:k:w>k?w:k,J=C>M?C>R?C:R:M>R?M:R,ie=Ac(N,V,e,i,o),fe=Ac(W,J,e,i,o),ne=r.prevZ,ge=r.nextZ;ne&&ne.z>=ie&&ge&&ge.z<=fe;){if(ne.x>=N&&ne.x<=W&&ne.y>=V&&ne.y<=J&&ne!==u&&ne!==g&&Va(_,C,w,M,k,R,ne.x,ne.y)&&Ti(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ge.x>=N&&ge.x<=W&&ge.y>=V&&ge.y<=J&&ge!==u&&ge!==g&&Va(_,C,w,M,k,R,ge.x,ge.y)&&Ti(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;ne&&ne.z>=ie;){if(ne.x>=N&&ne.x<=W&&ne.y>=V&&ne.y<=J&&ne!==u&&ne!==g&&Va(_,C,w,M,k,R,ne.x,ne.y)&&Ti(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ge&&ge.z<=fe;){if(ge.x>=N&&ge.x<=W&&ge.y>=V&&ge.y<=J&&ge!==u&&ge!==g&&Va(_,C,w,M,k,R,ge.x,ge.y)&&Ti(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function ep(r,e,i){var o=r;do{var u=o.prev,m=o.next.next;!zc(u,m)&&Ps(u,o,o.next,m)&&Xl(u,m)&&Xl(m,u)&&(e.push(u.i/i|0),e.push(o.i/i|0),e.push(m.i/i|0),ol(o),ol(o.next),o=r=m),o=o.next}while(o!==r);return Na(o)}function cd(r,e,i,o,u,m){var g=r;do{for(var _=g.next.next;_!==g.prev;){if(g.i!==_.i&&ip(g,_)){var w=_h(g,_);return g=Na(g,g.next),w=Na(w,w.next),Hl(g,e,i,o,u,m,0),void Hl(w,e,i,o,u,m,0)}_=_.next}g=g.next}while(g!==r)}function tp(r,e){return r.x-e.x}function rp(r,e){var i=function(u,m){var g,_=m,w=u.x,k=u.y,C=-1/0;do{if(k<=_.y&&k>=_.next.y&&_.next.y!==_.y){var M=_.x+(k-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(M<=w&&M>C&&(C=M,g=_.x<_.next.x?_:_.next,M===w))return g}_=_.next}while(_!==m);if(!g)return null;var R,N=g,V=g.x,W=g.y,J=1/0;_=g;do w>=_.x&&_.x>=V&&w!==_.x&&Va(k<W?w:C,k,V,W,k<W?C:w,k,_.x,_.y)&&(R=Math.abs(k-_.y)/(w-_.x),Xl(_,u)&&(R<J||R===J&&(_.x>g.x||_.x===g.x&&hd(g,_)))&&(g=_,J=R)),_=_.next;while(_!==N);return g}(r,e);if(!i)return e;var o=_h(i,r);return Na(o,o.next),Na(i,i.next)}function hd(r,e){return Ti(r.prev,r,e.prev)<0&&Ti(e.next,r,r.next)<0}function Ac(r,e,i,o,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dd(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Va(r,e,i,o,u,m,g,_){return(u-g)*(e-_)>=(r-g)*(m-_)&&(r-g)*(o-_)>=(i-g)*(e-_)&&(i-g)*(m-_)>=(u-g)*(o-_)}function ip(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,o){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&Ps(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1}(r,e)&&(Xl(r,e)&&Xl(e,r)&&function(i,o){var u=i,m=!1,g=(i.x+o.x)/2,_=(i.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&g<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next;while(u!==i);return m}(r,e)&&(Ti(r.prev,r,e.prev)||Ti(r,e.prev,e))||zc(r,e)&&Ti(r.prev,r,r.next)>0&&Ti(e.prev,e,e.next)>0)}function Ti(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function zc(r,e){return r.x===e.x&&r.y===e.y}function Ps(r,e,i,o){var u=al(Ti(r,e,i)),m=al(Ti(r,e,o)),g=al(Ti(i,o,r)),_=al(Ti(i,o,e));return u!==m&&g!==_||!(u!==0||!Kl(r,i,e))||!(m!==0||!Kl(r,o,e))||!(g!==0||!Kl(i,r,o))||!(_!==0||!Kl(i,e,o))}function Kl(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function al(r){return r>0?1:r<0?-1:0}function Xl(r,e){return Ti(r.prev,r,r.next)<0?Ti(r,e,r.next)>=0&&Ti(r,r.prev,e)>=0:Ti(r,e,r.prev)<0||Ti(r,r.next,e)<0}function _h(r,e){var i=new Mo(r.i,r.x,r.y),o=new Mo(e.i,e.x,e.y),u=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=u,u.prev=i,o.next=i,i.prev=o,m.next=o,o.prev=m,o}function vh(r,e,i,o){var u=new Mo(r,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ol(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Mo(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ju(r,e,i,o){for(var u=0,m=e,g=i-o;m<i;m+=o)u+=(r[g]-r[m])*(r[m+1]+r[g+1]),g=m;return u}Mc.exports=Vu,Mc.exports.default=Vu,Vu.deviation=function(r,e,i,o){var u=e&&e.length,m=Math.abs(ju(r,0,u?e[0]*i:r.length,i));if(u)for(var g=0,_=e.length;g<_;g++)m-=Math.abs(ju(r,e[g]*i,g<_-1?e[g+1]*i:r.length,i));var w=0;for(g=0;g<o.length;g+=3){var k=o[g]*i,C=o[g+1]*i,M=o[g+2]*i;w+=Math.abs((r[k]-r[M])*(r[C+1]-r[k+1])-(r[k]-r[C])*(r[M+1]-r[k+1]))}return m===0&&w===0?0:Math.abs((w-m)/m)},Vu.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,u=0;u<r.length;u++){for(var m=0;m<r[u].length;m++)for(var g=0;g<e;g++)i.vertices.push(r[u][m][g]);u>0&&i.holes.push(o+=r[u-1].length)}return i};var Dc=$(Mc.exports);function np(r,e,i,o,u){xh(r,e,i,o||r.length-1,u||pd)}function xh(r,e,i,o,u){for(;o>i;){if(o-i>600){var m=o-i+1,g=e-i+1,_=Math.log(m),w=.5*Math.exp(2*_/3),k=.5*Math.sqrt(_*w*(m-w)/m)*(g-m/2<0?-1:1);xh(r,e,Math.max(i,Math.floor(e-g*w/m+k)),Math.min(o,Math.floor(e+(m-g)*w/m+k)),u)}var C=r[e],M=i,R=o;for(Yl(r,i,e),u(r[o],C)>0&&Yl(r,i,o);M<R;){for(Yl(r,M,R),M++,R--;u(r[M],C)<0;)M++;for(;u(r[R],C)>0;)R--}u(r[i],C)===0?Yl(r,i,R):Yl(r,++R,o),R<=e&&(i=R+1),e<=R&&(o=R-1)}}function Yl(r,e,i){var o=r[e];r[e]=r[i],r[i]=o}function pd(r,e){return r<e?-1:r>e?1:0}function Lc(r,e){const i=r.length;if(i<=1)return[r];const o=[];let u,m;for(let g=0;g<i;g++){const _=pr(r[g]);_!==0&&(r[g].area=Math.abs(_),m===void 0&&(m=_<0),m===_<0?(u&&o.push(u),u=[r[g]]):u.push(r[g]))}if(u&&o.push(u),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(np(o[g],e,1,o[g].length-1,fd),o[g]=o[g].slice(0,e));return o}function fd(r,e){return e.area-r.area}function wh(r,e,i){const o=i.patternDependencies;let u=!1;for(const m of e){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(u=!0);const _=g.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function xn(r,e,i,o,u){const m=u.patternDependencies;for(const g of e){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:o-1},i,{},u.availableImages),k=_.evaluate({zoom:o},i,{},u.availableImages),C=_.evaluate({zoom:o+1},i,{},u.availableImages);w=w&&w.name?w.name:w,k=k&&k.name?k.name:k,C=C&&C.name?C.name:C,m[w]=!0,m[k]=!0,m[C]=!0,i.patterns[g.id]={min:w,mid:k,max:C}}}return i}class pn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cr,this.indexArray=new Li,this.indexArray2=new fi,this.programConfigurations=new Gn(e.layers,e.zoom),this.segments=new Or,this.segments2=new Or,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=wh("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),m=!u.isConstant(),g=[];for(const{feature:_,id:w,index:k,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,R=Ws(_,M);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),R,o))continue;const N=m?u.evaluate(R,{},o,i.availableImages):void 0,V={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:k,geometry:M?R.geometry:Gs(_),patterns:{},sortKey:N};g.push(V)}m&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:k,sourceLayerIndex:C}=_;if(this.hasPattern){const M=xn("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(_,w,k,o,{});i.featureIndex.insert(e[k].feature,w,k,C,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,od),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,m){for(const g of Lc(i,500)){let _=0;for(const N of g)_+=N.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),k=w.vertexLength,C=[],M=[];for(const N of g){if(N.length===0)continue;N!==g[0]&&M.push(C.length/2);const V=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),W=V.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(W+N.length-1,W),C.push(N[0].x),C.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(W+J-1,W+J),C.push(N[J].x),C.push(N[J].y);V.vertexLength+=N.length,V.primitiveLength+=N.length}const R=Dc(C,M);for(let N=0;N<R.length;N+=3)this.indexArray.emplaceBack(k+R[N],k+R[N+1],k+R[N+2]);w.vertexLength+=_,w.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,u)}}let bh,Sh;gt("FillBucket",pn,{omit:["layers","patternFeatures"]});var md={get paint(){return Sh=Sh||new pi({"fill-antialias":new It(Te.paint_fill["fill-antialias"]),"fill-opacity":new qt(Te.paint_fill["fill-opacity"]),"fill-color":new qt(Te.paint_fill["fill-color"]),"fill-outline-color":new qt(Te.paint_fill["fill-outline-color"]),"fill-translate":new It(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new It(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new el(Te.paint_fill["fill-pattern"])})},get layout(){return bh=bh||new pi({"fill-sort-key":new qt(Te.layout_fill["fill-sort-key"])})}};class gd extends _i{constructor(e){super(e,md)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new pn(e)}queryRadius(){return Pi(this.paint.get("fill-translate"))}queryIntersectsFeature(e,i,o,u,m,g,_){return Sc(sl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),u)}isTileClipped(){return!0}}const yd=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),kh=ii([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_d}=yd;var ma={},vd=Le,Th=Ao;function Ao(r,e,i,o,u){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=u,r.readFields(Eh,this,e)}function Eh(r,e,i){r==1?e.id=i.readVarint():r==2?function(o,u){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=u._keys[o.readVarint()],_=u._values[o.readVarint()];u.properties[g]=_}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function xd(r){for(var e,i,o=0,u=0,m=r.length,g=m-1;u<m;g=u++)o+=((i=r[g]).x-(e=r[u]).x)*(e.y+i.y);return o}Ao.types=["Unknown","Point","LineString","Polygon"],Ao.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,o=1,u=0,m=0,g=0,_=[];r.pos<i;){if(u<=0){var w=r.readVarint();o=7&w,u=w>>3}if(u--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new vd(m,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Ao.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,o=0,u=0,m=0,g=1/0,_=-1/0,w=1/0,k=-1/0;r.pos<e;){if(o<=0){var C=r.readVarint();i=7&C,o=C>>3}if(o--,i===1||i===2)(u+=r.readSVarint())<g&&(g=u),u>_&&(_=u),(m+=r.readSVarint())<w&&(w=m),m>k&&(k=m);else if(i!==7)throw new Error("unknown command "+i)}return[g,w,_,k]},Ao.prototype.toGeoJSON=function(r,e,i){var o,u,m=this.extent*Math.pow(2,i),g=this.extent*r,_=this.extent*e,w=this.loadGeometry(),k=Ao.types[this.type];function C(N){for(var V=0;V<N.length;V++){var W=N[V];N[V]=[360*(W.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<w.length;o++)M[o]=w[o][0];C(w=M);break;case 2:for(o=0;o<w.length;o++)C(w[o]);break;case 3:for(w=function(N){var V=N.length;if(V<=1)return[N];for(var W,J,ie=[],fe=0;fe<V;fe++){var ne=xd(N[fe]);ne!==0&&(J===void 0&&(J=ne<0),J===ne<0?(W&&ie.push(W),W=[N[fe]]):W.push(N[fe]))}return W&&ie.push(W),ie}(w),o=0;o<w.length;o++)for(u=0;u<w[o].length;u++)C(w[o][u])}w.length===1?w=w[0]:k="Multi"+k;var R={type:"Feature",geometry:{type:k,coordinates:w},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Ch=Th,Uu=wd;function wd(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(bd,this,e),this.length=this._features.length}function bd(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(o){for(var u=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;u=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return u}(i))}wd.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Ch(this._pbf,e,this.extent,this._keys,this._values)};var Ih=Uu;function Sd(r,e,i){if(r===3){var o=new Ih(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}ma.VectorTile=function(r,e){this.layers=r.readFields(Sd,{},e)},ma.VectorTileFeature=Th,ma.VectorTileLayer=Uu;const Rc=ma.VectorTileFeature.types,Hs=Math.pow(2,13);function $u(r,e,i,o,u,m,g,_){r.emplaceBack(e,i,2*Math.floor(o*Hs)+g,u*Hs*2,m*Hs*2,Math.round(_))}class Fc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new tt,this.centroidVertexArray=new qe,this.indexArray=new Li,this.programConfigurations=new Gn(e.layers,e.zoom),this.segments=new Or,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.features=[],this.hasPattern=wh("fill-extrusion",this.layers,i);for(const{feature:u,id:m,index:g,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,k=Ws(u,w);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),k,o))continue;const C={id:m,sourceLayerIndex:_,index:g,geometry:w?k.geometry:Gs(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(xn("fill-extrusion",this.layers,C,this.zoom,i)):this.addFeature(C,C.geometry,g,o,{}),i.featureIndex.insert(u,C.geometry,g,_,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:m}=u;this.addFeature(u,m,u.index,i,o)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_d),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,kh.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,m){const g={x:0,y:0,vertexCount:0};for(const _ of Lc(i,500)){let w=0;for(const V of _)w+=V.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of _){if(V.length===0||kd(V))continue;let W=0;for(let J=0;J<V.length;J++){const ie=V[J];if(J>=1){const fe=V[J-1];if(!Ph(ie,fe)){k.vertexLength+4>Or.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ne=ie.sub(fe)._perp()._unit(),ge=fe.dist(ie);W+ge>32768&&(W=0),$u(this.layoutVertexArray,ie.x,ie.y,ne.x,ne.y,0,0,W),$u(this.layoutVertexArray,ie.x,ie.y,ne.x,ne.y,0,1,W),g.x+=2*ie.x,g.y+=2*ie.y,g.vertexCount+=2,W+=ge,$u(this.layoutVertexArray,fe.x,fe.y,ne.x,ne.y,0,0,W),$u(this.layoutVertexArray,fe.x,fe.y,ne.x,ne.y,0,1,W),g.x+=2*fe.x,g.y+=2*fe.y,g.vertexCount+=2;const ke=k.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+w>Or.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),Rc[e.type]!=="Polygon")continue;const C=[],M=[],R=k.vertexLength;for(const V of _)if(V.length!==0){V!==_[0]&&M.push(C.length/2);for(let W=0;W<V.length;W++){const J=V[W];$u(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),g.x+=J.x,g.y+=J.y,g.vertexCount+=1,C.push(J.x),C.push(J.y)}}const N=Dc(C,M);for(let V=0;V<N.length;V+=3)this.indexArray.emplaceBack(R+N[V],R+N[V+2],R+N[V+1]);k.primitiveLength+=N.length/3,k.vertexLength+=w}for(let _=0;_<g.vertexCount;_++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,u)}}function Ph(r,e){return r.x===e.x&&(r.x<0||r.x>wi)||r.y===e.y&&(r.y<0||r.y>wi)}function kd(r){return r.every(e=>e.x<0)||r.every(e=>e.x>wi)||r.every(e=>e.y<0)||r.every(e=>e.y>wi)}let Mh;gt("FillExtrusionBucket",Fc,{omit:["layers","features"]});var qu={get paint(){return Mh=Mh||new pi({"fill-extrusion-opacity":new It(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new el(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class wn extends _i{constructor(e){super(e,qu)}createBucket(e){return new Fc(e)}queryRadius(){return Pi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,i,o,u,m,g,_,w){const k=sl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(i,o),M=this.paint.get("fill-extrusion-base").evaluate(i,o),R=function(V,W,J,ie){const fe=[];for(const ne of V){const ge=[ne.x,ne.y,0,1];Po(ge,ge,W),fe.push(new Ce(ge[0]/ge[3],ge[1]/ge[3]))}return fe}(k,w),N=function(V,W,J,ie){const fe=[],ne=[],ge=ie[8]*W,ke=ie[9]*W,Oe=ie[10]*W,dt=ie[11]*W,Et=ie[8]*J,ut=ie[9]*J,st=ie[10]*J,et=ie[11]*J;for(const vt of V){const it=[],Ze=[];for(const jt of vt){const Pt=jt.x,gr=jt.y,oi=ie[0]*Pt+ie[4]*gr+ie[12],li=ie[1]*Pt+ie[5]*gr+ie[13],Qi=ie[2]*Pt+ie[6]*gr+ie[14],Ds=ie[3]*Pt+ie[7]*gr+ie[15],Kn=Qi+Oe,ji=Ds+dt,gn=oi+Et,kn=li+ut,Xn=Qi+st,Yn=Ds+et,en=new Ce((oi+ge)/ji,(li+ke)/ji);en.z=Kn/ji,it.push(en);const tn=new Ce(gn/Yn,kn/Yn);tn.z=Xn/Yn,Ze.push(tn)}fe.push(it),ne.push(Ze)}return[fe,ne]}(u,M,C,w);return function(V,W,J){let ie=1/0;Sc(J,W)&&(ie=Td(J,W[0]));for(let fe=0;fe<W.length;fe++){const ne=W[fe],ge=V[fe];for(let ke=0;ke<ne.length-1;ke++){const Oe=ne[ke],dt=[Oe,ne[ke+1],ge[ke+1],ge[ke],Oe];nl(J,dt)&&(ie=Math.min(ie,Td(J,dt)))}}return ie!==1/0&&ie}(N[0],N[1],R)}}function Zu(r,e){return r.x*e.x+r.y*e.y}function Td(r,e){if(r.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const m=e[i],g=r[0],_=u.sub(o),w=m.sub(o),k=g.sub(o),C=Zu(_,_),M=Zu(_,w),R=Zu(w,w),N=Zu(k,_),V=Zu(k,w),W=C*R-M*M,J=(R*N-M*V)/W,ie=(C*V-M*N)/W,fe=o.z*(1-J-ie)+u.z*J+m.z*ie;if(isFinite(fe))return fe}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Bc=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:bn}=Bc,sp=ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mt}=sp,Jl=ma.VectorTileFeature.types,Ah=Math.cos(Math.PI/180*37.5),zh=Math.pow(2,14)/.5;class Dh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new kt,this.layoutVertexArray2=new ht,this.indexArray=new Li,this.programConfigurations=new Gn(e.layers,e.zoom),this.segments=new Or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=wh("line",this.layers,i);const u=this.layers[0].layout.get("line-sort-key"),m=!u.isConstant(),g=[];for(const{feature:_,id:w,index:k,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,R=Ws(_,M);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),R,o))continue;const N=m?u.evaluate(R,{},o):void 0,V={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:k,geometry:M?R.geometry:Gs(_),patterns:{},sortKey:N};g.push(V)}m&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:k,sourceLayerIndex:C}=_;if(this.hasPattern){const M=xn("line",this.layers,_,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(_,w,k,o,{});i.featureIndex.insert(e[k].feature,w,k,C,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mt)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(e,{}),w=g.get("line-cap"),k=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of i)this.addLine(M,e,_,w,k,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,u)}addLine(e,i,o,u,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=Jl[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let k=0;for(;k<w-1&&e[k].equals(e[k+1]);)k++;if(w<(_?3:2))return;o==="bevel"&&(m=1.05);const C=this.overscaling<=16?15*wi/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,N,V,W,J;this.e1=this.e2=-1,_&&(R=e[w-2],J=e[k].sub(R)._unit()._perp());for(let ie=k;ie<w;ie++){if(V=ie===w-1?_?e[k+1]:void 0:e[ie+1],V&&e[ie].equals(V))continue;J&&(W=J),R&&(N=R),R=e[ie],J=V?V.sub(R)._unit()._perp():W,W=W||J;let fe=W.add(J);fe.x===0&&fe.y===0||fe._unit();const ne=W.x*J.x+W.y*J.y,ge=fe.x*J.x+fe.y*J.y,ke=ge!==0?1/ge:1/0,Oe=2*Math.sqrt(2-2*ge),dt=ge<Ah&&N&&V,Et=W.x*J.y-W.y*J.x>0;if(dt&&ie>k){const et=R.dist(N);if(et>2*C){const vt=R.sub(R.sub(N)._mult(C/et)._round());this.updateDistance(N,vt),this.addCurrentVertex(vt,W,0,0,M),N=vt}}const ut=N&&V;let st=ut?o:_?"butt":u;if(ut&&st==="round"&&(ke<g?st="miter":ke<=2&&(st="fakeround")),st==="miter"&&ke>m&&(st="bevel"),st==="bevel"&&(ke>2&&(st="flipbevel"),ke<m&&(st="miter")),N&&this.updateDistance(N,R),st==="miter")fe._mult(ke),this.addCurrentVertex(R,fe,0,0,M);else if(st==="flipbevel"){if(ke>100)fe=J.mult(-1);else{const et=ke*W.add(J).mag()/W.sub(J).mag();fe._perp()._mult(et*(Et?-1:1))}this.addCurrentVertex(R,fe,0,0,M),this.addCurrentVertex(R,fe.mult(-1),0,0,M)}else if(st==="bevel"||st==="fakeround"){const et=-Math.sqrt(ke*ke-1),vt=Et?et:0,it=Et?0:et;if(N&&this.addCurrentVertex(R,W,vt,it,M),st==="fakeround"){const Ze=Math.round(180*Oe/Math.PI/20);for(let jt=1;jt<Ze;jt++){let Pt=jt/Ze;if(Pt!==.5){const oi=Pt-.5;Pt+=Pt*oi*(Pt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*oi*oi+(.848013+ne*(.215638*ne-1.06021)))}const gr=J.sub(W)._mult(Pt)._add(W)._unit()._mult(Et?-1:1);this.addHalfVertex(R,gr.x,gr.y,!1,Et,0,M)}}V&&this.addCurrentVertex(R,J,-vt,-it,M)}else if(st==="butt")this.addCurrentVertex(R,fe,0,0,M);else if(st==="square"){const et=N?1:-1;this.addCurrentVertex(R,fe,et,et,M)}else st==="round"&&(N&&(this.addCurrentVertex(R,W,0,0,M),this.addCurrentVertex(R,W,1,1,M,!0)),V&&(this.addCurrentVertex(R,J,-1,-1,M,!0),this.addCurrentVertex(R,J,0,0,M)));if(dt&&ie<w-1){const et=R.dist(V);if(et>2*C){const vt=R.add(V.sub(R)._mult(C/et)._round());this.updateDistance(R,vt),this.addCurrentVertex(vt,J,0,0,M),R=vt}}}}addCurrentVertex(e,i,o,u,m,g=!1){const _=i.y*u-i.x,w=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,g,!1,o,m),this.addHalfVertex(e,_,w,g,!0,-u,m),this.distance>zh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,m,g))}addHalfVertex({x:e,y:i},o,u,m,g,_,w){const k=.5*(this.lineClips?this.scaledDistance*(zh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}let Ql,Gu;gt("LineBucket",Dh,{omit:["layers","patternFeatures"]});var Oc={get paint(){return Gu=Gu||new pi({"line-opacity":new qt(Te.paint_line["line-opacity"]),"line-color":new qt(Te.paint_line["line-color"]),"line-translate":new It(Te.paint_line["line-translate"]),"line-translate-anchor":new It(Te.paint_line["line-translate-anchor"]),"line-width":new qt(Te.paint_line["line-width"]),"line-gap-width":new qt(Te.paint_line["line-gap-width"]),"line-offset":new qt(Te.paint_line["line-offset"]),"line-blur":new qt(Te.paint_line["line-blur"]),"line-dasharray":new tl(Te.paint_line["line-dasharray"]),"line-pattern":new el(Te.paint_line["line-pattern"]),"line-gradient":new bs(Te.paint_line["line-gradient"])})},get layout(){return Ql=Ql||new pi({"line-cap":new It(Te.layout_line["line-cap"]),"line-join":new qt(Te.layout_line["line-join"]),"line-miter-limit":new It(Te.layout_line["line-miter-limit"]),"line-round-limit":new It(Te.layout_line["line-round-limit"]),"line-sort-key":new qt(Te.layout_line["line-sort-key"])})}};class Ed extends qt{possiblyEvaluate(e,i){return i=new Yr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=le({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let Wu;class Cd extends _i{constructor(e){super(e,Oc),this.gradientVersion=0,Wu||(Wu=new Ed(Oc.paint.properties["line-width"].specification),Wu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof jn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=Wu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Dh(e)}queryRadius(e){const i=e,o=Nc(ki("line-width",this,i),ki("line-gap-width",this,i)),u=ki("line-offset",this,i);return o/2+Math.abs(u)+Pi(this.paint.get("line-translate"))}queryIntersectsFeature(e,i,o,u,m,g,_){const w=sl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),k=_/2*Nc(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),C=this.paint.get("line-offset").evaluate(i,o);return C&&(u=function(M,R){const N=[];for(let V=0;V<M.length;V++){const W=M[V],J=[];for(let ie=0;ie<W.length;ie++){const fe=W[ie-1],ne=W[ie],ge=W[ie+1],ke=ie===0?new Ce(0,0):ne.sub(fe)._unit()._perp(),Oe=ie===W.length-1?new Ce(0,0):ge.sub(ne)._unit()._perp(),dt=ke._add(Oe)._unit(),Et=dt.x*Oe.x+dt.y*Oe.y;Et!==0&&dt._mult(1/Et),J.push(dt._mult(R)._add(ne))}N.push(J)}return N}(u,C*_)),function(M,R,N){for(let V=0;V<R.length;V++){const W=R[V];if(M.length>=3){for(let J=0;J<W.length;J++)if(Cs(M,W[J]))return!0}if(bi(M,W,N))return!0}return!1}(w,u,k)}isTileClipped(){return!0}}function Nc(r,e){return e>0?e+2*r:r}const Lh=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fn=ii([{name:"a_projected_pos",components:3,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ks=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ja=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Id=ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(r,e,i){return r.sections.forEach(o=>{o.text=function(u,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),Pn.applyArabicShaping&&(u=Pn.applyArabicShaping(u)),u}(o.text,e,i)}),r}ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ii([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const zn={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ci=24,Xs=Dr,Md=function(r,e,i,o,u){var m,g,_=8*u-o-1,w=(1<<_)-1,k=w>>1,C=-7,M=u-1,R=-1,N=r[e+M];for(M+=R,m=N&(1<<-C)-1,N>>=-C,C+=_;C>0;m=256*m+r[e+M],M+=R,C-=8);for(g=m&(1<<-C)-1,m>>=-C,C+=o;C>0;g=256*g+r[e+M],M+=R,C-=8);if(m===0)m=1-k;else{if(m===w)return g?NaN:1/0*(N?-1:1);g+=Math.pow(2,o),m-=k}return(N?-1:1)*g*Math.pow(2,m-o)},Rh=function(r,e,i,o,u,m){var g,_,w,k=8*m-u-1,C=(1<<k)-1,M=C>>1,R=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=0,V=1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,g=C):(g=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-g))<1&&(g--,w*=2),(e+=g+M>=1?R/w:R*Math.pow(2,1-M))*w>=2&&(g++,w/=2),g+M>=C?(_=0,g=C):g+M>=1?(_=(e*w-1)*Math.pow(2,u),g+=M):(_=e*Math.pow(2,M-1)*Math.pow(2,u),g=0));u>=8;r[i+N]=255&_,N+=V,_/=256,u-=8);for(g=g<<u|_,k+=u;k>0;r[i+N]=255&g,N+=V,g/=256,k-=8);r[i+N-V]|=128*W};function Dr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Dr.Varint=0,Dr.Fixed64=1,Dr.Bytes=2,Dr.Fixed32=5;var Vc=4294967296,Fh=1/Vc,Ad=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ms(r){return r.type===Dr.Bytes?r.readVarint()+r.pos:r.pos+1}function zo(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function os(r,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var u=i.pos-1;u>=r;u--)i.buf[u+o]=i.buf[u]}function Ar(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function an(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function Vi(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function mn(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function ls(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function eu(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function Yi(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function Hu(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function ll(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function ul(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Do(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function tu(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Dr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),u=o>>3,m=this.pos;this.type=7&o,r(u,e,this),this.pos===m&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=ul(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=tu(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=ul(this.buf,this.pos)+ul(this.buf,this.pos+4)*Vc;return this.pos+=8,r},readSFixed64:function(){var r=ul(this.buf,this.pos)+tu(this.buf,this.pos+4)*Vc;return this.pos+=8,r},readFloat:function(){var r=Md(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Md(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(u,m,g){var _,w,k=g.buf;if(_=(112&(w=k[g.pos++]))>>4,w<128||(_|=(127&(w=k[g.pos++]))<<3,w<128)||(_|=(127&(w=k[g.pos++]))<<10,w<128)||(_|=(127&(w=k[g.pos++]))<<17,w<128)||(_|=(127&(w=k[g.pos++]))<<24,w<128)||(_|=(1&(w=k[g.pos++]))<<31,w<128))return zo(u,_,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Ad?function(i,o,u){return Ad.decode(i.subarray(o,u))}(this.buf,e,r):function(i,o,u){for(var m="",g=o;g<u;){var _,w,k,C=i[g],M=null,R=C>239?4:C>223?3:C>191?2:1;if(g+R>u)break;R===1?C<128&&(M=C):R===2?(192&(_=i[g+1]))==128&&(M=(31&C)<<6|63&_)<=127&&(M=null):R===3?(w=i[g+2],(192&(_=i[g+1]))==128&&(192&w)==128&&((M=(15&C)<<12|(63&_)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):R===4&&(w=i[g+2],k=i[g+3],(192&(_=i[g+1]))==128&&(192&w)==128&&(192&k)==128&&((M=(15&C)<<18|(63&_)<<12|(63&w)<<6|63&k)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,R=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),g+=R}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Dr.Bytes)return r.push(this.readVarint(e));var i=Ms(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Dr.Bytes)return r.push(this.readSVarint());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Dr.Bytes)return r.push(this.readBoolean());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Dr.Bytes)return r.push(this.readFloat());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Dr.Bytes)return r.push(this.readDouble());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Dr.Bytes)return r.push(this.readFixed32());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Dr.Bytes)return r.push(this.readSFixed32());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Dr.Bytes)return r.push(this.readFixed64());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Dr.Bytes)return r.push(this.readSFixed64());var e=Ms(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Dr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Dr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Dr.Fixed32)this.pos+=4;else{if(e!==Dr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Do(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Do(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Do(this.buf,-1&r,this.pos),Do(this.buf,Math.floor(r*Fh),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Do(this.buf,-1&r,this.pos),Do(this.buf,Math.floor(r*Fh),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var o,u;if(e>=0?(o=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)}(o,0,i),function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(u,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,u,m){for(var g,_,w=0;w<u.length;w++){if((g=u.charCodeAt(w))>55295&&g<57344){if(!_){g>56319||w+1===u.length?(o[m++]=239,o[m++]=191,o[m++]=189):_=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(o[m++]=239,o[m++]=191,o[m++]=189,_=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&os(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Rh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Rh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var o=this.pos-i;o>=128&&os(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,i){this.writeTag(r,Dr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Ar,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,an,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,ls,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Vi,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,mn,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,eu,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Yi,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Hu,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,ll,e)},writeBytesField:function(r,e){this.writeTag(r,Dr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Dr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Dr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Dr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Dr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Dr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Dr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Dr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Dr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Dr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Sn=$(Xs);const Ku=3;function ru(r,e,i){r===1&&i.readMessage(Ua,e)}function Ua(r,e,i){if(r===3){const{id:o,bitmap:u,width:m,height:g,left:_,top:w,advance:k}=i.readMessage(jc,{});e.push({id:o,bitmap:new Gl({width:m+2*Ku,height:g+2*Ku},u),metrics:{width:m,height:g,left:_,top:w,advance:k}})}}function jc(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const Bh=Ku;function $a(r){let e=0,i=0;for(const g of r)e+=g.w*g.h,i=Math.max(i,g.w);r.sort((g,_)=>_.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,m=0;for(const g of r)for(let _=o.length-1;_>=0;_--){const w=o[_];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,m=Math.max(m,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===w.w&&g.h===w.h){const k=o.pop();_<o.length&&(o[_]=k)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(o.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:u,h:m,fill:e/(u*m)||0}}const on=1;class ga{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=m,this.content=g,this.version=o}get tl(){return[this.paddedRect.x+on,this.paddedRect.y+on]}get br(){return[this.paddedRect.x+this.paddedRect.w-on,this.paddedRect.y+this.paddedRect.h-on]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*on)/this.pixelRatio,(this.paddedRect.h-2*on)/this.pixelRatio]}}class Xu{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(i,u,m);const{w:g,h:_}=$a(m),w=new Hn({width:g||1,height:_||1});for(const k in e){const C=e[k],M=o[k].paddedRect;Hn.copy(C.data,w,{x:0,y:0},{x:M.x+on,y:M.y+on},C.data)}for(const k in i){const C=i[k],M=u[k].paddedRect,R=M.x+on,N=M.y+on,V=C.data.width,W=C.data.height;Hn.copy(C.data,w,{x:0,y:0},{x:R,y:N},C.data),Hn.copy(C.data,w,{x:0,y:W-1},{x:R,y:N-1},{width:V,height:1}),Hn.copy(C.data,w,{x:0,y:0},{x:R,y:N+W},{width:V,height:1}),Hn.copy(C.data,w,{x:V-1,y:0},{x:R-1,y:N},{width:1,height:W}),Hn.copy(C.data,w,{x:0,y:0},{x:R+V,y:N},{width:1,height:W})}this.image=w,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const m=e[u],g={x:0,y:0,w:m.data.width+2*on,h:m.data.height+2*on};o.push(g),i[u]=new ga(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,m]=e.tl;o.update(i.data,void 0,{x:u,y:m})}}var As;gt("ImagePosition",ga),gt("ImageAtlas",Xu),c.ai=void 0,(As=c.ai||(c.ai={}))[As.none=0]="none",As[As.horizontal=1]="horizontal",As[As.vertical=2]="vertical",As[As.horizontalOnly=3]="horizontalOnly";const cl=-17;class Lo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Lo;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Lo;return i.imageName=e,i}}class qa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new qa;for(let u=0;u<e.sections.length;u++){const m=e.sections[u];m.image?o.addImageSection(m):o.addTextSection(m,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let i="";for(let o=0;o<e.length;o++){const u=e.charCodeAt(o+1)||null,m=e.charCodeAt(o-1)||null;i+=u&&xc(u)&&!zn[e[o+1]]||m&&xc(m)&&!zn[e[o-1]]||!zn[e[o]]?e[o]:zn[e[o]]}return i}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Ys[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Ys[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new qa;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Lo.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Wt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Lo.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ln(r,e,i,o,u,m,g,_,w,k,C,M,R,N,V,W){const J=qa.fromFeature(r,u);let ie;M===c.ai.vertical&&J.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:ne}=Pn;if(fe&&J.sections.length===1){ie=[];const Oe=fe(J.toString(),ya(J,k,m,e,o,N,V));for(const dt of Oe){const Et=new qa;Et.text=dt,Et.sections=J.sections;for(let ut=0;ut<dt.length;ut++)Et.sectionIndex.push(0);ie.push(Et)}}else if(ne){ie=[];const Oe=ne(J.text,J.sectionIndex,ya(J,k,m,e,o,N,V));for(const dt of Oe){const Et=new qa;Et.text=dt[0],Et.sectionIndex=dt[1],Et.sections=J.sections,ie.push(Et)}}else ie=function(Oe,dt){const Et=[],ut=Oe.text;let st=0;for(const et of dt)Et.push(Oe.substring(st,et)),st=et;return st<ut.length&&Et.push(Oe.substring(st,ut.length)),Et}(J,ya(J,k,m,e,o,N,V));const ge=[],ke={positionedLines:ge,text:J.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(Oe,dt,Et,ut,st,et,vt,it,Ze,jt,Pt,gr){let oi=0,li=cl,Qi=0,Ds=0;const Kn=it==="right"?1:it==="left"?0:.5;let ji=0;for(const en of st){en.trim();const tn=en.getMaxScale(),Ln=(tn-1)*Ci,Jn={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[ji]=Jn;const Rn=Jn.positionedGlyphs;let hs=0;if(!en.length()){li+=et,++ji;continue}for(let rn=0;rn<en.length();rn++){const _r=en.getSection(rn),Fn=en.getSectionIndex(rn),Tn=en.getCharCode(rn);let nn=0,_a=null,Ha=null,Ka=null,ml=Ci;const va=!(Ze===c.ai.horizontal||!Pt&&!Mu(Tn)||Pt&&(Ys[Tn]||(gn=Tn,lt.Arabic(gn)||lt["Arabic Supplement"](gn)||lt["Arabic Extended-A"](gn)||lt["Arabic Presentation Forms-A"](gn)||lt["Arabic Presentation Forms-B"](gn))));if(_r.imageName){const ra=ut[_r.imageName];if(!ra)continue;Ka=_r.imageName,Oe.iconsInText=Oe.iconsInText||!0,Ha=ra.paddedRect;const ps=ra.displaySize;_r.scale=_r.scale*Ci/gr,_a={width:ps[0],height:ps[1],left:on,top:-3,advance:va?ps[1]:ps[0]},nn=Ln+(Ci-ps[1]*_r.scale),ml=_a.advance;const gl=va?ps[0]*_r.scale-Ci*tn:ps[1]*_r.scale-Ci*tn;gl>0&&gl>hs&&(hs=gl)}else{const ra=Et[_r.fontStack],ps=ra&&ra[Tn];if(ps&&ps.rect)Ha=ps.rect,_a=ps.metrics;else{const gl=dt[_r.fontStack],Kh=gl&&gl[Tn];if(!Kh)continue;_a=Kh.metrics}nn=(tn-_r.scale)*Ci}va?(Oe.verticalizable=!0,Rn.push({glyph:Tn,imageName:Ka,x:oi,y:li+nn,vertical:va,scale:_r.scale,fontStack:_r.fontStack,sectionIndex:Fn,metrics:_a,rect:Ha}),oi+=ml*_r.scale+jt):(Rn.push({glyph:Tn,imageName:Ka,x:oi,y:li+nn,vertical:va,scale:_r.scale,fontStack:_r.fontStack,sectionIndex:Fn,metrics:_a,rect:Ha}),oi+=_a.advance*_r.scale+jt)}Rn.length!==0&&(Qi=Math.max(oi-jt,Qi),Vh(Rn,0,Rn.length-1,Kn,hs)),oi=0;const ds=et*tn+hs;Jn.lineOffset=Math.max(hs,Ln),li+=ds,Ds=Math.max(ds,Ds),++ji}var gn;const kn=li-cl,{horizontalAlign:Xn,verticalAlign:Yn}=$c(vt);(function(en,tn,Ln,Jn,Rn,hs,ds,rn,_r){const Fn=(tn-Ln)*Rn;let Tn=0;Tn=hs!==ds?-rn*Jn-cl:(-Jn*_r+.5)*ds;for(const nn of en)for(const _a of nn.positionedGlyphs)_a.x+=Fn,_a.y+=Tn})(Oe.positionedLines,Kn,Xn,Yn,Qi,Ds,et,kn,st.length),Oe.top+=-Yn*kn,Oe.bottom=Oe.top+kn,Oe.left+=-Xn*Qi,Oe.right=Oe.left+Qi}(ke,e,i,o,ie,g,_,w,M,k,R,W),!function(Oe){for(const dt of Oe)if(dt.positionedGlyphs.length!==0)return!1;return!0}(ge)&&ke}const Ys={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Js={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dn(r,e,i,o,u,m){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*Ci/m+u:0}{const g=i[e.fontStack],_=g&&g[r];return _?_.metrics.advance*e.scale+u:0}}function Oh(r,e,i,o){const u=Math.pow(r-e,2);return o?r<e?u/2:2*u:u+Math.abs(i)*i}function Nh(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Uc(r,e,i,o,u,m){let g=null,_=Oh(e,i,u,m);for(const w of o){const k=Oh(e-w.x,i,u,m)+w.badness;k<=_&&(g=w,_=k)}return{index:r,x:e,priorBreak:g,badness:_}}function zd(r){return r?zd(r.priorBreak).concat(r.index):[]}function ya(r,e,i,o,u,m,g){if(m!=="point")return[];if(!r)return[];const _=[],w=function(R,N,V,W,J,ie){let fe=0;for(let ne=0;ne<R.length();ne++){const ge=R.getSection(ne);fe+=Dn(R.getCharCode(ne),ge,W,J,N,ie)}return fe/Math.max(1,Math.ceil(fe/V))}(r,e,i,o,u,g),k=r.text.indexOf("")>=0;let C=0;for(let R=0;R<r.length();R++){const N=r.getSection(R),V=r.getCharCode(R);if(Ys[V]||(C+=Dn(V,N,o,u,e,g)),R<r.length()-1){const W=!((M=V)<11904||!(lt["Bopomofo Extended"](M)||lt.Bopomofo(M)||lt["CJK Compatibility Forms"](M)||lt["CJK Compatibility Ideographs"](M)||lt["CJK Compatibility"](M)||lt["CJK Radicals Supplement"](M)||lt["CJK Strokes"](M)||lt["CJK Symbols and Punctuation"](M)||lt["CJK Unified Ideographs Extension A"](M)||lt["CJK Unified Ideographs"](M)||lt["Enclosed CJK Letters and Months"](M)||lt["Halfwidth and Fullwidth Forms"](M)||lt.Hiragana(M)||lt["Ideographic Description Characters"](M)||lt["Kangxi Radicals"](M)||lt["Katakana Phonetic Extensions"](M)||lt.Katakana(M)||lt["Vertical Forms"](M)||lt["Yi Radicals"](M)||lt["Yi Syllables"](M)));(Js[V]||W||N.imageName)&&_.push(Uc(R+1,C,w,_,Nh(V,r.getCharCode(R+1),W&&k),!1))}}var M;return zd(Uc(r.length(),C,w,_,0,!0))}function $c(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Vh(r,e,i,o,u){if(!o&&!u)return;const m=r[i],g=(r[i].x+m.metrics.advance*m.scale)*o;for(let _=e;_<=i;_++)r[_].x-=g,r[_].y+=u}function hl(r,e,i){const{horizontalAlign:o,verticalAlign:u}=$c(i),m=e[0]-r.displaySize[0]*o,g=e[1]-r.displaySize[1]*u;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function qc(r,e,i,o,u,m){const g=r.image;let _;if(g.content){const J=g.content,ie=g.pixelRatio||1;_=[J[0]/ie,J[1]/ie,g.displaySize[0]-J[2]/ie,g.displaySize[1]-J[3]/ie]}const w=e.left*m,k=e.right*m;let C,M,R,N;i==="width"||i==="both"?(N=u[0]+w-o[3],M=u[0]+k+o[1]):(N=u[0]+(w+k-g.displaySize[0])/2,M=N+g.displaySize[0]);const V=e.top*m,W=e.bottom*m;return i==="height"||i==="both"?(C=u[1]+V-o[0],R=u[1]+W+o[2]):(C=u[1]+(V+W-g.displaySize[1])/2,R=C+g.displaySize[1]),{image:g,top:C,right:M,bottom:R,left:N,collisionPadding:_}}const Qs=255,ea=128,Za=Qs*ea;function Zc(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Yr(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const _=o[m],w=o[g];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:w,minSize:i.evaluate(new Yr(_)),maxSize:i.evaluate(new Yr(w)),interpolationType:u}}}function iu(r,e,i){let o="never";const u=r.get(e);return u?o=u:r.get(i)&&(o="always"),o}const ap=ma.VectorTileFeature.types,op=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yu(r,e,i,o,u,m,g,_,w,k,C,M,R){const N=_?Math.min(Za,Math.round(_[0])):0,V=_?Math.min(Za,Math.round(_[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),m,g,(N<<1)+(w?1:0),V,16*k,16*C,256*M,256*R)}function Gc(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function dl(r){for(const e of r.sections)if(bc(e.text))return!0;return!1}class jh{constructor(e){this.layoutVertexArray=new er,this.indexArray=new Li,this.programConfigurations=e,this.segments=new Or,this.dynamicLayoutVertexArray=new ar,this.opacityVertexArray=new hr,this.hasVisibleVertices=!1,this.placedSymbolArray=new oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,fn.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,op,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}gt("SymbolBuffers",jh);class Ro{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Or,this.collisionVertexArray=new Rr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ks.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}gt("CollisionBuffers",Ro);class pl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ou([]),this.placementViewportMatrix=Ou([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zc(this.zoom,i["text-size"]),this.iconSizeData=Zc(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=iu(o,"text-overlap","text-allow-overlap")!=="never"||iu(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>c.ai[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new jh(new Gn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new jh(new Gn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new he,this.lineVertexArray=new be,this.symbolInstances=new ee,this.textAnchorOffsets=new De}calculateGlyphDependencies(e,i,o,u,m){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,(o||u)&&m){const _=zn[e.charAt(g)];_&&(i[_.charCodeAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],m=u.layout,g=m.get("text-font"),_=m.get("text-field"),w=m.get("icon-image"),k=(_.value.kind!=="constant"||_.value.value instanceof Ii&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,M=m.get("symbol-sort-key");if(this.features=[],!k&&!C)return;const R=i.iconDependencies,N=i.glyphDependencies,V=i.availableImages,W=new Yr(this.zoom);for(const{feature:J,id:ie,index:fe,sourceLayerIndex:ne}of e){const ge=u._featureFilter.needGeometry,ke=Ws(J,ge);if(!u._featureFilter.filter(W,ke,o))continue;let Oe,dt;if(ge||(ke.geometry=Gs(J)),k){const ut=u.getValueAndResolveTokens("text-field",ke,o,V),st=Ii.factory(ut);dl(st)&&(this.hasRTLText=!0),(!this.hasRTLText||ca()==="unavailable"||this.hasRTLText&&Pn.isParsed())&&(Oe=Pd(st,u,ke))}if(C){const ut=u.getValueAndResolveTokens("icon-image",ke,o,V);dt=ut instanceof Wi?ut:Wi.fromString(ut)}if(!Oe&&!dt)continue;const Et=this.sortFeaturesByKey?M.evaluate(ke,{},o):void 0;if(this.features.push({id:ie,text:Oe,icon:dt,index:fe,sourceLayerIndex:ne,geometry:ke.geometry,properties:J.properties,type:ap[J.type],sortKey:Et}),dt&&(R[dt.name]=!0),Oe){const ut=g.evaluate(ke,{},o).join(","),st=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ai.vertical)>=0;for(const et of Oe.sections)if(et.image)R[et.image.name]=!0;else{const vt=ws(Oe.toString()),it=et.fontStack||ut,Ze=N[it]=N[it]||{};this.calculateGlyphDependencies(et.text,Ze,st,this.allowVerticalPlacement,vt)}}}m.get("symbol-placement")==="line"&&(this.features=function(J){const ie={},fe={},ne=[];let ge=0;function ke(ut){ne.push(J[ut]),ge++}function Oe(ut,st,et){const vt=fe[ut];return delete fe[ut],fe[st]=vt,ne[vt].geometry[0].pop(),ne[vt].geometry[0]=ne[vt].geometry[0].concat(et[0]),vt}function dt(ut,st,et){const vt=ie[st];return delete ie[st],ie[ut]=vt,ne[vt].geometry[0].shift(),ne[vt].geometry[0]=et[0].concat(ne[vt].geometry[0]),vt}function Et(ut,st,et){const vt=et?st[0][st[0].length-1]:st[0][0];return`${ut}:${vt.x}:${vt.y}`}for(let ut=0;ut<J.length;ut++){const st=J[ut],et=st.geometry,vt=st.text?st.text.toString():null;if(!vt){ke(ut);continue}const it=Et(vt,et),Ze=Et(vt,et,!0);if(it in fe&&Ze in ie&&fe[it]!==ie[Ze]){const jt=dt(it,Ze,et),Pt=Oe(it,Ze,ne[jt].geometry);delete ie[it],delete fe[Ze],fe[Et(vt,ne[Pt].geometry,!0)]=Pt,ne[jt].geometry=null}else it in fe?Oe(it,Ze,et):Ze in ie?dt(it,Ze,et):(ke(ut),ie[it]=ge-1,fe[Ze]=ge-1)}return ne.filter(ut=>ut.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),m=e.dist(i[e.segment]);const g={};for(let _=e.segment+1;_<i.length;_++)g[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:u},_<i.length-1&&(u+=i[_+1].dist(i[_]));for(let _=e.segment||0;_>=0;_--)g[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=i[_-1].dist(i[_]));for(let _=0;_<i.length;_++){const w=g[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,m,g,_,w,k,C,M,R){const N=e.indexArray,V=e.layoutVertexArray,W=e.segments.prepareSegment(4*i.length,V,N,this.canOverlap?g.sortKey:void 0),J=this.glyphOffsetArray.length,ie=W.vertexLength,fe=this.allowVerticalPlacement&&_===c.ai.vertical?Math.PI/2:0,ne=g.text&&g.text.sections;for(let ge=0;ge<i.length;ge++){const{tl:ke,tr:Oe,bl:dt,br:Et,tex:ut,pixelOffsetTL:st,pixelOffsetBR:et,minFontScaleX:vt,minFontScaleY:it,glyphOffset:Ze,isSDF:jt,sectionIndex:Pt}=i[ge],gr=W.vertexLength,oi=Ze[1];Yu(V,w.x,w.y,ke.x,oi+ke.y,ut.x,ut.y,o,jt,st.x,st.y,vt,it),Yu(V,w.x,w.y,Oe.x,oi+Oe.y,ut.x+ut.w,ut.y,o,jt,et.x,st.y,vt,it),Yu(V,w.x,w.y,dt.x,oi+dt.y,ut.x,ut.y+ut.h,o,jt,st.x,et.y,vt,it),Yu(V,w.x,w.y,Et.x,oi+Et.y,ut.x+ut.w,ut.y+ut.h,o,jt,et.x,et.y,vt,it),Gc(e.dynamicLayoutVertexArray,w,fe),N.emplaceBack(gr,gr+1,gr+2),N.emplaceBack(gr+1,gr+2,gr+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ze[0]),ge!==i.length-1&&Pt===i[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,g,g.index,{},R,ne&&ne[Pt])}e.placedSymbolArray.emplaceBack(w.x,w.y,J,this.glyphOffsetArray.length-J,ie,k,C,w.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,M)}_addCollisionDebugVertex(e,i,o,u,m,g){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,i,o,u,m,g,_){const w=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=w.vertexLength,C=m.layoutVertexArray,M=m.collisionVertexArray,R=_.anchorX,N=_.anchorY;this._addCollisionDebugVertex(C,M,g,R,N,new Ce(e,i)),this._addCollisionDebugVertex(C,M,g,R,N,new Ce(o,i)),this._addCollisionDebugVertex(C,M,g,R,N,new Ce(o,u)),this._addCollisionDebugVertex(C,M,g,R,N,new Ce(e,u)),w.vertexLength+=4;const V=m.indexArray;V.emplaceBack(k,k+1),V.emplaceBack(k+1,k+2),V.emplaceBack(k+2,k+3),V.emplaceBack(k+3,k),w.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let m=e;m<i;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,u?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ro(ni,ja.members,fi),this.iconCollisionBox=new Ro(ni,ja.members,fi);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,m,g,_,w,k){const C={};for(let M=i;M<o;M++){const R=e.get(M);C.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.textFeatureIndex=R.featureIndex;break}for(let M=u;M<m;M++){const R=e.get(M);C.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalTextFeatureIndex=R.featureIndex;break}for(let M=g;M<_;M++){const R=e.get(M);C.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.iconFeatureIndex=R.featureIndex;break}for(let M=w;M<k;M++){const R=e.get(M);C.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalIconFeatureIndex=R.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<u;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const w=this.symbolInstances.get(_);u.push(0|Math.round(i*w.anchorX+o*w.anchorY)),m.push(w.featureIndex)}return g.sort((_,w)=>u[_]-u[w]||m[w]-m[_]),g}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,m,g)=>{u>=0&&g.indexOf(u)===m&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ei,Dd;gt("SymbolBucket",pl,{omit:["layers","collisionBoxArray","features","compareText"]}),pl.MAX_GLYPHS=65535,pl.addDynamicAttributes=Gc;var Wc={get paint(){return Dd=Dd||new pi({"icon-opacity":new qt(Te.paint_symbol["icon-opacity"]),"icon-color":new qt(Te.paint_symbol["icon-color"]),"icon-halo-color":new qt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new It(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt(Te.paint_symbol["text-opacity"]),"text-color":new qt(Te.paint_symbol["text-color"],{runtimeType:qi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new qt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new qt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new qt(Te.paint_symbol["text-halo-blur"]),"text-translate":new It(Te.paint_symbol["text-translate"]),"text-translate-anchor":new It(Te.paint_symbol["text-translate-anchor"])})},get layout(){return Ei=Ei||new pi({"symbol-placement":new It(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new It(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new It(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new It(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new It(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt(Te.layout_symbol["icon-size"]),"icon-text-fit":new It(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt(Te.layout_symbol["icon-image"]),"icon-rotate":new qt(Te.layout_symbol["icon-rotate"]),"icon-padding":new qt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new It(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new qt(Te.layout_symbol["icon-offset"]),"icon-anchor":new qt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(Te.layout_symbol["text-rotation-alignment"]),"text-field":new qt(Te.layout_symbol["text-field"]),"text-font":new qt(Te.layout_symbol["text-font"]),"text-size":new qt(Te.layout_symbol["text-size"]),"text-max-width":new qt(Te.layout_symbol["text-max-width"]),"text-line-height":new It(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new qt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new qt(Te.layout_symbol["text-justify"]),"text-radial-offset":new qt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt(Te.layout_symbol["text-anchor"]),"text-max-angle":new It(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new It(Te.layout_symbol["text-writing-mode"]),"text-rotate":new qt(Te.layout_symbol["text-rotate"]),"text-padding":new It(Te.layout_symbol["text-padding"]),"text-keep-upright":new It(Te.layout_symbol["text-keep-upright"]),"text-transform":new qt(Te.layout_symbol["text-transform"]),"text-offset":new qt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new It(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new It(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new It(Te.layout_symbol["text-ignore-placement"]),"text-optional":new It(Te.layout_symbol["text-optional"])})}};class Ld{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:es,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gt("FormatSectionOverride",Ld,{omit:["defaultValue"]});class Hc extends _i{constructor(e){super(e,Wc)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const m of o)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const m=this.layout.get(e).evaluate(i,{},o,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Ll(g.value)||!m?m:function(_,w){return w.replace(/{([^{}]+)}/g,(k,C)=>_&&C in _?String(_[C]):"")}(i.properties,m)}createBucket(e){return new pl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Wc.paint.overridableProperties){if(!Hc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Ld(i),u=new xu(o,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new wu("source",u):new Fl("composite",u,i.value.zoomStops),this.paint._values[e]=new Xi(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Hc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=Wc.paint.properties[i];let m=!1;const g=_=>{for(const w of _)if(u.overrides&&u.overrides.hasOverride(w))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ii)g(o.value.value.sections);else if(o.value.kind==="source"){const _=k=>{m||(k instanceof ts&&Ur(k.value)===H?g(k.value.sections):k instanceof Ca?g(k.sections):k.eachChild(_))},w=o.value;w._styleExpression&&_(w._styleExpression.expression)}return m}}let Uh;var Rd={get paint(){return Uh=Uh||new pi({"background-color":new It(Te.paint_background["background-color"]),"background-pattern":new tl(Te.paint_background["background-pattern"]),"background-opacity":new It(Te.paint_background["background-opacity"])})}};class lp extends _i{constructor(e){super(e,Rd)}}let us;var $h={get paint(){return us=us||new pi({"raster-opacity":new It(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new It(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new It(Te.paint_raster["raster-saturation"]),"raster-contrast":new It(Te.paint_raster["raster-contrast"]),"raster-resampling":new It(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new It(Te.paint_raster["raster-fade-duration"])})}};class up extends _i{constructor(e){super(e,$h)}}class Fo extends _i{constructor(e){super(e,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Kc{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Ga=63710088e-1;class ta{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ta(ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,m=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return Ga*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof ta)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ta(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ta(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Xc=2*Math.PI*Ga;function Yc(r){return Xc*Math.cos(r*Math.PI/180)}function Fd(r){return(180+r)/360}function Jc(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Bd(r,e){return r/Yc(e)}function qh(r){return 360*r-180}function Qc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class fl{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=ta.convert(e);return new fl(Fd(o.lng),Jc(o.lat),Bd(i,o.lat))}toLngLat(){return new ta(qh(this.x),Qc(this.y))}toAltitude(){return this.z*Yc(Qc(this.y))}meterInMercatorCoordinateUnits(){return 1/Xc*(e=Qc(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ju(r,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class eh{constructor(e,i,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||i<0||i>=Math.pow(2,e))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=nu(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(g=this.y,_=this.z,w=Ju(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),k=Ju(256*(m+1),256*(g+1),_),w[0]+","+w[1]+","+k[0]+","+k[1]);var m,g,_,w,k;const C=function(M,R,N){let V,W="";for(let J=M;J>0;J--)V=1<<J-1,W+=(R&V?1:0)+(N&V?2:0);return W}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new Ce((e.x*i-this.x)*wi,(e.y*i-this.y)*wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class th{constructor(e,i){this.wrap=e,this.canonical=i,this.key=nu(e,i.z,i.z,i.x,i.y)}}class cs{constructor(e,i,o,u,m){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new eh(o,+u,+m),this.key=nu(i,e,o,u,m)}clone(){return new cs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new cs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?nu(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):nu(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new cs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new cs(i,this.wrap,i,o,u),new cs(i,this.wrap,i,o+1,u),new cs(i,this.wrap,i,o,u+1),new cs(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new cs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new cs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new th(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new fl(e.x-this.wrap,e.y))}}function nu(r,e,i,o,u){(r*=2)<0&&(r=-1*r-1);const m=1<<i;return(m*m*r+m*u+o).toString(36)+i.toString(36)+e.toString(36)}gt("CanonicalTileID",eh),gt("OverscaledTileID",cs,{omit:["posMatrix"]});class rh{constructor(e,i,o,u=1,m=1,g=1,_=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Wt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const w=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<w;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(w,k)]=this.data[this._idx(w-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,w)]=this.data[this._idx(k,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<w;k++)for(let C=0;C<w;C++){const M=this.get(k,C);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Hn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,m=i*this.dim+this.dim,g=o*this.dim,_=o*this.dim+this.dim;switch(i){case-1:u=m-1;break;case 1:m=u+1}switch(o){case-1:g=_-1;break;case 1:_=g+1}const w=-i*this.dim,k=-o*this.dim;for(let C=g;C<_;C++)for(let M=u;M<m;M++)this.data[this._idx(M,C)]=e.data[this._idx(M+w,C+k)]}}gt("DEMData",rh);class Qu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class ih{constructor(e,i,o,u,m){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=o,e._y=u,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}class ec{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new La(wi,16,0),this.grid3D=new La(wi,16,0),this.featureIndexArray=new Fe,this.promoteId=i}insert(e,i,o,u,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,m);const w=g?this.grid3D:this.grid;for(let k=0;k<i.length;k++){const C=i[k],M=[1/0,1/0,-1/0,-1/0];for(let R=0;R<C.length;R++){const N=C[R];M[0]=Math.min(M[0],N.x),M[1]=Math.min(M[1],N.y),M[2]=Math.max(M[2],N.x),M[3]=Math.max(M[3],N.y)}M[0]<wi&&M[1]<wi&&M[2]>=0&&M[3]>=0&&w.insert(_,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ma.VectorTile(new Sn(this.rawTileData)).layers,this.sourceLayerCoder=new Qu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const m=e.params||{},g=wi/e.tileSize/e.scale,_=Bl(m.filter),w=e.queryGeometry,k=e.queryPadding*g,C=Od(w),M=this.grid.query(C.minX-k,C.minY-k,C.maxX+k,C.maxY+k),R=Od(e.cameraQueryGeometry),N=this.grid3D.query(R.minX-k,R.minY-k,R.maxX+k,R.maxY+k,(J,ie,fe,ne)=>function(ge,ke,Oe,dt,Et){for(const st of ge)if(ke<=st.x&&Oe<=st.y&&dt>=st.x&&Et>=st.y)return!0;const ut=[new Ce(ke,Oe),new Ce(ke,Et),new Ce(dt,Et),new Ce(dt,Oe)];if(ge.length>2){for(const st of ut)if(Cs(ge,st))return!0}for(let st=0;st<ge.length-1;st++)if(Si(ge[st],ge[st+1],ut))return!0;return!1}(e.cameraQueryGeometry,J-k,ie-k,fe+k,ne+k));for(const J of N)M.push(J);M.sort(nh);const V={};let W;for(let J=0;J<M.length;J++){const ie=M[J];if(ie===W)continue;W=ie;const fe=this.featureIndexArray.get(ie);let ne=null;this.loadMatchingFeature(V,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,_,m.layers,m.availableImages,i,o,u,(ge,ke,Oe)=>(ne||(ne=Gs(ge)),ke.queryIntersectsFeature(w,ge,Oe,ne,this.z,e.transform,g,e.pixelPosMatrix)))}return V}loadMatchingFeature(e,i,o,u,m,g,_,w,k,C,M){const R=this.bucketLayerIDs[i];if(g&&!function(J,ie){for(let fe=0;fe<J.length;fe++)if(ie.indexOf(J[fe])>=0)return!0;return!1}(g,R))return;const N=this.sourceLayerCoder.decode(o),V=this.vtLayers[N].feature(u);if(m.needGeometry){const J=Ws(V,!0);if(!m.filter(new Yr(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!m.filter(new Yr(this.tileID.overscaledZ),V))return;const W=this.getId(V,N);for(let J=0;J<R.length;J++){const ie=R[J];if(g&&g.indexOf(ie)<0)continue;const fe=w[ie];if(!fe)continue;let ne={};W&&C&&(ne=C.getState(fe.sourceLayer||"_geojsonTileLayer",W));const ge=le({},k[ie]);ge.paint=Zh(ge.paint,fe.paint,V,ne,_),ge.layout=Zh(ge.layout,fe.layout,V,ne,_);const ke=!M||M(V,fe,ne);if(!ke)continue;const Oe=new ih(V,this.z,this.x,this.y,W);Oe.layer=ge;let dt=e[ie];dt===void 0&&(dt=e[ie]=[]),dt.push({featureIndex:u,feature:Oe,intersectionZ:ke})}}lookupSymbolFeatures(e,i,o,u,m,g,_,w){const k={};this.loadVTLayers();const C=Bl(m);for(const M of e)this.loadMatchingFeature(k,o,u,M,C,g,_,w,i);return k}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof o=="boolean"&&(o=Number(o))),o}}function Zh(r,e,i,o,u){return Ae(r,(m,g)=>{const _=e instanceof jl?e.get(g):null;return _&&_.evaluate?_.evaluate(i,o,u):_})}function Od(r){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),o=Math.max(o,m.x),u=Math.max(u,m.y);return{minX:e,minY:i,maxX:o,maxY:u}}function nh(r,e){return e-r}function Nd(r,e,i,o,u){const m=[];for(let g=0;g<r.length;g++){const _=r[g];let w;for(let k=0;k<_.length-1;k++){let C=_[k],M=_[k+1];C.x<e&&M.x<e||(C.x<e?C=new Ce(e,C.y+(e-C.x)/(M.x-C.x)*(M.y-C.y))._round():M.x<e&&(M=new Ce(e,C.y+(e-C.x)/(M.x-C.x)*(M.y-C.y))._round()),C.y<i&&M.y<i||(C.y<i?C=new Ce(C.x+(i-C.y)/(M.y-C.y)*(M.x-C.x),i)._round():M.y<i&&(M=new Ce(C.x+(i-C.y)/(M.y-C.y)*(M.x-C.x),i)._round()),C.x>=o&&M.x>=o||(C.x>=o?C=new Ce(o,C.y+(o-C.x)/(M.x-C.x)*(M.y-C.y))._round():M.x>=o&&(M=new Ce(o,C.y+(o-C.x)/(M.x-C.x)*(M.y-C.y))._round()),C.y>=u&&M.y>=u||(C.y>=u?C=new Ce(C.x+(u-C.y)/(M.y-C.y)*(M.x-C.x),u)._round():M.y>=u&&(M=new Ce(C.x+(u-C.y)/(M.y-C.y)*(M.x-C.x),u)._round()),w&&C.equals(w[w.length-1])||(w=[C],m.push(w)),w.push(M)))))}}return m}gt("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});class zs extends Ce{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new zs(this.x,this.y,this.angle,this.segment)}}function Vd(r,e,i,o,u){if(e.segment===void 0||i===0)return!0;let m=e,g=e.segment+1,_=0;for(;_>-i/2;){if(g--,g<0)return!1;_-=r[g].dist(m),m=r[g]}_+=r[g].dist(r[g+1]),g++;const w=[];let k=0;for(;_<i/2;){const C=r[g],M=r[g+1];if(!M)return!1;let R=r[g-1].angleTo(C)-C.angleTo(M);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:R}),k+=R;_-w[0].distance>o;)k-=w.shift().angleDelta;if(k>u)return!1;g++,_+=C.dist(M)}return!0}function tc(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function n(r,e,i){return r?.6*e*i:0}function a(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function d(r,e,i,o,u,m){const g=n(i,u,m),_=a(i,o)*m;let w=0;const k=tc(r)/2;for(let C=0;C<r.length-1;C++){const M=r[C],R=r[C+1],N=M.dist(R);if(w+N>k){const V=(k-w)/N,W=En.number(M.x,R.x,V),J=En.number(M.y,R.y,V),ie=new zs(W,J,R.angleTo(M),C);return ie._round(),!g||Vd(r,ie,_,g,e)?ie:void 0}w+=N}}function y(r,e,i,o,u,m,g,_,w){const k=n(o,m,g),C=a(o,u),M=C*g,R=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return e-M<e/4&&(e=M+e/4),b(r,R?e/2*_%e:(C/2+2*m)*g*_%e,e,k,i,M,R,!1,w)}function b(r,e,i,o,u,m,g,_,w){const k=m/2,C=tc(r);let M=0,R=e-i,N=[];for(let V=0;V<r.length-1;V++){const W=r[V],J=r[V+1],ie=W.dist(J),fe=J.angleTo(W);for(;R+i<M+ie;){R+=i;const ne=(R-M)/ie,ge=En.number(W.x,J.x,ne),ke=En.number(W.y,J.y,ne);if(ge>=0&&ge<w&&ke>=0&&ke<w&&R-k>=0&&R+k<=C){const Oe=new zs(ge,ke,fe,V);Oe._round(),o&&!Vd(r,Oe,m,o,u)||N.push(Oe)}}M+=ie}return _||N.length||g||(N=b(r,M/2,i,o,u,m,g,!0,w)),N}gt("Anchor",zs);const T=on;function O(r,e,i,o){const u=[],m=r.image,g=m.pixelRatio,_=m.paddedRect.w-2*T,w=m.paddedRect.h-2*T,k=r.right-r.left,C=r.bottom-r.top,M=m.stretchX||[[0,_]],R=m.stretchY||[[0,w]],N=(et,vt)=>et+vt[1]-vt[0],V=M.reduce(N,0),W=R.reduce(N,0),J=_-V,ie=w-W;let fe=0,ne=V,ge=0,ke=W,Oe=0,dt=J,Et=0,ut=ie;if(m.content&&o){const et=m.content;fe=re(M,0,et[0]),ge=re(R,0,et[1]),ne=re(M,et[0],et[2]),ke=re(R,et[1],et[3]),Oe=et[0]-fe,Et=et[1]-ge,dt=et[2]-et[0]-ne,ut=et[3]-et[1]-ke}const st=(et,vt,it,Ze)=>{const jt=Ie(et.stretch-fe,ne,k,r.left),Pt=We(et.fixed-Oe,dt,et.stretch,V),gr=Ie(vt.stretch-ge,ke,C,r.top),oi=We(vt.fixed-Et,ut,vt.stretch,W),li=Ie(it.stretch-fe,ne,k,r.left),Qi=We(it.fixed-Oe,dt,it.stretch,V),Ds=Ie(Ze.stretch-ge,ke,C,r.top),Kn=We(Ze.fixed-Et,ut,Ze.stretch,W),ji=new Ce(jt,gr),gn=new Ce(li,gr),kn=new Ce(li,Ds),Xn=new Ce(jt,Ds),Yn=new Ce(Pt/g,oi/g),en=new Ce(Qi/g,Kn/g),tn=e*Math.PI/180;if(tn){const Rn=Math.sin(tn),hs=Math.cos(tn),ds=[hs,-Rn,Rn,hs];ji._matMult(ds),gn._matMult(ds),Xn._matMult(ds),kn._matMult(ds)}const Ln=et.stretch+et.fixed,Jn=vt.stretch+vt.fixed;return{tl:ji,tr:gn,bl:Xn,br:kn,tex:{x:m.paddedRect.x+T+Ln,y:m.paddedRect.y+T+Jn,w:it.stretch+it.fixed-Ln,h:Ze.stretch+Ze.fixed-Jn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yn,pixelOffsetBR:en,minFontScaleX:dt/g/k,minFontScaleY:ut/g/C,isSDF:i}};if(o&&(m.stretchX||m.stretchY)){const et=ue(M,J,V),vt=ue(R,ie,W);for(let it=0;it<et.length-1;it++){const Ze=et[it],jt=et[it+1];for(let Pt=0;Pt<vt.length-1;Pt++)u.push(st(Ze,vt[Pt],jt,vt[Pt+1]))}}else u.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return u}function re(r,e,i){let o=0;for(const u of r)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function ue(r,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,m]of r){const g=o[o.length-1];o.push({fixed:u-g.stretch,stretch:g.stretch}),o.push({fixed:u-g.stretch,stretch:g.stretch+(m-u)})}return o.push({fixed:e+T,stretch:i}),o}function Ie(r,e,i,o){return r/e*i+o}function We(r,e,i,o){return r-e*i/o}class Ye{constructor(e,i,o,u,m,g,_,w,k,C){if(this.boxStartIndex=e.length,k){let M=g.top,R=g.bottom;const N=g.collisionPadding;N&&(M-=N[1],R+=N[3]);let V=R-M;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let M=g.top*_-w[0],R=g.bottom*_+w[2],N=g.left*_-w[3],V=g.right*_+w[1];const W=g.collisionPadding;if(W&&(N-=W[0]*_,M-=W[1]*_,V+=W[2]*_,R+=W[3]*_),C){const J=new Ce(N,M),ie=new Ce(V,M),fe=new Ce(N,R),ne=new Ce(V,R),ge=C*Math.PI/180;J._rotate(ge),ie._rotate(ge),fe._rotate(ge),ne._rotate(ge),N=Math.min(J.x,ie.x,fe.x,ne.x),V=Math.max(J.x,ie.x,fe.x,ne.x),M=Math.min(J.y,ie.y,fe.y,ne.y),R=Math.max(J.y,ie.y,fe.y,ne.y)}e.emplaceBack(i.x,i.y,N,M,V,R,o,u,m)}this.boxEndIndex=e.length}}class He{constructor(e=[],i=Tt){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const m=e-1>>1,g=i[m];if(o(u,g)>=0)break;i[e]=g,e=m}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,m=i[e];for(;e<u;){let g=1+(e<<1),_=i[g];const w=g+1;if(w<this.length&&o(i[w],_)<0&&(g=w,_=i[w]),o(_,m)>=0)break;i[e]=_,e=g}i[e]=m}}function Tt(r,e){return r<e?-1:r>e?1:0}function zt(r,e=1,i=!1){let o=1/0,u=1/0,m=-1/0,g=-1/0;const _=r[0];for(let N=0;N<_.length;N++){const V=_[N];(!N||V.x<o)&&(o=V.x),(!N||V.y<u)&&(u=V.y),(!N||V.x>m)&&(m=V.x),(!N||V.y>g)&&(g=V.y)}const w=Math.min(m-o,g-u);let k=w/2;const C=new He([],Bt);if(w===0)return new Ce(o,u);for(let N=o;N<m;N+=w)for(let V=u;V<g;V+=w)C.push(new ai(N+k,V+k,k,r));let M=function(N){let V=0,W=0,J=0;const ie=N[0];for(let fe=0,ne=ie.length,ge=ne-1;fe<ne;ge=fe++){const ke=ie[fe],Oe=ie[ge],dt=ke.x*Oe.y-Oe.x*ke.y;W+=(ke.x+Oe.x)*dt,J+=(ke.y+Oe.y)*dt,V+=3*dt}return new ai(W/V,J/V,0,N)}(r),R=C.length;for(;C.length;){const N=C.pop();(N.d>M.d||!M.d)&&(M=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,R)),N.max-M.d<=e||(k=N.h/2,C.push(new ai(N.p.x-k,N.p.y-k,k,r)),C.push(new ai(N.p.x+k,N.p.y-k,k,r)),C.push(new ai(N.p.x-k,N.p.y+k,k,r)),C.push(new ai(N.p.x+k,N.p.y+k,k,r)),R+=4)}return i&&(console.log(`num probes: ${R}`),console.log(`best distance: ${M.d}`)),M.p}function Bt(r,e){return e.max-r.max}function ai(r,e,i,o){this.p=new Ce(r,e),this.h=i,this.d=function(u,m){let g=!1,_=1/0;for(let w=0;w<m.length;w++){const k=m[w];for(let C=0,M=k.length,R=M-1;C<M;R=C++){const N=k[C],V=k[R];N.y>u.y!=V.y>u.y&&u.x<(V.x-N.x)*(u.y-N.y)/(V.y-N.y)+N.x&&(g=!g),_=Math.min(_,Bu(u,N,V))}}return(g?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var _e;c.aq=void 0,(_e=c.aq||(c.aq={}))[_e.center=1]="center",_e[_e.left=2]="left",_e[_e.right=3]="right",_e[_e.top=4]="top",_e[_e.bottom=5]="bottom",_e[_e["top-left"]=6]="top-left",_e[_e["top-right"]=7]="top-right",_e[_e["bottom-left"]=8]="bottom-left",_e[_e["bottom-right"]=9]="bottom-right";const de=7,Ee=Number.POSITIVE_INFINITY;function rt(r,e){return e[1]!==Ee?function(i,o,u){let m=0,g=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":g=u-de;break;case"bottom-right":case"bottom-left":case"bottom":g=-u+de}switch(i){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(r,e[0],e[1]):function(i,o){let u=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(i){case"top-right":case"top-left":m=g-de;break;case"bottom-right":case"bottom-left":m=-g+de;break;case"bottom":m=-o+de;break;case"top":m=o-de}switch(i){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}return[u,m]}(r,e[0])}function Vt(r,e,i){var o;const u=r.layout,m=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(m){const _=m.values,w=[];for(let k=0;k<_.length;k+=2){const C=w[k]=_[k],M=_[k+1].map(R=>R*Ci);C.startsWith("top")?M[1]-=de:C.startsWith("bottom")&&(M[1]+=de),w[k+1]=M}return new di(w)}const g=u.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*Ci,Ee]:u.get("text-offset").evaluate(e,{},i).map(k=>k*Ci);const w=[];for(const k of g)w.push(k,rt(k,_));return new di(w)}return null}function Yt(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tr(r,e,i,o,u,m,g,_,w,k,C){let M=m.textMaxSize.evaluate(e,{});M===void 0&&(M=g);const R=r.layers[0].layout,N=R.get("icon-offset").evaluate(e,{},C),V=Ji(i.horizontal),W=g/24,J=r.tilePixelRatio*W,ie=r.tilePixelRatio*M/24,fe=r.tilePixelRatio*_,ne=r.tilePixelRatio*R.get("symbol-spacing"),ge=R.get("text-padding")*r.tilePixelRatio,ke=function(Ze,jt,Pt,gr=1){const oi=Ze.get("icon-padding").evaluate(jt,{},Pt),li=oi&&oi.values;return[li[0]*gr,li[1]*gr,li[2]*gr,li[3]*gr]}(R,e,C,r.tilePixelRatio),Oe=R.get("text-max-angle")/180*Math.PI,dt=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",Et=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ut=R.get("symbol-placement"),st=ne/2,et=R.get("icon-text-fit");let vt;o&&et!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(vt=qc(o,i.vertical,et,R.get("icon-text-fit-padding"),N,W)),V&&(o=qc(o,V,et,R.get("icon-text-fit-padding"),N,W)));const it=(Ze,jt)=>{jt.x<0||jt.x>=wi||jt.y<0||jt.y>=wi||function(Pt,gr,oi,li,Qi,Ds,Kn,ji,gn,kn,Xn,Yn,en,tn,Ln,Jn,Rn,hs,ds,rn,_r,Fn,Tn,nn,_a){const Ha=Pt.addToLineVertexArray(gr,oi);let Ka,ml,va,ra,ps=0,gl=0,Kh=0,Hp=0,gp=-1,yp=-1;const yl={};let Kp=Ts("");if(Pt.allowVerticalPlacement&&li.vertical){const Bn=ji.layout.get("text-rotate").evaluate(_r,{},nn)+90;va=new Ye(gn,gr,kn,Xn,Yn,li.vertical,en,tn,Ln,Bn),Kn&&(ra=new Ye(gn,gr,kn,Xn,Yn,Kn,Rn,hs,Ln,Bn))}if(Qi){const Bn=ji.layout.get("icon-rotate").evaluate(_r,{}),ia=ji.layout.get("icon-text-fit")!=="none",rc=O(Qi,Bn,Tn,ia),Ya=Kn?O(Kn,Bn,Tn,ia):void 0;ml=new Ye(gn,gr,kn,Xn,Yn,Qi,Rn,hs,!1,Bn),ps=4*rc.length;const ic=Pt.iconSizeData;let Bo=null;ic.kind==="source"?(Bo=[ea*ji.layout.get("icon-size").evaluate(_r,{})],Bo[0]>Za&&Wt(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Qs}. Reduce your "icon-size".`)):ic.kind==="composite"&&(Bo=[ea*Fn.compositeIconSizes[0].evaluate(_r,{},nn),ea*Fn.compositeIconSizes[1].evaluate(_r,{},nn)],(Bo[0]>Za||Bo[1]>Za)&&Wt(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Qs}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,rc,Bo,rn,ds,_r,c.ai.none,gr,Ha.lineStartIndex,Ha.lineLength,-1,nn),gp=Pt.icon.placedSymbolArray.length-1,Ya&&(gl=4*Ya.length,Pt.addSymbols(Pt.icon,Ya,Bo,rn,ds,_r,c.ai.vertical,gr,Ha.lineStartIndex,Ha.lineLength,-1,nn),yp=Pt.icon.placedSymbolArray.length-1)}const Xp=Object.keys(li.horizontal);for(const Bn of Xp){const ia=li.horizontal[Bn];if(!Ka){Kp=Ts(ia.text);const Ya=ji.layout.get("text-rotate").evaluate(_r,{},nn);Ka=new Ye(gn,gr,kn,Xn,Yn,ia,en,tn,Ln,Ya)}const rc=ia.positionedLines.length===1;if(Kh+=or(Pt,gr,ia,Ds,ji,Ln,_r,Jn,Ha,li.vertical?c.ai.horizontal:c.ai.horizontalOnly,rc?Xp:[Bn],yl,gp,Fn,nn),rc)break}li.vertical&&(Hp+=or(Pt,gr,li.vertical,Ds,ji,Ln,_r,Jn,Ha,c.ai.vertical,["vertical"],yl,yp,Fn,nn));const Wf=Ka?Ka.boxStartIndex:Pt.collisionBoxArray.length,Hf=Ka?Ka.boxEndIndex:Pt.collisionBoxArray.length,Kf=va?va.boxStartIndex:Pt.collisionBoxArray.length,Xf=va?va.boxEndIndex:Pt.collisionBoxArray.length,Yf=ml?ml.boxStartIndex:Pt.collisionBoxArray.length,Jf=ml?ml.boxEndIndex:Pt.collisionBoxArray.length,Qf=ra?ra.boxStartIndex:Pt.collisionBoxArray.length,em=ra?ra.boxEndIndex:Pt.collisionBoxArray.length;let Xa=-1;const Ud=(Bn,ia)=>Bn&&Bn.circleDiameter?Math.max(Bn.circleDiameter,ia):ia;Xa=Ud(Ka,Xa),Xa=Ud(va,Xa),Xa=Ud(ml,Xa),Xa=Ud(ra,Xa);const Yp=Xa>-1?1:0;Yp&&(Xa*=_a/Ci),Pt.glyphOffsetArray.length>=pl.MAX_GLYPHS&&Wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_r.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,_r.sortKey);const tm=Vt(ji,_r,nn),[rm,im]=function(Bn,ia){const rc=Bn.length,Ya=ia==null?void 0:ia.values;if((Ya==null?void 0:Ya.length)>0)for(let ic=0;ic<Ya.length;ic+=2){const Bo=Ya[ic+1];Bn.emplaceBack(c.aq[Ya[ic]],Bo[0],Bo[1])}return[rc,Bn.length]}(Pt.textAnchorOffsets,tm);Pt.symbolInstances.emplaceBack(gr.x,gr.y,yl.right>=0?yl.right:-1,yl.center>=0?yl.center:-1,yl.left>=0?yl.left:-1,yl.vertical||-1,gp,yp,Kp,Wf,Hf,Kf,Xf,Yf,Jf,Qf,em,kn,Kh,Hp,ps,gl,Yp,0,en,Xa,rm,im)}(r,jt,Ze,i,o,u,vt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,J,[ge,ge,ge,ge],dt,w,fe,ke,Et,N,e,m,k,C,g)};if(ut==="line")for(const Ze of Nd(e.geometry,0,0,wi,wi)){const jt=y(Ze,ne,Oe,i.vertical||V,o,24,ie,r.overscaling,wi);for(const Pt of jt)V&&Lr(r,V.text,st,Pt)||it(Ze,Pt)}else if(ut==="line-center"){for(const Ze of e.geometry)if(Ze.length>1){const jt=d(Ze,Oe,i.vertical||V,o,24,ie);jt&&it(Ze,jt)}}else if(e.type==="Polygon")for(const Ze of Lc(e.geometry,0)){const jt=zt(Ze,16);it(Ze[0],new zs(jt.x,jt.y,0))}else if(e.type==="LineString")for(const Ze of e.geometry)it(Ze,new zs(Ze[0].x,Ze[0].y,0));else if(e.type==="Point")for(const Ze of e.geometry)for(const jt of Ze)it([jt],new zs(jt.x,jt.y,0))}function or(r,e,i,o,u,m,g,_,w,k,C,M,R,N,V){const W=function(fe,ne,ge,ke,Oe,dt,Et,ut){const st=ke.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,et=[];for(const vt of ne.positionedLines)for(const it of vt.positionedGlyphs){if(!it.rect)continue;const Ze=it.rect||{};let jt=Bh+1,Pt=!0,gr=1,oi=0;const li=(Oe||ut)&&it.vertical,Qi=it.metrics.advance*it.scale/2;if(ut&&ne.verticalizable&&(oi=vt.lineOffset/2-(it.imageName?-(Ci-it.metrics.width*it.scale)/2:(it.scale-1)*Ci)),it.imageName){const rn=Et[it.imageName];Pt=rn.sdf,gr=rn.pixelRatio,jt=on/gr}const Ds=Oe?[it.x+Qi,it.y]:[0,0];let Kn=Oe?[0,0]:[it.x+Qi+ge[0],it.y+ge[1]-oi],ji=[0,0];li&&(ji=Kn,Kn=[0,0]);const gn=it.metrics.isDoubleResolution?2:1,kn=(it.metrics.left-jt)*it.scale-Qi+Kn[0],Xn=(-it.metrics.top-jt)*it.scale+Kn[1],Yn=kn+Ze.w/gn*it.scale/gr,en=Xn+Ze.h/gn*it.scale/gr,tn=new Ce(kn,Xn),Ln=new Ce(Yn,Xn),Jn=new Ce(kn,en),Rn=new Ce(Yn,en);if(li){const rn=new Ce(-Qi,Qi-cl),_r=-Math.PI/2,Fn=Ci/2-Qi,Tn=new Ce(5-cl-Fn,-(it.imageName?Fn:0)),nn=new Ce(...ji);tn._rotateAround(_r,rn)._add(Tn)._add(nn),Ln._rotateAround(_r,rn)._add(Tn)._add(nn),Jn._rotateAround(_r,rn)._add(Tn)._add(nn),Rn._rotateAround(_r,rn)._add(Tn)._add(nn)}if(st){const rn=Math.sin(st),_r=Math.cos(st),Fn=[_r,-rn,rn,_r];tn._matMult(Fn),Ln._matMult(Fn),Jn._matMult(Fn),Rn._matMult(Fn)}const hs=new Ce(0,0),ds=new Ce(0,0);et.push({tl:tn,tr:Ln,bl:Jn,br:Rn,tex:Ze,writingMode:ne.writingMode,glyphOffset:Ds,sectionIndex:it.sectionIndex,isSDF:Pt,pixelOffsetTL:hs,pixelOffsetBR:ds,minFontScaleX:0,minFontScaleY:0})}return et}(0,i,_,u,m,g,o,r.allowVerticalPlacement),J=r.textSizeData;let ie=null;J.kind==="source"?(ie=[ea*u.layout.get("text-size").evaluate(g,{})],ie[0]>Za&&Wt(`${r.layerIds[0]}: Value for "text-size" is >= ${Qs}. Reduce your "text-size".`)):J.kind==="composite"&&(ie=[ea*N.compositeTextSizes[0].evaluate(g,{},V),ea*N.compositeTextSizes[1].evaluate(g,{},V)],(ie[0]>Za||ie[1]>Za)&&Wt(`${r.layerIds[0]}: Value for "text-size" is >= ${Qs}. Reduce your "text-size".`)),r.addSymbols(r.text,W,ie,_,m,g,k,e,w.lineStartIndex,w.lineLength,R,V);for(const fe of C)M[fe]=r.text.placedSymbolArray.length-1;return 4*W.length}function Ji(r){for(const e in r)return r[e];return null}function Lr(r,e,i,o){const u=r.compareText;if(e in u){const m=u[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<i)return!0}else u[e]=[];return u[e].push(o),!1}const Wa=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const m=Wa[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Gh(_,g,m,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Wa.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return cp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,w=[0,m.length-1,0],k=[];for(;w.length;){const C=w.pop()||0,M=w.pop()||0,R=w.pop()||0;if(M-R<=_){for(let J=R;J<=M;J++){const ie=g[2*J],fe=g[2*J+1];ie>=e&&ie<=o&&fe>=i&&fe<=u&&k.push(m[J])}continue}const N=R+M>>1,V=g[2*N],W=g[2*N+1];V>=e&&V<=o&&W>=i&&W<=u&&k.push(m[N]),(C===0?e<=V:i<=W)&&(w.push(R),w.push(N-1),w.push(1-C)),(C===0?o>=V:u>=W)&&(w.push(N+1),w.push(M),w.push(1-C))}return k}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:g}=this,_=[0,u.length-1,0],w=[],k=o*o;for(;_.length;){const C=_.pop()||0,M=_.pop()||0,R=_.pop()||0;if(M-R<=g){for(let J=R;J<=M;J++)Wp(m[2*J],m[2*J+1],e,i)<=k&&w.push(u[J]);continue}const N=R+M>>1,V=m[2*N],W=m[2*N+1];Wp(V,W,e,i)<=k&&w.push(u[N]),(C===0?e-o<=V:i-o<=W)&&(_.push(R),_.push(N-1),_.push(1-C)),(C===0?e+o>=V:i+o>=W)&&(_.push(N+1),_.push(M),_.push(1-C))}return w}}function cp(r,e,i,o,u,m){if(u-o<=i)return;const g=o+u>>1;Gp(r,e,g,o,u,m),cp(r,e,i,o,g-1,1-m),cp(r,e,i,g+1,u,1-m)}function Gp(r,e,i,o,u,m){for(;u>o;){if(u-o>600){const k=u-o+1,C=i-o+1,M=Math.log(k),R=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*R*(k-R)/k)*(C-k/2<0?-1:1);Gp(r,e,i,Math.max(o,Math.floor(i-C*R/k+N)),Math.min(u,Math.floor(i+(k-C)*R/k+N)),m)}const g=e[2*i+m];let _=o,w=u;for(Wh(r,e,o,i),e[2*u+m]>g&&Wh(r,e,o,u);_<w;){for(Wh(r,e,_,w),_++,w--;e[2*_+m]<g;)_++;for(;e[2*w+m]>g;)w--}e[2*o+m]===g?Wh(r,e,o,w):(w++,Wh(r,e,w,u)),w<=i&&(o=w+1),i<=w&&(u=w-1)}}function Wh(r,e,i,o){hp(r,i,o),hp(e,2*i,2*o),hp(e,2*i+1,2*o+1)}function hp(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function Wp(r,e,i,o){const u=r-i,m=e-o;return u*u+m*m}var dp;c.bh=void 0,(dp=c.bh||(c.bh={})).create="create",dp.load="load",dp.fullLoad="fullLoad";let jd=null,Hh=[];const pp=1e3/60,fp="loadTime",mp="fullLoadTime",Gf={mark(r){performance.mark(r)},frame(r){const e=r;jd!=null&&Hh.push(e-jd),jd=e},clearMetrics(){jd=null,Hh=[],performance.clearMeasures(fp),performance.clearMeasures(mp);for(const r in c.bh)performance.clearMarks(c.bh[r])},getPerformanceMetrics(){performance.measure(fp,c.bh.create,c.bh.load),performance.measure(mp,c.bh.create,c.bh.fullLoad);const r=performance.getEntriesByName(fp)[0].duration,e=performance.getEntriesByName(mp)[0].duration,i=Hh.length,o=1/(Hh.reduce((m,g)=>m+g,0)/i/1e3),u=Hh.filter(m=>m>pp).reduce((m,g)=>m+(g-pp)/pp,0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};c.$=function(r,e,i){var o,u,m,g,_,w,k,C,M,R,N,V,W=i[0],J=i[1],ie=i[2];return e===r?(r[12]=e[0]*W+e[4]*J+e[8]*ie+e[12],r[13]=e[1]*W+e[5]*J+e[9]*ie+e[13],r[14]=e[2]*W+e[6]*J+e[10]*ie+e[14],r[15]=e[3]*W+e[7]*J+e[11]*ie+e[15]):(u=e[1],m=e[2],g=e[3],_=e[4],w=e[5],k=e[6],C=e[7],M=e[8],R=e[9],N=e[10],V=e[11],r[0]=o=e[0],r[1]=u,r[2]=m,r[3]=g,r[4]=_,r[5]=w,r[6]=k,r[7]=C,r[8]=M,r[9]=R,r[10]=N,r[11]=V,r[12]=o*W+_*J+M*ie+e[12],r[13]=u*W+w*J+R*ie+e[13],r[14]=m*W+k*J+N*ie+e[14],r[15]=g*W+C*J+V*ie+e[15]),r},c.A=Io,c.B=En,c.C=class{constructor(r,e,i){this.receive=o=>{const u=o.data,m=u.id;if(m&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[m];const g=this.cancelCallbacks[m];delete this.cancelCallbacks[m],g&&g()}else yt()||u.mustQueue?(this.tasks[m]=u,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,u)},this.process=()=>{if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)},this.target=r,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Kc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=yt()?r:window}send(r,e,i,o,u=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[m]=i);const g=[],_={id:m,type:r,hasCallback:!!i,targetMapId:o,mustQueue:u,sourceMapId:this.mapId,data:Vs(e,g)};return this.target.postMessage(_,{transfer:g}),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}processTask(r,e){if(e.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(e.error?i(Ra(e.error)):i(null,Ra(e.data)))}else{let i=!1;const o=[],u=e.hasCallback?(_,w)=>{i=!0,delete this.cancelCallbacks[r];const k={id:r,type:"<response>",sourceMapId:this.mapId,error:_?Vs(_):null,data:Vs(w,o)};this.target.postMessage(k,{transfer:o})}:_=>{i=!0};let m=null;const g=Ra(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,u);else if("getWorkerSource"in this.parent){const _=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,_[0],g.source)[_[1]](g,u)}else u(new Error(`Could not find function ${e.type}`));!i&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.D=It,c.E=Er,c.F=function(r,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in r&&(i[u]=r[u])}return i},c.G=Fd,c.H=Jc,c.I=ga,c.J=Lt,c.K=Ot,c.L=ta,c.M=ae,c.N=wi,c.O=cs,c.P=Ce,c.Q=ii,c.R=Hn,c.S=Or,c.T=Qo,c.U=fl,c.V=class extends qn{},c.W=eh,c.X=function(r,e){const i=window.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<r.length;o++){const u=window.document.createElement("source");vr(r[o])||(i.crossOrigin="Anonymous"),u.src=r[o],i.appendChild(u)}return{cancel:()=>{}}},c.Y=Ge,c.Z=function(){var r=new Io(16);return Io!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},c._=ye,c.a=Xe,c.a$=class extends B{},c.a0=function(r,e,i){var o=i[0],u=i[1],m=i[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},c.a1=Tc,c.a2=function(){return ve++},c.a3=K,c.a4=pl,c.a5=function(){Pn.isLoading()||Pn.isLoaded()||ca()!=="deferred"||Au()},c.a6=Bl,c.a7=Ws,c.a8=Yr,c.a9=ih,c.aA=Fa,c.aB=function(r){r=r.slice();const e=Object.create(null);for(let i=0;i<r.length;i++)e[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=Jr(r[i],e[r[i].ref]));return r},c.aC=function(r){if(r.type==="custom")return new Fo(r);switch(r.type){case"background":return new lp(r);case"circle":return new dh(r);case"fill":return new gd(r);case"fill-extrusion":return new wn(r);case"heatmap":return new sd(r);case"hillshade":return new ad(r);case"line":return new Cd(r);case"raster":return new up(r);case"symbol":return new Hc(r)}},c.aD=ot,c.aE=function(r,e){if(!r)return[{command:Kt.setStyle,args:[e]}];let i=[];try{if(!kr(r.version,e.version))return[{command:Kt.setStyle,args:[e]}];kr(r.center,e.center)||i.push({command:Kt.setCenter,args:[e.center]}),kr(r.zoom,e.zoom)||i.push({command:Kt.setZoom,args:[e.zoom]}),kr(r.bearing,e.bearing)||i.push({command:Kt.setBearing,args:[e.bearing]}),kr(r.pitch,e.pitch)||i.push({command:Kt.setPitch,args:[e.pitch]}),kr(r.sprite,e.sprite)||i.push({command:Kt.setSprite,args:[e.sprite]}),kr(r.glyphs,e.glyphs)||i.push({command:Kt.setGlyphs,args:[e.glyphs]}),kr(r.transition,e.transition)||i.push({command:Kt.setTransition,args:[e.transition]}),kr(r.light,e.light)||i.push({command:Kt.setLight,args:[e.light]});const o={},u=[];(function(g,_,w,k){let C;for(C in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(_,C)||Hr(C,w,k));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(g,C)?kr(g[C],_[C])||(g[C].type==="geojson"&&_[C].type==="geojson"&&Ui(g,_,C)?w.push({command:Kt.setGeoJSONSourceData,args:[C,_[C].data]}):Kr(C,_,w,k)):ui(C,_,w))})(r.sources,e.sources,u,o);const m=[];r.layers&&r.layers.forEach(g=>{o[g.source]?i.push({command:Kt.removeLayer,args:[g.id]}):m.push(g)}),i=i.concat(u),function(g,_,w){_=_||[];const k=(g=g||[]).map(un),C=_.map(un),M=g.reduce(Ai,{}),R=_.reduce(Ai,{}),N=k.slice(),V=Object.create(null);let W,J,ie,fe,ne,ge,ke;for(W=0,J=0;W<k.length;W++)ie=k[W],Object.prototype.hasOwnProperty.call(R,ie)?J++:(w.push({command:Kt.removeLayer,args:[ie]}),N.splice(N.indexOf(ie,J),1));for(W=0,J=0;W<C.length;W++)ie=C[C.length-1-W],N[N.length-1-W]!==ie&&(Object.prototype.hasOwnProperty.call(M,ie)?(w.push({command:Kt.removeLayer,args:[ie]}),N.splice(N.lastIndexOf(ie,N.length-J),1)):J++,ge=N[N.length-W],w.push({command:Kt.addLayer,args:[R[ie],ge]}),N.splice(N.length-W,0,ie),V[ie]=!0);for(W=0;W<C.length;W++)if(ie=C[W],fe=M[ie],ne=R[ie],!V[ie]&&!kr(fe,ne))if(kr(fe.source,ne.source)&&kr(fe["source-layer"],ne["source-layer"])&&kr(fe.type,ne.type)){for(ke in Qn(fe.layout,ne.layout,w,ie,null,Kt.setLayoutProperty),Qn(fe.paint,ne.paint,w,ie,null,Kt.setPaintProperty),kr(fe.filter,ne.filter)||w.push({command:Kt.setFilter,args:[ie,ne.filter]}),kr(fe.minzoom,ne.minzoom)&&kr(fe.maxzoom,ne.maxzoom)||w.push({command:Kt.setLayerZoomRange,args:[ie,ne.minzoom,ne.maxzoom]}),fe)Object.prototype.hasOwnProperty.call(fe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Qn(fe[ke],ne[ke],w,ie,ke.slice(6),Kt.setPaintProperty):kr(fe[ke],ne[ke])||w.push({command:Kt.setLayerProperty,args:[ie,ke,ne[ke]]}));for(ke in ne)Object.prototype.hasOwnProperty.call(ne,ke)&&!Object.prototype.hasOwnProperty.call(fe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Qn(fe[ke],ne[ke],w,ie,ke.slice(6),Kt.setPaintProperty):kr(fe[ke],ne[ke])||w.push({command:Kt.setLayerProperty,args:[ie,ke,ne[ke]]}))}else w.push({command:Kt.removeLayer,args:[ie]}),ge=N[N.lastIndexOf(ie)+1],w.push({command:Kt.addLayer,args:[ne,ge]})}(m,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:Kt.setStyle,args:[e]}]}return i},c.aF=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},c.aG=function r(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!r(e[o],i[o]))return!1;return!0}return e===i},c.aH=Ae,c.aI=mt,c.aJ=ua,c.aK=function(r){return r({pluginStatus:Di,pluginURL:js}),ua.on("pluginStateChange",r),r},c.aL=class extends $s{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},c.aM=qs,c.aN=class extends $s{constructor(r,e){super(r,e),this.current=Du}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},c.aO=Mn,c.aP=class extends $s{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},c.aQ=class extends $s{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},c.aR=pa,c.aS=function(r,e,i,o,u,m,g){var _=1/(e-i),w=1/(o-u),k=1/(m-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+i)*_,r[13]=(u+o)*w,r[14]=(g+m)*k,r[15]=1,r},c.aT=Pr,c.aU=Is,c.aV=class extends l{},c.aW=Id,c.aX=class extends f{},c.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},c.aZ=Wl,c.a_=qe,c.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,u,m)=>{const g=u||m;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},c.ab=function(r,e){const i=[];for(const o in r)o in e||i.push(o);return i},c.ac=function(r){if(Ue==null){const e=r.navigator?r.navigator.userAgent:null;Ue=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ue},c.ad=Rt,c.ae=function(r,e,i){var o=Math.sin(i),u=Math.cos(i),m=e[0],g=e[1],_=e[2],w=e[3],k=e[4],C=e[5],M=e[6],R=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*u+k*o,r[1]=g*u+C*o,r[2]=_*u+M*o,r[3]=w*u+R*o,r[4]=k*u-m*o,r[5]=C*u-g*o,r[6]=M*u-_*o,r[7]=R*u-w*o,r},c.af=function(r){var e=new Io(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},c.ag=Po,c.ah=function(r,e){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:g}=r,_=u?Rt(Cn.interpolationFactor(u,e,m,g),0,1):0;r.kind==="camera"?o=En.number(r.minSize,r.maxSize,_):i=_}return{uSizeT:i,uSize:o}},c.aj=function(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return r.kind==="source"?o/ea:r.kind==="composite"?En.number(o/ea,u/ea,i):e},c.ak=Gc,c.al=function(r,e,i,o){const u=e.y-r.y,m=e.x-r.x,g=o.y-i.y,_=o.x-i.x,w=g*m-_*u;if(w===0)return null;const k=(_*(r.y-i.y)-g*(r.x-i.x))/w;return new Ce(r.x+k*m,r.y+k*u)},c.am=Nd,c.an=nl,c.ao=Ou,c.ap=Ci,c.ar=iu,c.as=function(r,e){var i=e[0],o=e[1],u=e[2],m=e[3],g=e[4],_=e[5],w=e[6],k=e[7],C=e[8],M=e[9],R=e[10],N=e[11],V=e[12],W=e[13],J=e[14],ie=e[15],fe=i*_-o*g,ne=i*w-u*g,ge=i*k-m*g,ke=o*w-u*_,Oe=o*k-m*_,dt=u*k-m*w,Et=C*W-M*V,ut=C*J-R*V,st=C*ie-N*V,et=M*J-R*W,vt=M*ie-N*W,it=R*ie-N*J,Ze=fe*it-ne*vt+ge*et+ke*st-Oe*ut+dt*Et;return Ze?(r[0]=(_*it-w*vt+k*et)*(Ze=1/Ze),r[1]=(u*vt-o*it-m*et)*Ze,r[2]=(W*dt-J*Oe+ie*ke)*Ze,r[3]=(R*Oe-M*dt-N*ke)*Ze,r[4]=(w*st-g*it-k*ut)*Ze,r[5]=(i*it-u*st+m*ut)*Ze,r[6]=(J*ge-V*dt-ie*ne)*Ze,r[7]=(C*dt-R*ge+N*ne)*Ze,r[8]=(g*vt-_*st+k*Et)*Ze,r[9]=(o*st-i*vt-m*Et)*Ze,r[10]=(V*Oe-W*ge+ie*fe)*Ze,r[11]=(M*ge-C*Oe-N*fe)*Ze,r[12]=(_*ut-g*et-w*Et)*Ze,r[13]=(i*et-o*ut+u*Et)*Ze,r[14]=(W*ne-V*ke-J*fe)*Ze,r[15]=(C*ke-M*ne+R*fe)*Ze,r):null},c.at=Yt,c.au=$c,c.av=Gh,c.aw=function(){const r={},e=Te.$version;for(const i in Te.$root){const o=Te.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(r[i]=u)}}return r},c.ax=Kt,c.ay=Iu,c.az=Ct,c.b=function(r,e){const i=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(i).then(o=>{e(null,o)}).catch(o=>{e(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},c.b0=Li,c.b1=function(r,e){var i=r[0],o=r[1],u=r[2],m=r[3],g=r[4],_=r[5],w=r[6],k=r[7],C=r[8],M=r[9],R=r[10],N=r[11],V=r[12],W=r[13],J=r[14],ie=r[15],fe=e[0],ne=e[1],ge=e[2],ke=e[3],Oe=e[4],dt=e[5],Et=e[6],ut=e[7],st=e[8],et=e[9],vt=e[10],it=e[11],Ze=e[12],jt=e[13],Pt=e[14],gr=e[15];return Math.abs(i-fe)<=Fr*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(o-ne)<=Fr*Math.max(1,Math.abs(o),Math.abs(ne))&&Math.abs(u-ge)<=Fr*Math.max(1,Math.abs(u),Math.abs(ge))&&Math.abs(m-ke)<=Fr*Math.max(1,Math.abs(m),Math.abs(ke))&&Math.abs(g-Oe)<=Fr*Math.max(1,Math.abs(g),Math.abs(Oe))&&Math.abs(_-dt)<=Fr*Math.max(1,Math.abs(_),Math.abs(dt))&&Math.abs(w-Et)<=Fr*Math.max(1,Math.abs(w),Math.abs(Et))&&Math.abs(k-ut)<=Fr*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(C-st)<=Fr*Math.max(1,Math.abs(C),Math.abs(st))&&Math.abs(M-et)<=Fr*Math.max(1,Math.abs(M),Math.abs(et))&&Math.abs(R-vt)<=Fr*Math.max(1,Math.abs(R),Math.abs(vt))&&Math.abs(N-it)<=Fr*Math.max(1,Math.abs(N),Math.abs(it))&&Math.abs(V-Ze)<=Fr*Math.max(1,Math.abs(V),Math.abs(Ze))&&Math.abs(W-jt)<=Fr*Math.max(1,Math.abs(W),Math.abs(jt))&&Math.abs(J-Pt)<=Fr*Math.max(1,Math.abs(J),Math.abs(Pt))&&Math.abs(ie-gr)<=Fr*Math.max(1,Math.abs(ie),Math.abs(gr))},c.b2=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},c.b3=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},c.b4=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},c.b5=ft,c.b6=th,c.b7=Bd,c.b8=function(r,e,i,o,u){var m,g=1/Math.tan(e/2);return r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(r[10]=(u+o)*(m=1/(o-u)),r[14]=2*u*o*m):(r[10]=-1,r[14]=-2*o),r},c.b9=function(r,e,i){var o=Math.sin(i),u=Math.cos(i),m=e[4],g=e[5],_=e[6],w=e[7],k=e[8],C=e[9],M=e[10],R=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*u+k*o,r[5]=g*u+C*o,r[6]=_*u+M*o,r[7]=w*u+R*o,r[8]=k*u-m*o,r[9]=C*u-g*o,r[10]=M*u-_*o,r[11]=R*u-w*o,r},c.bA=Le,c.bB=Xs,c.bC=Rl,c.bD=Pn,c.ba=Ut,c.bb=Dt,c.bc=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},c.bd=class extends Us{},c.be=Ga,c.bf=qh,c.bg=Gf,c.bi=_t,c.bj=function(r,e,i=!1){if(Di===Ol||Di===qr||Di===Yo)throw new Error("setRTLTextPlugin cannot be called multiple times.");js=Zt.resolveURL(r),Di=Ol,So=e,Ba(),i||Au()},c.bk=ca,c.bl=function(r,e){const i={};for(let u=0;u<r.length;u++){const m=e&&e[r[u].id]||Ho(r[u]);e&&(e[r[u].id]=m);let g=i[m];g||(g=i[m]=[]),g.push(r[u])}const o=[];for(const u in i)o.push(i[u]);return o},c.bm=gt,c.bn=Qu,c.bo=ec,c.bp=Xu,c.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=wi/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Yr(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Yr(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Yr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Yr(k),r.canonical),o["text-size"].possiblyEvaluate(new Yr(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Yr(k),r.canonical),o["icon-size"].possiblyEvaluate(new Yr(C),r.canonical)]}const m=i.get("text-line-height")*Ci,g=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",_=i.get("text-keep-upright"),w=i.get("text-size");for(const k of r.bucket.features){const C=i.get("text-font").evaluate(k,{},r.canonical).join(","),M=w.evaluate(k,{},r.canonical),R=u.layoutTextSize.evaluate(k,{},r.canonical),N=u.layoutIconSize.evaluate(k,{},r.canonical),V={horizontal:{},vertical:void 0},W=k.text;let J,ie=[0,0];if(W){const ge=W.toString(),ke=i.get("text-letter-spacing").evaluate(k,{},r.canonical)*Ci,Oe=Xo(ge)?ke:0,dt=i.get("text-anchor").evaluate(k,{},r.canonical),Et=Vt(e,k,r.canonical);if(!Et){const it=i.get("text-radial-offset").evaluate(k,{},r.canonical);ie=it?rt(dt,[it*Ci,Ee]):i.get("text-offset").evaluate(k,{},r.canonical).map(Ze=>Ze*Ci)}let ut=g?"center":i.get("text-justify").evaluate(k,{},r.canonical);const st=i.get("symbol-placement"),et=st==="point"?i.get("text-max-width").evaluate(k,{},r.canonical)*Ci:0,vt=()=>{r.bucket.allowVerticalPlacement&&ws(ge)&&(V.vertical=ln(W,r.glyphMap,r.glyphPositions,r.imagePositions,C,et,m,dt,"left",Oe,ie,c.ai.vertical,!0,st,R,M))};if(!g&&Et){const it=new Set;if(ut==="auto")for(let jt=0;jt<Et.values.length;jt+=2)it.add(Yt(Et.values[jt]));else it.add(ut);let Ze=!1;for(const jt of it)if(!V.horizontal[jt])if(Ze)V.horizontal[jt]=V.horizontal[0];else{const Pt=ln(W,r.glyphMap,r.glyphPositions,r.imagePositions,C,et,m,"center",jt,Oe,ie,c.ai.horizontal,!1,st,R,M);Pt&&(V.horizontal[jt]=Pt,Ze=Pt.positionedLines.length===1)}vt()}else{ut==="auto"&&(ut=Yt(dt));const it=ln(W,r.glyphMap,r.glyphPositions,r.imagePositions,C,et,m,dt,ut,Oe,ie,c.ai.horizontal,!1,st,R,M);it&&(V.horizontal[ut]=it),vt(),ws(ge)&&g&&_&&(V.vertical=ln(W,r.glyphMap,r.glyphPositions,r.imagePositions,C,et,m,dt,ut,Oe,ie,c.ai.vertical,!1,st,R,M))}}let fe=!1;if(k.icon&&k.icon.name){const ge=r.imageMap[k.icon.name];ge&&(J=hl(r.imagePositions[k.icon.name],i.get("icon-offset").evaluate(k,{},r.canonical),i.get("icon-anchor").evaluate(k,{},r.canonical)),fe=!!ge.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=fe:r.bucket.sdfIcons!==fe&&Wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ne=Ji(V.horizontal)||V.vertical;r.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||J)&&tr(r.bucket,k,V,J,r.imageMap,u,R,N,ie,fe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},c.br=Dh,c.bs=pn,c.bt=Fc,c.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},c.bv=Sn,c.bw=ma,c.bx=function(r,e,i,o,u){return ye(this,void 0,void 0,function*(){if(Ot())try{return yield ae(r,e,i,o,u)}catch{}return function(m,g,_,w,k){const C=m.width,M=m.height;Pe&&Ne||(Pe=new OffscreenCanvas(C,M),Ne=Pe.getContext("2d",{willReadFrequently:!0})),Pe.width=C,Pe.height=M,Ne.drawImage(m,0,0,C,M);const R=Ne.getImageData(g,_,w,k);return Ne.clearRect(0,0,C,M),R.data}(r,e,i,o,u)})},c.by=rh,c.bz=$,c.c=lr,c.d=function(r,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame(()=>{i.src=nt})},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(r)],{type:"image/png"});i.src=r.byteLength?URL.createObjectURL(o):nt},c.e=le,c.f=function(r,e){return Tr(le(r,{type:"json"}),e)},c.g=rr,c.h=Zt,c.i=yt,c.j=fr,c.k=Vr,c.l=Nr,c.m=Tr,c.n=function(r){return new Sn(r).readFields(ru,[])},c.o=function(r,e,i){if(!r.length)return i(null,[]);let o=r.length;const u=new Array(r.length);let m=null;r.forEach((g,_)=>{e(g,(w,k)=>{w&&(m=w),u[_]=k,--o==0&&i(m,u)})})},c.p=$a,c.q=Gl,c.r=pi,c.s=vr,c.t=vc,c.u=lt,c.v=Te,c.w=Wt,c.x=wo,c.y=is,c.z=function([r,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(i),y:r*Math.sin(e)*Math.sin(i),z:r*Math.cos(i)}}}),ce(["./shared"],function(c){class ye{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,F){for(const X of L){this._layerConfigs[X.id]=X;const Q=this._layers[X.id]=c.aC(X);Q._featureFilter=c.a6(Q.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of F)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const U=c.bl(Object.values(this._layerConfigs),this.keyCache);for(const X of U){const Q=X.map(Re=>this._layers[Re.id]),me=Q[0];if(me.visibility==="none")continue;const se=me.source||"";let te=this.familiesBySource[se];te||(te=this.familiesBySource[se]={});const pe=me.sourceLayer||"_geojsonTileLayer";let ze=te[pe];ze||(ze=te[pe]=[]),ze.push(Q)}}}class ${constructor(L){const F={},U=[];for(const se in L){const te=L[se],pe=F[se]={};for(const ze in te){const Re=te[+ze];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Be={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};U.push(Be),pe[ze]={rect:Be,metrics:Re.metrics}}}const{w:X,h:Q}=c.p(U),me=new c.q({width:X||1,height:Q||1});for(const se in L){const te=L[se];for(const pe in te){const ze=te[+pe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Re=F[se][pe].rect;c.q.copy(ze.bitmap,me,{x:0,y:0},{x:Re.x+1,y:Re.y+1},ze.bitmap)}}this.image=me,this.positions=F}}c.bm("GlyphAtlas",$);class Le{constructor(L){this.tileID=new c.O(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(L,F,U,X,Q){this.status="parsing",this.data=L,this.collisionBoxArray=new c.a3;const me=new c.bn(Object.keys(L.layers).sort()),se=new c.bo(this.tileID,this.promoteId);se.bucketLayerIDs=[];const te={},pe={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},ze=F.familiesBySource[this.source];for(const wr in ze){const yr=L.layers[wr];if(!yr)continue;yr.version===1&&c.w(`Vector tile source "${this.source}" layer "${wr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zi=me.encode(wr),Br=[];for(let yi=0;yi<yr.length;yi++){const Gi=yr.feature(yi),On=se.getId(Gi,wr);Br.push({feature:Gi,id:On,index:yi,sourceLayerIndex:Zi})}for(const yi of ze[wr]){const Gi=yi[0];Gi.source!==this.source&&c.w(`layer.source = ${Gi.source} does not equal this.source = ${this.source}`),Gi.minzoom&&this.zoom<Math.floor(Gi.minzoom)||Gi.maxzoom&&this.zoom>=Gi.maxzoom||Gi.visibility!=="none"&&(Me(yi,this.zoom,U),(te[Gi.id]=Gi.createBucket({index:se.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zi,sourceID:this.source})).populate(Br,pe,this.tileID.canonical),se.bucketLayerIDs.push(yi.map(On=>On.id)))}}let Re,Be,At,Xt;const St=c.aH(pe.glyphDependencies,wr=>Object.keys(wr).map(Number));this.inFlightDependencies.forEach(wr=>wr==null?void 0:wr.cancel()),this.inFlightDependencies=[];const Ft=++this.dependencySentinel;Object.keys(St).length?this.inFlightDependencies.push(X.send("getGlyphs",{uid:this.uid,stacks:St,source:this.source,tileID:this.tileID,type:"glyphs"},(wr,yr)=>{Ft===this.dependencySentinel&&(Re||(Re=wr,Be=yr,zr.call(this)))})):Be={};const Gt=Object.keys(pe.iconDependencies);Gt.length?this.inFlightDependencies.push(X.send("getImages",{icons:Gt,source:this.source,tileID:this.tileID,type:"icons"},(wr,yr)=>{Ft===this.dependencySentinel&&(Re||(Re=wr,At=yr,zr.call(this)))})):At={};const Ir=Object.keys(pe.patternDependencies);function zr(){if(Re)return Q(Re);if(Be&&At&&Xt){const wr=new $(Be),yr=new c.bp(At,Xt);for(const Zi in te){const Br=te[Zi];Br instanceof c.a4?(Me(Br.layers,this.zoom,U),c.bq({bucket:Br,glyphMap:Be,glyphPositions:wr.positions,imageMap:At,imagePositions:yr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Br.hasPattern&&(Br instanceof c.br||Br instanceof c.bs||Br instanceof c.bt)&&(Me(Br.layers,this.zoom,U),Br.addFeatures(pe,this.tileID.canonical,yr.patternPositions))}this.status="done",Q(null,{buckets:Object.values(te).filter(Zi=>!Zi.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wr.image,imageAtlas:yr,glyphMap:this.returnDependencies?Be:null,iconMap:this.returnDependencies?At:null,glyphPositions:this.returnDependencies?wr.positions:null})}}Ir.length?this.inFlightDependencies.push(X.send("getImages",{icons:Ir,source:this.source,tileID:this.tileID,type:"patterns"},(wr,yr)=>{Ft===this.dependencySentinel&&(Re||(Re=wr,Xt=yr,zr.call(this)))})):Xt={},zr.call(this)}}function Me(H,L,F){const U=new c.a8(L);for(const X of H)X.recalculate(U,F)}function Ce(H,L){const F=c.l(H.request,(U,X,Q,me)=>{if(U)L(U);else if(X)try{const se=new c.bw.VectorTile(new c.bv(X));L(null,{vectorTile:se,rawData:X,cacheControl:Q,expires:me})}catch(se){const te=new Uint8Array(X);let pe=`Unable to parse the tile at ${H.request.url}, `;pe+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.messge}`,L(new Error(pe))}});return()=>{F.cancel(),L()}}class xt{constructor(L,F,U,X){this.actor=L,this.layerIndex=F,this.availableImages=U,this.loadVectorData=X||Ce,this.fetching={},this.loading={},this.loaded={}}loadTile(L,F){const U=L.uid;this.loading||(this.loading={});const X=!!(L&&L.request&&L.request.collectResourceTiming)&&new c.bu(L.request),Q=this.loading[U]=new Le(L);Q.abort=this.loadVectorData(L,(me,se)=>{if(delete this.loading[U],me||!se)return Q.status="done",this.loaded[U]=Q,F(me);const te=se.rawData,pe={};se.expires&&(pe.expires=se.expires),se.cacheControl&&(pe.cacheControl=se.cacheControl);const ze={};if(X){const Re=X.finish();Re&&(ze.resourceTiming=JSON.parse(JSON.stringify(Re)))}Q.vectorTile=se.vectorTile,Q.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,(Re,Be)=>{if(delete this.fetching[U],Re||!Be)return F(Re);F(null,c.e({rawTileData:te.slice(0)},Be,pe,ze))}),this.loaded=this.loaded||{},this.loaded[U]=Q,this.fetching[U]={rawTileData:te,cacheControl:pe,resourceTiming:ze}})}reloadTile(L,F){const U=this.loaded,X=L.uid;if(U&&U[X]){const Q=U[X];Q.showCollisionBoxes=L.showCollisionBoxes,Q.status==="parsing"?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,(me,se)=>{if(me||!se)return F(me,se);let te;if(this.fetching[X]){const{rawTileData:pe,cacheControl:ze,resourceTiming:Re}=this.fetching[X];delete this.fetching[X],te=c.e({rawTileData:pe.slice(0)},se,ze,Re)}else te=se;F(null,te)}):Q.status==="done"&&(Q.vectorTile?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,F):F())}}abortTile(L,F){const U=this.loading,X=L.uid;U&&U[X]&&U[X].abort&&(U[X].abort(),delete U[X]),F()}removeTile(L,F){const U=this.loaded,X=L.uid;U&&U[X]&&delete U[X],F()}}class Je{constructor(){this.loaded={}}loadTile(L,F){return c._(this,void 0,void 0,function*(){const{uid:U,encoding:X,rawImageData:Q,redFactor:me,greenFactor:se,blueFactor:te,baseShift:pe}=L,ze=Q.width+2,Re=Q.height+2,Be=c.a(Q)?new c.R({width:ze,height:Re},yield c.bx(Q,-1,-1,ze,Re)):Q,At=new c.by(U,Be,X,me,se,te,pe);this.loaded=this.loaded||{},this.loaded[U]=At,F(null,At)})}removeTile(L){const F=this.loaded,U=L.uid;F&&F[U]&&delete F[U]}}function at(H,L){if(H.length!==0){je(H[0],L);for(var F=1;F<H.length;F++)je(H[F],!L)}}function je(H,L){for(var F=0,U=0,X=0,Q=H.length,me=Q-1;X<Q;me=X++){var se=(H[X][0]-H[me][0])*(H[me][1]+H[X][1]),te=F+se;U+=Math.abs(F)>=Math.abs(se)?F-te+se:se-te+F,F=te}F+U>=0!=!!L&&H.reverse()}var pt=c.bz(function H(L,F){var U,X=L&&L.type;if(X==="FeatureCollection")for(U=0;U<L.features.length;U++)H(L.features[U],F);else if(X==="GeometryCollection")for(U=0;U<L.geometries.length;U++)H(L.geometries[U],F);else if(X==="Feature")H(L.geometry,F);else if(X==="Polygon")at(L.coordinates,F);else if(X==="MultiPolygon")for(U=0;U<L.coordinates.length;U++)at(L.coordinates[U],F);return L});const Lt=c.bw.VectorTileFeature.prototype.toGeoJSON;var Ot={exports:{}},Ut=c.bA,Dt=c.bw.VectorTileFeature,Rt=ft;function ft(H,L){this.options=L||{},this.features=H,this.length=H.length}function le(H,L){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=L||4096}ft.prototype.feature=function(H){return new le(this.features[H],this.options.extent)},le.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var L=0;L<H.length;L++){for(var F=H[L],U=[],X=0;X<F.length;X++)U.push(new Ut(F[X][0],F[X][1]));this.geometry.push(U)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,L=1/0,F=-1/0,U=1/0,X=-1/0,Q=0;Q<H.length;Q++)for(var me=H[Q],se=0;se<me.length;se++){var te=me[se];L=Math.min(L,te.x),F=Math.max(F,te.x),U=Math.min(U,te.y),X=Math.max(X,te.y)}return[L,U,F,X]},le.prototype.toGeoJSON=Dt.prototype.toGeoJSON;var ve=c.bB,Ae=Rt;function mt(H){var L=new ve;return function(F,U){for(var X in F.layers)U.writeMessage(3,ot,F.layers[X])}(H,L),L.finish()}function ot(H,L){var F;L.writeVarintField(15,H.version||1),L.writeStringField(1,H.name||""),L.writeVarintField(5,H.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<H.length;F++)U.feature=H.feature(F),L.writeMessage(2,ct,U);var X=U.keys;for(F=0;F<X.length;F++)L.writeStringField(3,X[F]);var Q=U.values;for(F=0;F<Q.length;F++)L.writeMessage(4,Ue,Q[F])}function ct(H,L){var F=H.feature;F.id!==void 0&&L.writeVarintField(1,F.id),L.writeMessage(2,Wt,H),L.writeVarintField(3,F.type),L.writeMessage(4,yt,F)}function Wt(H,L){var F=H.feature,U=H.keys,X=H.values,Q=H.keycache,me=H.valuecache;for(var se in F.properties){var te=F.properties[se],pe=Q[se];if(te!==null){pe===void 0&&(U.push(se),Q[se]=pe=U.length-1),L.writeVarint(pe);var ze=typeof te;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(te=JSON.stringify(te));var Re=ze+":"+te,Be=me[Re];Be===void 0&&(X.push(te),me[Re]=Be=X.length-1),L.writeVarint(Be)}}}function dr(H,L){return(L<<3)+(7&H)}function pr(H){return H<<1^H>>31}function yt(H,L){for(var F=H.loadGeometry(),U=H.type,X=0,Q=0,me=F.length,se=0;se<me;se++){var te=F[se],pe=1;U===1&&(pe=te.length),L.writeVarint(dr(1,pe));for(var ze=U===3?te.length-1:te.length,Re=0;Re<ze;Re++){Re===1&&U!==1&&L.writeVarint(dr(2,ze-1));var Be=te[Re].x-X,At=te[Re].y-Q;L.writeVarint(pr(Be)),L.writeVarint(pr(At)),X+=Be,Q+=At}U===3&&L.writeVarint(dr(7,1))}}function Ue(H,L){var F=typeof H;F==="string"?L.writeStringField(1,H):F==="boolean"?L.writeBooleanField(7,H):F==="number"&&(H%1!=0?L.writeDoubleField(3,H):H<0?L.writeSVarintField(6,H):L.writeVarintField(5,H))}Ot.exports=mt,Ot.exports.fromVectorTileJs=mt,Ot.exports.fromGeojsonVt=function(H,L){L=L||{};var F={};for(var U in H)F[U]=new Ae(H[U].features,L),F[U].name=U,F[U].version=L.version,F[U].extent=L.extent;return mt({layers:F})},Ot.exports.GeoJSONWrapper=Ae;var Xe=c.bz(Ot.exports);const nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},ae=Math.fround||(Pe=new Float32Array(1),H=>(Pe[0]=+H,Pe[0]));var Pe;const Ne=3,wt=5,Nt=6;class Zt{constructor(L){this.options=Object.assign(Object.create(nt),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:F,minZoom:U,maxZoom:X}=this.options;F&&console.time("total time");const Q=`prepare ${L.length} points`;F&&console.time(Q),this.points=L;const me=[];for(let te=0;te<L.length;te++){const pe=L[te];if(!pe.geometry)continue;const[ze,Re]=pe.geometry.coordinates,Be=ae(Ct(ze)),At=ae(rr(Re));me.push(Be,At,1/0,te,-1,1),this.options.reduce&&me.push(0)}let se=this.trees[X+1]=this._createTree(me);F&&console.timeEnd(Q);for(let te=X;te>=U;te--){const pe=+Date.now();se=this.trees[te]=this._createTree(this._cluster(se,te)),F&&console.log("z%d: %d clusters in %dms",te,se.numItems,+Date.now()-pe)}return F&&console.timeEnd("total time"),this}getClusters(L,F){let U=((L[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,L[1]));let Q=L[2]===180?180:((L[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)U=-180,Q=180;else if(U>Q){const Re=this.getClusters([U,X,180,me],F),Be=this.getClusters([-180,X,Q,me],F);return Re.concat(Be)}const se=this.trees[this._limitZoom(F)],te=se.range(Ct(U),rr(me),Ct(Q),rr(X)),pe=se.data,ze=[];for(const Re of te){const Be=this.stride*Re;ze.push(pe[Be+wt]>1?lr(pe,Be,this.clusterProps):this.points[pe[Be+Ne]])}return ze}getChildren(L){const F=this._getOriginId(L),U=this._getOriginZoom(L),X="No cluster with the specified id.",Q=this.trees[U];if(!Q)throw new Error(X);const me=Q.data;if(F*this.stride>=me.length)throw new Error(X);const se=this.options.radius/(this.options.extent*Math.pow(2,U-1)),te=Q.within(me[F*this.stride],me[F*this.stride+1],se),pe=[];for(const ze of te){const Re=ze*this.stride;me[Re+4]===L&&pe.push(me[Re+wt]>1?lr(me,Re,this.clusterProps):this.points[me[Re+Ne]])}if(pe.length===0)throw new Error(X);return pe}getLeaves(L,F,U){const X=[];return this._appendLeaves(X,L,F=F||10,U=U||0,0),X}getTile(L,F,U){const X=this.trees[this._limitZoom(L)],Q=Math.pow(2,L),{extent:me,radius:se}=this.options,te=se/me,pe=(U-te)/Q,ze=(U+1+te)/Q,Re={features:[]};return this._addTileFeatures(X.range((F-te)/Q,pe,(F+1+te)/Q,ze),X.data,F,U,Q,Re),F===0&&this._addTileFeatures(X.range(1-te/Q,pe,1,ze),X.data,Q,U,Q,Re),F===Q-1&&this._addTileFeatures(X.range(0,pe,te/Q,ze),X.data,-1,U,Q,Re),Re.features.length?Re:null}getClusterExpansionZoom(L){let F=this._getOriginZoom(L)-1;for(;F<=this.options.maxZoom;){const U=this.getChildren(L);if(F++,U.length!==1)break;L=U[0].properties.cluster_id}return F}_appendLeaves(L,F,U,X,Q){const me=this.getChildren(F);for(const se of me){const te=se.properties;if(te&&te.cluster?Q+te.point_count<=X?Q+=te.point_count:Q=this._appendLeaves(L,te.cluster_id,U,X,Q):Q<X?Q++:L.push(se),L.length===U)break}return Q}_createTree(L){const F=new c.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<L.length;U+=this.stride)F.add(L[U],L[U+1]);return F.finish(),F.data=L,F}_addTileFeatures(L,F,U,X,Q,me){for(const se of L){const te=se*this.stride,pe=F[te+wt]>1;let ze,Re,Be;if(pe)ze=_t(F,te,this.clusterProps),Re=F[te],Be=F[te+1];else{const St=this.points[F[te+Ne]];ze=St.properties;const[Ft,Gt]=St.geometry.coordinates;Re=Ct(Ft),Be=rr(Gt)}const At={type:1,geometry:[[Math.round(this.options.extent*(Re*Q-U)),Math.round(this.options.extent*(Be*Q-X))]],tags:ze};let Xt;Xt=pe||this.options.generateId?F[te+Ne]:this.points[F[te+Ne]].id,Xt!==void 0&&(At.id=Xt),me.features.push(At)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,F){const{radius:U,extent:X,reduce:Q,minPoints:me}=this.options,se=U/(X*Math.pow(2,F)),te=L.data,pe=[],ze=this.stride;for(let Re=0;Re<te.length;Re+=ze){if(te[Re+2]<=F)continue;te[Re+2]=F;const Be=te[Re],At=te[Re+1],Xt=L.within(te[Re],te[Re+1],se),St=te[Re+wt];let Ft=St;for(const Gt of Xt){const Ir=Gt*ze;te[Ir+2]>F&&(Ft+=te[Ir+wt])}if(Ft>St&&Ft>=me){let Gt,Ir=Be*St,zr=At*St,wr=-1;const yr=((Re/ze|0)<<5)+(F+1)+this.points.length;for(const Zi of Xt){const Br=Zi*ze;if(te[Br+2]<=F)continue;te[Br+2]=F;const yi=te[Br+wt];Ir+=te[Br]*yi,zr+=te[Br+1]*yi,te[Br+4]=yr,Q&&(Gt||(Gt=this._map(te,Re,!0),wr=this.clusterProps.length,this.clusterProps.push(Gt)),Q(Gt,this._map(te,Br)))}te[Re+4]=yr,pe.push(Ir/Ft,zr/Ft,1/0,yr,-1,Ft),Q&&pe.push(wr)}else{for(let Gt=0;Gt<ze;Gt++)pe.push(te[Re+Gt]);if(Ft>1)for(const Gt of Xt){const Ir=Gt*ze;if(!(te[Ir+2]<=F)){te[Ir+2]=F;for(let zr=0;zr<ze;zr++)pe.push(te[Ir+zr])}}}}return pe}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,F,U){if(L[F+wt]>1){const me=this.clusterProps[L[F+Nt]];return U?Object.assign({},me):me}const X=this.points[L[F+Ne]].properties,Q=this.options.map(X);return U&&Q===X?Object.assign({},Q):Q}}function lr(H,L,F){return{type:"Feature",id:H[L+Ne],properties:_t(H,L,F),geometry:{type:"Point",coordinates:[(U=H[L],360*(U-.5)),ir(H[L+1])]}};var U}function _t(H,L,F){const U=H[L+wt],X=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,Q=H[L+Nt],me=Q===-1?{}:Object.assign({},F[Q]);return Object.assign(me,{cluster:!0,cluster_id:H[L+Ne],point_count:U,point_count_abbreviated:X})}function Ct(H){return H/360+.5}function rr(H){const L=Math.sin(H*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function ir(H){const L=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Tr(H,L,F,U){for(var X,Q=U,me=F-L>>1,se=F-L,te=H[L],pe=H[L+1],ze=H[F],Re=H[F+1],Be=L+3;Be<F;Be+=3){var At=Nr(H[Be],H[Be+1],te,pe,ze,Re);if(At>Q)X=Be,Q=At;else if(At===Q){var Xt=Math.abs(Be-me);Xt<se&&(X=Be,se=Xt)}}Q>U&&(X-L>3&&Tr(H,L,X,U),H[X+2]=Q,F-X>3&&Tr(H,X,F,U))}function Nr(H,L,F,U,X,Q){var me=X-F,se=Q-U;if(me!==0||se!==0){var te=((H-F)*me+(L-U)*se)/(me*me+se*se);te>1?(F=X,U=Q):te>0&&(F+=me*te,U+=se*te)}return(me=H-F)*me+(se=L-U)*se}function vr(H,L,F,U){var X={id:H===void 0?null:H,type:L,geometry:F,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var me=Q.geometry,se=Q.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")xr(Q,me);else if(se==="Polygon"||se==="MultiLineString")for(var te=0;te<me.length;te++)xr(Q,me[te]);else if(se==="MultiPolygon")for(te=0;te<me.length;te++)for(var pe=0;pe<me[te].length;pe++)xr(Q,me[te][pe])}(X),X}function xr(H,L){for(var F=0;F<L.length;F+=3)H.minX=Math.min(H.minX,L[F]),H.minY=Math.min(H.minY,L[F+1]),H.maxX=Math.max(H.maxX,L[F]),H.maxY=Math.max(H.maxY,L[F+1])}function nr(H,L,F,U){if(L.geometry){var X=L.geometry.coordinates,Q=L.geometry.type,me=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),se=[],te=L.id;if(F.promoteId?te=L.properties[F.promoteId]:F.generateId&&(te=U||0),Q==="Point")Vr(X,se);else if(Q==="MultiPoint")for(var pe=0;pe<X.length;pe++)Vr(X[pe],se);else if(Q==="LineString")fr(X,se,me,!1);else if(Q==="MultiLineString"){if(F.lineMetrics){for(pe=0;pe<X.length;pe++)fr(X[pe],se=[],me,!1),H.push(vr(te,"LineString",se,L.properties));return}Er(X,se,me,!1)}else if(Q==="Polygon")Er(X,se,me,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(pe=0;pe<L.geometry.geometries.length;pe++)nr(H,{id:te,geometry:L.geometry.geometries[pe],properties:L.properties},F,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<X.length;pe++){var ze=[];Er(X[pe],ze,me,!0),se.push(ze)}}H.push(vr(te,Q,se,L.properties))}}function Vr(H,L){L.push(Te(H[0])),L.push(Wr(H[1])),L.push(0)}function fr(H,L,F,U){for(var X,Q,me=0,se=0;se<H.length;se++){var te=Te(H[se][0]),pe=Wr(H[se][1]);L.push(te),L.push(pe),L.push(0),se>0&&(me+=U?(X*pe-te*Q)/2:Math.sqrt(Math.pow(te-X,2)+Math.pow(pe-Q,2))),X=te,Q=pe}var ze=L.length-3;L[2]=1,Tr(L,0,ze,F),L[ze+2]=1,L.size=Math.abs(me),L.start=0,L.end=L.size}function Er(H,L,F,U){for(var X=0;X<H.length;X++){var Q=[];fr(H[X],Q,F,U),L.push(Q)}}function Te(H){return H/360+.5}function Wr(H){var L=Math.sin(H*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function Jr(H,L,F,U,X,Q,me,se){if(U/=L,Q>=(F/=L)&&me<U)return H;if(me<F||Q>=U)return null;for(var te=[],pe=0;pe<H.length;pe++){var ze=H[pe],Re=ze.geometry,Be=ze.type,At=X===0?ze.minX:ze.minY,Xt=X===0?ze.maxX:ze.maxY;if(At>=F&&Xt<U)te.push(ze);else if(!(Xt<F||At>=U)){var St=[];if(Be==="Point"||Be==="MultiPoint")kr(Re,St,F,U,X);else if(Be==="LineString")Kt(Re,St,F,U,X,!1,se.lineMetrics);else if(Be==="MultiLineString")Hr(Re,St,F,U,X,!1);else if(Be==="Polygon")Hr(Re,St,F,U,X,!0);else if(Be==="MultiPolygon")for(var Ft=0;Ft<Re.length;Ft++){var Gt=[];Hr(Re[Ft],Gt,F,U,X,!0),Gt.length&&St.push(Gt)}if(St.length){if(se.lineMetrics&&Be==="LineString"){for(Ft=0;Ft<St.length;Ft++)te.push(vr(ze.id,Be,St[Ft],ze.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(St.length===1?(Be="LineString",St=St[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=St.length===3?"Point":"MultiPoint"),te.push(vr(ze.id,Be,St,ze.tags))}}}return te.length?te:null}function kr(H,L,F,U,X){for(var Q=0;Q<H.length;Q+=3){var me=H[Q+X];me>=F&&me<=U&&(L.push(H[Q]),L.push(H[Q+1]),L.push(H[Q+2]))}}function Kt(H,L,F,U,X,Q,me){for(var se,te,pe=ui(H),ze=X===0?Ui:Qn,Re=H.start,Be=0;Be<H.length-3;Be+=3){var At=H[Be],Xt=H[Be+1],St=H[Be+2],Ft=H[Be+3],Gt=H[Be+4],Ir=X===0?At:Xt,zr=X===0?Ft:Gt,wr=!1;me&&(se=Math.sqrt(Math.pow(At-Ft,2)+Math.pow(Xt-Gt,2))),Ir<F?zr>F&&(te=ze(pe,At,Xt,Ft,Gt,F),me&&(pe.start=Re+se*te)):Ir>U?zr<U&&(te=ze(pe,At,Xt,Ft,Gt,U),me&&(pe.start=Re+se*te)):Kr(pe,At,Xt,St),zr<F&&Ir>=F&&(te=ze(pe,At,Xt,Ft,Gt,F),wr=!0),zr>U&&Ir<=U&&(te=ze(pe,At,Xt,Ft,Gt,U),wr=!0),!Q&&wr&&(me&&(pe.end=Re+se*te),L.push(pe),pe=ui(H)),me&&(Re+=se)}var yr=H.length-3;At=H[yr],Xt=H[yr+1],St=H[yr+2],(Ir=X===0?At:Xt)>=F&&Ir<=U&&Kr(pe,At,Xt,St),yr=pe.length-3,Q&&yr>=3&&(pe[yr]!==pe[0]||pe[yr+1]!==pe[1])&&Kr(pe,pe[0],pe[1],pe[2]),pe.length&&L.push(pe)}function ui(H){var L=[];return L.size=H.size,L.start=H.start,L.end=H.end,L}function Hr(H,L,F,U,X,Q){for(var me=0;me<H.length;me++)Kt(H[me],L,F,U,X,Q,!1)}function Kr(H,L,F,U){H.push(L),H.push(F),H.push(U)}function Ui(H,L,F,U,X,Q){var me=(Q-L)/(U-L);return H.push(Q),H.push(F+(X-F)*me),H.push(1),me}function Qn(H,L,F,U,X,Q){var me=(Q-F)/(X-F);return H.push(L+(U-L)*me),H.push(Q),H.push(1),me}function un(H,L){for(var F=[],U=0;U<H.length;U++){var X,Q=H[U],me=Q.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")X=Ai(Q.geometry,L);else if(me==="MultiLineString"||me==="Polygon"){X=[];for(var se=0;se<Q.geometry.length;se++)X.push(Ai(Q.geometry[se],L))}else if(me==="MultiPolygon")for(X=[],se=0;se<Q.geometry.length;se++){for(var te=[],pe=0;pe<Q.geometry[se].length;pe++)te.push(Ai(Q.geometry[se][pe],L));X.push(te)}F.push(vr(Q.id,me,X,Q.tags))}return F}function Ai(H,L){var F=[];F.size=H.size,H.start!==void 0&&(F.start=H.start,F.end=H.end);for(var U=0;U<H.length;U+=3)F.push(H[U]+L,H[U+1],H[U+2]);return F}function Ge(H,L){if(H.transformed)return H;var F,U,X,Q=1<<H.z,me=H.x,se=H.y;for(F=0;F<H.features.length;F++){var te=H.features[F],pe=te.geometry,ze=te.type;if(te.geometry=[],ze===1)for(U=0;U<pe.length;U+=2)te.geometry.push($i(pe[U],pe[U+1],L,Q,me,se));else for(U=0;U<pe.length;U++){var Re=[];for(X=0;X<pe[U].length;X+=2)Re.push($i(pe[U][X],pe[U][X+1],L,Q,me,se));te.geometry.push(Re)}}return H.transformed=!0,H}function $i(H,L,F,U,X,Q){return[Math.round(F*(H*U-X)),Math.round(F*(L*U-Q))]}function jr(H,L,F,U,X){for(var Q=L===X.maxZoom?0:X.tolerance/((1<<L)*X.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:U,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<H.length;se++){me.numFeatures++,xa(me,H[se],Q,X);var te=H[se].minX,pe=H[se].minY,ze=H[se].maxX,Re=H[se].maxY;te<me.minX&&(me.minX=te),pe<me.minY&&(me.minY=pe),ze>me.maxX&&(me.maxX=ze),Re>me.maxY&&(me.maxY=Re)}return me}function xa(H,L,F,U){var X=L.geometry,Q=L.type,me=[];if(Q==="Point"||Q==="MultiPoint")for(var se=0;se<X.length;se+=3)me.push(X[se]),me.push(X[se+1]),H.numPoints++,H.numSimplified++;else if(Q==="LineString")es(me,X,H,F,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(se=0;se<X.length;se++)es(me,X[se],H,F,Q==="Polygon",se===0);else if(Q==="MultiPolygon")for(var te=0;te<X.length;te++){var pe=X[te];for(se=0;se<pe.length;se++)es(me,pe[se],H,F,!0,se===0)}if(me.length){var ze=L.tags||null;if(Q==="LineString"&&U.lineMetrics){for(var Re in ze={},L.tags)ze[Re]=L.tags[Re];ze.mapbox_clip_start=X.start/X.size,ze.mapbox_clip_end=X.end/X.size}var Be={geometry:me,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:ze};L.id!==null&&(Be.id=L.id),H.features.push(Be)}}function es(H,L,F,U,X,Q){var me=U*U;if(U>0&&L.size<(X?me:U))F.numPoints+=L.length/3;else{for(var se=[],te=0;te<L.length;te+=3)(U===0||L[te+2]>me)&&(F.numSimplified++,se.push(L[te]),se.push(L[te+1])),F.numPoints++;X&&function(pe,ze){for(var Re=0,Be=0,At=pe.length,Xt=At-2;Be<At;Xt=Be,Be+=2)Re+=(pe[Be]-pe[Xt])*(pe[Be+1]+pe[Xt+1]);if(Re>0===ze)for(Be=0,At=pe.length;Be<At/2;Be+=2){var St=pe[Be],Ft=pe[Be+1];pe[Be]=pe[At-2-Be],pe[Be+1]=pe[At-1-Be],pe[At-2-Be]=St,pe[At-1-Be]=Ft}}(se,Q),H.push(se)}}function Qe(H,L){var F=(L=this.options=function(X,Q){for(var me in Q)X[me]=Q[me];return X}(Object.create(this.options),L)).debug;if(F&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(X,Q){var me=[];if(X.type==="FeatureCollection")for(var se=0;se<X.features.length;se++)nr(me,X.features[se],Q,se);else nr(me,X.type==="Feature"?X:{geometry:X},Q);return me}(H,L);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),U=function(X,Q){var me=Q.buffer/Q.extent,se=X,te=Jr(X,1,-1-me,me,0,-1,2,Q),pe=Jr(X,1,1-me,2+me,0,-1,2,Q);return(te||pe)&&(se=Jr(X,1,-me,1+me,0,-1,2,Q)||[],te&&(se=un(te,1).concat(se)),pe&&(se=se.concat(un(pe,-1)))),se}(U,L),U.length&&this.splitTile(U,0,0,0),F&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function sr(H,L,F){return 32*((1<<H)*F+L)+H}function Jt(H,L){return L?H.properties[L]:H.id}function qi(H,L){if(H==null)return!0;if(H.type==="Feature")return Jt(H,L)!=null;if(H.type==="FeatureCollection"){const F=new Set;for(const U of H.features){const X=Jt(U,L);if(X==null||F.has(X))return!1;F.add(X)}return!0}return!1}function cn(H,L){const F=new Map;if(H!=null)if(H.type==="Feature")F.set(Jt(H,L),H);else for(const U of H.features)F.set(Jt(U,L),U);return F}Qe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qe.prototype.splitTile=function(H,L,F,U,X,Q,me){for(var se=[H,L,F,U],te=this.options,pe=te.debug;se.length;){U=se.pop(),F=se.pop(),L=se.pop(),H=se.pop();var ze=1<<L,Re=sr(L,F,U),Be=this.tiles[Re];if(!Be&&(pe>1&&console.time("creation"),Be=this.tiles[Re]=jr(H,L,F,U,te),this.tileCoords.push({z:L,x:F,y:U}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,F,U,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var At="z"+L;this.stats[At]=(this.stats[At]||0)+1,this.total++}if(Be.source=H,X){if(L===te.maxZoom||L===X)continue;var Xt=1<<X-L;if(F!==Math.floor(Q/Xt)||U!==Math.floor(me/Xt))continue}else if(L===te.indexMaxZoom||Be.numPoints<=te.indexMaxPoints)continue;if(Be.source=null,H.length!==0){pe>1&&console.time("clipping");var St,Ft,Gt,Ir,zr,wr,yr=.5*te.buffer/te.extent,Zi=.5-yr,Br=.5+yr,yi=1+yr;St=Ft=Gt=Ir=null,zr=Jr(H,ze,F-yr,F+Br,0,Be.minX,Be.maxX,te),wr=Jr(H,ze,F+Zi,F+yi,0,Be.minX,Be.maxX,te),H=null,zr&&(St=Jr(zr,ze,U-yr,U+Br,1,Be.minY,Be.maxY,te),Ft=Jr(zr,ze,U+Zi,U+yi,1,Be.minY,Be.maxY,te),zr=null),wr&&(Gt=Jr(wr,ze,U-yr,U+Br,1,Be.minY,Be.maxY,te),Ir=Jr(wr,ze,U+Zi,U+yi,1,Be.minY,Be.maxY,te),wr=null),pe>1&&console.timeEnd("clipping"),se.push(St||[],L+1,2*F,2*U),se.push(Ft||[],L+1,2*F,2*U+1),se.push(Gt||[],L+1,2*F+1,2*U),se.push(Ir||[],L+1,2*F+1,2*U+1)}}},Qe.prototype.getTile=function(H,L,F){var U=this.options,X=U.extent,Q=U.debug;if(H<0||H>24)return null;var me=1<<H,se=sr(H,L=(L%me+me)%me,F);if(this.tiles[se])return Ge(this.tiles[se],X);Q>1&&console.log("drilling down to z%d-%d-%d",H,L,F);for(var te,pe=H,ze=L,Re=F;!te&&pe>0;)pe--,ze=Math.floor(ze/2),Re=Math.floor(Re/2),te=this.tiles[sr(pe,ze,Re)];return te&&te.source?(Q>1&&console.log("found parent tile z%d-%d-%d",pe,ze,Re),Q>1&&console.time("drilling down"),this.splitTile(te.source,pe,ze,Re,H,L,F),Q>1&&console.timeEnd("drilling down"),this.tiles[se]?Ge(this.tiles[se],X):null):null};class Qt extends xt{constructor(L,F,U,X){super(L,F,U),this._dataUpdateable=new Map,this.loadGeoJSON=(Q,me)=>{const{promoteId:se}=Q;if(Q.request)return c.f(Q.request,(te,pe,ze,Re)=>{this._dataUpdateable=qi(pe,se)?cn(pe,se):void 0,me(te,pe,ze,Re)});if(typeof Q.data=="string")try{const te=JSON.parse(Q.data);this._dataUpdateable=qi(te,se)?cn(te,se):void 0,me(null,te)}catch{me(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}else Q.dataDiff?this._dataUpdateable?(function(te,pe,ze){var Re,Be,At,Xt;if(pe.removeAll&&te.clear(),pe.remove)for(const St of pe.remove)te.delete(St);if(pe.add)for(const St of pe.add){const Ft=Jt(St,ze);Ft!=null&&te.set(Ft,St)}if(pe.update)for(const St of pe.update){let Ft=te.get(St.id);if(Ft==null)continue;const Gt=!St.removeAllProperties&&(((Re=St.removeProperties)===null||Re===void 0?void 0:Re.length)>0||((Be=St.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0);if((St.newGeometry||St.removeAllProperties||Gt)&&(Ft=Object.assign({},Ft),te.set(St.id,Ft),Gt&&(Ft.properties=Object.assign({},Ft.properties))),St.newGeometry&&(Ft.geometry=St.newGeometry),St.removeAllProperties)Ft.properties={};else if(((At=St.removeProperties)===null||At===void 0?void 0:At.length)>0)for(const Ir of St.removeProperties)Object.prototype.hasOwnProperty.call(Ft.properties,Ir)&&delete Ft.properties[Ir];if(((Xt=St.addOrUpdateProperties)===null||Xt===void 0?void 0:Xt.length)>0)for(const{key:Ir,value:zr}of St.addOrUpdateProperties)Ft.properties[Ir]=zr}}(this._dataUpdateable,Q.dataDiff,se),me(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):me(new Error(`Cannot update existing geojson data in ${Q.source}`)):me(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,X&&(this.loadGeoJSON=X)}loadGeoJSONTile(L,F){const U=L.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const X=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!X)return F(null,null);const Q=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.N,this.length=se.length,this._features=se}feature(se){return new class{constructor(te){this._feature=te,this.extent=c.N,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const pe of this._feature.geometry)te.push([new c.P(pe[0],pe[1])]);return te}{const te=[];for(const pe of this._feature.geometry){const ze=[];for(const Re of pe)ze.push(new c.P(Re[0],Re[1]));te.push(ze)}return te}}toGeoJSON(te,pe,ze){return Lt.call(this,te,pe,ze)}}(this._features[se])}}(X.features);let me=Xe(Q);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),F(null,{vectorTile:Q,rawData:me.buffer})}loadData(L,F){var U;(U=this._pendingRequest)===null||U===void 0||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const X=!!(L&&L.request&&L.request.collectResourceTiming)&&new c.bu(L.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(L,(Q,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!me)return F(Q);if(typeof me!="object")return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{pt(me,!0);try{if(L.filter){const te=c.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(ze=>te.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=L.cluster?new Zt(function({superclusterOptions:te,clusterProperties:pe}){if(!pe||!te)return te;const ze={},Re={},Be={accumulated:null,zoom:0},At={properties:null},Xt=Object.keys(pe);for(const St of Xt){const[Ft,Gt]=pe[St],Ir=c.bC(Gt),zr=c.bC(typeof Ft=="string"?[Ft,["accumulated"],["get",St]]:Ft);ze[St]=Ir.value,Re[St]=zr.value}return te.map=St=>{At.properties=St;const Ft={};for(const Gt of Xt)Ft[Gt]=ze[Gt].evaluate(Be,At);return Ft},te.reduce=(St,Ft)=>{At.properties=Ft;for(const Gt of Xt)Be.accumulated=St[Gt],St[Gt]=Re[Gt].evaluate(Be,At)},te}(L)).load(me.features):function(te,pe){return new Qe(te,pe)}(me,L.geojsonVtOptions)}catch(te){return F(te)}this.loaded={};const se={};if(X){const te=X.finish();te&&(se.resourceTiming={},se.resourceTiming[L.source]=JSON.parse(JSON.stringify(te)))}F(null,se)}})}reloadTile(L,F){const U=this.loaded;return U&&U[L.uid]?super.reloadTile(L,F):this.loadTile(L,F)}removeSource(L,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(L,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(U){F(U)}}getClusterChildren(L,F){try{F(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(U){F(U)}}getClusterLeaves(L,F){try{F(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(U){F(U)}}}class ms{constructor(L){this.self=L,this.actor=new c.C(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:xt,geojson:Qt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,U)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=U},this.self.registerRTLTextPlugin=F=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.applyArabicShaping=F.applyArabicShaping,c.bD.processBidirectionalText=F.processBidirectionalText,c.bD.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(L,F){this.referrer=F}setImages(L,F,U){this.availableImages[L]=F;for(const X in this.workerSources[L]){const Q=this.workerSources[L][X];for(const me in Q)Q[me].availableImages=F}U()}setLayers(L,F,U){this.getLayerIndex(L).replace(F),U()}updateLayers(L,F,U){this.getLayerIndex(L).update(F.layers,F.removedIds),U()}loadTile(L,F,U){this.getWorkerSource(L,F.type,F.source).loadTile(F,U)}loadDEMTile(L,F,U){this.getDEMWorkerSource(L,F.source).loadTile(F,U)}reloadTile(L,F,U){this.getWorkerSource(L,F.type,F.source).reloadTile(F,U)}abortTile(L,F,U){this.getWorkerSource(L,F.type,F.source).abortTile(F,U)}removeTile(L,F,U){this.getWorkerSource(L,F.type,F.source).removeTile(F,U)}removeDEMTile(L,F){this.getDEMWorkerSource(L,F.source).removeTile(F)}removeSource(L,F,U){if(!this.workerSources[L]||!this.workerSources[L][F.type]||!this.workerSources[L][F.type][F.source])return;const X=this.workerSources[L][F.type][F.source];delete this.workerSources[L][F.type][F.source],X.removeSource!==void 0?X.removeSource(F,U):U()}loadWorkerSource(L,F,U){try{this.self.importScripts(F.url),U()}catch(X){U(X.toString())}}syncRTLPluginState(L,F,U){try{c.bD.setState(F);const X=c.bD.getPluginURL();if(c.bD.isLoaded()&&!c.bD.isParsed()&&X!=null){this.self.importScripts(X);const Q=c.bD.isParsed();U(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${X}`),Q)}}catch(X){U(X.toString())}}getAvailableImages(L){let F=this.availableImages[L];return F||(F=[]),F}getLayerIndex(L){let F=this.layerIndexes[L];return F||(F=this.layerIndexes[L]=new ye),F}getWorkerSource(L,F,U){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][F]||(this.workerSources[L][F]={}),this.workerSources[L][F][U]||(this.workerSources[L][F][U]=new this.workerSourceTypes[F]({send:(X,Q,me)=>{this.actor.send(X,Q,me,L)}},this.getLayerIndex(L),this.getAvailableImages(L))),this.workerSources[L][F][U]}getDEMWorkerSource(L,F){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][F]||(this.demWorkerSources[L][F]=new Je),this.demWorkerSources[L][F]}}return c.i()&&(self.worker=new ms(self)),ms}),ce(["./shared"],function(c){var ye="3.6.2";class ${static testProp(t){if(!$.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in $.docStyle)return t[s];return t[0]}static create(t,s,l){const h=window.document.createElement(t);return s!==void 0&&(h.className=s),l&&l.appendChild(h),h}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(t,s){t.style[$.transformProp]=s}static addEventListener(t,s,l,h={}){t.addEventListener(s,l,"passive"in h?h:h.capture)}static removeEventListener(t,s,l,h={}){t.removeEventListener(s,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static mousePos(t,s){const l=t.getBoundingClientRect();return new c.P(s.clientX-l.left-t.clientLeft,s.clientY-l.top-t.clientTop)}static touchPos(t,s){const l=t.getBoundingClientRect(),h=[];for(let f=0;f<s.length;f++)h.push(new c.P(s[f].clientX-l.left-t.clientLeft,s[f].clientY-l.top-t.clientTop));return h}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(p){!xt&&Ce&&(Je?at(p):Me=p)}};let Me,Ce,xt=!1,Je=!1;function at(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ce),p.isContextLost())return;Le.supported=!0}catch{}p.deleteTexture(t),xt=!0}var je,pt;typeof document<"u"&&(Ce=document.createElement("img"),Ce.onload=function(){Me&&at(Me),Me=null,Je=!0},Ce.onerror=function(){xt=!0,Me=null},Ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,s,l,h;p.resetRequestQueue=()=>{t=[],s=0,l=0,h={}},p.addThrottleControl=E=>{const I=l++;return h[I]=E,I},p.removeThrottleControl=E=>{delete h[E],x()},p.getImage=(E,I,P=!0)=>{Le.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*");const B={requestParameters:E,supportImageRefresh:P,callback:I,cancelled:!1,completed:!1,cancel:()=>{B.completed||B.cancelled||(B.cancelled=!0,B.innerRequest&&(B.innerRequest.cancel(),s--),x())}};return t.push(B),x(),B};const f=E=>{const{requestParameters:I,supportImageRefresh:P,callback:B}=E;return c.e(I,{type:"image"}),(P!==!1||c.i()||c.g(I.url)||I.headers&&!Object.keys(I.headers).reduce((Z,G)=>Z&&G==="accept",!0)?c.m:S)(I,(Z,G,K,q)=>{v(E,B,Z,G,K,q)})},v=(E,I,P,B,Z,G)=>{P?I(P):B instanceof HTMLImageElement||c.a(B)?I(null,B):B&&((K,q)=>{typeof createImageBitmap=="function"?c.b(K,q):c.d(K,q)})(B,(K,q)=>{K!=null?I(K):q!=null&&I(null,q,{cacheControl:Z,expires:G})}),E.cancelled||(E.completed=!0,s--,x())},x=()=>{const E=(()=>{const I=Object.keys(h);let P=!1;if(I.length>0){for(const B of I)if(P=h[B](),P)break}return P})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=s;I<E&&t.length>0;I++){const P=t.shift();if(P.cancelled){I--;continue}const B=f(P);s++,P.innerRequest=B}},S=(E,I)=>{const P=new Image,B=E.url;let Z=!1;const G=E.credentials;return G&&G==="include"?P.crossOrigin="use-credentials":(G&&G==="same-origin"||!c.s(B))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{I(null,P),P.onerror=P.onload=null},P.onerror=()=>{Z||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=B,{cancel:()=>{Z=!0,P.src=""}}}}(je||(je={})),je.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(pt||(pt={}));class Lt{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,l){const h=function(f){const v=f.match(Ot);if(!v)throw new Error(`Unable to parse URL "${f}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return h.path+=`${s}${l}`,function(f){const v=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${v}`}(h)}setTransformRequest(t){this._transformRequestFn=t}}const Ot=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ut(p){var t=new c.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var Dt,Rt=function(p,t,s){return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],p};Dt=new c.A(3),c.A!=Float32Array&&(Dt[0]=0,Dt[1]=0,Dt[2]=0);var ft=function(p){var t=p[0],s=p[1];return t*t+s*s};function le(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:h}of p){const f=`${l}${h}`;s.indexOf(f)===-1&&(s.push(f),t.push({id:l,url:h}))}}return t}function ve(p,t,s,l,h){if(l)return void p(l);if(h!==Object.values(t).length||h!==Object.values(s).length)return;const f={};for(const v in t){f[v]={};const x=c.h.getImageCanvasContext(s[v]),S=t[v];for(const E in S){const{width:I,height:P,x:B,y:Z,sdf:G,pixelRatio:K,stretchX:q,stretchY:oe,content:we}=S[E];f[v][E]={data:null,pixelRatio:K,sdf:G,stretchX:q,stretchY:oe,content:we,spriteData:{width:I,height:P,x:B,y:Z,context:x}}}}p(null,f)}(function(){var p=new c.A(2);c.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Ae{constructor(t,s,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,h)}update(t,s,l){const{width:h,height:f}=t,v=!(this.size&&this.size[0]===h&&this.size[1]===f||l),{context:x}=this,{gl:S}=x;if(this.useMipmap=!!(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[h,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||c.a(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,h,f,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:E,y:I}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||c.a(t)?S.texSubImage2D(S.TEXTURE_2D,0,E,I,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,E,I,h,f,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(t,s,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function mt(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class ot extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:l}of this.requestors)this._notify(s,l);this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const h=s.data||s.spriteData;return this._validateStretch(s.stretchX,h&&h.width)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,h&&h.height)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||s<h[1])return!1;l=h[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,h=l&&l.width||s.data.width,f=l&&l.height||s.data.height;return!(t[0]<0||h<t[0]||t[1]<0||f<t[1]||t[2]<0||h<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==s.data.width||h.data.height!==s.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=h.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let l=!0;if(!this.isLoaded())for(const h of t)this.images[h]||(l=!1);this.isLoaded()||l?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const l={};for(const h of t){let f=this.getImage(h);f||(this.fire(new c.k("styleimagemissing",{id:h})),f=this.getImage(h)),f?l[h]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:c.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,l)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new c.I(h,l);this.patterns[t]={bin:h,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ae(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:s,h:l}=c.p(t),h=this.atlasImage;h.resize({width:s||1,height:l||1});for(const f in this.patterns){const{bin:v}=this.patterns[f],x=v.x+1,S=v.y+1,E=this.getImage(f).data,I=E.width,P=E.height;c.R.copy(E,h,{x:0,y:0},{x,y:S},{width:I,height:P}),c.R.copy(E,h,{x:0,y:P-1},{x,y:S-1},{width:I,height:1}),c.R.copy(E,h,{x:0,y:0},{x,y:S+P},{width:I,height:1}),c.R.copy(E,h,{x:I-1,y:0},{x:x-1,y:S},{width:1,height:P}),c.R.copy(E,h,{x:0,y:0},{x:x+I,y:S},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||c.w(`Image with ID: "${s}" was not found`),mt(l)&&this.updateImage(s,l)}}}const ct=1e20;function Wt(p,t,s,l,h,f,v,x,S){for(let E=t;E<t+l;E++)dr(p,s*f+E,f,h,v,x,S);for(let E=s;E<s+h;E++)dr(p,E*f+t,1,l,v,x,S)}function dr(p,t,s,l,h,f,v){f[0]=0,v[0]=-1e20,v[1]=ct,h[0]=p[t];for(let x=1,S=0,E=0;x<l;x++){h[x]=p[t+x*s];const I=x*x;do{const P=f[S];E=(h[x]-h[P]+I-P*P)/(x-P)/2}while(E<=v[S]&&--S>-1);S++,f[S]=x,v[S]=E,v[S+1]=ct}for(let x=0,S=0;x<l;x++){for(;v[S+1]<x;)S++;const E=f[S],I=x-E;p[t+x*s]=h[E]+I*I}}class pr{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const l=[];for(const h in t)for(const f of t[h])l.push({stack:h,id:f});c.o(l,({stack:h,id:f},v)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{}});let S=x.glyphs[f];if(S!==void 0)return void v(null,{stack:h,id:f,glyph:S});if(S=this._tinySDF(x,h,f),S)return x.glyphs[f]=S,void v(null,{stack:h,id:f,glyph:S});const E=Math.floor(f/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void v(null,{stack:h,id:f,glyph:S});if(!this.url)return void v(new Error("glyphsUrl is not set"));let I=x.requests[E];I||(I=x.requests[E]=[],pr.loadGlyphRange(h,E,this.url,this.requestManager,(P,B)=>{if(B){for(const Z in B)this._doesCharSupportLocalGlyph(+Z)||(x.glyphs[+Z]=B[+Z]);x.ranges[E]=!0}for(const Z of I)Z(P,B);delete x.requests[E]})),I.push((P,B)=>{P?v(P):B&&v(null,{stack:h,id:f,glyph:B[f]||null})})},(h,f)=>{if(h)s(h);else if(f){const v={};for(const{stack:x,id:S,glyph:E}of f)(v[x]||(v[x]={}))[S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};s(null,v)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](t)||c.u["Hangul Syllables"](t)||c.u.Hiragana(t)||c.u.Katakana(t))}_tinySDF(t,s,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let x="400";/bold/i.test(s)?x="900":/medium/i.test(s)?x="500":/light/i.test(s)&&(x="200"),f=t.tinySDF=new pr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:x})}const v=f.draw(String.fromCharCode(l));return{id:l,bitmap:new c.q({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}pr.loadGlyphRange=function(p,t,s,l,h){const f=256*t,v=f+255,x=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${f}-${v}`),pt.Glyphs);c.l(x,(S,E)=>{if(S)h(S);else if(E){const I={};for(const P of c.n(E))I[P.id]=P;h(null,I)}})},pr.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=s;const x=this.size=p+4*t,S=this._createCanvas(x),E=this.ctx=S.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${f} ${p}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(p),v=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),E=x+2*this.buffer,I=S+2*this.buffer,P=Math.max(E*I,0),B=new Uint8ClampedArray(P),Z={data:B,width:E,height:I,glyphWidth:x,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(x===0||S===0)return Z;const{ctx:G,buffer:K,gridInner:q,gridOuter:oe}=this;G.clearRect(K,K,x,S),G.fillText(p,K,K+v);const we=G.getImageData(K,K,x,S);oe.fill(ct,0,P),q.fill(0,0,P);for(let ee=0;ee<S;ee++)for(let he=0;he<x;he++){const be=we.data[4*(ee*x+he)+3]/255;if(be===0)continue;const Se=(ee+K)*E+he+K;if(be===1)oe[Se]=0,q[Se]=ct;else{const De=.5-be;oe[Se]=De>0?De*De:0,q[Se]=De<0?De*De:0}}Wt(oe,0,0,E,I,E,this.f,this.v,this.z),Wt(q,K,K,x,S,E,this.f,this.v,this.z);for(let ee=0;ee<P;ee++){const he=Math.sqrt(oe[ee])-Math.sqrt(q[ee]);B[ee]=Math.round(255-255*(he/this.radius+this.cutoff))}return Z}};class yt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(t,s){return c.z(t.expression.evaluate(s))}interpolate(t,s,l){return{x:c.B.number(t.x,s.x,l),y:c.B.number(t.y,s.y,l),z:c.B.number(t.z,s.z,l)}}}let Ue;class Xe extends c.E{constructor(t){super(),Ue=Ue||new c.r({anchor:new c.D(c.v.light.anchor),position:new yt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ue),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(c.t,t,s))for(const l in t){const h=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&c.x(this,t.call(c.y,c.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}}class nt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const h=[];let f=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,x=!0;h.push({left:f,right:v,isDash:x,zeroLength:t[0]===0});let S=t[0];for(let E=1;E<t.length;E++){x=!x;const I=t[E];f=S*l,S+=I,v=S*l,h.push({left:f,right:v,isDash:x,zeroLength:I===0})}return h}addRoundDash(t,s,l){const h=s/2;for(let f=-l;f<=l;f++){const v=this.width*(this.nextRow+l+f);let x=0,S=t[x];for(let E=0;E<this.width;E++){E/S.right>1&&(S=t[++x]);const I=Math.abs(E-S.left),P=Math.abs(E-S.right),B=Math.min(I,P);let Z;const G=f/l*(h+1);if(S.isDash){const K=h-Math.abs(G);Z=Math.sqrt(B*B+K*K)}else Z=h-Math.sqrt(B*B+G*G);this.data[v+E]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let x=t.length-1;x>=0;--x){const S=t[x],E=t[x+1];S.zeroLength?t.splice(x,1):E&&E.isDash===S.isDash&&(E.left=S.left,t.splice(x,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const h=this.width*this.nextRow;let f=0,v=t[f];for(let x=0;x<this.width;x++){x/v.right>1&&(v=t[++f]);const S=Math.abs(x-v.left),E=Math.abs(x-v.right),I=Math.min(S,E);this.data[h+x]=Math.max(0,Math.min(255,(v.isDash?I:-I)+128))}}addDash(t,s){const l=s?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let f=0;for(let x=0;x<t.length;x++)f+=t[x];if(f!==0){const x=this.width/f,S=this.getDashRanges(t,this.width,x);s?this.addRoundDash(S,x,l):this.addRegularDash(S)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=h,this.dirty=!0,v}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class ae{constructor(t,s,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const h=this.workerPool.acquire(l);for(let f=0;f<h.length;f++){const v=new c.C(h[f],s,l);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,l){c.o(this.actors,(h,f)=>{h.send(t,s,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Pe(p,t,s){const l=function(h,f){if(h)return s(h);if(f){const v=c.F(c.e(f,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(v.vectorLayers=f.vector_layers,v.vectorLayerIds=v.vectorLayers.map(x=>x.id)),s(null,v)}};return p.url?c.f(t.transformRequest(p.url,pt.Source),l):c.h.frame(()=>l(null,p))}class Ne{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.L?new c.L(t.lng,t.lat):c.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.L?new c.L(t.lng,t.lat):c.L.convert(t),this}extend(t){const s=this._sw,l=this._ne;let h,f;if(t instanceof c.L)h=t,f=t;else{if(!(t instanceof Ne))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ne.convert(t)):this.extend(c.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.L.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new c.L(h.lng,h.lat),this._ne=new c.L(f.lng,f.lat)),this}getCenter(){return new c.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.L(this.getWest(),this.getNorth())}getSouthEast(){return new c.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=c.L.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return t instanceof Ne?t:t&&new Ne(t)}static fromLngLat(t,s=0){const l=360*s/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new Ne(new c.L(t.lng-h,t.lat-l),new c.L(t.lng+h,t.lat+l))}}class wt{constructor(t,s,l){this.bounds=Ne.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(c.G(this.bounds.getWest())*s),h=Math.floor(c.H(this.bounds.getNorth())*s),f=Math.ceil(c.G(this.bounds.getEast())*s),v=Math.ceil(c.H(this.bounds.getSouth())*s);return t.x>=l&&t.x<f&&t.y>=h&&t.y<v}}class Nt extends c.E{constructor(t,s,l,h){if(super(),this.load=()=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Pe(this._options,this.map._requestManager,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),f?this.fire(new c.j(f)):v&&(c.e(this,v),v.bounds&&(this.tileBounds=new wt(v.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>c.e({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.F(s,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,s){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(l,pt.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(v,x){return delete t.request,t.aborted?s(null):v&&v.status!==404?s(v):(x&&x.resourceTiming&&(t.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&t.setExpiryData(x),t.loadVectorData(x,this.map.painter),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}h.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",h,f.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",h,f.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Zt extends c.E{constructor(t,s,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},s),c.e(this,c.F(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Pe(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new c.j(t)):s&&(c.e(this,s),s.bounds&&(this.tileBounds=new wt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=je.getImage(this.map._requestManager.transformRequest(l,pt.Tile),(h,f,v)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(h)t.state="errored",s(h);else if(f){this.map._refreshExpiredTiles&&v&&t.setExpiryData(v);const x=this.map.painter.context,S=x.gl;t.texture=this.map.painter.getTileTexture(f.width),t.texture?t.texture.update(f,{useMipmap:!0}):(t.texture=new Ae(x,f,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),t.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}class lr extends Zt{constructor(t,s,l,h){super(t,s,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t,s){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(l,pt.Tile);function f(v,x){v&&(t.state="errored",s(v)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=je.getImage(h,(v,x,S)=>c._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(v)t.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(S);const E=c.a(x)&&c.J()?x:yield function(P){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.K()){const B=P.width+2,Z=P.height+2;try{return new c.R({width:B,height:Z},yield c.M(P,-1,-1,B,Z))}catch{}}return c.h.getImageData(P,1)})}(x),I={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",I,f))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),h=(s.x-1+l)%l,f=s.x===0?t.wrap-1:t.wrap,v=(s.x+1+l)%l,x=s.x+1===l?t.wrap+1:t.wrap,S={};return S[new c.O(t.overscaledZ,f,s.z,h,s.y).key]={backfilled:!1},S[new c.O(t.overscaledZ,x,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(S[new c.O(t.overscaledZ,f,s.z,h,s.y-1).key]={backfilled:!1},S[new c.O(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new c.O(t.overscaledZ,x,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(S[new c.O(t.overscaledZ,f,s.z,h,s.y+1).key]={backfilled:!1},S[new c.O(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new c.O(t.overscaledZ,x,s.z,v,s.y+1).key]={backfilled:!1}),S}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class _t extends c.E{constructor(t,s,l,h){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>c.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=s.data,this._options=c.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=c.N/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:c.N,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.N,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,l,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:l},h),this}_updateWorkerData(t){const s=c.e({},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(c.h.resolveURL(this._data),pt.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(l,h)=>{if(this._pendingLoads--,this._removed||h&&h.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let f=null;if(h&&h.resourceTiming&&h.resourceTiming[this.id]&&(f=h.resourceTiming[this.id].slice(0)),l)return void this.fire(new c.j(l));const v={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&c.e(v,{resourceTiming:f}),this.fire(new c.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const h={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,h,(f,v)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):f?s(f):(t.loadVectorData(v,this.map.painter,l==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ct=c.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class rr extends c.E{constructor(t,s,l,h){super(),this.load=(f,v)=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=je.getImage(this.map._requestManager.transformRequest(this.url,pt.Image),(x,S)=>{this._request=null,this._loaded=!0,x?this.fire(new c.j(x)):S&&(this.image=S,f&&(this.coordinates=f),v&&v(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,v=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ae(f,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=s}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(c.U.fromLngLat);this.tileID=function(h){let f=1/0,v=1/0,x=-1/0,S=-1/0;for(const B of h)f=Math.min(f,B.x),v=Math.min(v,B.y),x=Math.max(x,B.x),S=Math.max(S,B.y);const E=Math.max(x-f,S-v),I=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),P=Math.pow(2,I);return new c.W(I,Math.floor((f+x)/2*P),Math.floor((v+S)/2*P))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new c.V,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,c.N,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,c.N),this._boundsArray.emplaceBack(l[2].x,l[2].y,c.N,c.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}hasTransition(){return!1}}class ir extends rr{constructor(t,s,l,h){super(t,s,l,h),this.load=()=>{this._loaded=!1;const f=this.options;this.urls=[];for(const v of f.urls)this.urls.push(this.map._requestManager.transformRequest(v,pt.Source).url);c.X(this.urls,(v,x)=>{this._loaded=!0,v?this.fire(new c.j(v)):x&&(this.video=x,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,v=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new Ae(f,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=s}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new c.j(new c.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Tr extends rr{constructor(t,s,l,h){super(t,s,l,h),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const v=this.map.painter.context,x=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ae(v,this.canvas,x.RGBA,{premultiply:!0});let S=!1;for(const E in this.tiles){const I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,S=!0)}S&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(v=>typeof v!="number"))||this.fire(new c.j(new c.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.Y(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.j(new c.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Nr={},vr=p=>{switch(p){case"geojson":return _t;case"image":return rr;case"raster":return Zt;case"raster-dem":return lr;case"vector":return Nt;case"video":return ir;case"canvas":return Tr}return Nr[p]};function xr(p,t){const s=c.Z();return c.$(s,s,[1,1,0]),c.a0(s,s,[.5*p.width,.5*p.height,1]),c.a1(s,s,p.calculatePosMatrix(t.toUnwrapped()))}function nr(p,t,s,l,h,f){const v=function(P,B,Z){if(P)for(const G of P){const K=B[G];if(K&&K.source===Z&&K.type==="fill-extrusion")return!0}else for(const G in B){const K=B[G];if(K.source===Z&&K.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,p.id),x=f.maxPitchScaleFactor(),S=p.tilesIn(l,x,v);S.sort(Vr);const E=[];for(const P of S)E.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,s,p._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,h,f,x,xr(p.transform,P.tileID))});const I=function(P){const B={},Z={};for(const G of P){const K=G.queryResults,q=G.wrappedTileID,oe=Z[q]=Z[q]||{};for(const we in K){const ee=K[we],he=oe[we]=oe[we]||{},be=B[we]=B[we]||[];for(const Se of ee)he[Se.featureIndex]||(he[Se.featureIndex]=!0,be.push(Se))}}return B}(E);for(const P in I)I[P].forEach(B=>{const Z=B.feature,G=p.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=G});return I}function Vr(p,t){const s=p.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}class fr{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=c.a2(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const v={};if(!f)return v;for(const x of h){const S=x.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(S.length!==0){x.layers=S,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>S.filter(I=>I.id===E)[0]));for(const E of S)v[E.id]=x}}return v}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof c.a4){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof c.a4&&f.hasRTLText){this.hasRTLText=!0,c.a5();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new c.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ae(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ae(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,h,f,v,x,S,E,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:f,scale:v,tileSize:this.tileSize,pixelPosMatrix:I,transform:S,params:x,queryPadding:this.queryPadding*E},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=s&&s.sourceLayer?s.sourceLayer:"",v=h._geojsonTileLayer||h[f];if(!v)return;const x=c.a6(s&&s.filter),{z:S,x:E,y:I}=this.tileID.canonical,P={z:S,x:E,y:I};for(let B=0;B<v.length;B++){const Z=v.feature(B);if(x.needGeometry){const q=c.a7(Z,!0);if(!x.filter(new c.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!x.filter(new c.a8(this.tileID.overscaledZ),Z))continue;const G=l.getId(Z,f),K=new c.a9(Z,S,E,I,G);K.tile=P,t.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=c.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const f=this.expirationTime-s;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!s.style.hasLayer(h))continue;const f=this.buckets[h],v=f.layers[0].sourceLayer||"_geojsonTileLayer",x=l[v],S=t[v];if(!x||!S||Object.keys(S).length===0)continue;f.update(S,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=s&&s.style&&s.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=c.h.now()+t}setDependencies(t,s){const l={};for(const h of s)l[h]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const h=this.dependencies[l];if(h){for(const f of s)if(h[f])return!0}}return!1}}class Er{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:s,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,h=s===void 0?0:this.data[l].indexOf(s),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class Te{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const h=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},c.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const f in this.state[t][h])l[f]||(this.deletedStates[t][h][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][f]===null&&delete this.deletedStates[t][h][f]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const h=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),h=c.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][s];if(f===null)return{};for(const v in f)delete h[v]}return h}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),c.e(this.state[h][v],this.stateChanges[h][v]),f[v]=this.state[h][v];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const v in this.state[h])f[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const x of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][x];f[v]=this.state[h][v]}l[h]=l[h]||{},c.e(l[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,s)}}class Wr extends c.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,f,v,x)=>{const S=new(vr(f.type))(h,f,v,x);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,s,l,this),this._tiles={},this._cache=new Er(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Te,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new c.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Jr).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&s.push(this._tiles[l]);return t?s.sort((l,h)=>{const f=l.tileID,v=h.tileID,x=new c.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new c.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-v.overscaledZ||S.y-x.y||S.x-x.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Jr).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,t,s)))}_tileLoaded(t,s,l,h){if(h)return t.state="errored",void(h.status!==404?this._source.fire(new c.j(h,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=c.h.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const f=s[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const v=this.getTileByID(f);l(t,v),l(v,t)}}function l(h,f){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let v=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,S=Math.pow(2,h.tileID.canonical.z),E=f.tileID.key;v===0&&x===0||Math.abs(x)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,v,x),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,h){for(const f in this._tiles){let v=this._tiles[f];if(h[f]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let x=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(x=E)}let S=x;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){h[x.key]=x;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const h=t.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(f)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new c.O(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(I=>this._source.hasTile(I)))):l=[];const h=t.coveringZoomLevel(this._source),f=Math.max(h-Wr.maxOverzooming,this._source.minzoom),v=Math.max(h+Wr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const P of l)if(P.canonical.z>this._source.minzoom){const B=P.scaledTo(P.canonical.z-1);I[B.key]=B;const Z=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));I[Z.key]=Z}l=l.concat(Object.values(I))}const x=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,h);if(kr(this._source.type)){const I={},P={},B=Object.keys(S),Z=c.h.now();for(const G of B){const K=S[G],q=this._tiles[G];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=Z)continue;const oe=this.findLoadedParent(K,f);oe&&(this._addTile(oe.tileID),I[oe.tileID.key]=oe.tileID),P[G]=K}this._retainLoadedChildren(P,h,v,S);for(const G in I)S[G]||(this._coveredTiles[G]=!0,S[G]=I[G]);if(s){const G={},K={};for(const q of l)this._tiles[q.key].hasData()?G[q.key]=q:K[q.key]=q;for(const q in K){const oe=K[q].children(this._source.maxzoom);this._tiles[oe[0].key]&&this._tiles[oe[1].key]&&this._tiles[oe[2].key]&&this._tiles[oe[3].key]&&(G[oe[0].key]=S[oe[0].key]=oe[0],G[oe[1].key]=S[oe[1].key]=oe[1],G[oe[2].key]=S[oe[2].key]=oe[2],G[oe[3].key]=S[oe[3].key]=oe[3],delete K[q])}for(const q in K){const oe=this.findLoadedParent(K[q],this._source.minzoom);if(oe){G[oe.tileID.key]=S[oe.tileID.key]=oe.tileID;for(const we in G)G[we].isChildOf(oe.tileID)&&delete G[we]}}for(const q in this._tiles)G[q]||(this._coveredTiles[q]=!0)}}for(const I in S)this._tiles[I].clearFadeHold();const E=c.ab(this._tiles,S);for(const I of E){const P=this._tiles[I];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const l={},h={},f=Math.max(s-Wr.maxOverzooming,this._source.minzoom),v=Math.max(s+Wr.maxUnderzooming,this._source.minzoom),x={};for(const S of t){const E=this._addTile(S);l[S.key]=S,E.hasData()||s<this._source.maxzoom&&(x[S.key]=S)}this._retainLoadedChildren(x,s,v,l);for(const S of t){let E=this._tiles[S.key];if(E.hasData())continue;if(s+1>this._source.maxzoom){const P=S.children(this._source.maxzoom)[0],B=this.getTile(P);if(B&&B.hasData()){l[P.key]=P;continue}}else{const P=S.children(this._source.maxzoom);if(l[P[0].key]&&l[P[1].key]&&l[P[2].key]&&l[P[3].key])continue}let I=E.wasRequested();for(let P=S.overscaledZ-1;P>=f;--P){const B=S.scaledTo(P);if(h[B.key])break;if(h[B.key]=!0,E=this.getTile(B),!E&&I&&(E=this._addTile(B)),E){const Z=E.hasData();if((I||Z)&&(l[B.key]=B),I=E.wasRequested(),Z)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of s)this._loadedParentTiles[f]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=s;return s||(s=new fr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,l||this._source.fire(new c.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,l){const h=[],f=this.transform;if(!f)return h;const v=l?f.getCameraQueryGeometry(t):t,x=t.map(G=>f.pointCoordinate(G,this.terrain)),S=v.map(G=>f.pointCoordinate(G,this.terrain)),E=this.getIds();let I=1/0,P=1/0,B=-1/0,Z=-1/0;for(const G of S)I=Math.min(I,G.x),P=Math.min(P,G.y),B=Math.max(B,G.x),Z=Math.max(Z,G.y);for(let G=0;G<E.length;G++){const K=this._tiles[E[G]];if(K.holdingForFade())continue;const q=K.tileID,oe=Math.pow(2,f.zoom-K.tileID.overscaledZ),we=s*K.queryPadding*c.N/K.tileSize/oe,ee=[q.getTilePoint(new c.U(I,P)),q.getTilePoint(new c.U(B,Z))];if(ee[0].x-we<c.N&&ee[0].y-we<c.N&&ee[1].x+we>=0&&ee[1].y+we>=0){const he=x.map(Se=>q.getTilePoint(Se)),be=S.map(Se=>q.getTilePoint(Se));h.push({tile:K,tileID:q,queryGeometry:he,cameraQueryGeometry:be,scale:oe})}}return h}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(kr(this._source.type)){const t=c.h.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const h=this._tiles[t];h&&h.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function Jr(p,t){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-s||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function kr(p){return p==="raster"||p==="image"||p==="video"}Wr.maxOverzooming=10,Wr.maxUnderzooming=3;const Kt="mapboxgl_preloaded_worker_pool";class ui{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ui.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kt]}numActive(){return Object.keys(this.active).length}}const Hr=Math.floor(c.h.hardwareConcurrency/2);let Kr;function Ui(){return Kr||(Kr=new ui),Kr}ui.workerCount=c.ac(globalThis)?Math.max(Math.min(Hr,3),1):1;class Qn{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.ad(t,0,1);let s=1,l=this._distances[s];const h=t*this.paddedLength+this.padding;for(;l<h&&s<this._distances.length;)l=this._distances[++s];const f=s-1,v=this._distances[f],x=l-v,S=x>0?(h-v)/x:0;return this.points[f].mult(1-S).add(this.points[s].mult(S))}}function un(p,t){let s=!0;return p==="always"||p!=="never"&&t!=="never"||(s=!1),s}class Ai{constructor(t,s,l){const h=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,h,f){this._forEachCell(s,l,h,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)}insertCircle(t,s,l,h){this._forEachCell(s-h,l-h,s+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,s,l,h,f,v){this.boxCells[f].push(v)}_insertCircleCell(t,s,l,h,f,v){this.circleCells[f].push(v)}_query(t,s,l,h,f,v,x){if(l<0||t>this.width||h<0||s>this.height)return[];const S=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=h){if(f)return[{key:null,x1:t,y1:s,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const I=this.circles[3*E],P=this.circles[3*E+1],B=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:I-B,y1:P-B,x2:I+B,y2:P+B})}}else this._forEachCell(t,s,l,h,this._queryCell,S,{hitTest:f,overlapMode:v,seenUids:{box:{},circle:{}}},x);return S}query(t,s,l,h){return this._query(t,s,l,h,!1,null)}hitTest(t,s,l,h,f,v){return this._query(t,s,l,h,!0,f,v).length>0}hitTestCircle(t,s,l,h,f){const v=t-l,x=t+l,S=s-l,E=s+l;if(x<0||v>this.width||E<0||S>this.height)return!1;const I=[];return this._forEachCell(v,S,x,E,this._queryCellCircle,I,{hitTest:!0,overlapMode:h,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},f),I.length>0}_queryCell(t,s,l,h,f,v,x,S){const{seenUids:E,hitTest:I,overlapMode:P}=x,B=this.boxCells[f];if(B!==null){const G=this.bboxes;for(const K of B)if(!E.box[K]){E.box[K]=!0;const q=4*K,oe=this.boxKeys[K];if(t<=G[q+2]&&s<=G[q+3]&&l>=G[q+0]&&h>=G[q+1]&&(!S||S(oe))&&(!I||!un(P,oe.overlapMode))&&(v.push({key:oe,x1:G[q],y1:G[q+1],x2:G[q+2],y2:G[q+3]}),I))return!0}}const Z=this.circleCells[f];if(Z!==null){const G=this.circles;for(const K of Z)if(!E.circle[K]){E.circle[K]=!0;const q=3*K,oe=this.circleKeys[K];if(this._circleAndRectCollide(G[q],G[q+1],G[q+2],t,s,l,h)&&(!S||S(oe))&&(!I||!un(P,oe.overlapMode))){const we=G[q],ee=G[q+1],he=G[q+2];if(v.push({key:oe,x1:we-he,y1:ee-he,x2:we+he,y2:ee+he}),I)return!0}}}return!1}_queryCellCircle(t,s,l,h,f,v,x,S){const{circle:E,seenUids:I,overlapMode:P}=x,B=this.boxCells[f];if(B!==null){const G=this.bboxes;for(const K of B)if(!I.box[K]){I.box[K]=!0;const q=4*K,oe=this.boxKeys[K];if(this._circleAndRectCollide(E.x,E.y,E.radius,G[q+0],G[q+1],G[q+2],G[q+3])&&(!S||S(oe))&&!un(P,oe.overlapMode))return v.push(!0),!0}}const Z=this.circleCells[f];if(Z!==null){const G=this.circles;for(const K of Z)if(!I.circle[K]){I.circle[K]=!0;const q=3*K,oe=this.circleKeys[K];if(this._circlesCollide(G[q],G[q+1],G[q+2],E.x,E.y,E.radius)&&(!S||S(oe))&&!un(P,oe.overlapMode))return v.push(!0),!0}}}_forEachCell(t,s,l,h,f,v,x,S){const E=this._convertToXCellCoord(t),I=this._convertToYCellCoord(s),P=this._convertToXCellCoord(l),B=this._convertToYCellCoord(h);for(let Z=E;Z<=P;Z++)for(let G=I;G<=B;G++)if(f.call(this,t,s,l,h,this.xCellCount*G+Z,v,x,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,h,f,v){const x=h-t,S=f-s,E=l+v;return E*E>x*x+S*S}_circleAndRectCollide(t,s,l,h,f,v,x){const S=(v-h)/2,E=Math.abs(t-(h+S));if(E>S+l)return!1;const I=(x-f)/2,P=Math.abs(s-(f+I));if(P>I+l)return!1;if(E<=S||P<=I)return!0;const B=E-S,Z=P-I;return B*B+Z*Z<=l*l}}function Ge(p,t,s,l,h){const f=c.Z();return t?(c.a0(f,f,[1/h,1/h,1]),s||c.ae(f,f,l.angle)):c.a1(f,l.labelPlaneMatrix,p),f}function $i(p,t,s,l,h){if(t){const f=c.af(p);return c.a0(f,f,[h,h,1]),s||c.ae(f,f,-l.angle),f}return l.glCoordMatrix}function jr(p,t,s){let l;s?(l=[p.x,p.y,s(p.x,p.y),1],c.ag(l,l,t)):(l=[p.x,p.y,0,1],X(l,l,t));const h=l[3];return{point:new c.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function xa(p,t){return .5+p/t*.5}function es(p,t){const s=p[0]/p[3],l=p[1]/p[3];return s>=-t[0]&&s<=t[0]&&l>=-t[1]&&l<=t[1]}function Qe(p,t,s,l,h,f,v,x,S,E){const I=l?p.textSizeData:p.iconSizeData,P=c.ah(I,s.transform.zoom),B=[256/s.width*2+1,256/s.height*2+1],Z=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Z.clear();const G=p.lineVertexArray,K=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,q=s.transform.width/s.transform.height;let oe=!1;for(let we=0;we<K.length;we++){const ee=K.get(we);if(ee.hidden||ee.writingMode===c.ai.vertical&&!oe){U(ee.numGlyphs,Z);continue}let he;if(oe=!1,E?(he=[ee.anchorX,ee.anchorY,E(ee.anchorX,ee.anchorY),1],c.ag(he,he,t)):(he=[ee.anchorX,ee.anchorY,0,1],X(he,he,t)),!es(he,B)){U(ee.numGlyphs,Z);continue}const be=xa(s.transform.cameraToCenterDistance,he[3]),Se=c.aj(I,P,ee),De=v?Se/be:Se*be,Ve=new c.P(ee.anchorX,ee.anchorY),Fe=jr(Ve,h,E).point,qe={projections:{},offsets:{}},bt=qi(ee,De,!1,x,t,h,f,p.glyphOffsetArray,G,Z,Fe,Ve,qe,q,S,E);oe=bt.useVertical,(bt.notEnoughRoom||oe||bt.needsFlipping&&qi(ee,De,!0,x,t,h,f,p.glyphOffsetArray,G,Z,Fe,Ve,qe,q,S,E).notEnoughRoom)&&U(ee.numGlyphs,Z)}l?p.text.dynamicLayoutVertexBuffer.updateData(Z):p.icon.dynamicLayoutVertexBuffer.updateData(Z)}function sr(p,t,s,l,h,f,v,x,S,E,I,P,B){const Z=x.glyphStartIndex+x.numGlyphs,G=x.lineStartIndex,K=x.lineStartIndex+x.lineLength,q=t.getoffsetX(x.glyphStartIndex),oe=t.getoffsetX(Z-1),we=L(p*q,s,l,h,f,v,x.segment,G,K,S,E,I,P,B);if(!we)return null;const ee=L(p*oe,s,l,h,f,v,x.segment,G,K,S,E,I,P,B);return ee?{first:we,last:ee}:null}function Jt(p,t,s,l){return p===c.ai.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(p===c.ai.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function qi(p,t,s,l,h,f,v,x,S,E,I,P,B,Z,G,K){const q=t/24,oe=p.lineOffsetX*q,we=p.lineOffsetY*q;let ee;if(p.numGlyphs>1){const he=p.glyphStartIndex+p.numGlyphs,be=p.lineStartIndex,Se=p.lineStartIndex+p.lineLength,De=sr(q,x,oe,we,s,I,P,p,S,f,B,G,K);if(!De)return{notEnoughRoom:!0};const Ve=jr(De.first.point,v,K).point,Fe=jr(De.last.point,v,K).point;if(l&&!s){const qe=Jt(p.writingMode,Ve,Fe,Z);if(qe)return qe}ee=[De.first];for(let qe=p.glyphStartIndex+1;qe<he-1;qe++)ee.push(L(q*x.getoffsetX(qe),oe,we,s,I,P,p.segment,be,Se,S,f,B,G,K));ee.push(De.last)}else{if(l&&!s){const be=jr(P,h,K).point,Se=p.lineStartIndex+p.segment+1,De=new c.P(S.getx(Se),S.gety(Se)),Ve=jr(De,h,K),Fe=Ve.signedDistanceFromCamera>0?Ve.point:cn(P,De,be,1,h,K),qe=Jt(p.writingMode,be,Fe,Z);if(qe)return qe}const he=L(q*x.getoffsetX(p.glyphStartIndex),oe,we,s,I,P,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,S,f,B,G,K);if(!he)return{notEnoughRoom:!0};ee=[he]}for(const he of ee)c.ak(E,he.point,he.angle);return{}}function cn(p,t,s,l,h,f){const v=jr(p.add(p.sub(t)._unit()),h,f).point,x=s.sub(v);return s.add(x._mult(l/x.mag()))}function Qt(p,t){const{projectionCache:s,lineVertexArray:l,labelPlaneMatrix:h,tileAnchorPoint:f,distanceFromAnchor:v,getElevation:x,previousVertex:S,direction:E,absOffsetX:I}=t;if(s.projections[p])return s.projections[p];const P=new c.P(l.getx(p),l.gety(p)),B=jr(P,h,x);if(B.signedDistanceFromCamera>0)return s.projections[p]=B.point,B.point;const Z=p-E;return cn(v===0?f:new c.P(l.getx(Z),l.gety(Z)),P,S,I-v+1,h,x)}function ms(p,t,s){return p._unit()._perp()._mult(t*s)}function H(p,t,s,l,h,f,v,x){const{projectionCache:S,direction:E}=x;if(S.offsets[p])return S.offsets[p];const I=s.add(t);if(p+E<l||p+E>=h)return S.offsets[p]=I,I;const P=Qt(p+E,x),B=ms(P.sub(s),v,E),Z=s.add(B),G=P.add(B);return S.offsets[p]=c.al(f,I,Z,G)||I,S.offsets[p]}function L(p,t,s,l,h,f,v,x,S,E,I,P,B,Z){const G=l?p-t:p+t;let K=G>0?1:-1,q=0;l&&(K*=-1,q=Math.PI),K<0&&(q+=Math.PI);let oe,we,ee=K>0?x+v:x+v+1,he=h,be=h,Se=0,De=0;const Ve=Math.abs(G),Fe=[];let qe;for(;Se+De<=Ve;){if(ee+=K,ee<x||ee>=S)return null;Se+=De,be=he,we=oe;const tt={projectionCache:P,lineVertexArray:E,labelPlaneMatrix:I,tileAnchorPoint:f,distanceFromAnchor:Se,getElevation:Z,previousVertex:be,direction:K,absOffsetX:Ve};if(he=Qt(ee,tt),s===0)Fe.push(be),qe=he.sub(be);else{let kt;const ht=he.sub(be);kt=ht.mag()===0?ms(Qt(ee+K,tt).sub(he),s,K):ms(ht,s,K),we||(we=be.add(kt)),oe=H(ee,kt,he,x,S,we,s,tt),Fe.push(we),qe=oe.sub(we)}De=qe.mag()}const bt=qe._mult((Ve-Se)/De)._add(we||be),cr=q+Math.atan2(he.y-be.y,he.x-be.x);return Fe.push(bt),{point:bt,angle:B?cr:0,path:Fe}}const F=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function U(p,t){for(let s=0;s<p;s++){const l=t.length;t.resize(l+4),t.float32.set(F,3*l)}}function X(p,t,s){const l=t[0],h=t[1];return p[0]=s[0]*l+s[4]*h+s[12],p[1]=s[1]*l+s[5]*h+s[13],p[3]=s[3]*l+s[7]*h+s[15],p}const Q=100;class me{constructor(t,s=new Ai(t.width+200,t.height+200,25),l=new Ai(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Q,this.screenBottomBoundary=t.height+Q,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,h,f,v){const x=this.projectAndGetPerspectiveRatio(h,t.anchorPointX,t.anchorPointY,v),S=l*x.perspectiveRatio,E=t.x1*S+x.point.x,I=t.y1*S+x.point.y,P=t.x2*S+x.point.x,B=t.y2*S+x.point.y;return!this.isInsideGrid(E,I,P,B)||s!=="always"&&this.grid.hitTest(E,I,P,B,s,f)||x.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[E,I,P,B],offscreen:this.isOffscreen(E,I,P,B)}}placeCollisionCircles(t,s,l,h,f,v,x,S,E,I,P,B,Z,G){const K=[],q=new c.P(s.anchorX,s.anchorY),oe=jr(q,v,G),we=xa(this.transform.cameraToCenterDistance,oe.signedDistanceFromCamera),ee=(I?f/we:f*we)/c.ap,he=jr(q,x,G).point,be=sr(ee,h,s.lineOffsetX*ee,s.lineOffsetY*ee,!1,he,q,s,l,x,{projections:{},offsets:{}},!1,G);let Se=!1,De=!1,Ve=!0;if(be){const Fe=.5*B*we+Z,qe=new c.P(-100,-100),bt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),cr=new Qn,tt=be.first,kt=be.last;let ht=[];for(let ar=tt.path.length-1;ar>=1;ar--)ht.push(tt.path[ar]);for(let ar=1;ar<kt.path.length;ar++)ht.push(kt.path[ar]);const Ht=2.5*Fe;if(S){const ar=ht.map(hr=>jr(hr,S,G));ht=ar.some(hr=>hr.signedDistanceFromCamera<=0)?[]:ar.map(hr=>hr.point)}let er=[];if(ht.length>0){const ar=ht[0].clone(),hr=ht[0].clone();for(let ni=1;ni<ht.length;ni++)ar.x=Math.min(ar.x,ht[ni].x),ar.y=Math.min(ar.y,ht[ni].y),hr.x=Math.max(hr.x,ht[ni].x),hr.y=Math.max(hr.y,ht[ni].y);er=ar.x>=qe.x&&hr.x<=bt.x&&ar.y>=qe.y&&hr.y<=bt.y?[ht]:hr.x<qe.x||ar.x>bt.x||hr.y<qe.y||ar.y>bt.y?[]:c.am([ht],qe.x,qe.y,bt.x,bt.y)}for(const ar of er){cr.reset(ar,.25*Fe);let hr=0;hr=cr.length<=.5*Fe?1:Math.ceil(cr.paddedLength/Ht)+1;for(let ni=0;ni<hr;ni++){const Rr=ni/Math.max(hr-1,1),Li=cr.lerp(Rr),fi=Li.x+Q,mi=Li.y+Q;K.push(fi,mi,Fe,0);const Ri=fi-Fe,Or=mi-Fe,ks=fi+Fe,_n=mi+Fe;if(Ve=Ve&&this.isOffscreen(Ri,Or,ks,_n),De=De||this.isInsideGrid(Ri,Or,ks,_n),t!=="always"&&this.grid.hitTestCircle(fi,mi,Fe,t,P)&&(Se=!0,!E))return{circles:[],offscreen:!1,collisionDetected:Se}}}}return{circles:!E&&Se||!De||we<this.perspectiveRatioCutoff?[]:K,offscreen:Ve,collisionDetected:Se}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,h=1/0,f=-1/0,v=-1/0;for(const I of t){const P=new c.P(I.x+Q,I.y+Q);l=Math.min(l,P.x),h=Math.min(h,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y),s.push(P)}const x=this.grid.query(l,h,f,v).concat(this.ignoredGrid.query(l,h,f,v)),S={},E={};for(const I of x){const P=I.key;if(S[P.bucketInstanceId]===void 0&&(S[P.bucketInstanceId]={}),S[P.bucketInstanceId][P.featureIndex])continue;const B=[new c.P(I.x1,I.y1),new c.P(I.x2,I.y1),new c.P(I.x2,I.y2),new c.P(I.x1,I.y2)];c.an(s,B)&&(S[P.bucketInstanceId][P.featureIndex]=!0,E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]=[]),E[P.bucketInstanceId].push(P.featureIndex))}return E}insertCollisionBox(t,s,l,h,f,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:f,collisionGroupID:v,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,h,f,v){const x=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:f,collisionGroupID:v,overlapMode:s};for(let E=0;E<t.length;E+=4)x.insertCircle(S,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,s,l,h){let f;return h?(f=[s,l,h(s,l),1],c.ag(f,f,t)):(f=[s,l,0,1],X(f,f,t)),{point:new c.P((f[0]/f[3]+1)/2*this.transform.width+Q,(-f[1]/f[3]+1)/2*this.transform.height+Q),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,s,l,h){return l<Q||t>=this.screenRightBoundary||h<Q||s>this.screenBottomBoundary}isInsideGrid(t,s,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=c.ao([]);return c.$(t,t,[-100,-100,0]),t}}function se(p,t,s){return t*(c.N/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class te{constructor(t,s,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class pe{constructor(t,s,l,h,f){this.text=new te(t?t.text:null,s,l,f),this.icon=new te(t?t.icon:null,s,h,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ze{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class Re{constructor(){this.invProjMatrix=c.Z(),this.viewportMatrix=c.Z(),this.circles=[]}}class Be{constructor(t,s,l,h,f){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=f}}class At{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function Xt(p,t,s,l,h){const{horizontalAlign:f,verticalAlign:v}=c.au(p);return new c.P(-(f-.5)*t+l[0]*h,-(v-.5)*s+l[1]*h)}function St(p,t,s,l,h,f){const{x1:v,x2:x,y1:S,y2:E,anchorPointX:I,anchorPointY:P}=p,B=new c.P(t,s);return l&&B._rotate(h?f:-f),{x1:v+B.x,y1:S+B.y,x2:x+B.x,y2:E+B.y,anchorPointX:I,anchorPointY:P}}class Ft{constructor(t,s,l,h,f){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new me(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new At(h),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,l,h){const f=l.getBucket(s),v=l.latestFeatureIndex;if(!f||!v||s.id!==f.layerIds[0])return;const x=l.collisionBoxArray,S=f.layers[0].layout,E=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),I=l.tileSize/c.N,P=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),B=S.get("text-pitch-alignment")==="map",Z=S.get("text-rotation-alignment")==="map",G=se(l,1,this.transform.zoom),K=Ge(P,B,Z,this.transform,G);let q=null;if(B){const we=$i(P,B,Z,this.transform,G);q=c.a1([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[f.bucketInstanceId]=new Be(f.bucketInstanceId,v,f.sourceLayerIndex,f.index,l.tileID);const oe={bucket:f,layout:S,posMatrix:P,textLabelPlaneMatrix:K,labelToScreenMatrix:q,scale:E,textPixelRatio:I,holdingForFade:l.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:c.ah(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(h)for(const we of f.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:be}=we;t.push({sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:be,parameters:oe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(t,s,l,h,f,v,x,S,E,I,P,B,Z,G,K,q){const oe=c.aq[t.textAnchor],we=[t.textOffset0,t.textOffset1],ee=Xt(oe,l,h,we,f),he=this.collisionIndex.placeCollisionBox(St(s,ee.x,ee.y,v,x,this.transform.angle),P,S,E,I.predicate,q);if((!K||this.collisionIndex.placeCollisionBox(St(K,ee.x,ee.y,v,x,this.transform.angle),P,S,E,I.predicate,q).box.length!==0)&&he.box.length>0){let be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(be=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:we,width:l,height:h,anchor:oe,textBoxScale:f,prevAnchor:be},this.markUsedJustification(Z,oe,B,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,B),this.placedOrientations[B.crossTileID]=G),{shift:ee,placedGlyphBoxes:he}}}placeLayerBucketPart(t,s,l){const{bucket:h,layout:f,posMatrix:v,textLabelPlaneMatrix:x,labelToScreenMatrix:S,textPixelRatio:E,holdingForFade:I,collisionBoxArray:P,partiallyEvaluatedTextSize:B,collisionGroup:Z}=t.parameters,G=f.get("text-optional"),K=f.get("icon-optional"),q=c.ar(f,"text-overlap","text-allow-overlap"),oe=q==="always",we=c.ar(f,"icon-overlap","icon-allow-overlap"),ee=we==="always",he=f.get("text-rotation-alignment")==="map",be=f.get("text-pitch-alignment")==="map",Se=f.get("icon-text-fit")!=="none",De=f.get("symbol-z-order")==="viewport-y",Ve=oe&&(ee||!h.hasIconData()||K),Fe=ee&&(oe||!h.hasTextData()||G);!h.collisionArrays&&P&&h.deserializeCollisionBoxes(P);const qe=this.retainedQueryData[h.bucketInstanceId].tileID,bt=this.terrain?(tt,kt)=>this.terrain.getElevation(qe,tt,kt):null,cr=(tt,kt)=>{var ht,Ht;if(s[tt.crossTileID])return;if(I)return void(this.placements[tt.crossTileID]=new ze(!1,!1,!1));let er=!1,ar=!1,hr=!0,ni=null,Rr={box:null,offscreen:null},Li={box:null},fi=null,mi=null,Ri=null,Or=0,ks=0,_n=0;kt.textFeatureIndex?Or=kt.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Or=tt.featureIndex),kt.verticalTextFeatureIndex&&(ks=kt.verticalTextFeatureIndex);const as=kt.textBox;if(as){const vi=Gr=>{let xi=c.ai.horizontal;if(h.allowVerticalPlacement&&!Gr&&this.prevPlacement){const sn=this.prevPlacement.placedOrientations[tt.crossTileID];sn&&(this.placedOrientations[tt.crossTileID]=sn,xi=sn,this.markUsedOrientation(h,xi,tt))}return xi},Fi=(Gr,xi)=>{if(h.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const sn of h.writingModes)if(sn===c.ai.vertical?(Rr=xi(),Li=Rr):Rr=Gr(),Rr&&Rr.box&&Rr.box.length)break}else Rr=Gr()},Bi=tt.textAnchorOffsetStartIndex,Ts=tt.textAnchorOffsetEndIndex;if(Ts===Bi){const Gr=(xi,sn)=>{const si=this.collisionIndex.placeCollisionBox(xi,q,E,v,Z.predicate,bt);return si&&si.box&&si.box.length&&(this.markUsedOrientation(h,sn,tt),this.placedOrientations[tt.crossTileID]=sn),si};Fi(()=>Gr(as,c.ai.horizontal),()=>{const xi=kt.verticalTextBox;return h.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&xi?Gr(xi,c.ai.vertical):{box:null,offscreen:null}}),vi(Rr&&Rr.box&&Rr.box.length)}else{let Gr=c.aq[(Ht=(ht=this.prevPlacement)===null||ht===void 0?void 0:ht.variableOffsets[tt.crossTileID])===null||Ht===void 0?void 0:Ht.anchor];const xi=(si,$s,qs)=>{const Mn=si.x2-si.x1,pa=si.y2-si.y1,Du=tt.textBoxScale,Ul=Se&&we==="never"?$s:null;let Oi={box:[],offscreen:!1},vn=q==="never"?1:2,Zn="never";Gr&&vn++;for(let An=0;An<vn;An++){for(let Ni=Bi;Ni<Ts;Ni++){const Es=h.textAnchorOffsets.get(Ni);if(Gr&&Es.textAnchor!==Gr)continue;const Gn=this.attemptAnchorPlacement(Es,si,Mn,pa,Du,he,be,E,v,Z,Zn,tt,h,qs,Ul,bt);if(Gn&&(Oi=Gn.placedGlyphBoxes,Oi&&Oi.box&&Oi.box.length))return er=!0,ni=Gn.shift,Oi}Gr?Gr=null:Zn=q}return Oi};Fi(()=>xi(as,kt.iconBox,c.ai.horizontal),()=>{const si=kt.verticalTextBox;return h.allowVerticalPlacement&&!(Rr&&Rr.box&&Rr.box.length)&&tt.numVerticalGlyphVertices>0&&si?xi(si,kt.verticalIconBox,c.ai.vertical):{box:null,offscreen:null}}),Rr&&(er=Rr.box,hr=Rr.offscreen);const sn=vi(Rr&&Rr.box);if(!er&&this.prevPlacement){const si=this.prevPlacement.variableOffsets[tt.crossTileID];si&&(this.variableOffsets[tt.crossTileID]=si,this.markUsedJustification(h,si.anchor,tt,sn))}}}if(fi=Rr,er=fi&&fi.box&&fi.box.length>0,hr=fi&&fi.offscreen,tt.useRuntimeCollisionCircles){const vi=h.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Fi=c.aj(h.textSizeData,B,vi),Bi=f.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(q,vi,h.lineVertexArray,h.glyphOffsetArray,Fi,v,x,S,l,be,Z.predicate,tt.collisionCircleDiameter,Bi,bt),mi.circles.length&&mi.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),er=oe||mi.circles.length>0&&!mi.collisionDetected,hr=hr&&mi.offscreen}if(kt.iconFeatureIndex&&(_n=kt.iconFeatureIndex),kt.iconBox){const vi=Fi=>{const Bi=Se&&ni?St(Fi,ni.x,ni.y,he,be,this.transform.angle):Fi;return this.collisionIndex.placeCollisionBox(Bi,we,E,v,Z.predicate,bt)};Li&&Li.box&&Li.box.length&&kt.verticalIconBox?(Ri=vi(kt.verticalIconBox),ar=Ri.box.length>0):(Ri=vi(kt.iconBox),ar=Ri.box.length>0),hr=hr&&Ri.offscreen}const da=G||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Oa=K||tt.numIconVertices===0;if(da||Oa?Oa?da||(ar=ar&&er):er=ar&&er:ar=er=ar&&er,er&&fi&&fi.box&&this.collisionIndex.insertCollisionBox(fi.box,q,f.get("text-ignore-placement"),h.bucketInstanceId,Li&&Li.box&&ks?ks:Or,Z.ID),ar&&Ri&&this.collisionIndex.insertCollisionBox(Ri.box,we,f.get("icon-ignore-placement"),h.bucketInstanceId,_n,Z.ID),mi&&(er&&this.collisionIndex.insertCollisionCircles(mi.circles,q,f.get("text-ignore-placement"),h.bucketInstanceId,Or,Z.ID),l)){const vi=h.bucketInstanceId;let Fi=this.collisionCircleArrays[vi];Fi===void 0&&(Fi=this.collisionCircleArrays[vi]=new Re);for(let Bi=0;Bi<mi.circles.length;Bi+=4)Fi.circles.push(mi.circles[Bi+0]),Fi.circles.push(mi.circles[Bi+1]),Fi.circles.push(mi.circles[Bi+2]),Fi.circles.push(mi.collisionDetected?1:0)}if(tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new ze(er||Ve,ar||Fe,hr||h.justReloaded),s[tt.crossTileID]=!0};if(De){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=h.getSortedSymbolIndexes(this.transform.angle);for(let kt=tt.length-1;kt>=0;--kt){const ht=tt[kt];cr(h.symbolInstances.get(ht),h.collisionArrays[ht])}}else for(let tt=t.symbolInstanceStart;tt<t.symbolInstanceEnd;tt++)cr(h.symbolInstances.get(tt),h.collisionArrays[tt]);if(l&&h.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[h.bucketInstanceId];c.as(tt.invProjMatrix,v),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}markUsedJustification(t,s,l,h){let f;f=h===c.ai.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const x of v)x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=f>=0&&x!==f?0:l.crossTileID)}markUsedOrientation(t,s,l){const h=s===c.ai.horizontal||s===c.ai.horizontalOnly?s:0,f=s===c.ai.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const x of v)t.text.placedSymbolArray.get(x).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const h=s?s.symbolFadeChange(t):1,f=s?s.opacities:{},v=s?s.variableOffsets:{},x=s?s.placedOrientations:{};for(const S in this.placements){const E=this.placements[S],I=f[S];I?(this.opacities[S]=new pe(I,h,E.text,E.icon),l=l||E.text!==I.text.placed||E.icon!==I.icon.placed):(this.opacities[S]=new pe(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const S in f){const E=f[S];if(!this.opacities[S]){const I=new pe(E,h,!1,!1);I.isHidden()||(this.opacities[S]=I,l=l||E.text.placed||E.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in x)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=x[S]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const h of s){const f=h.getBucket(t);f&&h.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,h.collisionBoxArray)}}updateBucketOpacities(t,s,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const h=t.layers[0],f=h.layout,v=new pe(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),S=f.get("icon-allow-overlap"),E=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",B=f.get("icon-text-fit")!=="none",Z=new pe(null,0,x&&(S||!t.hasIconData()||f.get("icon-optional")),S&&(x||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const G=(K,q,oe)=>{for(let we=0;we<q/4;we++)K.opacityVertexArray.emplaceBack(oe);K.hasVisibleVertices=K.hasVisibleVertices||oe!==On};for(let K=0;K<t.symbolInstances.length;K++){const q=t.symbolInstances.get(K),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:we,crossTileID:ee}=q;let he=this.opacities[ee];s[ee]?he=v:he||(he=Z,this.opacities[ee]=he),s[ee]=!0;const be=q.numIconVertices>0,Se=this.placedOrientations[q.crossTileID],De=Se===c.ai.vertical,Ve=Se===c.ai.horizontal||Se===c.ai.horizontalOnly;if(oe>0||we>0){const Fe=Gi(he.text);G(t.text,oe,De?On:Fe),G(t.text,we,Ve?On:Fe);const qe=he.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(tt=>{tt>=0&&(t.text.placedSymbolArray.get(tt).hidden=qe||De?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=qe||Ve?1:0);const bt=this.variableOffsets[q.crossTileID];bt&&this.markUsedJustification(t,bt.anchor,q,Se);const cr=this.placedOrientations[q.crossTileID];cr&&(this.markUsedJustification(t,"left",q,cr),this.markUsedOrientation(t,cr,q))}if(be){const Fe=Gi(he.icon),qe=!(B&&q.verticalPlacedIconSymbolIndex&&De);q.placedIconSymbolIndex>=0&&(G(t.icon,q.numIconVertices,qe?Fe:On),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=he.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,q.numVerticalIconVertices,qe?On:Fe),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Fe=t.collisionArrays[K];if(Fe){let qe=new c.P(0,0);if(Fe.textBox||Fe.verticalTextBox){let cr=!0;if(E){const tt=this.variableOffsets[ee];tt?(qe=Xt(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),I&&qe._rotate(P?this.transform.angle:-this.transform.angle)):cr=!1}Fe.textBox&&Gt(t.textCollisionBox.collisionVertexArray,he.text.placed,!cr||De,qe.x,qe.y),Fe.verticalTextBox&&Gt(t.textCollisionBox.collisionVertexArray,he.text.placed,!cr||Ve,qe.x,qe.y)}const bt=!!(!Ve&&Fe.verticalIconBox);Fe.iconBox&&Gt(t.iconCollisionBox.collisionVertexArray,he.icon.placed,bt,B?qe.x:0,B?qe.y:0),Fe.verticalIconBox&&Gt(t.iconCollisionBox.collisionVertexArray,he.icon.placed,!bt,B?qe.x:0,B?qe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=K.invProjMatrix,t.placementViewportMatrix=K.viewportMatrix,t.collisionCircleArray=K.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function Gt(p,t,s,l,h){p.emplaceBack(t?1:0,s?1:0,l||0,h||0),p.emplaceBack(t?1:0,s?1:0,l||0,h||0),p.emplaceBack(t?1:0,s?1:0,l||0,h||0),p.emplaceBack(t?1:0,s?1:0,l||0,h||0)}const Ir=Math.pow(2,25),zr=Math.pow(2,24),wr=Math.pow(2,17),yr=Math.pow(2,16),Zi=Math.pow(2,9),Br=Math.pow(2,8),yi=Math.pow(2,1);function Gi(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,s=Math.floor(127*p.opacity);return s*Ir+t*zr+s*wr+t*yr+s*Zi+t*Br+s*yi+t}const On=0;class ci{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,h,f){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((x,S)=>x.sortKey-S.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class Ja{constructor(t,s,l,h,f,v,x,S){this.placement=new Ft(t,s,v,x,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const h=c.h.now(),f=()=>!this._forceFullPlacement&&c.h.now()-h>2;for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=x)&&(!v.maxzoom||v.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new ci(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const na=512/c.N/2;class sc{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let f=0;f<s.length;f++){const v=s.get(f),x=v.key,S=h.get(x);S?S.push(v):h.set(x,[v])}for(const[f,v]of h){const x={positions:v.map(S=>({x:Math.floor(S.anchorX*na),y:Math.floor(S.anchorY*na)})),crossTileIDs:v.map(S=>S.crossTileID)};if(x.positions.length>128){const S=new c.av(x.positions.length,16,Uint16Array);for(const{x:E,y:I}of x.positions)S.add(E,I);S.finish(),delete x.positions,x.index=S}this._symbolsByKey[f]=x}}getScaledCoordinates(t,s){const{x:l,y:h,z:f}=this.tileID.canonical,{x:v,y:x,z:S}=s.canonical,E=na/Math.pow(2,S-f),I=(x*c.N+t.anchorY)*E,P=h*c.N*na;return{x:Math.floor((v*c.N+t.anchorX)*E-l*c.N*na),y:Math.floor(I-P)}}findMatches(t,s,l){const h=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<t.length;f++){const v=t.get(f);if(v.crossTileID)continue;const x=this._symbolsByKey[v.key];if(!x)continue;const S=this.getScaledCoordinates(v,s);if(x.index){const E=x.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const I of E){const P=x.crossTileIDs[I];if(!l[P]){l[P]=!0,v.crossTileID=P;break}}}else if(x.positions)for(let E=0;E<x.positions.length;E++){const I=x.positions[E],P=x.crossTileIDs[E];if(Math.abs(I.x-S.x)<=h&&Math.abs(I.y-S.y)<=h&&!l[P]){l[P]=!0,v.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Pr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const h=this.indexes[l],f={};for(const v in h){const x=h[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+s),f[x.tileID.key]=x}this.indexes[l]=f}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const v=this.indexes[f];if(Number(f)>t.overscaledZ)for(const x in v){const S=v[x];S.tileID.isChildOf(t)&&S.findMatches(s.symbolInstances,t,h)}else{const x=v[t.scaledTo(Number(f)).key];x&&x.findMatches(s.symbolInstances,t,h)}}for(let f=0;f<s.symbolInstances.length;f++){const v=s.symbolInstances.get(f);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new sc(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const h=this.indexes[l];for(const f in h)t[h[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[f]),delete h[f],s=!0)}return s}}class Oo{constructor(){this.layerIndexes={},this.crossTileIDs=new Pr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new cu);let f=!1;const v={};h.handleWrapJump(l);for(const x of s){const S=x.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(x.tileID,S,this.crossTileIDs)&&(f=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(f=!0),f}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Ii=(p,t)=>c.x(p,t&&t.filter(s=>s.identifier!=="source.canvas")),hi=c.F(c.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),lh=c.F(c.ax,["setCenter","setZoom","setBearing","setPitch"]),di=c.aw();class Wi extends c.E{constructor(t,s={}){super(),this.map=t,this.dispatcher=new ae(Ui(),this,t._getMapId()),this.imageManager=new ot,this.imageManager.setEventedParent(this),this.glyphManager=new pr(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new nt(256,512),this.crossTileSymbolIndex=new Oo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.az());const l=this;this._rtlTextPluginCallback=Wi.registerForPluginStateChange(h=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:h.pluginStatus,pluginURL:h.pluginURL},(f,v)=>{if(c.aA(f),v&&v.every(x=>x))for(const x in l.sourceCaches){const S=l.sourceCaches[x].getSource().type;S!=="vector"&&S!=="geojson"||l.sourceCaches[x].reload()}})}),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const f=this.sourceCaches[h.sourceId];if(!f)return;const v=f.getSource();if(v&&v.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===v.id&&this._validateLayer(S)}})}loadURL(t,s={},l){this.fire(new c.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const h=this.map._requestManager.transformRequest(t,pt.Style);this._request=c.f(h,(f,v)=>{this._request=null,f?this.fire(new c.j(f)):v&&this._load(v,s,l)})}loadJSON(t,s={},l){this.fire(new c.k("dataloading",{dataType:"style"})),this._request=c.h.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(t,s,l)})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(di,{validate:!1})}_load(t,s,l){var h;const f=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!Ii(this,c.y(f))){this._loaded=!0,this.stylesheet=f;for(const v in f.sources)this.addSource(v,f.sources[v],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Xe(this.stylesheet.light),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const t=c.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const l=c.aC(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(t,s=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(h,f,v,x){const S=le(h),E=S.length,I=v>1?"@2x":"",P={},B={},Z={};for(const{id:G,url:K}of S){const q=f.transformRequest(f.normalizeSpriteURL(K,I,".json"),pt.SpriteJSON),oe=`${G}_${q.url}`;P[oe]=c.f(q,(he,be)=>{delete P[oe],B[G]=be,ve(x,B,Z,he,E)});const we=f.transformRequest(f.normalizeSpriteURL(K,I,".png"),pt.SpriteImage),ee=`${G}_${we.url}`;P[ee]=je.getImage(we,(he,be)=>{delete P[ee],Z[G]=be,ve(x,B,Z,he,E)})}return{cancel(){for(const G of Object.values(P))G.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(h,f)=>{if(this._spriteRequest=null,h)this.fire(new c.j(h));else if(f)for(const v in f){this._spritesImagesIds[v]=[];const x=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(S=>!(S in f)):[];for(const S of x)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in f[v]){const E=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,f[v][S],!1):this.imageManager.addImage(E,f[v][S]),s&&(this._changedImages[E]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const h=s.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.j(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const l=[];for(const h of t)s[h]&&l.push(s[h]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const h=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(h.length||f.length)&&this._updateWorkerLayers(h,f);for(const v in this._updatedSources){const x=this._updatedSources[v];if(x==="reload")this._reloadSource(v);else{if(x!=="clear")throw new Error(`Invalid action ${x}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const f=this.sourceCaches[h];l[h]=f.used,f.used=!1}for(const h of this._order){const f=this._layers[h];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const h in l){const f=this.sourceCaches[h];l[h]!==f.used&&f.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){this._checkLoaded();const l=this.serialize();if(t=s.transformStyle?s.transformStyle(l,t):t,Ii(this,c.y(t)))return!1;(t=c.aD(t)).layers=c.aB(t.layers);const h=c.aE(l,t).filter(v=>!(v.command in lh));if(h.length===0)return!1;const f=h.filter(v=>!(v.command in hi));if(f.length>0)throw new Error(`Unimplemented: ${f.map(v=>v.command).join(", ")}.`);for(const v of h)v.command!=="setTransition"&&this[v.command].apply(this,v.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,s){if(this.getImage(t))return this.fire(new c.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.y.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const h=this.sourceCaches[t]=new Wr(t,s,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new c.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new c.j(new Error(`Layer "${h}" already exists on this map.`)));let f;if(t.type==="custom"){if(Ii(this,c.aF(t)))return;f=c.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=c.aD(t),t=c.e(t,{source:h})),this._validate(c.y.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;f=c.aC(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:h}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new c.j(new Error(`Cannot add layer "${h}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=f,this._removedLayers[h]&&f.source&&f.type!=="custom"){const x=this._removedLayers[h];delete this._removedLayers[h],x.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=s?this._order.indexOf(s):this._order.length;s&&h===-1?this.fire(new c.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===s&&h.maxzoom===l||(s!=null&&(h.minzoom=s),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!c.aG(h.filter,s))return s==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(c.y.filter,`layers.${h.id}.filter`,s,null,l)||(h.filter=c.aD(s),this._updateLayer(h)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.aD(this.getLayer(t).filter)}setLayoutProperty(t,s,l,h={}){this._checkLoaded();const f=this.getLayer(t);f?c.aG(f.getLayoutProperty(s),l)||(f.setLayoutProperty(s,l,h),this._updateLayer(f)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,h={}){this._checkLoaded();const f=this.getLayer(t);f?c.aG(f.getPaintProperty(s),l)||(f.setPaintProperty(s,l,h)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new c.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,h=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new c.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=f.getSource().type;v==="geojson"&&h?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(h,t.id,s)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${l}' does not exist in the map's style.`)));const f=h.getSource().type,v=f==="vector"?t.sourceLayer:void 0;f!=="vector"||v?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,s):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,h=this.sourceCaches[s];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.aH(this.sourceCaches,f=>f.serialize()),s=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.aI({version:h.version,name:h.name,metadata:h.metadata,light:h.light,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,sources:t,layers:s,terrain:l},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(s(x)){l[x]=v;for(const S of t){const E=S[x];if(E)for(const I of E)h.push(I)}}}h.sort((v,x)=>x.intersectionZ-v.intersectionZ);const f=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(s(x))for(let S=h.length-1;S>=0;S--){const E=h[S].feature;if(l[E.layer.id]<v)break;f.push(E),h.pop()}else for(const S of t){const E=S[x];if(E)for(const I of E)f.push(I.feature)}}return f}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",s.filter,null,s);const h={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const x of s.layers){const S=this._layers[x];if(!S)return this.fire(new c.j(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];h[S.source]=!0}}const f=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const x in this.sourceCaches)s.layers&&!h[x]||f.push(nr(this.sourceCaches[x],this._layers,v,t,s,l));return this.placement&&f.push(function(x,S,E,I,P,B,Z){const G={},K=B.queryRenderedSymbols(I),q=[];for(const oe of Object.keys(K).map(Number))q.push(Z[oe]);q.sort(Vr);for(const oe of q){const we=oe.featureIndex.lookupSymbolFeatures(K[oe.bucketInstanceId],S,oe.bucketIndex,oe.sourceLayerIndex,P.filter,P.layers,P.availableImages,x);for(const ee in we){const he=G[ee]=G[ee]||[],be=we[ee];be.sort((Se,De)=>{const Ve=oe.featureSortOrder;if(Ve){const Fe=Ve.indexOf(Se.featureIndex);return Ve.indexOf(De.featureIndex)-Fe}return De.featureIndex-Se.featureIndex});for(const Se of be)he.push(Se)}}for(const oe in G)G[oe].forEach(we=>{const ee=we.feature,he=E[x[oe].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=he});return G}(this._layers,v,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,s){s&&s.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[t];return l?function(h,f){const v=h.getRenderableIds().map(E=>h.getTileByID(E)),x=[],S={};for(let E=0;E<v.length;E++){const I=v[E],P=I.tileID.canonical.key;S[P]||(S[P]=!0,I.querySourceFeatures(x,f))}return x}(l,s):[]}addSourceType(t,s,l){return vr(t)?l(new Error(`A source type called "${t}" already exists.`)):(((h,f)=>{Nr[h]=f})(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!c.aG(t[v],l[v])){h=!0;break}if(!h)return;const f={now:c.h.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(f)}_validate(t,s,l,h,f={}){return(!f||f.validate!==!1)&&Ii(this,t.call(c.y,c.e({key:s,style:this.serialize(),value:l,styleSpec:c.v},h)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,l,h,f=!1){let v=!1,x=!1;const S={};for(const E of this._order){const I=this._layers[E];if(I.type!=="symbol")continue;if(!S[I.source]){const B=this.sourceCaches[I.source];S[I.source]=B.getRenderableIds(!0).map(Z=>B.getTileByID(Z)).sort((Z,G)=>G.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(G.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(I,S[I.source],t.center.lng);v=v||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.h.now(),t.zoom))&&(this.pauseablePlacement=new Ja(t,this.map.terrain,this._order,f,s,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.h.now()),x=!0),v&&this.pauseablePlacement.placement.setStale()),x||v)for(const E of this._order){const I=this._layers[E];I.type==="symbol"&&this.placement.updateLayerOpacities(I,S[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,l){this.imageManager.getImages(s.icons,l),this._updateTilesForChangedImages();const h=this.sourceCaches[s.source];h&&h.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,l){this.glyphManager.getGlyphs(s.stacks,l);const h=this.sourceCaches[s.source];h&&h.setDependencies(s.tileID.key,s.type,[""])}getResource(t,s,l){return c.m(s,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(c.y.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,l={},h){this._checkLoaded();const f=[{id:t,url:s}],v=[...le(this.stylesheet.sprite),...f];this._validate(c.y.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(f,!0,h))}removeSprite(t){this._checkLoaded();const s=le(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return le(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(c.y.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}Wi.registerForPluginStateChange=c.aK;var vl=c.Q([{name:"a_pos",type:"Int16",components:2}]),Qa="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ur={prelude:br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:br(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:br(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:br("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:br(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:br("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:br("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:br("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:br(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:br(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:br(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:br(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:br(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:br("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Qa),terrainDepth:br("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Qa),terrainCoords:br("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Qa)};function br(p,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),h=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=f?f.concat(h):h,x={};return{fragmentSource:p=p.replace(s,(S,E,I,P,B)=>(x[B]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${I} ${P} ${B};
#else
uniform ${I} ${P} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${I} ${P} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(s,(S,E,I,P,B)=>{const Z=P==="float"?"vec2":"vec4",G=B.match(/color/)?"color":Z;return x[B]?E==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${I} ${Z} a_${B};
varying ${I} ${P} ${B};
#else
uniform ${I} ${P} u_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${I} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${I} ${P} ${B} = u_${B};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${I} ${Z} a_${B};
#else
uniform ${I} ${P} u_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${I} ${P} ${B} = a_${B};
#else
    ${I} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${I} ${P} ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${I} ${P} ${B} = u_${B};
#endif
`}),staticAttributes:l,staticUniforms:v}}class ts{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,h,f,v,x,S,E){this.context=t;let I=this.boundPaintVertexBuffers.length!==h.length;for(let P=0;!I&&P<h.length;P++)this.boundPaintVertexBuffers[P]!==h[P]&&(I=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||I||this.boundIndexBuffer!==f||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==x||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==E?this.freshBind(s,l,h,f,v,x,S,E):(t.bindVertexArray.set(this.vao),x&&x.bind(),f&&f.dynamicDraw&&f.bind(),S&&S.bind(),E&&E.bind())}freshBind(t,s,l,h,f,v,x,S){const E=t.numAttributes,I=this.context,P=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=x,this.boundDynamicVertexBuffer3=S,s.enableAttributes(P,t);for(const B of l)B.enableAttributes(P,t);v&&v.enableAttributes(P,t),x&&x.enableAttributes(P,t),S&&S.enableAttributes(P,t),s.bind(),s.setVertexAttribPointers(P,t,f);for(const B of l)B.bind(),B.setVertexAttribPointers(P,t,f);v&&(v.bind(),v.setVertexAttribPointers(P,t,f)),h&&h.bind(),x&&(x.bind(),x.setVertexAttribPointers(P,t,f)),S&&(S.bind(),S.setVertexAttribPointers(P,t,f)),I.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xr(p){const t=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");t.push(l.pop())}return t}class xl{constructor(t,s,l,h,f,v){const x=t.gl;this.program=x.createProgram();const S=Xr(s.staticAttributes),E=l?l.getBinderAttributes():[],I=S.concat(E),P=Ur.prelude.staticUniforms?Xr(Ur.prelude.staticUniforms):[],B=s.staticUniforms?Xr(s.staticUniforms):[],Z=l?l.getBinderUniforms():[],G=P.concat(B).concat(Z),K=[];for(const Se of G)K.indexOf(Se)<0&&K.push(Se);const q=l?l.defines():[];f&&q.push("#define OVERDRAW_INSPECTOR;"),v&&q.push("#define TERRAIN3D;");const oe=q.concat(Ur.prelude.fragmentSource,s.fragmentSource).join(`
`),we=q.concat(Ur.prelude.vertexSource,s.vertexSource).join(`
`),ee=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(ee,oe),x.compileShader(ee),!x.getShaderParameter(ee,x.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${x.getShaderInfoLog(ee)}`);x.attachShader(this.program,ee);const he=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(he,we),x.compileShader(he),!x.getShaderParameter(he,x.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${x.getShaderInfoLog(he)}`);x.attachShader(this.program,he),this.attributes={};const be={};this.numAttributes=I.length;for(let Se=0;Se<this.numAttributes;Se++)I[Se]&&(x.bindAttribLocation(this.program,Se,I[Se]),this.attributes[I[Se]]=Se);if(x.linkProgram(this.program),!x.getProgramParameter(this.program,x.LINK_STATUS))throw new Error(`Program failed to link: ${x.getProgramInfoLog(this.program)}`);x.deleteShader(he),x.deleteShader(ee);for(let Se=0;Se<K.length;Se++){const De=K[Se];if(De&&!be[De]){const Ve=x.getUniformLocation(this.program,De);Ve&&(be[De]=Ve)}}this.fixedUniforms=h(t,be),this.terrainUniforms=((Se,De)=>({u_depth:new c.aL(Se,De.u_depth),u_terrain:new c.aL(Se,De.u_terrain),u_terrain_dim:new c.aM(Se,De.u_terrain_dim),u_terrain_matrix:new c.aN(Se,De.u_terrain_matrix),u_terrain_unpack:new c.aO(Se,De.u_terrain_unpack),u_terrain_exaggeration:new c.aM(Se,De.u_terrain_exaggeration)}))(t,be),this.binderUniforms=l?l.getUniforms(t,be):[]}draw(t,s,l,h,f,v,x,S,E,I,P,B,Z,G,K,q,oe,we){const ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(f),t.setCullFace(v),S){t.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,S.depthTexture),t.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,S.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(S[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(x[be]);K&&K.setUniforms(t,this.binderUniforms,Z,{zoom:G});let he=0;switch(s){case ee.LINES:he=2;break;case ee.TRIANGLES:he=3;break;case ee.LINE_STRIP:he=1}for(const be of B.get()){const Se=be.vaos||(be.vaos={});(Se[E]||(Se[E]=new ts)).bind(t,this,I,K?K.getPaintVertexBuffers():[],P,be.vertexOffset,q,oe,we),ee.drawElements(s,be.primitiveLength*he,ee.UNSIGNED_SHORT,be.primitiveOffset*he*2)}}}function Nn(p,t,s){const l=1/se(s,1,t.transform.tileZoom),h=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=f*(s.tileID.canonical.x+s.tileID.wrap*h),x=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}const No=(p,t,s,l)=>{const h=t.style.light,f=h.properties.get("position"),v=[f.x,f.y,f.z],x=function(){var E=new c.A(9);return c.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();h.properties.get("anchor")==="viewport"&&function(E,I){var P=Math.sin(I),B=Math.cos(I);E[0]=B,E[1]=P,E[2]=0,E[3]=-P,E[4]=B,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(x,-t.transform.angle),function(E,I,P){var B=I[0],Z=I[1],G=I[2];E[0]=B*P[0]+Z*P[3]+G*P[6],E[1]=B*P[1]+Z*P[4]+G*P[7],E[2]=B*P[2]+Z*P[5]+G*P[8]}(v,v,x);const S=h.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+s,u_opacity:l}},Rs=(p,t,s,l,h,f,v)=>c.e(No(p,t,s,l),Nn(f,t,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),wl=p=>({u_matrix:p}),wa=(p,t,s,l)=>c.e(wl(p),Nn(s,t,l)),bl=(p,t)=>({u_matrix:p,u_world:t}),eo=(p,t,s,l,h)=>c.e(wa(p,t,s,l),{u_world:h}),Sr=(p,t,s,l)=>{const h=p.transform;let f,v;if(l.paint.get("circle-pitch-alignment")==="map"){const x=se(s,1,h.zoom);f=!0,v=[x,x]}else f=!1,v=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},Sl=(p,t,s)=>{const l=se(s,1,t.zoom),h=Math.pow(2,t.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*h),t.pixelsToGLUnits[1]/(l*h)],u_overscale_factor:f}},to=(p,t,s=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:s}),kl=p=>({u_matrix:p}),ac=(p,t,s,l)=>({u_matrix:p,u_extrude_scale:se(t,1,s),u_intensity:l});function Tl(p,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new c.U(0,l/s).toLngLat().lat,new c.U(0,(l+1)/s).toLngLat().lat]}const El=(p,t,s,l)=>{const h=p.transform;return{u_matrix:rs(p,t,s,l),u_ratio:1/se(t,1,h.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Cl=(p,t,s,l,h)=>c.e(El(p,t,s,h),{u_image:0,u_image_height:l}),Il=(p,t,s,l,h)=>{const f=p.transform,v=Bs(t,f);return{u_matrix:rs(p,t,s,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/se(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Fs=(p,t,s,l,h,f)=>{const v=p.lineAtlas,x=Bs(t,p.transform),S=s.layout.get("line-cap")==="round",E=v.getDash(l.from,S),I=v.getDash(l.to,S),P=E.width*h.fromScale,B=I.width*h.toScale;return c.e(El(p,t,s,f),{u_patternscale_a:[x/P,-E.height/2],u_patternscale_b:[x/B,-I.height/2],u_sdfgamma:v.width/(256*Math.min(P,B)*p.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:I.y,u_mix:h.t})};function Bs(p,t){return 1/se(p,1,t.tileZoom)}function rs(p,t,s,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ro=(p,t,s,l,h)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(v=h.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(f=h.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:io(h.paint.get("raster-hue-rotate"))};var f,v};function io(p){p*=Math.PI/180;const t=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const gs=(p,t,s,l,h,f,v,x,S,E)=>{const I=h.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:I.cameraToCenterDistance,u_pitch:I.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:I.width/I.height,u_fade_change:h.options.fadeDuration?h.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:v,u_coord_matrix:x,u_is_text:+S,u_pitch_with_map:+l,u_texsize:E,u_texture:0}},hu=(p,t,s,l,h,f,v,x,S,E,I)=>{const P=h.transform;return c.e(gs(p,t,s,l,h,f,v,x,S,E),{u_gamma_scale:l?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:h.pixelRatio,u_is_halo:1})},sa=(p,t,s,l,h,f,v,x,S,E)=>c.e(hu(p,t,s,l,h,f,v,x,!0,S),{u_texsize_icon:E,u_texture_icon:1}),aa=(p,t,s)=>({u_matrix:p,u_opacity:t,u_color:s}),Vn=(p,t,s,l,h,f)=>c.e(function(v,x,S,E){const I=S.imageManager.getPattern(v.from.toString()),P=S.imageManager.getPattern(v.to.toString()),{width:B,height:Z}=S.imageManager.getPixelSize(),G=Math.pow(2,E.tileID.overscaledZ),K=E.tileSize*Math.pow(2,S.transform.tileZoom)/G,q=K*(E.tileID.canonical.x+E.tileID.wrap*G),oe=K*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[B,Z],u_mix:x.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/se(E,1,S.transform.tileZoom),u_pixel_coord_upper:[q>>16,oe>>16],u_pixel_coord_lower:[65535&q,65535&oe]}}(l,f,s,h),{u_matrix:p,u_opacity:t}),Vo={fillExtrusion:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_lightpos:new c.aP(p,t.u_lightpos),u_lightintensity:new c.aM(p,t.u_lightintensity),u_lightcolor:new c.aP(p,t.u_lightcolor),u_vertical_gradient:new c.aM(p,t.u_vertical_gradient),u_opacity:new c.aM(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_lightpos:new c.aP(p,t.u_lightpos),u_lightintensity:new c.aM(p,t.u_lightintensity),u_lightcolor:new c.aP(p,t.u_lightcolor),u_vertical_gradient:new c.aM(p,t.u_vertical_gradient),u_height_factor:new c.aM(p,t.u_height_factor),u_image:new c.aL(p,t.u_image),u_texsize:new c.aQ(p,t.u_texsize),u_pixel_coord_upper:new c.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(p,t.u_pixel_coord_lower),u_scale:new c.aP(p,t.u_scale),u_fade:new c.aM(p,t.u_fade),u_opacity:new c.aM(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_image:new c.aL(p,t.u_image),u_texsize:new c.aQ(p,t.u_texsize),u_pixel_coord_upper:new c.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(p,t.u_pixel_coord_lower),u_scale:new c.aP(p,t.u_scale),u_fade:new c.aM(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_world:new c.aQ(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_world:new c.aQ(p,t.u_world),u_image:new c.aL(p,t.u_image),u_texsize:new c.aQ(p,t.u_texsize),u_pixel_coord_upper:new c.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(p,t.u_pixel_coord_lower),u_scale:new c.aP(p,t.u_scale),u_fade:new c.aM(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_scale_with_map:new c.aL(p,t.u_scale_with_map),u_pitch_with_map:new c.aL(p,t.u_pitch_with_map),u_extrude_scale:new c.aQ(p,t.u_extrude_scale),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_matrix:new c.aN(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aM(p,t.u_pixels_to_tile_units),u_extrude_scale:new c.aQ(p,t.u_extrude_scale),u_overscale_factor:new c.aM(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_inv_matrix:new c.aN(p,t.u_inv_matrix),u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_viewport_size:new c.aQ(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new c.aR(p,t.u_color),u_matrix:new c.aN(p,t.u_matrix),u_overlay:new c.aL(p,t.u_overlay),u_overlay_scale:new c.aM(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new c.aM(p,t.u_extrude_scale),u_intensity:new c.aM(p,t.u_intensity),u_matrix:new c.aN(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_world:new c.aQ(p,t.u_world),u_image:new c.aL(p,t.u_image),u_color_ramp:new c.aL(p,t.u_color_ramp),u_opacity:new c.aM(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_image:new c.aL(p,t.u_image),u_latrange:new c.aQ(p,t.u_latrange),u_light:new c.aQ(p,t.u_light),u_shadow:new c.aR(p,t.u_shadow),u_highlight:new c.aR(p,t.u_highlight),u_accent:new c.aR(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_image:new c.aL(p,t.u_image),u_dimension:new c.aQ(p,t.u_dimension),u_zoom:new c.aM(p,t.u_zoom),u_unpack:new c.aO(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_ratio:new c.aM(p,t.u_ratio),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_ratio:new c.aM(p,t.u_ratio),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(p,t.u_units_to_pixels),u_image:new c.aL(p,t.u_image),u_image_height:new c.aM(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_texsize:new c.aQ(p,t.u_texsize),u_ratio:new c.aM(p,t.u_ratio),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_image:new c.aL(p,t.u_image),u_units_to_pixels:new c.aQ(p,t.u_units_to_pixels),u_scale:new c.aP(p,t.u_scale),u_fade:new c.aM(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_ratio:new c.aM(p,t.u_ratio),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(p,t.u_units_to_pixels),u_patternscale_a:new c.aQ(p,t.u_patternscale_a),u_patternscale_b:new c.aQ(p,t.u_patternscale_b),u_sdfgamma:new c.aM(p,t.u_sdfgamma),u_image:new c.aL(p,t.u_image),u_tex_y_a:new c.aM(p,t.u_tex_y_a),u_tex_y_b:new c.aM(p,t.u_tex_y_b),u_mix:new c.aM(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_tl_parent:new c.aQ(p,t.u_tl_parent),u_scale_parent:new c.aM(p,t.u_scale_parent),u_buffer_scale:new c.aM(p,t.u_buffer_scale),u_fade_t:new c.aM(p,t.u_fade_t),u_opacity:new c.aM(p,t.u_opacity),u_image0:new c.aL(p,t.u_image0),u_image1:new c.aL(p,t.u_image1),u_brightness_low:new c.aM(p,t.u_brightness_low),u_brightness_high:new c.aM(p,t.u_brightness_high),u_saturation_factor:new c.aM(p,t.u_saturation_factor),u_contrast_factor:new c.aM(p,t.u_contrast_factor),u_spin_weights:new c.aP(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new c.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(p,t.u_is_size_feature_constant),u_size_t:new c.aM(p,t.u_size_t),u_size:new c.aM(p,t.u_size),u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_pitch:new c.aM(p,t.u_pitch),u_rotate_symbol:new c.aL(p,t.u_rotate_symbol),u_aspect_ratio:new c.aM(p,t.u_aspect_ratio),u_fade_change:new c.aM(p,t.u_fade_change),u_matrix:new c.aN(p,t.u_matrix),u_label_plane_matrix:new c.aN(p,t.u_label_plane_matrix),u_coord_matrix:new c.aN(p,t.u_coord_matrix),u_is_text:new c.aL(p,t.u_is_text),u_pitch_with_map:new c.aL(p,t.u_pitch_with_map),u_texsize:new c.aQ(p,t.u_texsize),u_texture:new c.aL(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new c.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(p,t.u_is_size_feature_constant),u_size_t:new c.aM(p,t.u_size_t),u_size:new c.aM(p,t.u_size),u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_pitch:new c.aM(p,t.u_pitch),u_rotate_symbol:new c.aL(p,t.u_rotate_symbol),u_aspect_ratio:new c.aM(p,t.u_aspect_ratio),u_fade_change:new c.aM(p,t.u_fade_change),u_matrix:new c.aN(p,t.u_matrix),u_label_plane_matrix:new c.aN(p,t.u_label_plane_matrix),u_coord_matrix:new c.aN(p,t.u_coord_matrix),u_is_text:new c.aL(p,t.u_is_text),u_pitch_with_map:new c.aL(p,t.u_pitch_with_map),u_texsize:new c.aQ(p,t.u_texsize),u_texture:new c.aL(p,t.u_texture),u_gamma_scale:new c.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_is_halo:new c.aL(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new c.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(p,t.u_is_size_feature_constant),u_size_t:new c.aM(p,t.u_size_t),u_size:new c.aM(p,t.u_size),u_camera_to_center_distance:new c.aM(p,t.u_camera_to_center_distance),u_pitch:new c.aM(p,t.u_pitch),u_rotate_symbol:new c.aL(p,t.u_rotate_symbol),u_aspect_ratio:new c.aM(p,t.u_aspect_ratio),u_fade_change:new c.aM(p,t.u_fade_change),u_matrix:new c.aN(p,t.u_matrix),u_label_plane_matrix:new c.aN(p,t.u_label_plane_matrix),u_coord_matrix:new c.aN(p,t.u_coord_matrix),u_is_text:new c.aL(p,t.u_is_text),u_pitch_with_map:new c.aL(p,t.u_pitch_with_map),u_texsize:new c.aQ(p,t.u_texsize),u_texsize_icon:new c.aQ(p,t.u_texsize_icon),u_texture:new c.aL(p,t.u_texture),u_texture_icon:new c.aL(p,t.u_texture_icon),u_gamma_scale:new c.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new c.aM(p,t.u_device_pixel_ratio),u_is_halo:new c.aL(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_opacity:new c.aM(p,t.u_opacity),u_color:new c.aR(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_opacity:new c.aM(p,t.u_opacity),u_image:new c.aL(p,t.u_image),u_pattern_tl_a:new c.aQ(p,t.u_pattern_tl_a),u_pattern_br_a:new c.aQ(p,t.u_pattern_br_a),u_pattern_tl_b:new c.aQ(p,t.u_pattern_tl_b),u_pattern_br_b:new c.aQ(p,t.u_pattern_br_b),u_texsize:new c.aQ(p,t.u_texsize),u_mix:new c.aM(p,t.u_mix),u_pattern_size_a:new c.aQ(p,t.u_pattern_size_a),u_pattern_size_b:new c.aQ(p,t.u_pattern_size_b),u_scale_a:new c.aM(p,t.u_scale_a),u_scale_b:new c.aM(p,t.u_scale_b),u_pixel_coord_upper:new c.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aM(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_texture:new c.aL(p,t.u_texture),u_ele_delta:new c.aM(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_ele_delta:new c.aM(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new c.aN(p,t.u_matrix),u_texture:new c.aL(p,t.u_texture),u_terrain_coords_id:new c.aM(p,t.u_terrain_coords_id),u_ele_delta:new c.aM(p,t.u_ele_delta)})};class ba{constructor(t,s,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const no={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pl{constructor(t,s,l,h){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=h,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const h=s.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,s,l){for(let h=0;h<this.attributes.length;h++){const f=this.attributes[h],v=s.attributes[f.name];v!==void 0&&t.vertexAttribPointer(v,f.components,t[no[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ys=new WeakMap;function jn(p){var t;if(ys.has(p))return ys.get(p);{const s=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return ys.set(p,s),s}}class ur{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sa extends ur{getDefault(){return c.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class En extends ur{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Cn extends ur{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class jo extends ur{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ka extends ur{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class so extends ur{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ml extends ur{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class _s extends ur{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ao extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class oo extends ur{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Al extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ta extends ur{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Uo extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class du extends ur{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class zi extends ur{getDefault(){return c.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class lo extends ur{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class pu extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class $o extends ur{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class uh extends ur{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class fu extends ur{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class mu extends ur{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ea extends ur{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ca extends ur{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class zl extends ur{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class gu extends ur{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class uo extends ur{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class oc extends ur{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Dl extends ur{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;jn(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class yu extends ur{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ia extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class lc extends ur{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class oa extends ur{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class co extends oa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _u extends oa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vu extends oa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mr{constructor(t,s,l,h,f){this.context=t,this.width=s,this.height=l;const v=t.gl,x=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new co(t,x),h)this.depthAttachment=f?new vu(t,x):new _u(t,x);else if(f)throw new Error("Stencil cannot be setted without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ti{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}ti.Replace=[1,0],ti.disabled=new ti(ti.Replace,c.aT.transparent,[!1,!1,!1,!1]),ti.unblended=new ti(ti.Replace,c.aT.transparent,[!0,!0,!0,!0]),ti.alphaBlended=new ti([1,771],c.aT.transparent,[!0,!0,!0,!0]);class ch{constructor(t){var s,l;if(this.gl=t,this.clearColor=new Sa(this),this.clearDepth=new En(this),this.clearStencil=new Cn(this),this.colorMask=new jo(this),this.depthMask=new ka(this),this.stencilMask=new so(this),this.stencilFunc=new Ml(this),this.stencilOp=new _s(this),this.stencilTest=new ao(this),this.depthRange=new oo(this),this.depthTest=new Al(this),this.depthFunc=new Ta(this),this.blend=new Uo(this),this.blendFunc=new du(this),this.blendColor=new zi(this),this.blendEquation=new lo(this),this.cullFace=new pu(this),this.cullFaceSide=new $o(this),this.frontFace=new uh(this),this.program=new fu(this),this.activeTexture=new mu(this),this.viewport=new Ea(this),this.bindFramebuffer=new Ca(this),this.bindRenderbuffer=new zl(this),this.bindTexture=new gu(this),this.bindVertexBuffer=new uo(this),this.bindElementBuffer=new oc(this),this.bindVertexArray=new Dl(this),this.pixelStoreUnpack=new yu(this),this.pixelStoreUnpackPremultiplyAlpha=new Ia(this),this.pixelStoreUnpackFlipY=new lc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),jn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new ba(this,t,s)}createVertexBuffer(t,s,l){return new Pl(this,t,s,l)}createRenderbuffer(t,s,l){const h=this.gl,f=h.createRenderbuffer();return this.bindRenderbuffer.set(f),h.renderbufferStorage(h.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,s,l,h){return new Mr(this,t,s,l,h)}clear({color:t,depth:s,stencil:l}){const h=this.gl;let f=0;t&&(f|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(f|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.aG(t.blendFunction,ti.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return jn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return jn(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class mr{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}mr.ReadOnly=!1,mr.ReadWrite=!0,mr.disabled=new mr(519,mr.ReadOnly,[0,1]);const Pa=7680;class ri{constructor(t,s,l,h,f,v){this.test=t,this.ref=s,this.mask=l,this.fail=h,this.depthFail=f,this.pass=v}}ri.disabled=new ri({func:519,mask:0},0,0,Pa,Pa,Pa);class Qr{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}let ho;function uc(p,t,s,l,h,f,v){const x=p.context,S=x.gl,E=p.useProgram("collisionBox"),I=[];let P=0,B=0;for(let ee=0;ee<l.length;ee++){const he=l[ee],be=t.getTile(he),Se=be.getBucket(s);if(!Se)continue;let De=he.posMatrix;h[0]===0&&h[1]===0||(De=p.translatePosMatrix(he.posMatrix,be,h,f));const Ve=v?Se.textCollisionBox:Se.iconCollisionBox,Fe=Se.collisionCircleArray;if(Fe.length>0){const qe=c.Z(),bt=De;c.aU(qe,Se.placementInvProjMatrix,p.transform.glCoordMatrix),c.aU(qe,qe,Se.placementViewportMatrix),I.push({circleArray:Fe,circleOffset:B,transform:bt,invTransform:qe,coord:he}),P+=Fe.length/4,B=P}Ve&&E.draw(x,S.LINES,mr.disabled,ri.disabled,p.colorModeForRenderPass(),Qr.disabled,Sl(De,p.transform,be),p.style.map.terrain&&p.style.map.terrain.getTerrainData(he),s.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,p.transform.zoom,null,null,Ve.collisionVertexBuffer)}if(!v||!I.length)return;const Z=p.useProgram("collisionCircle"),G=new c.aV;G.resize(4*P),G._trim();let K=0;for(const ee of I)for(let he=0;he<ee.circleArray.length/4;he++){const be=4*he,Se=ee.circleArray[be+0],De=ee.circleArray[be+1],Ve=ee.circleArray[be+2],Fe=ee.circleArray[be+3];G.emplace(K++,Se,De,Ve,Fe,0),G.emplace(K++,Se,De,Ve,Fe,1),G.emplace(K++,Se,De,Ve,Fe,2),G.emplace(K++,Se,De,Ve,Fe,3)}(!ho||ho.length<2*P)&&(ho=function(ee){const he=2*ee,be=new c.aX;be.resize(he),be._trim();for(let Se=0;Se<he;Se++){const De=6*Se;be.uint16[De+0]=4*Se+0,be.uint16[De+1]=4*Se+1,be.uint16[De+2]=4*Se+2,be.uint16[De+3]=4*Se+2,be.uint16[De+4]=4*Se+3,be.uint16[De+5]=4*Se+0}return be}(P));const q=x.createIndexBuffer(ho,!0),oe=x.createVertexBuffer(G,c.aW.members,!0);for(const ee of I){const he={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(we=p.transform).cameraToCenterDistance,u_viewport_size:[we.width,we.height]};Z.draw(x,S.TRIANGLES,mr.disabled,ri.disabled,p.colorModeForRenderPass(),Qr.disabled,he,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ee.coord),s.id,oe,q,c.S.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,p.transform.zoom,null,null,null)}var we;oe.destroy(),q.destroy()}Qr.disabled=new Qr(!1,1029,2305),Qr.backCCW=new Qr(!0,1029,2305);const xu=c.ao(new Float32Array(16));function Ll(p,t,s,l,h,f){const{horizontalAlign:v,verticalAlign:x}=c.au(p);return new c.P((-(v-.5)*t/h+l[0])*f,(-(x-.5)*s/h+l[1])*f)}function Rl(p,t,s,l,h,f,v,x,S,E,I){const P=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,G={};B.clear();for(let K=0;K<P.length;K++){const q=P.get(K),oe=q.hidden||!q.crossTileID||p.allowVerticalPlacement&&!q.placedOrientation?null:l[q.crossTileID];if(oe){const we=new c.P(q.anchorX,q.anchorY),ee=jr(we,s?v:f,I),he=xa(h.cameraToCenterDistance,ee.signedDistanceFromCamera);let be=c.aj(p.textSizeData,S,q)*he/c.ap;s&&(be*=p.tilePixelRatio/x);const{width:Se,height:De,anchor:Ve,textOffset:Fe,textBoxScale:qe}=oe,bt=Ll(Ve,Se,De,Fe,qe,be),cr=s?jr(we.add(bt),f,I).point:ee.point.add(t?bt.rotate(-h.angle):bt),tt=p.allowVerticalPlacement&&q.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let kt=0;kt<q.numGlyphs;kt++)c.ak(B,cr,tt);E&&q.associatedIconIndex>=0&&(G[q.associatedIconIndex]={shiftedAnchor:cr,angle:tt})}else U(q.numGlyphs,B)}if(E){Z.clear();const K=p.icon.placedSymbolArray;for(let q=0;q<K.length;q++){const oe=K.get(q);if(oe.hidden)U(oe.numGlyphs,Z);else{const we=G[q];if(we)for(let ee=0;ee<oe.numGlyphs;ee++)c.ak(Z,we.shiftedAnchor,we.angle);else U(oe.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function wu(p,t,s){return s.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Fl(p,t,s,l,h,f,v,x,S,E,I,P){const B=p.context,Z=B.gl,G=p.transform,K=x==="map",q=S==="map",oe=x!=="viewport"&&s.layout.get("symbol-placement")!=="point",we=K&&!q&&!oe,ee=!s.layout.get("symbol-sort-key").isConstant();let he=!1;const be=p.depthModeForSublayer(0,mr.ReadOnly),Se=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),De=[];for(const Ve of l){const Fe=t.getTile(Ve),qe=Fe.getBucket(s);if(!qe)continue;const bt=h?qe.text:qe.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const cr=bt.programConfigurations.get(s.id),tt=h||qe.sdfIcons,kt=h?qe.textSizeData:qe.iconSizeData,ht=q||G.pitch!==0,Ht=p.useProgram(wu(tt,h,qe),cr),er=c.ah(kt,G.zoom),ar=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ve);let hr,ni,Rr,Li,fi=[0,0],mi=null;if(h)ni=Fe.glyphAtlasTexture,Rr=Z.LINEAR,hr=Fe.glyphAtlasTexture.size,qe.iconsInText&&(fi=Fe.imageAtlasTexture.size,mi=Fe.imageAtlasTexture,Li=ht||p.options.rotating||p.options.zooming||kt.kind==="composite"||kt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Gr=s.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;ni=Fe.imageAtlasTexture,Rr=tt||p.options.rotating||p.options.zooming||Gr||ht?Z.LINEAR:Z.NEAREST,hr=Fe.imageAtlasTexture.size}const Ri=se(Fe,1,p.transform.zoom),Or=Ge(Ve.posMatrix,q,K,p.transform,Ri),ks=$i(Ve.posMatrix,q,K,p.transform,Ri),_n=Se&&qe.hasTextData(),as=s.layout.get("icon-text-fit")!=="none"&&_n&&qe.hasIconData();if(oe){const Gr=p.style.map.terrain?(sn,si)=>p.style.map.terrain.getElevation(Ve,sn,si):null,xi=s.layout.get("text-rotation-alignment")==="map";Qe(qe,Ve.posMatrix,p,h,Or,ks,q,E,xi,Gr)}const da=p.translatePosMatrix(Ve.posMatrix,Fe,f,v),Oa=oe||h&&Se||as?xu:Or,vi=p.translatePosMatrix(ks,Fe,f,v,!0),Fi=tt&&s.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Bi;Bi=tt?qe.iconsInText?sa(kt.kind,er,we,q,p,da,Oa,vi,hr,fi):hu(kt.kind,er,we,q,p,da,Oa,vi,h,hr):gs(kt.kind,er,we,q,p,da,Oa,vi,h,hr);const Ts={program:Ht,buffers:bt,uniformValues:Bi,atlasTexture:ni,atlasTextureIcon:mi,atlasInterpolation:Rr,atlasInterpolationIcon:Li,isSDF:tt,hasHalo:Fi};if(ee&&qe.canOverlap){he=!0;const Gr=bt.segments.get();for(const xi of Gr)De.push({segments:new c.S([xi]),sortKey:xi.sortKey,state:Ts,terrainData:ar})}else De.push({segments:bt.segments,sortKey:0,state:Ts,terrainData:ar})}he&&De.sort((Ve,Fe)=>Ve.sortKey-Fe.sortKey);for(const Ve of De){const Fe=Ve.state;if(B.activeTexture.set(Z.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,Z.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(B.activeTexture.set(Z.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Fe.isSDF){const qe=Fe.uniformValues;Fe.hasHalo&&(qe.u_is_halo=1,bu(Fe.buffers,Ve.segments,s,p,Fe.program,be,I,P,qe,Ve.terrainData)),qe.u_is_halo=0}bu(Fe.buffers,Ve.segments,s,p,Fe.program,be,I,P,Fe.uniformValues,Ve.terrainData)}}function bu(p,t,s,l,h,f,v,x,S,E){const I=l.context;h.draw(I,I.gl.TRIANGLES,f,v,x,Qr.disabled,S,E,s.id,p.layoutVertexBuffer,p.indexBuffer,t,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Ma(p,t,s,l,h){if(!s||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let v=f[s.to.toString()],x=f[s.from.toString()];if(!v&&x&&(v=x),!x&&v&&(x=v),!v||!x){const S=h.getPaintProperty(t);v=f[S],x=f[S]}v&&x&&p.setConstantPatternPositions(v,x)}function Os(p,t,s,l,h,f,v){const x=p.context.gl,S="fill-pattern",E=s.paint.get(S),I=E&&E.constantOr(1),P=s.getCrossfadeParameters();let B,Z,G,K,q;v?(Z=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=x.LINES):(Z=I?"fillPattern":"fill",B=x.TRIANGLES);const oe=E.constantOr(null);for(const we of l){const ee=t.getTile(we);if(I&&!ee.patternsLoaded())continue;const he=ee.getBucket(s);if(!he)continue;const be=he.programConfigurations.get(s.id),Se=p.useProgram(Z,be),De=p.style.map.terrain&&p.style.map.terrain.getTerrainData(we);I&&(p.context.activeTexture.set(x.TEXTURE0),ee.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),be.updatePaintBuffers(P)),Ma(be,S,oe,ee,s);const Ve=De?we:null,Fe=p.translatePosMatrix(Ve?Ve.posMatrix:we.posMatrix,ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){K=he.indexBuffer2,q=he.segments2;const qe=[x.drawingBufferWidth,x.drawingBufferHeight];G=Z==="fillOutlinePattern"&&I?eo(Fe,p,P,ee,qe):bl(Fe,qe)}else K=he.indexBuffer,q=he.segments,G=I?wa(Fe,p,P,ee):wl(Fe);Se.draw(p.context,B,h,p.stencilModeForClipping(we),f,Qr.disabled,G,De,s.id,he.layoutVertexBuffer,K,q,s.paint,p.transform.zoom,be)}}function qo(p,t,s,l,h,f,v){const x=p.context,S=x.gl,E="fill-extrusion-pattern",I=s.paint.get(E),P=I.constantOr(1),B=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity"),G=I.constantOr(null);for(const K of l){const q=t.getTile(K),oe=q.getBucket(s);if(!oe)continue;const we=p.style.map.terrain&&p.style.map.terrain.getTerrainData(K),ee=oe.programConfigurations.get(s.id),he=p.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ee);P&&(p.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ee.updatePaintBuffers(B)),Ma(ee,E,G,q,s);const be=p.translatePosMatrix(K.posMatrix,q,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Se=s.paint.get("fill-extrusion-vertical-gradient"),De=P?Rs(be,p,Se,Z,K,B,q):No(be,p,Se,Z);he.draw(x,x.gl.TRIANGLES,h,f,v,Qr.backCCW,De,we,s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,s.paint,p.transform.zoom,ee,p.style.map.terrain&&oe.centroidVertexBuffer)}}function cc(p,t,s,l,h,f,v){const x=p.context,S=x.gl,E=s.fbo;if(!E)return;const I=p.useProgram("hillshade"),P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),I.draw(x,S.TRIANGLES,h,f,v,Qr.disabled,((B,Z,G,K)=>{const q=G.paint.get("hillshade-shadow-color"),oe=G.paint.get("hillshade-highlight-color"),we=G.paint.get("hillshade-accent-color");let ee=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=B.transform.angle);const he=!B.options.moving;return{u_matrix:K?K.posMatrix:B.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),he),u_image:0,u_latrange:Tl(0,Z.tileID),u_light:[G.paint.get("hillshade-exaggeration"),ee],u_shadow:q,u_highlight:oe,u_accent:we}})(p,s,l,P?t:null),P,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function Bl(p,t,s,l,h,f){const v=p.context,x=v.gl,S=t.dem;if(S&&S.data){const E=S.dim,I=S.stride,P=S.getPixels();if(v.activeTexture.set(x.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(I),t.demTexture){const Z=t.demTexture;Z.update(P,{premultiply:!1}),Z.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else t.demTexture=new Ae(v,P,x.RGBA,{premultiply:!1}),t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);v.activeTexture.set(x.TEXTURE0);let B=t.fbo;if(!B){const Z=new Ae(v,{width:E,height:E,data:null},x.RGBA);Z.bind(x.LINEAR,x.CLAMP_TO_EDGE),B=t.fbo=v.createFramebuffer(E,E,!0,!1),B.colorAttachment.set(Z.texture)}v.bindFramebuffer.set(B.framebuffer),v.viewport.set([0,0,E,E]),p.useProgram("hillshadePrepare").draw(v,x.TRIANGLES,l,h,f,Qr.disabled,((Z,G)=>{const K=G.stride,q=c.Z();return c.aS(q,0,c.N,-c.N,0,0,1),c.$(q,q,[0,-c.N,0]),{u_matrix:q,u_image:1,u_dimension:[K,K],u_zoom:Z.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,S),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function hc(p,t,s,l,h,f){const v=l.paint.get("raster-fade-duration");if(!f&&v>0){const x=c.h.now(),S=(x-p.timeAdded)/v,E=t?(x-t.timeAdded)/v:-1,I=s.getSource(),P=h.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),Z=B&&p.refreshedUponExpiration?1:c.ad(B?S:1-E,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const Su=new c.aT(1,0,0,1),Zo=new c.aT(0,1,0,1),la=new c.aT(0,0,1,1),dc=new c.aT(1,0,1,1),pc=new c.aT(0,1,1,1);function Go(p,t,s,l){Ho(p,0,t+s/2,p.transform.width,s,l)}function Wo(p,t,s,l){Ho(p,t-s/2,0,s,p.transform.height,l)}function Ho(p,t,s,l,h,f){const v=p.context,x=v.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,h*p.pixelRatio),v.clear({color:f}),x.disable(x.SCISSOR_TEST)}function po(p,t,s){const l=p.context,h=l.gl,f=s.posMatrix,v=p.useProgram("debug"),x=mr.disabled,S=ri.disabled,E=p.colorModeForRenderPass(),I="$debug",P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(h.TEXTURE0);const B=t.getTileByID(s.key).latestRawTileData,Z=Math.floor((B&&B.byteLength||0)/1024),G=t.getTile(s).tileSize,K=512/Math.min(G,512)*(s.overscaledZ/p.transform.zoom)*.5;let q=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(q+=` => ${s.overscaledZ}`),function(oe,we){oe.initDebugOverlayCanvas();const ee=oe.debugOverlayCanvas,he=oe.context.gl,be=oe.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,ee.width,ee.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(we,5,5),be.strokeText(we,5,5),oe.debugOverlayTexture.update(ee),oe.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(p,`${q} ${Z}kB`),v.draw(l,h.TRIANGLES,x,S,ti.alphaBlended,Qr.disabled,to(f,c.aT.transparent,K),null,I,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,h.LINE_STRIP,x,S,E,Qr.disabled,to(f,c.aT.red),P,I,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function $r(p,t,s){const l=p.context,h=l.gl,f=p.colorModeForRenderPass(),v=new mr(h.LEQUAL,mr.ReadWrite,p.depthRangeFor3D),x=p.useProgram("terrain"),S=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const E of s){const I=p.renderToTexture.getTexture(E),P=t.getTerrainData(E.tileID);l.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,I.texture);const B={u_matrix:p.transform.calculatePosMatrix(E.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};x.draw(l,h.TRIANGLES,v,ri.disabled,f,Qr.backCCW,B,P,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class Aa{constructor(t,s){this.context=new ch(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.Z(),renderTime:0},this.setup(),this.numSublayers=Wr.maxUnderzooming+Wr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Oo}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,s=new c.a_;s.emplaceBack(0,0),s.emplaceBack(c.N,0),s.emplaceBack(0,c.N),s.emplaceBack(c.N,c.N),this.tileExtentBuffer=t.createVertexBuffer(s,vl.members),this.tileExtentSegments=c.S.simpleSegment(0,0,4,2);const l=new c.a_;l.emplaceBack(0,0),l.emplaceBack(c.N,0),l.emplaceBack(0,c.N),l.emplaceBack(c.N,c.N),this.debugBuffer=t.createVertexBuffer(l,vl.members),this.debugSegments=c.S.simpleSegment(0,0,4,5);const h=new c.V;h.emplaceBack(0,0,0,0),h.emplaceBack(c.N,0,c.N,0),h.emplaceBack(0,c.N,0,c.N),h.emplaceBack(c.N,c.N,c.N,c.N),this.rasterBoundsBuffer=t.createVertexBuffer(h,Ct.members),this.rasterBoundsSegments=c.S.simpleSegment(0,0,4,2);const f=new c.a_;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,vl.members),this.viewportSegments=c.S.simpleSegment(0,0,4,2);const v=new c.a$;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const x=new c.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const S=this.context.gl;this.stencilClearMode=new ri({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.Z();c.aS(l,0,this.width,this.height,0,0,1),c.a0(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,mr.disabled,this.stencilClearMode,ti.disabled,Qr.disabled,kl(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const l=this.context,h=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(ti.disabled),l.setDepthMode(mr.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const x=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);f.draw(l,h.TRIANGLES,mr.disabled,new ri({func:h.ALWAYS,mask:0},x,255,h.KEEP,h.KEEP,h.REPLACE),ti.disabled,Qr.disabled,kl(v.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new ri({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new ri({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,l=t.sort((v,x)=>x.overscaledZ-v.overscaledZ),h=l[l.length-1].overscaledZ,f=l[0].overscaledZ-h+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const v={};for(let x=0;x<f;x++)v[x+h]=new ri({func:s.GEQUAL,mask:255},x+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[v,l]}return[{[h]:ri.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ti([t.CONSTANT_COLOR,t.ONE],new c.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ti.unblended:ti.alphaBlended}depthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return mr.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new mr(l||this.context.gl.LEQUAL,s,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(c.h.now()),this.imageManager.beginFrame();const l=this.style._order,h=this.style.sourceCaches,f={},v={},x={};for(const S in h){const E=h[S];E.used&&E.prepare(this.context),f[S]=E.getVisibleCoordinates(),v[S]=f[S].slice().reverse(),x[S]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<l.length;S++)if(this.style._layers[l[S]].is3D()){this.opaquePassCutoff=S;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(c.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,I){const P=E.context,B=P.gl,Z=ti.unblended,G=new mr(B.LEQUAL,mr.ReadWrite,[0,1]),K=I.getTerrainMesh(),q=I.sourceCache.getRenderableTiles(),oe=E.useProgram("terrainDepth");P.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),P.clear({color:c.aT.transparent,depth:1});for(const we of q){const ee=I.getTerrainData(we.tileID),he={u_matrix:E.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(E.transform.zoom)};oe.draw(P,B.TRIANGLES,G,ri.disabled,Z,Qr.backCCW,he,ee,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,I){const P=E.context,B=P.gl,Z=ti.unblended,G=new mr(B.LEQUAL,mr.ReadWrite,[0,1]),K=I.getTerrainMesh(),q=I.getCoordsTexture(),oe=I.sourceCache.getRenderableTiles(),we=E.useProgram("terrainCoords");P.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),P.clear({color:c.aT.transparent,depth:1}),I.coordsIndex=[];for(const ee of oe){const he=I.getTerrainData(ee.tileID);P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,q.texture);const be={u_matrix:E.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(E.transform.zoom)};we.draw(P,B.TRIANGLES,G,ri.disabled,Z,Qr.backCCW,be,he,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),I.coordsIndex.push(ee.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const S of l){const E=this.style._layers[S];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const I=v[E.source];(E.type==="custom"||I.length)&&this.renderLayer(this,h[E.source],E,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.aT.black:c.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[l[this.currentLayer]],E=h[S.source],I=f[S.source];this._renderTileClippingMasks(S,I),this.renderLayer(this,E,S,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const S=this.style._layers[l[this.currentLayer]],E=h[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const I=(S.type==="symbol"?x:v)[S.source];this._renderTileClippingMasks(S,f[S.source]),this.renderLayer(this,E,S,I)}if(this.options.showTileBoundaries){const S=function(E,I){let P=null;const B=Object.values(E._layers).flatMap(q=>q.source&&!q.isHidden(I)?[E.sourceCaches[q.source]]:[]),Z=B.filter(q=>q.getSource().type==="vector"),G=B.filter(q=>q.getSource().type!=="vector"),K=q=>{(!P||P.getSource().maxzoom<q.getSource().maxzoom)&&(P=q)};return Z.forEach(q=>K(q)),P||G.forEach(q=>K(q)),P}(this.style,this.transform.zoom);S&&function(E,I,P){for(let B=0;B<P.length;B++)po(E,I,P[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const E=S.transform.padding;Go(S,S.transform.height-(E.top||0),3,Su),Go(S,E.bottom||0,3,Zo),Wo(S,E.left||0,3,la),Wo(S,S.transform.width-(E.right||0),3,dc);const I=S.transform.centerPoint;(function(P,B,Z,G){Ho(P,B-1,Z-10,2,20,G),Ho(P,B-10,Z-1,20,2,G)})(S,I.x,S.transform.height-I.y,pc)}(this),this.context.setDefault()}renderLayer(t,s,l,h){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(h||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,v,x,S,E){if(f.renderPass!=="translucent")return;const I=ri.disabled,P=f.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,Z,G,K,q,oe,we){const ee=Z.transform,he=q==="map",be=oe==="map";for(const Se of B){const De=K.getTile(Se),Ve=De.getBucket(G);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const Fe=c.ah(Ve.textSizeData,ee.zoom),qe=se(De,1,Z.transform.zoom),bt=Ge(Se.posMatrix,be,he,Z.transform,qe),cr=G.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(Fe){const tt=Math.pow(2,ee.zoom-De.tileID.overscaledZ);Rl(Ve,he,be,we,ee,bt,Se.posMatrix,tt,Fe,cr,Z.style.map.terrain?(kt,ht)=>Z.style.map.terrain.getElevation(Se,kt,ht):null)}}}(S,f,x,v,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),E),x.paint.get("icon-opacity").constantOr(1)!==0&&Fl(f,v,x,S,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),I,P),x.paint.get("text-opacity").constantOr(1)!==0&&Fl(f,v,x,S,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),I,P),v.map.showCollisionBoxes&&(uc(f,v,x,S,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),!0),uc(f,v,x,S,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),!1))})(t,s,l,h,this.style.placement.variableOffsets);break;case"circle":(function(f,v,x,S){if(f.renderPass!=="translucent")return;const E=x.paint.get("circle-opacity"),I=x.paint.get("circle-stroke-width"),P=x.paint.get("circle-stroke-opacity"),B=!x.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(I.constantOr(1)===0||P.constantOr(1)===0))return;const Z=f.context,G=Z.gl,K=f.depthModeForSublayer(0,mr.ReadOnly),q=ri.disabled,oe=f.colorModeForRenderPass(),we=[];for(let ee=0;ee<S.length;ee++){const he=S[ee],be=v.getTile(he),Se=be.getBucket(x);if(!Se)continue;const De=Se.programConfigurations.get(x.id),Ve=f.useProgram("circle",De),Fe=Se.layoutVertexBuffer,qe=Se.indexBuffer,bt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(he),cr={programConfiguration:De,program:Ve,layoutVertexBuffer:Fe,indexBuffer:qe,uniformValues:Sr(f,he,be,x),terrainData:bt};if(B){const tt=Se.segments.get();for(const kt of tt)we.push({segments:new c.S([kt]),sortKey:kt.sortKey,state:cr})}else we.push({segments:Se.segments,sortKey:0,state:cr})}B&&we.sort((ee,he)=>ee.sortKey-he.sortKey);for(const ee of we){const{programConfiguration:he,program:be,layoutVertexBuffer:Se,indexBuffer:De,uniformValues:Ve,terrainData:Fe}=ee.state;be.draw(Z,G.TRIANGLES,K,q,oe,Qr.disabled,Ve,Fe,x.id,Se,De,ee.segments,x.paint,f.transform.zoom,he)}})(t,s,l,h);break;case"heatmap":(function(f,v,x,S){if(x.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const E=f.context,I=E.gl,P=ri.disabled,B=new ti([I.ONE,I.ONE],c.aT.transparent,[!0,!0,!0,!0]);(function(Z,G,K){const q=Z.gl;Z.activeTexture.set(q.TEXTURE1),Z.viewport.set([0,0,G.width/4,G.height/4]);let oe=K.heatmapFbo;if(oe)q.bindTexture(q.TEXTURE_2D,oe.colorAttachment.get()),Z.bindFramebuffer.set(oe.framebuffer);else{const we=q.createTexture();q.bindTexture(q.TEXTURE_2D,we),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),oe=K.heatmapFbo=Z.createFramebuffer(G.width/4,G.height/4,!1,!1),function(ee,he,be,Se){var De,Ve;const Fe=ee.gl,qe=(De=ee.HALF_FLOAT)!==null&&De!==void 0?De:Fe.UNSIGNED_BYTE,bt=(Ve=ee.RGBA16F)!==null&&Ve!==void 0?Ve:Fe.RGBA;Fe.texImage2D(Fe.TEXTURE_2D,0,bt,he.width/4,he.height/4,0,Fe.RGBA,qe,null),Se.colorAttachment.set(be)}(Z,G,we,oe)}})(E,f,x),E.clear({color:c.aT.transparent});for(let Z=0;Z<S.length;Z++){const G=S[Z];if(v.hasRenderableParent(G))continue;const K=v.getTile(G),q=K.getBucket(x);if(!q)continue;const oe=q.programConfigurations.get(x.id),we=f.useProgram("heatmap",oe),{zoom:ee}=f.transform;we.draw(E,I.TRIANGLES,mr.disabled,P,B,Qr.disabled,ac(G.posMatrix,K,ee,x.paint.get("heatmap-intensity")),null,x.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,x.paint,f.transform.zoom,oe)}E.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(E,I){const P=E.context,B=P.gl,Z=I.heatmapFbo;if(!Z)return;P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Z.colorAttachment.get()),P.activeTexture.set(B.TEXTURE1);let G=I.colorRampTexture;G||(G=I.colorRampTexture=new Ae(P,I.colorRamp,B.RGBA)),G.bind(B.LINEAR,B.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(P,B.TRIANGLES,mr.disabled,ri.disabled,E.colorModeForRenderPass(),Qr.disabled,((K,q,oe,we)=>{const ee=c.Z();c.aS(ee,0,K.width,K.height,0,0,1);const he=K.context.gl;return{u_matrix:ee,u_world:[he.drawingBufferWidth,he.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(E,I),null,I.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,I.paint,E.transform.zoom)}(f,x))})(t,s,l,h);break;case"line":(function(f,v,x,S){if(f.renderPass!=="translucent")return;const E=x.paint.get("line-opacity"),I=x.paint.get("line-width");if(E.constantOr(1)===0||I.constantOr(1)===0)return;const P=f.depthModeForSublayer(0,mr.ReadOnly),B=f.colorModeForRenderPass(),Z=x.paint.get("line-dasharray"),G=x.paint.get("line-pattern"),K=G.constantOr(1),q=x.paint.get("line-gradient"),oe=x.getCrossfadeParameters(),we=K?"linePattern":Z?"lineSDF":q?"lineGradient":"line",ee=f.context,he=ee.gl;let be=!0;for(const Se of S){const De=v.getTile(Se);if(K&&!De.patternsLoaded())continue;const Ve=De.getBucket(x);if(!Ve)continue;const Fe=Ve.programConfigurations.get(x.id),qe=f.context.program.get(),bt=f.useProgram(we,Fe),cr=be||bt.program!==qe,tt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Se),kt=G.constantOr(null);if(kt&&De.imageAtlas){const er=De.imageAtlas,ar=er.patternPositions[kt.to.toString()],hr=er.patternPositions[kt.from.toString()];ar&&hr&&Fe.setConstantPatternPositions(ar,hr)}const ht=tt?Se:null,Ht=K?Il(f,De,x,oe,ht):Z?Fs(f,De,x,Z,oe,ht):q?Cl(f,De,x,Ve.lineClipsArray.length,ht):El(f,De,x,ht);if(K)ee.activeTexture.set(he.TEXTURE0),De.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Fe.updatePaintBuffers(oe);else if(Z&&(cr||f.lineAtlas.dirty))ee.activeTexture.set(he.TEXTURE0),f.lineAtlas.bind(ee);else if(q){const er=Ve.gradients[x.id];let ar=er.texture;if(x.gradientVersion!==er.version){let hr=256;if(x.stepInterpolant){const ni=v.getSource().maxzoom,Rr=Se.canonical.z===ni?Math.ceil(1<<f.transform.maxZoom-Se.canonical.z):1;hr=c.ad(c.aY(Ve.maxLineLength/c.N*1024*Rr),256,ee.maxTextureSize)}er.gradient=c.aZ({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:hr,image:er.gradient||void 0,clips:Ve.lineClipsArray}),er.texture?er.texture.update(er.gradient):er.texture=new Ae(ee,er.gradient,he.RGBA),er.version=x.gradientVersion,ar=er.texture}ee.activeTexture.set(he.TEXTURE0),ar.bind(x.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}bt.draw(ee,he.TRIANGLES,P,f.stencilModeForClipping(Se),B,Qr.disabled,Ht,tt,x.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,x.paint,f.transform.zoom,Fe,Ve.layoutVertexBuffer2),be=!1}})(t,s,l,h);break;case"fill":(function(f,v,x,S){const E=x.paint.get("fill-color"),I=x.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const P=f.colorModeForRenderPass(),B=x.paint.get("fill-pattern"),Z=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&E.constantOr(c.aT.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Z){const G=f.depthModeForSublayer(1,f.renderPass==="opaque"?mr.ReadWrite:mr.ReadOnly);Os(f,v,x,S,G,P,!1)}if(f.renderPass==="translucent"&&x.paint.get("fill-antialias")){const G=f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,mr.ReadOnly);Os(f,v,x,S,G,P,!0)}})(t,s,l,h);break;case"fill-extrusion":(function(f,v,x,S){const E=x.paint.get("fill-extrusion-opacity");if(E!==0&&f.renderPass==="translucent"){const I=new mr(f.context.gl.LEQUAL,mr.ReadWrite,f.depthRangeFor3D);if(E!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))qo(f,v,x,S,I,ri.disabled,ti.disabled),qo(f,v,x,S,I,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const P=f.colorModeForRenderPass();qo(f,v,x,S,I,ri.disabled,P)}}})(t,s,l,h);break;case"hillshade":(function(f,v,x,S){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const E=f.context,I=f.depthModeForSublayer(0,mr.ReadOnly),P=f.colorModeForRenderPass(),[B,Z]=f.renderPass==="translucent"?f.stencilConfigForOverlap(S):[{},S];for(const G of Z){const K=v.getTile(G);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&f.renderPass==="offscreen"?Bl(f,K,x,I,ri.disabled,P):f.renderPass==="translucent"&&cc(f,G,K,x,I,B[G.overscaledZ],P)}E.viewport.set([0,0,f.width,f.height])})(t,s,l,h);break;case"raster":(function(f,v,x,S){if(f.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!S.length)return;const E=f.context,I=E.gl,P=v.getSource(),B=f.useProgram("raster"),Z=f.colorModeForRenderPass(),[G,K]=P instanceof rr?[{},S]:f.stencilConfigForOverlap(S),q=K[K.length-1].overscaledZ,oe=!f.options.moving;for(const we of K){const ee=f.depthModeForSublayer(we.overscaledZ-q,x.paint.get("raster-opacity")===1?mr.ReadWrite:mr.ReadOnly,I.LESS),he=v.getTile(we);he.registerFadeDuration(x.paint.get("raster-fade-duration"));const be=v.findLoadedParent(we,0),Se=hc(he,be,v,x,f.transform,f.style.map.terrain);let De,Ve;const Fe=x.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;E.activeTexture.set(I.TEXTURE0),he.texture.bind(Fe,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(I.TEXTURE1),be?(be.texture.bind(Fe,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),De=Math.pow(2,be.tileID.overscaledZ-he.tileID.overscaledZ),Ve=[he.tileID.canonical.x*De%1,he.tileID.canonical.y*De%1]):he.texture.bind(Fe,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const qe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(we),bt=qe?we:null,cr=bt?bt.posMatrix:f.transform.calculatePosMatrix(we.toUnwrapped(),oe),tt=ro(cr,Ve||[0,0],De||1,Se,x);P instanceof rr?B.draw(E,I.TRIANGLES,ee,ri.disabled,Z,Qr.disabled,tt,qe,x.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments):B.draw(E,I.TRIANGLES,ee,G[we.overscaledZ],Z,Qr.disabled,tt,qe,x.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,s,l,h);break;case"background":(function(f,v,x,S){const E=x.paint.get("background-color"),I=x.paint.get("background-opacity");if(I===0)return;const P=f.context,B=P.gl,Z=f.transform,G=Z.tileSize,K=x.paint.get("background-pattern");if(f.isPatternMissing(K))return;const q=!K&&E.a===1&&I===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;const oe=ri.disabled,we=f.depthModeForSublayer(0,q==="opaque"?mr.ReadWrite:mr.ReadOnly),ee=f.colorModeForRenderPass(),he=f.useProgram(K?"backgroundPattern":"background"),be=S||Z.coveringTiles({tileSize:G,terrain:f.style.map.terrain});K&&(P.activeTexture.set(B.TEXTURE0),f.imageManager.bind(f.context));const Se=x.getCrossfadeParameters();for(const De of be){const Ve=S?De.posMatrix:f.transform.calculatePosMatrix(De.toUnwrapped()),Fe=K?Vn(Ve,I,f,K,{tileID:De,tileSize:G},Se):aa(Ve,I,E),qe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(De);he.draw(P,B.TRIANGLES,we,oe,ee,Qr.disabled,Fe,qe,x.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,h);break;case"custom":(function(f,v,x){const S=f.context,E=x.implementation;if(f.renderPass==="offscreen"){const I=E.prerender;I&&(f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),I.call(E,S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),S.setStencilMode(ri.disabled);const I=E.renderingMode==="3d"?new mr(f.context.gl.LEQUAL,mr.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,mr.ReadOnly);S.setDepthMode(I),E.render(S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState(),S.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,s,l,h,f){if(!l[0]&&!l[1])return t;const v=f?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(v){const E=Math.sin(v),I=Math.cos(v);l=[l[0]*I-l[1]*E,l[0]*E+l[1]*I]}const x=[f?l[0]:se(s,l[0],this.transform.zoom),f?l[1]:se(s,l[1],this.transform.zoom),0],S=new Float32Array(16);return c.$(S,t,x),S}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s){this.cache=this.cache||{};const l=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new xl(this.context,Ur[t],s,Vo[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ae(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Hi{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l){const h=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const S=1/(x=c.ag([],x,t))[3]/s*h;return c.b3(x,x,[S,S,1/x[3],S])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const S=function(B,Z){var G=Z[0],K=Z[1],q=Z[2],oe=G*G+K*K+q*q;return oe>0&&(oe=1/Math.sqrt(oe)),B[0]=Z[0]*oe,B[1]=Z[1]*oe,B[2]=Z[2]*oe,B}([],function(B,Z,G){var K=Z[0],q=Z[1],oe=Z[2],we=G[0],ee=G[1],he=G[2];return B[0]=q*he-oe*ee,B[1]=oe*we-K*he,B[2]=K*ee-q*we,B}([],Rt([],f[x[0]],f[x[1]]),Rt([],f[x[2]],f[x[1]]))),E=-((I=S)[0]*(P=f[x[1]])[0]+I[1]*P[1]+I[2]*P[2]);var I,P;return S.concat(E)});return new Hi(f,v)}}class fo{constructor(t,s){this.min=t,this.max=s,this.center=function(l,h,f){return l[0]=.5*h[0],l[1]=.5*h[1],l[2]=.5*h[2],l}([],function(l,h,f){return l[0]=h[0]+f[0],l[1]=h[1]+f[1],l[2]=h[2]+f[2],l}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],l=Ut(this.min),h=Ut(this.max);for(let f=0;f<s.length;f++)l[f]=s[f]?this.min[f]:this.center[f],h[f]=s[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new fo(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let v=0;for(let x=0;x<s.length;x++)c.b4(f,s[x])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const S=t.points[x][h]-this.min[h];f=Math.min(f,S),v=Math.max(v,S)}if(v<0||f>this.max[h]-this.min[h])return 0}return 1}}class mo{constructor(t=0,s=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=h}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=c.B.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=c.B.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=c.B.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=c.B.number(t.right,s.right,l)),this}getCenter(t,s){const l=c.ad((this.left+t-this.right)/2,0,t),h=c.ad((this.top+s-this.bottom)/2,0,s);return new c.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new mo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class go{constructor(t,s,l,h,f){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new mo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new go(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-c.b5(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new c.A(4);return c.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,h,f){var v=h[0],x=h[1],S=h[2],E=h[3],I=Math.sin(f),P=Math.cos(f);l[0]=v*P+S*I,l[1]=x*P+E*I,l[2]=v*-I+S*P,l[3]=x*-I+E*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=c.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new c.b6(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new c.P(0,0)),h=this.pointCoordinate(new c.P(this.width,0)),f=this.pointCoordinate(new c.P(this.width,this.height)),v=this.pointCoordinate(new c.P(0,this.height)),x=Math.floor(Math.min(l.x,h.x,f.x,v.x)),S=Math.floor(Math.max(l.x,h.x,f.x,v.x)),E=1;for(let I=x-E;I<=S+E;I++)I!==0&&s.push(new c.b6(I,t))}return s}coveringTiles(t){var s,l;let h=this.coveringZoomLevel(t);const f=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),x=c.U.fromLngLat(this.center),S=Math.pow(2,h),E=[S*v.x,S*v.y,0],I=[S*x.x,S*x.y,0],P=Hi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=h);const Z=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=ee=>({aabb:new fo([ee*S,0,0],[(ee+1)*S,S,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),K=[],q=[],oe=h,we=t.reparseOverscaled?f:h;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)K.push(G(-ee)),K.push(G(ee));for(K.push(G(0));K.length>0;){const ee=K.pop(),he=ee.x,be=ee.y;let Se=ee.fullyVisible;if(!Se){const bt=ee.aabb.intersects(P);if(bt===0)continue;Se=bt===2}const De=t.terrain?E:I,Ve=ee.aabb.distanceX(De),Fe=ee.aabb.distanceY(De),qe=Math.max(Math.abs(Ve),Math.abs(Fe));if(ee.zoom===oe||qe>Z+(1<<oe-ee.zoom)-2&&ee.zoom>=B){const bt=oe-ee.zoom,cr=E[0]-.5-(he<<bt),tt=E[1]-.5-(be<<bt);q.push({tileID:new c.O(ee.zoom===oe?we:ee.zoom,ee.wrap,ee.zoom,he,be),distanceSq:ft([I[0]-.5-he,I[1]-.5-be]),tileDistanceToCamera:Math.sqrt(cr*cr+tt*tt)})}else for(let bt=0;bt<4;bt++){const cr=(he<<1)+bt%2,tt=(be<<1)+(bt>>1),kt=ee.zoom+1;let ht=ee.aabb.quadrant(bt);if(t.terrain){const Ht=new c.O(kt,ee.wrap,kt,cr,tt),er=t.terrain.getMinMaxElevation(Ht),ar=(s=er.minElevation)!==null&&s!==void 0?s:this.elevation,hr=(l=er.maxElevation)!==null&&l!==void 0?l:this.elevation;ht=new fo([ht.min[0],ht.min[1],ar],[ht.max[0],ht.max[1],hr])}K.push({aabb:ht,zoom:kt,x:cr,y:tt,wrap:ee.wrap,fullyVisible:Se})}}return q.sort((ee,he)=>ee.distanceSq-he.distanceSq).map(ee=>ee.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=c.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.P(c.G(t.lng)*this.worldSize,c.H(s)*this.worldSize)}unproject(t){return new c.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-l))return;const h=this.getCameraPosition(),f=c.U.fromLngLat(h.lngLat,h.altitude),v=c.U.fromLngLat(s,l),x=f.x-v.x,S=f.y-v.y,E=f.z-v.z,I=Math.sqrt(x*x+S*S+E*E),P=this.scaleZoom(this.cameraToCenterDistance/I/this.tileSize);this._elevation=l,this._center=s,this.zoom=P}setLocationAtPoint(t,s){const l=this.pointCoordinate(s),h=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),v=new c.U(f.x-(l.x-h.x),f.y-(l.y-h.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return c.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const B=s.pointCoordinate(t);if(B!=null)return B}const l=[t.x,t.y,0,1],h=[t.x,t.y,1,1];c.ag(l,l,this.pixelMatrixInverse),c.ag(h,h,this.pixelMatrixInverse);const f=l[3],v=h[3],x=l[1]/f,S=h[1]/v,E=l[2]/f,I=h[2]/v,P=E===I?0:(0-E)/(I-E);return new c.U(c.B.number(l[0]/f,h[0]/v,P)/this.worldSize,c.B.number(x,S,P)/this.worldSize)}coordinatePoint(t,s=0,l=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,s,1];return c.ag(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new c.P(0,t))).extend(this.pointLocation(new c.P(this.width,t))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const l=t.key,h=s?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];const f=t.canonical,v=this.worldSize/this.zoomScale(f.z),x=f.x+Math.pow(2,f.z)*t.wrap,S=c.ao(new Float64Array(16));return c.$(S,S,[x*v,f.y*v,0]),c.a0(S,S,[v/c.N,v/c.N,1]),c.a1(S,s?this.alignedProjMatrix:this.projMatrix,S),h[l]=new Float32Array(S),h[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,l,h,f=-90,v=90,x=-180,S=180;const E=this.size,I=this._unmodified;if(this.latRange){const Z=this.latRange;f=c.H(Z[1])*this.worldSize,v=c.H(Z[0])*this.worldSize,t=v-f<E.y?E.y/(v-f):0}if(this.lngRange){const Z=this.lngRange;x=c.b5(c.G(Z[0])*this.worldSize,0,this.worldSize),S=c.b5(c.G(Z[1])*this.worldSize,0,this.worldSize),S<x&&(S+=this.worldSize),s=S-x<E.x?E.x/(S-x):0}const P=this.point,B=Math.max(s||0,t||0);if(B)return this.center=this.unproject(new c.P(s?(S+x)/2:P.x,t?(v+f)/2:P.y)),this.zoom+=this.scaleZoom(B),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const Z=P.y,G=E.y/2;Z-G<f&&(h=f+G),Z+G>v&&(h=v-G)}if(this.lngRange){const Z=(x+S)/2,G=c.b5(P.x,Z-this.worldSize/2,Z+this.worldSize/2),K=E.x/2;G-K<x&&(l=x+K),G+K>S&&(l=S-K)}l===void 0&&h===void 0||(this.center=this.unproject(new c.P(l!==void 0?l:P.x,h!==void 0?h:P.y)).wrap()),this._unmodified=I,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b7(1,this.center.lat)*this.worldSize;let h=c.ao(new Float64Array(16));c.a0(h,h,[this.width/2,-this.height/2,1]),c.$(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=c.ao(new Float64Array(16)),c.a0(h,h,[1,-1,1]),c.$(h,h,[-1,-1,0]),c.a0(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this._minEleveationForCurrentTile),x=f-v*this._pixelPerMeter/Math.cos(this._pitch),S=v<0?x:f,E=Math.PI/2+this._pitch,I=this._fov*(.5+t.y/this.height),P=Math.sin(I)*S/Math.sin(c.ad(Math.PI-E-I,.01,Math.PI-.01)),B=this.getHorizon(),Z=2*Math.atan(B/this.cameraToCenterDistance)*(.5+t.y/(2*B)),G=Math.sin(Z)*S/Math.sin(c.ad(Math.PI-E-Z,.01,Math.PI-.01)),K=Math.min(P,G),q=1.01*(Math.cos(Math.PI/2-this._pitch)*K+S),oe=this.height/50;h=new Float64Array(16),c.b8(h,this._fov,this.width/this.height,oe,q),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,c.a0(h,h,[1,-1,1]),c.$(h,h,[0,0,-this.cameraToCenterDistance]),c.b9(h,h,this._pitch),c.ae(h,h,this.angle),c.$(h,h,[-s,-l,0]),this.mercatorMatrix=c.a0([],h,[this.worldSize,this.worldSize,this.worldSize]),c.a0(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.a1(new Float64Array(16),this.labelPlaneMatrix,h),c.$(h,h,[0,0,-this.elevation]),this.projMatrix=h,this.invProjMatrix=c.as([],h),this.pixelMatrix3D=c.a1(new Float64Array(16),this.labelPlaneMatrix,h);const we=this.width%2/2,ee=this.height%2/2,he=Math.cos(this.angle),be=Math.sin(this.angle),Se=s-Math.round(s)+he*we+be*ee,De=l-Math.round(l)+he*ee+be*we,Ve=new Float64Array(h);if(c.$(Ve,Ve,[Se>.5?Se-1:Se,De>.5?De-1:De,0]),this.alignedProjMatrix=Ve,h=c.as(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new c.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.ag(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let l=s.x,h=s.y,f=s.x,v=s.y;for(const x of t)l=Math.min(l,x.x),h=Math.min(h,x.y),f=Math.max(f,x.x),v=Math.max(v,x.y);return[new c.P(l,h),new c.P(f,h),new c.P(f,v),new c.P(l,v),new c.P(l,h)]}}}function Ns(p,t){let s,l=!1,h=null,f=null;const v=()=>{h=null,l&&(p.apply(f,s),h=setTimeout(v,t),l=!1)};return(...x)=>(l=!0,f=this,s=x,h||v(),h)}class yo{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=Ns(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,h),v=Math.round(s.lng*f)/f,x=Math.round(s.lat*f)/f,S=this._map.getBearing(),E=this._map.getPitch();let I="";if(I+=t?`/${v}/${x}/${l}`:`${l}/${x}/${v}`,(S||E)&&(I+="/"+Math.round(10*S)/10),E&&(I+=`/${Math.round(E)}`),this._hashName){const P=this._hashName;let B=!1;const Z=window.location.hash.slice(1).split("&").map(G=>{const K=G.split("=")[0];return K===P?(B=!0,`${K}=${I}`):G}).filter(G=>G);return B||Z.push(`${P}=${I}`),`#${Z.join("&")}`}return`#${I}`}}const za={linearity:.3,easing:c.ba(0,0,.3,1)},ku=c.e({deceleration:2500,maxSpeed:1400},za),fc=c.e({deceleration:20,maxSpeed:1400},za),mc=c.e({deceleration:1e3,maxSpeed:360},za),gc=c.e({deceleration:1e3,maxSpeed:90},za);class yc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=c.h.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(s.pan.mag()){const f=hn(s.pan.mag(),l,c.e({},ku,t||{}));h.offset=s.pan.mult(f.amount/s.pan.mag()),h.center=this._map.transform.center,vs(h,f)}if(s.zoom){const f=hn(s.zoom,l,fc);h.zoom=this._map.transform.zoom+f.amount,vs(h,f)}if(s.bearing){const f=hn(s.bearing,l,mc);h.bearing=this._map.transform.bearing+c.ad(f.amount,-179,179),vs(h,f)}if(s.pitch){const f=hn(s.pitch,l,gc);h.pitch=this._map.transform.pitch+f.amount,vs(h,f)}if(h.zoom||h.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;h.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function vs(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function hn(p,t,s){const{maxSpeed:l,linearity:h,deceleration:f}=s,v=c.ad(p*h/(t/1e3),-l,l),x=Math.abs(v)/(f*h);return{easing:s.easing,duration:1e3*x,amount:v*(x/2)}}class Ki extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,h={}){const f=$.mousePos(s.getCanvasContainer(),l),v=s.unproject(f);super(t,c.e({point:f,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=s}}class _o extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const h=t==="touchend"?l.changedTouches:l.touches,f=$.touchPos(s.getCanvasContainer(),h),v=f.map(S=>s.unproject(S)),x=f.reduce((S,E,I,P)=>S.add(E.div(P.length)),new c.P(0,0));super(t,{points:f,point:x,lngLats:v,lngLat:s.unproject(x),originalEvent:l}),this._defaultPrevented=!1}}class Tu extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Eu{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Tu(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Ki(t.type,this._map,t))}mouseup(t){this._map.fire(new Ki(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Ki(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ki(t.type,this._map,t))}mouseover(t){this._map.fire(new Ki(t.type,this._map,t))}mouseout(t){this._map.fire(new Ki(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _o(t.type,this._map,t))}touchmove(t){this._map.fire(new _o(t.type,this._map,t))}touchend(t){this._map.fire(new _o(t.type,this._map,t))}touchcancel(t){this._map.fire(new _o(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ki(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ki("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ki(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xs{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(c.P.convert(t),this._map.terrain)}}class _c{constructor(t,s){this._map=t,this._tr=new xs(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&($.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(h.x,l.x),v=Math.max(h.x,l.x),x=Math.min(h.y,l.y),S=Math.max(h.y,l.y);$.setTransform(this._box,`translate(${f}px,${x}px)`),this._box.style.width=v-f+"px",this._box.style.height=S-x+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,h=s;if(this.reset(),$.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new c.k(t,{originalEvent:s}))}}function Un(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=t[l];return s}class yn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const f=new c.P(0,0);for(const v of h)f._add(v);return f.div(h.length)}(s),this.touches=Un(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const h=Un(l,s);for(const f in this.touches){const v=h[f];(!v||v.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class vo{constructor(t){this.singleTap=new yn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const h=this.singleTap.touchend(t,s,l);if(h){const f=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(f&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class In{constructor(t){this._tr=new xs(t),this._zoomIn=new vo({numTouches:1,numTaps:2}),this._zoomOut=new vo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const h=this._zoomIn.touchend(t,s,l),f=this._zoomOut.touchend(t,s,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class is{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=s.length?s[0]:s;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&$.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vc={0:1,2:2};class xo{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=$.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const h=vc[l];return s.buttons===void 0||(s.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return $.mouseButton(t)===this._eventButton}}class Da{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const wo=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},La=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const l=new xo({checkCorrectEvent:h=>$.mouseButton(h)===0&&h.ctrlKey||$.mouseButton(h)===2});return new is({clickTolerance:t,move:(h,f)=>({bearingDelta:(f.x-h.x)*s}),moveStateManager:l,enable:p,assignEvents:wo})},$n=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new xo({checkCorrectEvent:h=>$.mouseButton(h)===0&&h.ctrlKey||$.mouseButton(h)===2});return new is({clickTolerance:t,move:(h,f)=>({pitchDelta:(f.y-h.y)*s}),moveStateManager:l,enable:p,assignEvents:wo})};class gt{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,l)}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const h=Un(l,s),f=new c.P(0,0),v=new c.P(0,0);let x=0;for(const E in h){const I=h[E],P=this._touches[E];P&&(f._add(I),v._add(I.sub(P)),x++,h[E]=I)}if(this._touches=h,x<this._minTouches||!v.mag())return;const S=v.div(x);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(x),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ko{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,f]=this._firstTwoTouches,v=Vs(l,s,h),x=Vs(l,s,f);if(!v||!x)return;const S=this._aroundCenter?null:v.add(x).div(2);return this._move([v,x],S,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[h,f]=this._firstTwoTouches,v=Vs(l,s,h),x=Vs(l,s,f);v&&x||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vs(p,t,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return t[l]}function Ra(p,t){return Math.log(p/t)/Math.LN2}class Iu extends Ko{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ra(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ra(this._distance,l),pinchAround:s}}}function lt(p,t){return 180*p.angleWith(t)/Math.PI}class ws extends Ko{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:lt(this._vector,l),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=lt(t,this._startVector);return Math.abs(l)<s}}function Xo(p){return Math.abs(p.y)>Math.abs(p.x)}class Pu extends Ko{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,f=s.mag()>=2;if(!h&&!f)return;if(!h||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return Xo(t)&&Xo(s)&&v}}const Mu={panStep:100,bearingStep:15,pitchStep:10};class xc{constructor(t){this._tr=new xs(t);const s=Mu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,h=0,f=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:x=>{const S=this._tr;x.easeTo({duration:300,easeId:"keyboardHandler",easing:bo,zoom:s?Math.round(S.zoom)+s*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-f*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bo(p){return p*(2-p)}const wc=4.000244140625;class bc{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new xs(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=c.h.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%wc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=$.mousePos(this._el,t),l=this._tr;this._around=c.L.convert(this._aroundCenter?l.center:l.unproject(s)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>wc?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&S!==0&&(S=1/S);const E=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(E*S))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,h=this._easing;let f,v=!1;if(this._type==="wheel"&&l&&h){const x=Math.min((c.h.now()-this._lastWheelEventTime)/200,1),S=h(x);f=c.B.number(l,s,S),x<1?this._frameId||(this._frameId=!0):v=!0}else f=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=c.bb;if(this._prevEase){const l=this._prevEase,h=(c.h.now()-l.start)/l.duration,f=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(f*f+1e-4)*.01,x=Math.sqrt(.0729-v*v);s=c.ba(v,x,.25,1)}return this._prevEase={start:c.h.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ol{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qr{constructor(t){this._tr=new xs(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yo{constructor(){this._tap=new vo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const h=s[0],f=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;f&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=s[0],f=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,s,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class So{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Di{constructor(t,s,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class js{constructor(t,s,l,h){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fa=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ba extends c.k{}function ua(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ca{constructor(t,s){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,f)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,x={needsRenderFrame:!1},S={},E={},I=h.touches,P=I?this._getMapTouches(I):void 0,B=P?$.touchPos(this._el,P):$.mousePos(this._el,h);for(const{handlerName:K,handler:q,allowed:oe}of this._handlers){if(!q.isEnabled())continue;let we;this._blockedByActive(E,oe,K)?q.reset():q[f||h.type]&&(we=q[f||h.type](h,B,P),this.mergeHandlerResult(x,S,we,K,v),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||q.isActive())&&(E[K]=q)}const Z={};for(const K in this._previousActiveHandlers)E[K]||(Z[K]=v);this._previousActiveHandlers=E,(Object.keys(Z).length||ua(x))&&(this._changes.push([x,S,Z]),this._triggerRenderFrame()),(Object.keys(E).length||ua(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=x;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,f,v]of this._listeners)$.addEventListener(h,f,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,l]of this._listeners)$.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Eu(s,t));const h=s.boxZoom=new _c(s,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const f=new In(s),v=new qr(s);s.doubleClickZoom=new Ol(v,f),this._add("tapZoom",f),this._add("clickZoom",v),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const x=new Yo;this._add("tapDragZoom",x);const S=s.touchPitch=new Pu(s);this._add("touchPitch",S),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const E=La(t),I=$n(t);s.dragRotate=new Di(t,E,I),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const P=(({enable:oe,clickTolerance:we})=>{const ee=new xo({checkCorrectEvent:he=>$.mouseButton(he)===0&&!he.ctrlKey});return new is({clickTolerance:we,move:(he,be)=>({around:be,panDelta:be.sub(he)}),activateOnStart:!0,moveStateManager:ee,enable:oe,assignEvents:wo})})(t),B=new gt(t,s);s.dragPan=new So(l,P,B),this._add("mousePan",P),this._add("touchPan",B,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Z=new ws,G=new Iu;s.touchZoomRotate=new js(l,G,Z,x),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const K=s.scrollZoom=new bc(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const q=s.keyboard=new xc(s);this._add("keyboard",q),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Cu(s))}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fa(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const h in t)if(h!==l&&(!s||s.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,h,f){if(!l)return;c.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},l={};for(const[h,f,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),c.e(s,f),c.e(l,v);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const h=this._map,f=h._getTransformForUpdate(),v=h.terrain;if(!(ua(t)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:x,zoomDelta:S,bearingDelta:E,pitchDelta:I,around:P,pinchAround:B}=t;B!==void 0&&(P=B),h._stop(!0),P=P||h.transform.centerPoint;const Z=f.pointLocation(x?P.sub(x):P);E&&(f.bearing+=E),I&&(f.pitch+=I),S&&(f.zoom+=S),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(x)):f.setLocationAtPoint(Z,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(Z,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(h.terrain)})):f.setLocationAtPoint(Z,P),h._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_fireEvents(t,s,l){const h=Fa(this._eventsInProgress),f=Fa(t),v={};for(const I in t){const{originalEvent:P}=t[I];this._eventsInProgress[I]||(v[`${I}start`]=P),this._eventsInProgress[I]=t[I]}!h&&f&&this._fireEvent("movestart",f.originalEvent);for(const I in v)this._fireEvent(I,v[I]);f&&this._fireEvent("move",f.originalEvent);for(const I in t){const{originalEvent:P}=t[I];this._fireEvent(I,P)}const x={};let S;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:B}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],S=s[P]||B,x[`${I}end`]=S)}for(const I in x)this._fireEvent(I,x[I]);const E=Fa(this._eventsInProgress);if(l&&(h||f)&&!E){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!I||!I.essential&&c.h.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:S})),P(this._map.getBearing())&&this._map.resetNorth()):(P(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new c.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ba("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Au extends c.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const l=Math.min((c.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,l){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(c.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(c.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(c.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,c.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=Ne.convert(t);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,h){const f={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const be=h.padding;h.padding={top:be,bottom:be,right:be,left:be}}h.padding=c.e(f,h.padding);const v=this.transform,x=v.padding,S=v.project(c.L.convert(t)),E=v.project(c.L.convert(s)),I=S.rotate(-l*Math.PI/180),P=E.rotate(-l*Math.PI/180),B=new c.P(Math.max(I.x,P.x),Math.max(I.y,P.y)),Z=new c.P(Math.min(I.x,P.x),Math.min(I.y,P.y)),G=B.sub(Z),K=(v.width-(x.left+x.right+h.padding.left+h.padding.right))/G.x,q=(v.height-(x.top+x.bottom+h.padding.top+h.padding.bottom))/G.y;if(q<0||K<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(v.scaleZoom(v.scale*Math.min(K,q)),h.maxZoom),we=c.P.convert(h.offset),ee=new c.P((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(l*Math.PI/180),he=we.add(ee).mult(v.scale/v.zoomScale(oe));return{center:v.unproject(S.add(E).div(2).sub(he)),zoom:oe,bearing:l}}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,h,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(t)),this.transform.pointLocation(c.P.convert(s)),l,h),h,f)}_fitInternal(t,s,l){return t?(delete(s=c.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let h=!1,f=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(h=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=c.L.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new c.k("movestart",s)).fire(new c.k("move",s)),h&&this.fire(new c.k("zoomstart",s)).fire(new c.k("zoom",s)).fire(new c.k("zoomend",s)),f&&this.fire(new c.k("rotatestart",s)).fire(new c.k("rotate",s)).fire(new c.k("rotateend",s)),v&&this.fire(new c.k("pitchstart",s)).fire(new c.k("pitch",s)).fire(new c.k("pitchend",s)),this.fire(new c.k("moveend",s))}calculateCameraOptionsFromTo(t,s,l,h=0){const f=c.U.fromLngLat(t,s),v=c.U.fromLngLat(l,h),x=v.x-f.x,S=v.y-f.y,E=v.z-f.z,I=Math.hypot(x,S,E);if(I===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(x,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/I/this.transform.tileSize),Z=180*Math.atan2(x,-S)/Math.PI;let G=180*Math.acos(P/I)/Math.PI;return G=E<0?90-G:90+G,{center:v.toLngLat(),zoom:B,pitch:G,bearing:Z}}easeTo(t,s){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.bb},t)).animate===!1||!t.essential&&c.h.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),v=this.getPitch(),x=this.getPadding(),S="zoom"in t?+t.zoom:h,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,I="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:l.padding,B=c.P.convert(t.offset);let Z=l.centerPoint.add(B);const G=l.pointLocation(Z),K=c.L.convert(t.center||G);this._normalizeCenter(K);const q=l.project(G),oe=l.project(K).sub(q),we=l.zoomScale(S-h);let ee,he;t.around&&(ee=c.L.convert(t.around),he=l.locationPoint(ee));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==h,this._rotating=this._rotating||f!==E,this._pitching=this._pitching||I!==v,this._padding=!l.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,be),this.terrain&&this._prepareElevation(K),this._ease(Se=>{if(this._zooming&&(l.zoom=c.B.number(h,S,Se)),this._rotating&&(l.bearing=c.B.number(f,E,Se)),this._pitching&&(l.pitch=c.B.number(v,I,Se)),this._padding&&(l.interpolatePadding(x,P,Se),Z=l.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(Se),ee)l.setLocationAtPoint(ee,he);else{const De=l.zoomScale(l.zoom-h),Ve=S>h?Math.min(2,we):Math.max(.5,we),Fe=Math.pow(Ve,1-Se),qe=l.unproject(q.add(oe.mult(Se*Fe)).mult(De));l.setLocationAtPoint(l.renderWorldCopies?qe.wrap():qe,Z)}this._applyUpdatedTransform(l),this._fireMoveEvents(s)},Se=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,Se)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new c.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new c.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new c.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new c.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=c.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:l,zoom:h,pitch:f,bearing:v,elevation:x}=this.transformCameraUpdate(s);l&&(s.center=l),h!==void 0&&(s.zoom=h),f!==void 0&&(s.pitch=f),v!==void 0&&(s.bearing=v),x!==void 0&&(s.elevation=x),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new c.k("move",t)),this._zooming&&this.fire(new c.k("zoom",t)),this._rotating&&this.fire(new c.k("rotate",t)),this._pitching&&this.fire(new c.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,h=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new c.k("zoomend",t)),h&&this.fire(new c.k("rotateend",t)),f&&this.fire(new c.k("pitchend",t)),this.fire(new c.k("moveend",t))}flyTo(t,s){if(!t.essential&&c.h.prefersReducedMotion){const ht=c.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ht,s)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.bb},t);const l=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),v=this.getPitch(),x=this.getPadding(),S="zoom"in t?c.ad(+t.zoom,l.minZoom,l.maxZoom):h,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,I="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:l.padding,B=l.zoomScale(S-h),Z=c.P.convert(t.offset);let G=l.centerPoint.add(Z);const K=l.pointLocation(G),q=c.L.convert(t.center||K);this._normalizeCenter(q);const oe=l.project(K),we=l.project(q).sub(oe);let ee=t.curve;const he=Math.max(l.width,l.height),be=he/B,Se=we.mag();if("minZoom"in t){const ht=c.ad(Math.min(t.minZoom,h,S),l.minZoom,l.maxZoom),Ht=he/l.zoomScale(ht-h);ee=Math.sqrt(Ht/Se*2)}const De=ee*ee;function Ve(ht){const Ht=(be*be-he*he+(ht?-1:1)*De*De*Se*Se)/(2*(ht?be:he)*De*Se);return Math.log(Math.sqrt(Ht*Ht+1)-Ht)}function Fe(ht){return(Math.exp(ht)-Math.exp(-ht))/2}function qe(ht){return(Math.exp(ht)+Math.exp(-ht))/2}const bt=Ve(!1);let cr=function(ht){return qe(bt)/qe(bt+ee*ht)},tt=function(ht){return he*((qe(bt)*(Fe(Ht=bt+ee*ht)/qe(Ht))-Fe(bt))/De)/Se;var Ht},kt=(Ve(!0)-bt)/ee;if(Math.abs(Se)<1e-6||!isFinite(kt)){if(Math.abs(he-be)<1e-6)return this.easeTo(t,s);const ht=be<he?-1:1;kt=Math.abs(Math.log(be/he))/ee,tt=function(){return 0},cr=function(Ht){return Math.exp(ht*ee*Ht)}}return t.duration="duration"in t?+t.duration:1e3*kt/("screenSpeed"in t?+t.screenSpeed/ee:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==E,this._pitching=I!==v,this._padding=!l.isPaddingEqual(P),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(q),this._ease(ht=>{const Ht=ht*kt,er=1/cr(Ht);l.zoom=ht===1?S:h+l.scaleZoom(er),this._rotating&&(l.bearing=c.B.number(f,E,ht)),this._pitching&&(l.pitch=c.B.number(v,I,ht)),this._padding&&(l.interpolatePadding(x,P,ht),G=l.centerPoint.add(Z)),this.terrain&&!t.freezeElevation&&this._updateElevation(ht);const ar=ht===1?q:l.unproject(oe.add(we.mult(tt(Ht))).mult(er));l.setLocationAtPoint(l.renderWorldCopies?ar.wrap():ar,G),this._applyUpdatedTransform(l),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,s)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=c.h.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=c.b5(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=t.lng-s.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(c.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Pn{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const s=this._map.style.sourceCaches;for(const h in s){const f=s[h];if(f.used||f.usedForTerrain){const v=f.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,f)=>h.length-f.length),t=t.filter((h,f)=>{for(let v=f+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yr{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const s=$.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Jo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ko={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Qo=c.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Nl extends c.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const l={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),c.aS(h.posMatrix,0,c.N,0,c.N,0,1),this._tiles[h.key]=new fr(h,this.tileSize));for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID;if(h.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),c.aS(f.posMatrix,0,c.N,0,c.N,0,1),s[l]=f}else if(h.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=h.canonical.z-t.canonical.z,x=h.canonical.x-(h.canonical.x>>v<<v),S=h.canonical.y-(h.canonical.y>>v<<v),E=c.N>>v;c.aS(f.posMatrix,0,E,0,E,0,1),c.$(f.posMatrix,f.posMatrix,[-x*E,-S*E,0]),s[l]=f}else if(t.canonical.isChildOf(h.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=t.canonical.z-h.canonical.z,x=t.canonical.x-(t.canonical.x>>v<<v),S=t.canonical.y-(t.canonical.y>>v<<v),E=c.N>>v;c.aS(f.posMatrix,0,c.N,0,c.N,0,1),c.$(f.posMatrix,f.posMatrix,[x*E,S*E,0]),c.a0(f.posMatrix,f.posMatrix,[1/2**v,1/2**v,0]),s[l]=f}}return s}getSourceTile(t,s){const l=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&s)for(;h>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(h--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class Vl{constructor(t,s,l){this.painter=t,this.sourceCache=new Nl(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,h=c.N){var f;if(!(s>=0&&s<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),x=(f=v.tile)===null||f===void 0?void 0:f.dem;if(!x)return 0;const S=function(G,K,q){var oe=K[0],we=K[1];return G[0]=q[0]*oe+q[4]*we+q[12],G[1]=q[1]*oe+q[5]*we+q[13],G}([],[s/h*c.N,l/h*c.N],v.u_terrain_matrix),E=[S[0]*x.dim,S[1]*x.dim],I=Math.floor(E[0]),P=Math.floor(E[1]),B=E[0]-I,Z=E[1]-P;return x.get(I,P)*(1-B)*(1-Z)+x.get(I+1,P)*B*(1-Z)+x.get(I,P+1)*(1-B)*Z+x.get(I+1,P+1)*B*Z}getElevationForLngLatZoom(t,s){const{tileID:l,mercatorX:h,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,h%c.N,f%c.N,c.N)}getElevation(t,s,l,h=c.N){return this.getDEMElevation(t,s,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,f=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ae(h,f,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ae(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ao([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const h=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Ae(h,s.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),s.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?f=t.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>f<<f),x=t.canonical.y-(t.canonical.y>>f<<f),S=c.bc(new Float64Array(16),[1/(c.N<<f),1/(c.N<<f),0]);c.$(S,S,[v*c.N,x*c.N,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,h=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ae(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ae(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,v=0;f<this._coordsTextureSize;f++)for(let x=0;x<this._coordsTextureSize;x++,v+=4)s[v+0]=255&x,s[v+1]=255&f,s[v+2]=x>>8<<4|f>>8,s[v+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),h=new Ae(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){const s=new Uint8Array(4),l=this.painter.context,h=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const f=s[0]+(s[2]>>4<<8),v=s[1]+((15&s[2])<<8),x=this.coordsIndex[255-s[3]],S=x&&this.sourceCache.getTileByID(x);if(!S)return null;const E=this._coordsTextureSize,I=(1<<S.tileID.canonical.z)*E;return new c.U(this._allowMercatorOverflow(t,(S.tileID.canonical.x*E+f)/I),(S.tileID.canonical.y*E+v)/I,this.getElevation(S.tileID,f,v,E))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new c.bd,l=new c.b0,h=this.meshSize,f=c.N/h,v=h*h;for(let P=0;P<=h;P++)for(let B=0;B<=h;B++)s.emplaceBack(B*f,P*f,0);for(let P=0;P<v;P+=h+1)for(let B=0;B<h;B++)l.emplaceBack(B+P,h+B+P+1,h+B+P+2),l.emplaceBack(B+P,h+B+P+2,B+P+1);const x=s.length,S=x+2*(h+1);for(const P of[0,1])for(let B=0;B<=h;B++)for(const Z of[0,1])s.emplaceBack(B*f,P*c.N,Z);for(let P=0;P<2*h;P+=2)l.emplaceBack(S+P,S+P+1,S+P+3),l.emplaceBack(S+P,S+P+3,S+P+2),l.emplaceBack(x+P,x+P+3,x+P+1),l.emplaceBack(x+P,x+P+2,x+P+3);const E=s.length,I=E+2*(h+1);for(const P of[0,1])for(let B=0;B<=h;B++)for(const Z of[0,1])s.emplaceBack(P*c.N,B*f,Z);for(let P=0;P<2*h;P+=2)l.emplaceBack(E+P,E+P+1,E+P+3),l.emplaceBack(E+P,E+P+3,E+P+2),l.emplaceBack(I+P,I+P+3,I+P+1),l.emplaceBack(I+P,I+P+2,I+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(s,Qo.members),segments:c.S.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*c.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=c.U.fromLngLat(t.wrap()),h=(1<<s)*c.N,f=l.x*h,v=l.y*h,x=Math.floor(f/c.N),S=Math.floor(v/c.N);return{tileID:new c.O(s,0,s,x,S),mercatorX:f,mercatorY:v}}_allowMercatorOverflow(t,s){const l=t.x<this.painter.width/2;let h=c.bf(s);const f=this.painter.transform.center.lng;return l&&Math.sign(h)>0&&Math.sign(f)<0||!l&&Math.sign(h)<0&&Math.sign(f)>0?(h=360*Math.sign(f)+h,c.G(h)):s}}class zu{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Ae(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Xi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class jl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new zu(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const h=t.sourceCaches[l].getVisibleCoordinates();for(const f of h){const v=this.terrain.sourceCache.getTerrainCoords(f);for(const x in v)this._coordsDescendingInv[l][x]||(this._coordsDescendingInv[l][x]=[]),this._coordsDescendingInv[l][x].push(v[x])}}this._coordsDescendingInvStr={};for(const l of t._order){const h=t._layers[l],f=h.source;if(Xi[h.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const v in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][v]=this._coordsDescendingInv[f][v].map(x=>x.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[h][l.tileID.key];f&&f!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,l=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Xi[s]&&(this._prevType&&Xi[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(Xi[this._prevType]||Xi[s]&&h){this._prevType=s;const f=this._stacks.length-1,v=this._stacks[f]||[];for(const x of this._renderableTiles){if(this.pool.isFull()&&($r(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(x),x.rtt[f]){const E=this.pool.getObjectForId(x.rtt[f].id);if(E.stamp===x.rtt[f].stamp){this.pool.useObject(E);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),x.rtt[f]={id:S.id,stamp:S.stamp},l.context.bindFramebuffer.set(S.fbo.framebuffer),l.context.clear({color:c.aT.transparent,stencil:0}),l.currentStencilSource=void 0;for(let E=0;E<v.length;E++){const I=l.style._layers[v[E]],P=I.source?this._coordsDescendingInv[I.source][x.tileID.key]:[x.tileID];l.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),l._renderTileClippingMasks(I,P),l.renderLayer(l,l.style.sourceCaches[I.source],I,P),I.source&&(x.rttCoords[I.source]=this._coordsDescendingInvStr[I.source][x.tileID.key])}}return $r(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Xi[s]}return!1}}const It=ye,qt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},el=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},tl={showCompass:!0,showZoom:!0,visualizePitch:!1};class bs{constructor(t,s,l=!1){this.mousedown=v=>{this.startMouse(c.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),$.mousePos(this.element,v)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,$.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=La({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:x,bearingDegreesPerPixelMoved:S=.8})=>{const E=new Da;return new is({clickTolerance:x,move:(I,P)=>({bearingDelta:(P.x-I.x)*S}),moveStateManager:E,enable:v,assignEvents:el})})({clickTolerance:h,enable:!0}),this.map=t,l&&(this.mousePitch=$n({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:x,pitchDegreesPerPixelMoved:S=-.5})=>{const E=new Da;return new is({clickTolerance:x,move:(I,P)=>({pitchDelta:(P.y-I.y)*S}),moveStateManager:E,enable:v,assignEvents:el})})({clickTolerance:f,enable:!0})),$.addEventListener(s,"mousedown",this.mousedown),$.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),$.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),$.disableDrag()}moveMouse(t,s){const l=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,s)||{};if(h&&l.setBearing(l.getBearing()+h),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,s){const l=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,s)||{};if(h&&l.setBearing(l.getBearing()+h),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;$.removeEventListener(t,"mousedown",this.mousedown),$.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let pi;function ha(p,t,s){if(p=new c.L(p.lng,p.lat),t){const l=new c.L(p.lng-360,p.lat),h=new c.L(p.lng+360,p.lat),f=s.locationPoint(p).distSqr(t);s.locationPoint(l).distSqr(t)<f?p=l:s.locationPoint(h).distSqr(t)<f&&(p=h)}for(;Math.abs(p.lng-s.center.lng)>180;){const l=s.locationPoint(p);if(l.x>=0&&l.y>=0&&l.x<=s.width&&l.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p}const _i={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function To(p,t,s){const l=p.classList;for(const h in _i)l.remove(`maplibregl-${s}-anchor-${h}`);l.add(`maplibregl-${s}-anchor-${t}`)}class dn extends c.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,h=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!l)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${_i[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${h}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const v=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=v.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div"),this._element.setAttribute("aria-label","Map marker");const s=$.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${h}px`),s.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const f=$.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const v=$.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const x=$.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(3.0, 29.0)"),x.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of S){const we=$.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",oe.rx),we.setAttributeNS(null,"ry",oe.ry),x.appendChild(we)}const E=$.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const I=$.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(I);const P=$.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const B=$.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(B);const Z=$.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const G=$.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=$.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const q=$.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),G.appendChild(K),G.appendChild(q),v.appendChild(x),v.appendChild(E),v.appendChild(P),v.appendChild(Z),v.appendChild(G),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(s),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),To(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ei={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ii=0,Eo=!1;const ns={maxWidth:100,unit:"metric"};function Us(p,t,s){const l=s&&s.maxWidth||100,h=p._container.clientHeight/2,f=p.unproject([0,h]),v=p.unproject([l,h]),x=f.distanceTo(v);if(s&&s.unit==="imperial"){const S=3.2808*x;S>5280?qn(t,l,S/5280,p._getUIString("ScaleControl.Miles")):qn(t,l,S,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?qn(t,l,x/1852,p._getUIString("ScaleControl.NauticalMiles")):x>=1e3?qn(t,l,x/1e3,p._getUIString("ScaleControl.Kilometers")):qn(t,l,x,p._getUIString("ScaleControl.Meters"))}function qn(p,t,s,l){const h=function(f){const v=Math.pow(10,`${Math.floor(f)}`.length-1);let x=f/v;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(S){const E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E}(x),v*x}(s);p.style.width=t*(h/s)+"px",p.innerHTML=`${h}&nbsp;${l}`}const Co={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ss(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,p),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-p),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(p,0),right:new c.P(-p,0)}}if(p instanceof c.P||Array.isArray(p)){const t=c.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(p.center||[0,0]),top:c.P.convert(p.top||[0,0]),"top-left":c.P.convert(p["top-left"]||[0,0]),"top-right":c.P.convert(p["top-right"]||[0,0]),bottom:c.P.convert(p.bottom||[0,0]),"bottom-left":c.P.convert(p["bottom-left"]||[0,0]),"bottom-right":c.P.convert(p["bottom-right"]||[0,0]),left:c.P.convert(p.left||[0,0]),right:c.P.convert(p.right||[0,0])}}return ss(new c.P(0,0))}const Ss={extend:(p,...t)=>c.e(p,...t),run(p){p()},logToElement(p,t=!1,s="log"){const l=window.document.getElementById(s);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${p}`)}},Zr=ye;class $t{static get version(){return Zr}static get workerCount(){return ui.workerCount}static set workerCount(t){ui.workerCount=t}static get maxParallelImageRequests(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){c.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return c.c.WORKER_URL}static set workerUrl(t){c.c.WORKER_URL=t}static addProtocol(t,s){c.c.REGISTERED_PROTOCOLS[t]=s}static removeProtocol(t){delete c.c.REGISTERED_PROTOCOLS[t]}}return $t.Map=class extends Au{constructor(p){if(c.bg.mark(c.bh.create),(p=c.e({},qt,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new go(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Jo,this._controls=[],this._mapId=c.a2(),this._locale=c.e({},ko,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=je.addThrottleControl(()=>this.isMoving()),this._requestManager=new Lt(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=Ns(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?s(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ca(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new yo(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,c.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Pn({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new Yr,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new c.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new c.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new c.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,s,l)}resize(p){var t;const s=this._containerDimensions(),l=s[0],h=s[1],f=this._getClampedPixelRatio(l,h);if(this._resizeCanvas(l,h,f),this.painter.resize(l,h,f),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(l,h);this._resizeCanvas(l,h,S),this.painter.resize(l,h,S)}this.transform.resize(l,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,h);const v=!this._moving;return v&&(this.stop(),this.fire(new c.k("movestart",p)).fire(new c.k("move",p))),this.fire(new c.k("resize",p)),v&&this.fire(new c.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:s,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),f=p*h,v=t*h;return Math.min(f>s?s/f:1,v>l?l/v:1)*h}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Ne.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(p){return this.transform.locationPoint(c.L.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(c.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:f=>{const v=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];v.length?l||(l=!0,s.call(this,new Ki(p,this,f.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,s.call(this,new Ki(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Ki(p,this,v.originalEvent)))}}}}{const l=h=>{const f=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];f.length&&(h.features=f,s.call(this,h),delete h.features)};return{layer:t,listener:s,delegates:{[p]:l}}}}on(p,t,s){if(s===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const h in l.delegates)this.on(h,l.delegates[h]);return this}once(p,t,s){if(s===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,s);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(p,t,s){return s===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const h=this._delegatedListeners[p];for(let f=0;f<h.length;f++){const v=h[f];if(v.layer===t&&v.listener===s){for(const x in v.delegates)this.off(x,v.delegates[x]);return h.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let s;const l=p instanceof c.P||Array.isArray(p),h=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},h instanceof c.P||typeof h[0]=="number")s=[c.P.convert(h)];else{const f=c.P.convert(h[0]),v=c.P.convert(h[1]);s=[f,new c.P(v.x,f.y),v,new c.P(f.x,v.y),f]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Wi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,s):this.style.loadJSON(p,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,pt.Style);c.f(s,(l,h)=>{l?this.fire(new c.j(l)):h&&this._updateDiff(h,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(s){c.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new c.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Vl(this.painter,t,p),this.painter.renderToTexture=new jl(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const s=p[t]._tiles;for(const l in s){const h=s[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}addSourceType(p,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,s)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,s={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:f,stretchY:v,content:x}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:E,data:I}=t,P=t;return this.style.addImage(p,{data:new c.R({width:S,height:E},new Uint8Array(I)),pixelRatio:l,stretchX:f,stretchY:v,content:x,sdf:h,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p),this}}{const{width:S,height:E,data:I}=c.h.getImageData(t);this.style.addImage(p,{data:new c.R({width:S,height:E},I),pixelRatio:l,stretchX:f,stretchY:v,content:x,sdf:h,version:0})}}updateImage(p,t){const s=this.style.getImage(p);if(!s)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||c.a(t)?c.h.getImageData(t):t,{width:h,height:f,data:v}=l;if(h===void 0||f===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==s.data.width||f!==s.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(t instanceof HTMLImageElement||c.a(t));return s.data.replace(v,x),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){je.getImage(this._requestManager.transformRequest(p,pt.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,s){return this.style.setLayerZoomRange(p,t,s),this._update(!0)}setFilter(p,t,s={}){return this.style.setFilter(p,t,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,s,l={}){return this.style.setPaintProperty(p,t,s,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,s,l={}){return this.style.setLayoutProperty(p,t,s,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,s,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,s=>{s||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=$.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const h=this._controlContainer=$.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{f[v]=$.create("div",`maplibregl-ctrl-${v} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=$.create("div","maplibregl-cooperative-gesture-screen",this._container);let p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){$.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(p,t,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Aa(s,this.transform),Le.testSupport(s)}_onCooperativeGesture(p,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,f=c.h.now();this.style.zoomHistory.update(h,f);const v=new c.a8(h,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),x=v.crossFadingFactor();x===1&&x===this._crossFadingFactor||(s=!0,this._crossFadingFactor=x),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bg.mark(c.bh.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,c.bg.mark(c.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),je.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),c.bg.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.h.frame(p=>{c.bg.frame(p),this._frame=null,this._render(p)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return It}getCameraTargetElevation(){return this.transform.elevation}},$t.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=c.e({},tl,p),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const s=$.create("button",p,this._container);return s.type="button",s.addEventListener("click",t),s}},$t.GeolocateControl=class extends c.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new c.L(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),f=c.e({bearing:h},this.options.fitBoundsOptions),v=Ne.fromLngLat(s,l);this._map.fitBounds(v,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new c.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Eo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dn({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},ei,p)}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,s=!1){pi===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{pi=l.state!=="denied",t(pi)}).catch(()=>{pi=!!window.navigator.geolocation,t(pi)}):(pi=!!window.navigator.geolocation,t(pi)):t(pi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ii=0,Eo=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),s=p.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),s=p.getNorthEast(),l=t.distanceTo(s),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ii--,Eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ii++,ii>1?(p={maximumAge:6e5,timeout:0},Eo=!0):(p=this.options.positionOptions,Eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},$t.AttributionControl=Pn,$t.LogoControl=Yr,$t.ScaleControl=class{constructor(p){this._onMove=()=>{Us(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Us(this._map,this._container,this.options)},this.options=c.e({},ns,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},$t.FullscreenControl=class extends c.E{constructor(p={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},$t.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=p}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},$t.Popup=class extends c.E{constructor(p){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const s=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const h=ss(this.options.offset);if(!l){const v=this._container.offsetWidth,x=this._container.offsetHeight;let S;S=s.y+h.bottom.y<x?["top"]:s.y>this._map.transform.height-x?["bottom"]:[],s.x<v/2?S.push("left"):s.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}const f=s.add(h[l]).round();$.setTransform(this._container,`${_i[l]} translate(${f.x}px,${f.y}px)`),To(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Co),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=c.L.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(rl);p&&p.focus()}},$t.Marker=dn,$t.Style=Wi,$t.LngLat=c.L,$t.LngLatBounds=Ne,$t.Point=c.P,$t.MercatorCoordinate=c.U,$t.Evented=c.E,$t.AJAXError=c.bi,$t.config=c.c,$t.CanvasSource=Tr,$t.GeoJSONSource=_t,$t.ImageSource=rr,$t.RasterDEMTileSource=lr,$t.RasterTileSource=Zt,$t.VectorTileSource=Nt,$t.VideoSource=ir,$t.setRTLTextPlugin=c.bj,$t.getRTLTextPluginStatus=c.bk,$t.prewarm=function(){Ui().acquire(Kt)},$t.clearPrewarmedResources=function(){const p=Kr;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Kt),Kr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ss.extend($t,{isSafari:c.ac,getPerformanceMetrics:c.bg.getPerformanceMetrics}),$t});var xe=Y;return xe})}(Gd)),Gd.exports}var Yg=Xg();const Dp=ed(Yg),Jg=A=>{const D=$e.useRef(null),z=$e.useRef(null),[j,Y]=$e.useState(null),[ce,xe]=$e.useState(null),[c,ye]=$e.useState(null),[$,Le]=$e.useState(!1),[Me,Ce]=$e.useState(!1),{visitedPlaces:xt,markPlaceAsVisited:Je,initializeStore:at}=Zp(),je=$e.useCallback(Dt=>{console.log("",Dt),Je(Dt),z.current&&z.current.remove()},[Je]);$e.useEffect(()=>{console.log(""),at(),Ce("ontouchstart"in window||navigator.maxTouchPoints>0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(Dt=>{const{longitude:Rt,latitude:ft}=Dt.coords;xe([Rt,ft])},Dt=>{console.log(":",Dt),xe([139.7528,35.6852])}):xe([139.7528,35.6852])},[at]);const pt=$e.useCallback(Dt=>{if(!D.current||!$||!Dt.features||Dt.features.length===0)return;const ft=Dt.features[0].properties.ISO_A2;if(c!==ft){if(c)try{D.current.setFeatureState({source:"countries",sourceLayer:"",id:c},{hover:!1})}catch(le){console.error(":",le)}try{D.current.setFeatureState({source:"countries",sourceLayer:"",id:ft},{hover:!0}),console.log(` ${ft} `)}catch(le){console.error(":",le)}ye(ft)}},[c,$]),Lt=$e.useCallback(()=>{if(!(!D.current||!$||!c)){try{D.current.setFeatureState({source:"countries",sourceLayer:"",id:c},{hover:!1}),console.log(` ${c} `)}catch(Dt){console.error(":",Dt)}ye(null)}},[c,$]),Ot=$e.useCallback(Dt=>{if(!D.current||!$||!Dt.features||Dt.features.length===0)return;const ft=Dt.features[0].properties;console.log(":",ft.ADMIN);const le={uniqueId:ft.ISO_A2,placeName:ft.ADMIN,adminLevel:"Country",countryCodeISO:ft.ISO_A2};Y(le);const ve=`
      <div class="map-popup">
        <h3>${ft.ADMIN}</h3>
        <button class="mark-visited-btn" id="mark-visited-${ft.ISO_A2}"></button>
      </div>
    `;z.current.setLngLat(Dt.lngLat).setHTML(ve).addTo(D.current),setTimeout(()=>{const Ae=document.getElementById(`mark-visited-${ft.ISO_A2}`);Ae?Ae.addEventListener("click",()=>{console.log(":",le),je(le)}):console.error("")},100)},[je,$]);$e.useEffect(()=>{if(D.current||!A.current)return;console.log("");const Dt=ce||[139,35];return D.current=new Dp.Map({container:A.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:Dt,zoom:3,touchZoomRotate:!0,dragPan:!0,doubleClickZoom:!0,touchPitch:!0,inertia:{duration:500,speedFactor:.7}}),D.current.touchZoomRotate.enable(),D.current.dragPan.enable({inertia:!0,linearity:.3}),z.current=new Dp.Popup({closeButton:!1,closeOnClick:!0,anchor:"bottom",offset:[0,-10]}),D.current.on("load",()=>{console.log(""),D.current.addSource("countries",{type:"geojson",data:"https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson",generateId:!0});const Rt=xt.filter(ft=>ft.countryCodeISO).map(ft=>ft.countryCodeISO);console.log(":",Rt),D.current.addLayer({id:"countries-fill",type:"fill",source:"countries",paint:{"fill-color":["case",["boolean",["feature-state","hover"],!1],"#69b3dd",["case",["in",["get","ISO_A2"],["literal",Rt]],"#ADD8E6","rgba(0, 0, 0, 0)"]],"fill-opacity":["case",["boolean",["feature-state","hover"],!1],.9,.7]}}),D.current.addLayer({id:"countries-outline",type:"line",source:"countries",paint:{"line-color":"#627BC1","line-width":1}}),Me?(D.current.on("touchstart","countries-fill",pt),D.current.on("touchend","countries-fill",ft=>{setTimeout(Lt,1e3)})):(D.current.on("mousemove","countries-fill",pt),D.current.on("mouseleave","countries-fill",Lt)),D.current.on("click","countries-fill",Ot),Me||(D.current.on("mouseenter","countries-fill",()=>{D.current.getCanvas().style.cursor="pointer"}),D.current.on("mouseleave","countries-fill",()=>{D.current.getCanvas().style.cursor=""})),ce&&(D.current.flyTo({center:ce,zoom:5,speed:1.5,curve:1.5}),new Dp.Marker({color:"#e74c3c"}).setLngLat(ce).addTo(D.current)),Le(!0)}),()=>{D.current&&(D.current.getLayer("countries-fill")&&(Me?(D.current.off("touchstart","countries-fill",pt),D.current.off("touchend","countries-fill")):(D.current.off("mousemove","countries-fill",pt),D.current.off("mouseleave","countries-fill",Lt)),D.current.off("click","countries-fill",Ot)),D.current.remove(),D.current=null,Le(!1))}},[A,xt,ce,je,pt,Lt,Ot,Me]),$e.useEffect(()=>{if(!(!D.current||!$||!D.current.getLayer("countries-fill")))try{const Dt=xt.filter(Rt=>Rt.countryCodeISO).map(Rt=>Rt.countryCodeISO);console.log(":",Dt),D.current.setPaintProperty("countries-fill","fill-color",["case",["boolean",["feature-state","hover"],!1],"#69b3dd",["case",["in",["get","ISO_A2"],["literal",Dt]],"#ADD8E6","rgba(0, 0, 0, 0)"]])}catch(Dt){console.error(":",Dt)}},[xt,$]);const Ut=$e.useCallback(()=>{!D.current||!ce||D.current.flyTo({center:ce,zoom:5,speed:1.5})},[ce]);return{map:D,selectedFeature:j,userLocation:ce,flyToUserLocation:Ut,isTouchDevice:Me}},Qg=({onExportClick:A,onImportClick:D,userLocation:z,onLocationClick:j})=>Ke.jsxs("div",{className:"map-controls",role:"toolbar","aria-label":"",children:[Ke.jsx("button",{className:"map-control-button",onClick:A,title:"CSV","aria-label":"CSV",children:Ke.jsx("span",{className:"material-icons","aria-hidden":"true",children:"file_download"})}),Ke.jsx("button",{className:"map-control-button",onClick:D,title:"CSV","aria-label":"CSV",children:Ke.jsx("span",{className:"material-icons","aria-hidden":"true",children:"file_upload"})}),z&&Ke.jsx("button",{className:"map-control-button",onClick:j,title:"","aria-label":"",children:Ke.jsx("span",{className:"material-icons","aria-hidden":"true",children:"my_location"})})]}),qf=({isOpen:A,onClose:D,onSubmit:z})=>{const j=$e.useRef(null);if(!A)return null;const Y=c=>{c.preventDefault();const ye=j.current.files[0];z(ye)},ce=c=>{c.key==="Escape"&&D()},xe=c=>{c.target.className==="import-overlay"&&D()};return Ke.jsx("div",{className:"import-overlay",onClick:xe,onKeyDown:ce,role:"dialog","aria-modal":"true","aria-labelledby":"import-title",children:Ke.jsxs("div",{className:"import-container",children:[Ke.jsx("h3",{id:"import-title",children:"CSV"}),Ke.jsxs("form",{onSubmit:Y,children:[Ke.jsxs("div",{className:"form-group",children:[Ke.jsx("label",{htmlFor:"csvFile",children:"CSV"}),Ke.jsx("input",{type:"file",id:"csvFile",name:"csvFile",ref:j,accept:".csv",required:!0,"aria-required":"true","aria-describedby":"file-format-help"}),Ke.jsx("small",{id:"file-format-help",className:"form-text text-muted",children:"My World AtlasCSV"})]}),Ke.jsxs("div",{className:"form-actions",children:[Ke.jsx("button",{type:"button",className:"btn btn-secondary",onClick:D,children:""}),Ke.jsx("button",{type:"submit",className:"btn btn-primary",children:""})]})]})]})})};function Zf({show:A,message:D,type:z="info",onClose:j}){return $e.useEffect(()=>{if(A){const Y=setTimeout(()=>{j&&j()},3e3);return()=>clearTimeout(Y)}},[A,j]),A?Ke.jsx("div",{className:`toast ${z} ${A?"show":""}`,children:Ke.jsx("p",{children:D})}):null}function ey(){const A=$e.useRef(null),[D,z]=$e.useState(!1),{toast:j,showToast:Y,exportToCSV:ce,importFromCSV:xe}=Zp(),{userLocation:c,flyToUserLocation:ye}=Jg(A),$=Le=>{if(!Le){Y("","warning");return}xe(Le),z(!1)};return $e.useEffect(()=>(document.body.classList.add("map-view-active"),()=>{document.body.classList.remove("map-view-active")}),[]),Ke.jsxs("div",{className:"map-view",children:[Ke.jsx("div",{ref:A,className:"map-container"}),Ke.jsx(Qg,{onExportClick:ce,onImportClick:()=>z(!0),userLocation:c,onLocationClick:ye}),Ke.jsx(qf,{isOpen:D,onClose:()=>z(!1),onSubmit:$}),Ke.jsx(Zf,{show:j.show,message:j.message,type:j.type})]})}const ty=({filter:A,onFilterChange:D,adminFilter:z,onAdminFilterChange:j})=>Ke.jsxs("div",{className:"filter-controls",children:[Ke.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:A,onChange:Y=>D(Y.target.value),"aria-label":""}),Ke.jsxs("select",{className:"admin-filter",value:z,onChange:Y=>j(Y.target.value),"aria-label":"",children:[Ke.jsx("option",{value:"all",children:""}),Ke.jsx("option",{value:"Country",children:""}),Ke.jsx("option",{value:"State",children:""})]})]}),ry=({onExportClick:A,onImportClick:D})=>Ke.jsxs("div",{className:"action-buttons",children:[Ke.jsx("button",{className:"btn btn-sm",onClick:A,"aria-label":"CSV",children:""}),Ke.jsx("button",{className:"btn btn-sm",onClick:D,"aria-label":"CSV",children:""})]}),iy=({place:A,onRowClick:D,onDeleteClick:z})=>{const j=ce=>ce?new Date(ce).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Y=ce=>{ce.stopPropagation(),z(A.uniqueId,A.placeName)};return Ke.jsxs("tr",{className:"list-row",onClick:()=>D(A),children:[Ke.jsx("td",{children:A.placeName}),Ke.jsx("td",{children:A.adminLevel==="Country"?"":""}),Ke.jsx("td",{children:j(A.dateMarked)}),Ke.jsx("td",{children:Ke.jsx("button",{className:"delete-btn",onClick:Y,title:"","aria-label":`${A.placeName}`,children:""})})]})},ny=({isOpen:A,title:D="",message:z,confirmText:j="",cancelText:Y="",onConfirm:ce,onCancel:xe})=>{if(!A)return null;const c=ye=>{ye.stopPropagation()};return Ke.jsx("div",{className:"confirm-overlay",onClick:xe,children:Ke.jsxs("div",{className:"confirm-dialog",onClick:c,children:[Ke.jsx("div",{className:"confirm-header",children:Ke.jsx("h3",{children:D})}),Ke.jsx("div",{className:"confirm-body",children:Ke.jsx("p",{children:z})}),Ke.jsxs("div",{className:"confirm-footer",children:[Ke.jsx("button",{className:"btn btn-secondary",onClick:xe,children:Y}),Ke.jsx("button",{className:"btn btn-danger",onClick:ce,children:j})]})]})})};function sy(){const A=$p(),{visitedPlaces:D,initializeStore:z,toast:j,removePlaceVisit:Y,exportToCSV:ce,importFromCSV:xe,showToast:c}=Zp(),[ye,$]=$e.useState("dateMarked"),[Le,Me]=$e.useState("desc"),[Ce,xt]=$e.useState(""),[Je,at]=$e.useState("all"),[je,pt]=$e.useState(!1),[Lt,Ot]=$e.useState({isOpen:!1,uniqueId:null,placeName:""});$e.useEffect(()=>{z()},[z]);const Ut=$e.useMemo(()=>{let ct=[...D];if(Je!=="all"&&(ct=ct.filter(Wt=>Wt.adminLevel===Je)),Ce){const Wt=Ce.toLowerCase();ct=ct.filter(dr=>dr.placeName.toLowerCase().includes(Wt)||dr.uniqueId.toLowerCase().includes(Wt))}return ct.sort((Wt,dr)=>{let pr=Wt[ye],yt=dr[ye];if(typeof pr=="string"&&typeof yt=="string"){const Ue=pr.localeCompare(yt,"ja");return Le==="asc"?Ue:-Ue}return pr<yt?Le==="asc"?-1:1:pr>yt?Le==="asc"?1:-1:0})},[D,ye,Le,Ce,Je]),Dt=$e.useCallback(ct=>{ye===ct?Me(Le==="asc"?"desc":"asc"):($(ct),Me("asc"))},[ye,Le]),Rt=$e.useCallback(su(ct=>{A("/")},ct=>{c("","error")}),[A,c]),ft=$e.useCallback((ct,Wt)=>{Ot({isOpen:!0,uniqueId:ct,placeName:Wt})},[]),le=$e.useCallback(()=>{Lt.uniqueId&&Y(Lt.uniqueId),Ot({isOpen:!1,uniqueId:null,placeName:""})},[Lt.uniqueId,Y]),ve=$e.useCallback(()=>{Ot({isOpen:!1,uniqueId:null,placeName:""})},[]),Ae=$e.useCallback(ct=>{if(!ct){c("","warning");return}xe(ct),pt(!1)},[xe,c]),mt=$e.useCallback(ct=>{xt(ct)},[]),ot=$e.useCallback(ct=>{at(ct)},[]);return Ke.jsxs("div",{className:"list-view",children:[Ke.jsxs("div",{className:"list-controls",children:[Ke.jsx(ty,{filter:Ce,onFilterChange:mt,adminFilter:Je,onAdminFilterChange:ot}),Ke.jsx(ry,{onExportClick:ce,onImportClick:()=>pt(!0)})]}),Ke.jsx("div",{className:"table-container",children:Ke.jsxs("table",{className:"list-table","aria-label":"",children:[Ke.jsx("thead",{children:Ke.jsxs("tr",{children:[Ke.jsx("th",{className:ye==="placeName"?`sorted-${Le}`:"",onClick:()=>Dt("placeName"),"aria-sort":ye==="placeName"?Le==="asc"?"ascending":"descending":"none",children:""}),Ke.jsx("th",{className:ye==="adminLevel"?`sorted-${Le}`:"",onClick:()=>Dt("adminLevel"),"aria-sort":ye==="adminLevel"?Le==="asc"?"ascending":"descending":"none",children:""}),Ke.jsx("th",{className:ye==="dateMarked"?`sorted-${Le}`:"",onClick:()=>Dt("dateMarked"),"aria-sort":ye==="dateMarked"?Le==="asc"?"ascending":"descending":"none",children:""}),Ke.jsx("th",{children:""})]})}),Ke.jsx("tbody",{children:Ut.length===0?Ke.jsx("tr",{children:Ke.jsx("td",{colSpan:"4",className:"empty-message",children:Ce||Je!=="all"?"":""})}):Ut.map(ct=>Ke.jsx(iy,{place:ct,onRowClick:Rt,onDeleteClick:ft},ct.uniqueId))})]})}),Ke.jsx("div",{className:"list-counter","aria-live":"polite",children:Ut.length>0&&Ke.jsx("p",{children:Je==="all"?`: ${Ut.length}`:`${Je==="Country"?"":""}: ${Ut.length}`})}),Ke.jsx(qf,{isOpen:je,onClose:()=>pt(!1),onSubmit:Ae}),Ke.jsx(ny,{isOpen:Lt.isOpen,title:"",message:`${Lt.placeName}`,confirmText:"",cancelText:"",onConfirm:le,onCancel:ve}),Ke.jsx(Zf,{show:j.show,message:j.message,type:j.type})]})}function ay(){return Ke.jsx("header",{className:"header",children:Ke.jsxs("div",{className:"container header-container",children:[Ke.jsx("h1",{className:"logo",children:Ke.jsx(kp,{to:"/",children:"My World Atlas"})}),Ke.jsx("nav",{className:"nav",children:Ke.jsxs("ul",{className:"nav-list",children:[Ke.jsx("li",{className:"nav-item",children:Ke.jsx(kp,{to:"/",className:({isActive:A})=>A?"nav-link active":"nav-link",end:!0,children:""})}),Ke.jsx("li",{className:"nav-item",children:Ke.jsx(kp,{to:"/list",className:({isActive:A})=>A?"nav-link active":"nav-link",children:""})})]})})]})})}class oy extends Kd.Component{constructor(D){super(D),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(D){return{hasError:!0}}componentDidCatch(D,z){this.setState({error:D,errorInfo:z}),console.error("ErrorBoundary caught an error:",D,z)}render(){return this.state.hasError?Ke.jsxs("div",{className:"error-boundary",children:[Ke.jsx("h2",{children:""}),Ke.jsx("p",{children:""}),Ke.jsx("p",{children:""}),Ke.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:""}),this.props.showDetails&&Ke.jsxs("details",{className:"error-details",children:[Ke.jsx("summary",{children:""}),Ke.jsx("p",{children:this.state.error&&this.state.error.toString()}),Ke.jsx("pre",{children:this.state.errorInfo&&this.state.errorInfo.componentStack})]})]}):this.props.children}}function ly(){return Ke.jsxs("div",{className:"app",children:[Ke.jsx(ay,{}),Ke.jsx("main",{className:"main-content",children:Ke.jsx(oy,{showDetails:!1,children:Ke.jsxs(ng,{children:[Ke.jsx(qd,{path:"/",element:Ke.jsx(ey,{})}),Ke.jsx(qd,{path:"/list",element:Ke.jsx(sy,{})}),Ke.jsx(qd,{path:"*",element:Ke.jsx(rg,{to:"/",replace:!0})})]})})})]})}fm.createRoot(document.getElementById("root")).render(Ke.jsx(Kd.StrictMode,{children:Ke.jsx(dg,{children:Ke.jsx(ly,{})})}));
//# sourceMappingURL=index-CXJWMAdh.js.map
